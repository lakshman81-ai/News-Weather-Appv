import{r as Cs,a as Es,b as y,L as De,g as Ts,R as Ln,u as kt,c as Is,d as On,N as As,H as Ms,e as Rs,f as de}from"./vendor-react-hF7JAobB.js";import{r as Ds}from"./utils-sentiment-EAYl0nxh.js";import{G as Te}from"./vendor-ui-Dm16880k.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();var pt={exports:{}},$e={};var Dt;function Ls(){if(Dt)return $e;Dt=1;var e=Cs(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var h,u={},g=null,p=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(p=c.ref);for(h in c)i.call(c,h)&&!r.hasOwnProperty(h)&&(u[h]=c[h]);if(l&&l.defaultProps)for(h in c=l.defaultProps,c)u[h]===void 0&&(u[h]=c[h]);return{$$typeof:n,type:l,key:g,ref:p,props:u,_owner:a.current}}return $e.Fragment=s,$e.jsx=o,$e.jsxs=o,$e}var Lt;function Os(){return Lt||(Lt=1,pt.exports=Ls()),pt.exports}var t=Os(),Xe={},Ot;function Fs(){if(Ot)return Xe;Ot=1;var e=Es();return Xe.createRoot=e.createRoot,Xe.hydrateRoot=e.hydrateRoot,Xe}var $s=Fs();const be={SETTINGS:"dailyEventAI_settings",LAST_REFRESH:"dailyEventAI_lastRefresh",CACHED_DATA:"dailyEventAI_cachedData",ARTICLE_VIEWS:"dailyEventAI_articleViews"},Fn="/api",oe={uiMode:"timeline",customSortTopStories:!0,theme:"dark",fontSize:26,freshnessLimitHours:36,hideOlderThanHours:60,weatherFreshnessLimit:4,strictFreshness:!0,filteringMode:"source",rankingMode:"smart",rankingWeights:{temporal:{weekendBoost:2,entertainmentBoost:2.5},geo:{cityMatch:1.5,maxScore:5},freshness:{decayHours:26,maxBoost:3},impact:{boost:1,highImpactBoost:2.5},visual:{videoBoost:1.3,imageBoost:1.15},sentiment:{positiveBoost:.5,negativeBoost:.3},keyword:{matchBoost:2},source:{tier1Boost:.25,tier2Boost:.15,tier3Boost:0},viewedPenalty:.4,trending:{threshold:12},audit:{consensusThreshold:2,anomalySigma:2}},buzzRankingWeights:{visual:{videoBoost:2,imageBoost:1.5},freshness:{decayHours:12,maxBoost:2},trending:{threshold:10}},buzz:{entertainment:{enabled:!0,positiveKeywords:["tamil","kollywood","hindi","bollywood","hollywood","ott","netflix","prime video","disney","hotstar"],positiveMultiplier:2,negativeKeywords:["gossip","rumour","dating","spotted"],negativeMultiplier:2,filterThreshold:0},technology:{enabled:!0,positiveKeywords:["startup","ai","artificial intelligence","innovation","funding","launch","generative ai","llm"],positiveMultiplier:2,negativeKeywords:["rumour","leak","speculation"],negativeMultiplier:2,filterThreshold:0},sports:{enabled:!0,positiveKeywords:["cricket","football","ipl","world cup","india vs","final","highlights"],positiveMultiplier:2,negativeKeywords:["opinion","blog"],negativeMultiplier:2,filterThreshold:0}},weather:{models:{ecmwf:!0,gfs:!0,icon:!0},cities:["chennai","trichy","muscat"],showHumidity:!0,showWind:!1},sections:{world:{enabled:!0,count:5},india:{enabled:!0,count:5},chennai:{enabled:!0,count:5},trichy:{enabled:!0,count:5},local:{enabled:!0,count:5},social:{enabled:!0,count:25},entertainment:{enabled:!0,count:5},business:{enabled:!0,count:5},technology:{enabled:!0,count:5},sports:{enabled:!0,count:5}},newsSources:{bbc:!0,reuters:!0,ndtv:!0,theHindu:!0,toi:!0,financialExpress:!0,dtNext:!0,omanObserver:!0,moneyControl:!0,variety:!0,hollywoodReporter:!0,bollywoodHungama:!0,filmCompanion:!0,indiaToday:!0,timesOfOman:!0},sourceTiers:{tier1:["BBC","Reuters","TechCrunch","The Verge","ESPN"],tier2:["NDTV","The Hindu","Times of India","Moneycontrol","Indian Express"],tier3:["Oman Observer","DT Next","Bollywood Hungama"]},market:{showIndices:!0,showGainers:!0,showLosers:!0,showMutualFunds:!0,showIPO:!0,showSectorals:!0,showCommodities:!0,showCurrency:!0,showFIIDII:!0,cacheMinutes:15},entertainment:{tamilCount:5,hindiCount:5,hollywoodCount:3,ottCount:2},socialTrends:{worldCount:8,indiaCount:8,tamilnaduCount:5,muscatCount:4},customFeeds:[],feedBlockedKeywords:[],highImpactKeywords:["Budget","Election","Summit","Treaty","War","Crash","Landfall","Verdict","Resigns","Assassination"],upAhead:{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},ranking:{movies:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},events:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},festivals:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},sports:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},shopping:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},airlines:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},weather_alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},civic:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0}},locations:["Chennai","Muscat"],customLocation:"",signals:["upcoming","scheduled","starting","launches","opens","begins","commences","from today","this weekend","next week","releasing","premieres","debuts","kicks off","set to","slated for","expected on","effective from","valid till","last date","deadline","registrations open","bookings open","doors open","book now","tickets available","grab your","register","rsvp","sign up","enroll","apply before","limited seats","early bird","pre-order","advance booking","buy tickets","entry free","venue","stadium","auditorium","convention centre","exhibition hall","multiplex","arena","grounds","schedule","timetable","lineup","itinerary","match day","race day","show timings","showtimes","time slot","batch"],keywords:{movies:["release date","releasing","release","in theatres","in theaters","first day","advance booking","fdfs","premiere","preview","sneak peek","special screening","ott release","streaming from","now streaming","available on","direct to ott","digital premiere","tickets","showtimes","book now","bookmyshow","ticketnew","paytm movies","trailer launch","teaser release","motion poster"],events:["concert","live music","standup","comedy show","theatre","theater","drama","stage play","dance recital","sabha","kutcheri","kutchery","exhibition","expo","book fair","trade fair","flea market","art gallery","trade show","workshop","masterclass","bootcamp","seminar","webinar","hackathon","meetup","food festival","pop-up","tasting","brunch","food walk","heritage walk","night market","entry fee","passes available","gate open","limited slots","registration"],sports:[" vs "," v/s ","match","fixture","squad announced","playing xi","toss","innings","schedule","points table","qualifier","semi final","final","playoffs","stadium","live on","broadcast","streaming","start time","kick off","first ball"],festivals:["holiday","bank holiday","gazetted","declared holiday","government holiday","pongal","diwali","deepavali","navratri","dussehra","eid","ramadan","christmas","onam","vishu","ugadi","holi","ganesh","jayanti","puja","pooja","thai pusam","observed on","falls on","celebrated on","auspicious","muhurtham","tithi"],shopping:["sale","mega sale","flash sale","clearance","end of season","flat discount","upto off","cashback","coupon","promo code","shopping festival","exhibition sale","trade fair","grand opening","limited period","ends today","last day","offer valid","while stocks last","hurry"],airlines:["oman air","goindigo","salam air","ticket offer","flight deal","air india","vistara","akasa air","fare sale","booking open"],alerts:["power cut","power shutdown","load shedding","tangedco","tneb","scheduled maintenance","water cut","water supply","disruption","traffic advisory","road closure","diversion","metro shutdown","bus route change","train cancelled","flight delayed","boil water advisory","mosquito fogging","tree trimming","construction zone"],weather_alerts:["warning","alert","advisory","watch","red alert","orange alert","yellow alert","heavy rain","very heavy rain","cyclone","thunderstorm","heat wave","cold wave","fog","flooding","high tide","storm surge","imd","met department","weather bulletin"],civic:["vip movement","vip visit","road block","security arrangement","route change","bandh","hartal","strike","protest march","rasta roko","rail roko","corporation notice","tender","public hearing","ward meeting","grievance day"],movies_negative:["review","reviewed","reviews","opinion","editorial","column","interview","gossip","rumour","rumor","spotted","dating","controversy","trolled","slammed","reacts","reaction","leaked","wardrobe malfunction","breakup","case explained","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","promo shoot","shooting begins","wrapped up","schedule wrap","title reveal","first look","motion poster","cast revealed","plot leaked","producer","director","music director","remuneration","salary","budget","rights sold","satellite rights","audio launch","pre-release event","success meet","press meet","renamed","casts","court","petition","arrested","stealing","sewage","overflow","warns against","talks","deal","financial results","board meeting","did for free","bank holiday alert","check full list","divorce","decommission","released crore","schedules board meeting","fog","mist"],events_negative:["cancelled","postponed","webinar","virtual only","legacy","tribute","obituary"],sports_negative:["rumour","speculation","opinion","prediction","predictions","bracketology","power rankings","fantasy value"],festivals_negative:[],shopping_negative:["expired","sold out"],airlines_negative:["accident","crash","emergency landing","technical snag"],alerts_negative:["rumour","hoax","fake news"],civic_negative:["clinic","surgery","transplant","arrested","held"],negative:["review","reviewed","reviews","opinion","editorial","column","op-ed","analysis","deep dive","explainer","explained","interview","memoir","podcast","recap","retrospective","lookback","throwback","gossip","rumour","rumor","spotted","dating","divorce","controversy","trolled","slammed","reacts","reaction","claps back","feud","leaked","wardrobe malfunction","breakup","arrested","murder","stabbed","robbery","scam","fraud","accused","chargesheet","sentenced","bail","fir filed","kidnap","suicide","death toll","fatal","quarterly results","earnings call","dividend","stock split","ipo allotment","listing gains","shareholding pattern","promoter stake","mutual fund nav","portfolio rebalancing","alleges","slams","hits out","war of words","defamation","no confidence","horse trading","exit poll","poll prediction","meme","was held","concluded","wrapped up","came to an end","successfully completed","inaugurated by","flagged off","took place","was celebrated","passes away","passed away","demise","rip","condolences","last rites","funeral","pays tribute","mourns","obituary","top 10","top 5","best of","worst of","reasons why","things you","ranked","all you need to know","everything we know","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","shocking","you won't believe","jaw dropping","gone viral","breaks the internet","exclusive","board meeting","financial results","quarterly results","dividend","earnings call","stock split","bonus issue","record date","schedules board meeting","to consider","fund raising","petrol price","price hike","title reveal","first look","renamed","locks release date","casts","producer","court","petition","arrested","stealing","sewage","warns","talks","deal","did for free","bank holiday alert","check full list","decommission","fog","mist","opens office","launches","inaugurated","reveals"]}},sectionOverrides:{},newspaper:{enableImages:!0,headlinesCount:3,leadsCount:6,briefsCount:12},enableNewScoring:!0,enableProximityScoring:!1,maxTopicPercent:40,maxGeoPercent:30,followedTopics:[],readingHistory:[],topicSuggestions:{enabled:!0,basedOnReadingHistory:!0},enableCache:!0,crawlerMode:"auto",debugLogs:!1,showDebugConsole:!0,lastUpdated:0};function V(){let e=oe.fontSize;typeof window<"u"&&(e=window.innerWidth>=1024?18:26);const n={...oe,fontSize:e};try{const s=localStorage.getItem(be.SETTINGS);if(s){const i=JSON.parse(s);return $n(n,i)}}catch(s){console.error("Error reading settings:",s)}return{...n}}function We(e){try{const n={...e,lastUpdated:Date.now()};return localStorage.setItem(be.SETTINGS,JSON.stringify(n)),Bs(n),!0}catch(n){return console.error("Error saving settings:",n),!1}}async function Bs(e){try{(await fetch(`${Fn}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok||console.warn("Failed to save settings to API")}catch(n){console.warn("API save error:",n)}}async function Ps(){try{const e=await fetch(`${Fn}/settings`);return e.ok?await e.json():null}catch(e){return console.warn("API fetch error:",e),null}}function mt(e){try{const n=localStorage.getItem(be.LAST_REFRESH),s=n?JSON.parse(n):{};s[e]=new Date().toISOString(),localStorage.setItem(be.LAST_REFRESH,JSON.stringify(s))}catch(n){console.error("Error setting last refresh:",n)}}function zs(e=null){try{const n=localStorage.getItem(be.LAST_REFRESH);if(!n)return"Never";const s=JSON.parse(n);let i=null;if(e&&s[e])i=new Date(s[e]);else{const c=Object.values(s).map(d=>new Date(d).getTime());c.length>0&&(i=new Date(Math.max(...c)))}if(!i)return"Never";const r=new Date-i,o=Math.floor(r/6e4),l=Math.floor(r/36e5);return o<1?"Just now":o<60?`${o} min${o>1?"s":""} ago`:l<24?`${l} hour${l>1?"s":""} ago`:i.toLocaleDateString()}catch{return"Unknown"}}function $n(e,n){const s={...e};for(const i in n){const a=n[i];a!=null&&(typeof a=="object"&&!Array.isArray(a)?s[i]=$n(e[i]||{},a):s[i]=a)}return s}function Hs(e){const n=V();n.followedTopics=n.followedTopics||[],n.followedTopics.push({...e,id:`topic_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,created:new Date().toISOString(),lastFetched:null}),We(n)}function Us(e){const n=V();n.followedTopics=n.followedTopics.filter(s=>s.id!==e),We(n)}function Ws(e){const n=V(),s=n.followedTopics.find(i=>i.id===e);s&&(s.lastFetched=new Date().toISOString(),We(n))}function Gs(e){if(!(!e||e.length===0))try{const n=localStorage.getItem(be.ARTICLE_VIEWS),s=n?JSON.parse(n):{};e.forEach(i=>{s[i]=(s[i]||0)+1}),localStorage.setItem(be.ARTICLE_VIEWS,JSON.stringify(s))}catch(n){console.error("[Storage] Error incrementing views",n)}}function Bn(e){try{const n=localStorage.getItem(be.ARTICLE_VIEWS);return(n?JSON.parse(n):{})[e]||0}catch{return 0}}function Ks(e){return V().readingHistory?.some(s=>s.id===e)||!1}function Pn(e){if(!e||!e.title)return;const n=V(),s=n.readingHistory||[];s.some(i=>i.id===e.id)||(s.unshift({id:e.id,title:e.title,description:e.description||"",timestamp:Date.now()}),s.length>50&&(s.length=50),n.readingHistory=s,We(n))}function Vs(){const n=V().readingHistory||[];if(n.length===0)return[];const s=n.map(l=>`${l.title} ${l.description}`).join(" ").toLowerCase(),i=["the","and","in","of","to","a","is","for","on","with","at","from","by","an","be","as","it","has","that","are","was","will","says","said","after","over","new","more","about","can","top","best","india","news","update","latest","today","live"],a=s.match(/\b[a-z]{4,}\b/g)||[],r={};return a.forEach(l=>{i.includes(l)||(r[l]=(r[l]||0)+1)}),Object.entries(r).sort((l,c)=>c[1]-l[1]).slice(0,5).map(([l,c])=>({word:l.charAt(0).toUpperCase()+l.slice(1),count:c}))}const Be={nifty50:"^NSEI",sensex:"^BSESN",niftyBank:"^NSEBANK",niftyIT:"^CNXIT",niftyMidcap:"NIFTYMIDCAP150.NS",niftyPharma:"^CNXPHARMA",niftyAuto:"^CNXAUTO"},qs="https://query1.finance.yahoo.com/v8/finance/chart/",Ys=[e=>`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`];async function Le(e){const n=`${qs}${encodeURIComponent(e)}?interval=1d&range=1d`,s=async(i,a={})=>{const r=new AbortController,o=setTimeout(()=>r.abort(),1e4);try{const l=await fetch(i,{...a,signal:r.signal});return clearTimeout(o),l}catch(l){throw clearTimeout(o),l}};for(const i of Ys)try{const a=i(n),r=await s(a);if(r.ok)return await r.json()}catch(a){console.warn(`[MarketService] Proxy failed: ${a.message}`)}throw new Error(`Failed to fetch market data for ${e}`)}async function Js(e,n,s){if(!s)return null;const i=`https://www.alphavantage.co/query?function=${e}&symbol=${n}&apikey=${s}`;try{const r=await(await fetch(i)).json();if(r["Global Quote"])return r["Global Quote"];if(r["Top Gainers, Losers, and Most Active"])return r}catch(a){console.warn("Alpha Vantage fetch failed",a)}return null}function Oe(e){const n=e.chart?.result?.[0]||e.finance?.result?.[0];if(!n||!n.meta)return null;const s=n.meta,i=s.regularMarketPrice,a=s.chartPreviousClose||s.previousClose,r=i-a,o=a?r/a*100:0,l=s.regularMarketTime?s.regularMarketTime*1e3:Date.now();return{price:i,change:r,changePercent:o.toFixed(2),timestamp:l}}async function Xs(){console.log("[MarketService] Fetching Indian indices...");const e=Object.entries(Be).map(async([i,a])=>{try{const r=await Le(a),o=Oe(r);return o?(console.log(`[MarketService] âœ… ${i}: ${o.price}`),{name:i==="nifty50"?"NIFTY 50":i==="sensex"?"SENSEX":i==="niftyBank"?"BANK NIFTY":i==="niftyIT"?"NIFTY IT":i==="niftyPharma"?"NIFTY PHARMA":i==="niftyAuto"?"NIFTY AUTO":"MIDCAP 150",symbol:a,value:o.price.toLocaleString("en-IN"),change:o.change.toFixed(2),changePercent:o.changePercent,direction:o.change>=0?"up":"down",currency:"â‚¹",timestamp:o.timestamp}):null}catch(r){return console.warn(`[MarketService] âš ï¸ Failed to fetch ${i}:`,r.message),null}}),s=(await Promise.all(e)).filter(i=>i!==null);return s.length===0?(console.warn("[MarketService] Yahoo Indices failed, trying backup..."),await Qs()):s}async function Qs(){const e={"NIFTY 50":"INDEXNSE:NIFTY_50",SENSEX:"INDEXBOM:SENSEX"};try{const n=Object.entries(e).map(async([i,a])=>{const r=`https://www.google.com/finance/quote/${a}`,o=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r)}`,d=(await(await fetch(o)).text()).match(/<div[^>]*class="[^"]*YMlKec[^"]*"[^>]*>([^<]+)<\/div>/);if(d&&d[1]){const h=d[1].replace(/,/g,""),u=parseFloat(h);return{name:i,symbol:a,value:u.toLocaleString("en-IN"),change:"0.00",changePercent:"0.00",direction:"neutral",currency:"â‚¹",timestamp:Date.now(),source:"Google (Backup)"}}return null});return(await Promise.all(n)).filter(i=>i!==null)}catch(n){return console.error("Backup indices fetch failed",n),[]}}const Zs="https://api.mfapi.in/mf/",ei=[{code:"119551",name:"SBI Bluechip Fund"},{code:"120503",name:"HDFC Mid-Cap Opportunities"},{code:"118834",name:"ICICI Prudential Value Discovery"},{code:"122639",name:"Axis Long Term Equity Fund"},{code:"125354",name:"Mirae Asset Large Cap Fund"},{code:"118989",name:"Kotak Emerging Equity Fund"}];async function ti(){return console.log("[MarketService] Fetching Mutual Fund NAVs..."),(await Promise.allSettled(ei.map(async s=>{const a=await(await fetch(`${Zs}${s.code}`)).json();if(!a.data||a.data.length===0)throw new Error("No NAV data");const r=parseFloat(a.data[0].nav),o=a.data.length>1?parseFloat(a.data[1].nav):r,l=r-o,c=(l/o*100).toFixed(2);return{code:s.code,name:a.meta?.scheme_name||s.name,category:a.meta?.scheme_category||"Equity",fundHouse:a.meta?.fund_house||"Unknown",nav:r.toFixed(2),navDate:a.data[0].date,change:l.toFixed(2),changePercent:c,direction:l>=0?"up":"down"}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function ni(){console.log("[MarketService] Fetching IPO data from IPOWatch...");const n=`https://api.allorigins.win/get?url=${encodeURIComponent("https://ipowatch.in/upcoming-ipo-calendar-ipo-list/")}`;try{const s=await fetch(n);if(!s.ok)throw new Error("Proxy failed");const a=(await s.json()).contents,l=new DOMParser().parseFromString(a,"text/html").querySelectorAll("table");let c=null;for(const m of l){const w=m.textContent.toLowerCase();if(w.includes("ipo")&&w.includes("price")||w.includes("ipo name")){c=m;break}}if(!c)throw new Error("No IPO table found");const d=Array.from(c.querySelectorAll("tr")),h=[];for(let m=1;m<d.length;m++){const w=d[m].querySelectorAll("td");if(w.length<3)continue;const v=w[0]?.textContent?.trim()||"Unknown";let j="Upcoming",f="TBA";const N=w[1]?.textContent?.trim(),A=w[2]?.textContent?.trim();N&&(j=N),A&&(f=A);let _="upcoming";const L=j.toLowerCase();L.includes("live")||L.includes("open")?_="live":L.includes("close")?_="recent":L.includes("upcoming")&&(_="upcoming");const P=v.includes("SME")||c.textContent.includes("SME");h.push({name:v,openDate:f,closeDate:"",status:_,isSME:P,issueSize:"-"})}const u=h.filter(m=>m.status==="upcoming").slice(0,5),g=h.filter(m=>m.status==="live"),p=h.filter(m=>m.status==="recent").slice(0,5);return{upcoming:u.length?u:h.slice(0,3),live:g,recent:p.length?p:h.slice(3,6),fetchedAt:Date.now()}}catch(s){return console.error("[MarketService] IPO Fetch Failed:",s),{upcoming:[],live:[],recent:[],fetchedAt:Date.now(),error:s.message}}}const si="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_gainers&count=5",ii="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_losers&count=5";async function Ft(e){const n=`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`;try{const s=await fetch(n);return s.ok?((await s.json()).finance?.result?.[0]?.quotes||[]).map(r=>({symbol:r.symbol.replace(".NS","").replace(".BO",""),price:r.regularMarketPrice?.toFixed(2)||"0.00",change:r.regularMarketChange?.toFixed(2)||"0.00",changePercent:r.regularMarketChangePercent?.toFixed(2)||"0.00",direction:(r.regularMarketChange||0)>=0?"up":"down",volume:r.regularMarketVolume})).filter(r=>r.symbol):[]}catch(s){return console.warn("[MarketService] Screener fetch failed:",s),[]}}const ai=["RELIANCE.NS","TCS.NS","HDFCBANK.NS","INFY.NS","ICICIBANK.NS","HINDUNILVR.NS","SBIN.NS","BHARTIARTL.NS","ITC.NS","KOTAKBANK.NS","LT.NS","AXISBANK.NS","ASIANPAINT.NS","MARUTI.NS","BAJFINANCE.NS"];async function ri(){console.log("[MarketService] Using fallback for movers...");const e=ai.slice(0,10).map(async a=>{try{const r=await Le(a),o=Oe(r);return o?{symbol:a.replace(".NS",""),price:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:parseFloat(o.changePercent),direction:o.change>=0?"up":"down"}:null}catch{return null}}),i=(await Promise.all(e)).filter(a=>a!==null).sort((a,r)=>r.changePercent-a.changePercent);return{gainers:i.filter(a=>a.changePercent>0).slice(0,5),losers:i.filter(a=>a.changePercent<0).slice(-5).reverse()}}async function oi(){console.log("[MarketService] Fetching top movers...");const n=V().alphaVantageKey;if(n)try{console.log("[MarketService] Trying Alpha Vantage for Movers...");const s=await Js("TOP_GAINERS_LOSERS","",n);if(s&&s.top_gainers&&s.top_losers){const i=a=>a.slice(0,5).map(r=>({symbol:r.ticker,price:parseFloat(r.price).toFixed(2),change:parseFloat(r.change_amount).toFixed(2),changePercent:parseFloat(r.change_percentage.replace("%","")).toFixed(2),direction:parseFloat(r.change_amount)>=0?"up":"down"}));return{gainers:i(s.top_gainers),losers:i(s.top_losers)}}}catch(s){console.warn("[MarketService] Alpha Vantage failed:",s)}try{const[s,i]=await Promise.all([Ft(si),Ft(ii)]);if(s.length>0||i.length>0)return console.log("[MarketService] âœ… Used Screener API"),{gainers:s.slice(0,5),losers:i.slice(0,5)}}catch{console.warn("[MarketService] Screener API failed, trying fallback...")}return await ri()}async function li(){console.log("[MarketService] Fetching sectoral indices...");const e=[{key:"niftyBank",name:"Bank Nifty",symbol:Be.niftyBank},{key:"niftyIT",name:"Nifty IT",symbol:Be.niftyIT},{key:"niftyPharma",name:"Nifty Pharma",symbol:Be.niftyPharma},{key:"niftyAuto",name:"Nifty Auto",symbol:Be.niftyAuto}];return(await Promise.allSettled(e.map(async s=>{const i=await Le(s.symbol),a=Oe(i);if(!a)throw new Error("No data");return{name:s.name,value:a.price.toFixed(2),change:a.change.toFixed(2),changePercent:a.changePercent,timestamp:a.timestamp}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function ci(){console.log("[MarketService] Fetching commodities...");try{const e=await Le("INR=X"),n=Oe(e),s=n?n.price:84,i=[{name:"Gold",symbol:"GC=F",type:"gold"},{name:"Silver",symbol:"SI=F",type:"silver"},{name:"Crude Oil",symbol:"CL=F",type:"crude"}];return(await Promise.allSettled(i.map(async r=>{let o=null;try{const h=await Le(r.symbol);o=Oe(h)}catch{console.warn(`[MarketService] Failed to fetch ${r.name} (${r.symbol})`)}if(!o)throw new Error("No data");let l,c,d;return r.type==="gold"?(l=o.price*s/31.1035*10,c=o.change*s/31.1035*10,d="â‚¹/10g"):r.type==="silver"?(l=o.price*s/31.1035*1e3,c=o.change*s/31.1035*1e3,d="â‚¹/kg"):(l=o.price*s,c=o.change*s,d="â‚¹/bbl"),{name:r.name,value:l.toFixed(2),change:c.toFixed(2),changePercent:o.changePercent,unit:d,direction:c>=0?"up":"down",timestamp:o.timestamp}}))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}}async function di(){console.log("[MarketService] Fetching currency rates...");const e=[{name:"USD/INR",symbol:"INR=X"},{name:"OMR/INR",symbol:"OMRINR=X"}],n=e.map(async a=>{try{const r=await Le(a.symbol),o=Oe(r);if(!o)throw new Error("No data");return{name:a.name,value:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:o.changePercent,timestamp:o.timestamp,source:"yahoo"}}catch{return null}}),i=(await Promise.all(n)).filter(a=>a!==null);if(i.length===e.length)return i;console.log("[MarketService] âš ï¸ Yahoo Currency failed, using fallback...");try{const r=await(await fetch("https://open.er-api.com/v6/latest/USD")).json();if(!r||!r.rates)throw new Error("Fallback API failed");const o=r.rates.INR,l=r.rates.OMR,c=[];if(c.push({name:"USD/INR",value:o.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"}),l){const d=o/l;c.push({name:"OMR/INR",value:d.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"})}return c}catch(a){return console.error("[MarketService] âŒ All currency sources failed:",a),i}}async function ui(){return{fii:{buy:12500.5,sell:11800.3,net:700.2},dii:{buy:8900.7,sell:9200.4,net:-299.7},date:new Date().toISOString().split("T")[0]}}const $t="indian_market_data",hi=14400*1e3;async function pi(){try{const e=await fetch("/data/market_snapshot.json");if(e.ok)return await e.json()}catch(e){console.warn("[MarketService] Failed to load static snapshot",e)}return null}async function mi(){console.log("[MarketService] ðŸš€ Fetching all market data...");const[e,n,s,i,a,r,o,l]=await Promise.allSettled([Xs(),ti(),ni(),oi(),li(),ci(),di(),ui()]),c={indices:e.status==="fulfilled"?e.value:[],mutualFunds:n.status==="fulfilled"?n.value:[],ipo:s.status==="fulfilled"?s.value:{upcoming:[],live:[],recent:[]},movers:i.status==="fulfilled"?i.value:{gainers:[],losers:[]},sectorals:a.status==="fulfilled"?a.value:[],commodities:r.status==="fulfilled"?r.value:[],currencies:o.status==="fulfilled"?o.value:[],fiidii:l.status==="fulfilled"?l.value:{fii:{},dii:{},date:""},fetchedAt:Date.now(),errors:{indices:e.status==="rejected"?e.reason?.message:null}};if(c.indices.length>0){try{localStorage.setItem($t,JSON.stringify(c)),console.log("[MarketService] âœ… Fresh data cached")}catch(h){console.warn("[MarketService] Cache write failed",h)}return c}console.warn("[MarketService] Critical data (Indices) missing. Checking cache...");try{const h=localStorage.getItem($t);if(h){const u=JSON.parse(h),g=Date.now()-(u.fetchedAt||0);if(g<hi)return console.log(`[MarketService] âš ï¸ Returning cached data (${(g/6e4).toFixed(0)} mins old)`),{...u,isStale:!0,staleReason:"Network/Proxy Failure - Showing cached data"};console.warn("[MarketService] Cache expired")}}catch(h){console.error("[MarketService] Cache read failed",h)}console.warn("[MarketService] Cache unavailable/expired. Attempting static snapshot...");const d=await pi();return d?(console.log("[MarketService] âœ… Loaded snapshot data"),{...d,isSnapshot:!0,fetchedAt:d.generated_at?new Date(d.generated_at).getTime():Date.now()}):c}const zn=y.createContext(null),gt="market_cache",gi=900*1e3;function fi({children:e}){const[n,s]=y.useState(null),[i,a]=y.useState(!0),[r,o]=y.useState(null),[l,c]=y.useState(null),d=y.useCallback(async(u=!1)=>{if(!u)try{const g=localStorage.getItem(gt);if(g){const p=JSON.parse(g);if(Date.now()-p.fetchedAt<gi){console.log("[MarketContext] Using cached data"),s(p),a(!1),c(p.fetchedAt);return}}}catch{console.warn("[MarketContext] Cache read failed")}a(!0),o(null);try{const g=await mi();s(g),c(Date.now()),localStorage.setItem(gt,JSON.stringify(g)),console.log("[MarketContext] âœ… Market data loaded")}catch(g){console.error("[MarketContext] âŒ Failed to load market data:",g);try{const p=localStorage.getItem(gt);if(p){const m=JSON.parse(p),w=Date.now()-m.fetchedAt;console.log(`[MarketContext] Using stale cache due to fetch error (Age: ${(w/6e4).toFixed(0)}m)`),s(m),c(m.fetchedAt),w>14400*1e3?o("Network error. Data is expired (>4h)."):o("Network error. Showing cached data.")}else{try{const m=await fetch("/data/market_snapshot.json");if(m.ok){const w=await m.json();if(w&&w.indices&&w.indices.length>0){console.log("[MarketContext] Using static snapshot fallback"),s(w),c(new Date(w.generated_at).getTime()),o("Using offline snapshot (Live data failed)");return}}}catch(m){console.warn("Static fallback failed",m)}o(g.message)}}catch{o(g.message)}}finally{a(!1)}},[]);y.useEffect(()=>{d()},[d]);const h=y.useCallback(()=>d(!0),[d]);return t.jsx(zn.Provider,{value:{marketData:n,loading:i,error:r,lastFetch:l,refreshMarket:h},children:e})}function Hn(){const e=y.useContext(zn);if(!e)throw new Error("useMarket must be used within MarketProvider");return e}const Un=({loadingPhase:e})=>{const{marketData:n,loading:s,lastFetch:i}=Hn(),a=y.useRef(null),r=y.useRef(!1),o=y.useMemo(()=>{if(!n)return[];const{indices:u=[],commodities:g=[]}=n,p=[...u,...g];return["NIFTY 50","NSE 50","50","SENSEX","BSE SENSEX","Gold","Silver"].map(w=>p.find(v=>v.name===w)).filter(Boolean)},[n]);y.useEffect(()=>{let u,g=0;const p=40;let m=0;const w=j=>{g||(g=j);const f=j-g;if(g=j,a.current&&!r.current){const N=p*f/1e3;if(m+=N,m>=1){const A=Math.floor(m);m-=A;const{scrollLeft:_,scrollWidth:L}=a.current;_>=L/2?a.current.scrollLeft=0:a.current.scrollLeft+=A}}else g=j;u=requestAnimationFrame(w)},v=setTimeout(()=>{u=requestAnimationFrame(w)},1e3);return()=>{cancelAnimationFrame(u),clearTimeout(v)}},[o]);const l=u=>{if(!u.timestamp)return!0;const p=Date.now()-u.timestamp,w=["Gold","Silver","Crude Oil"].includes(u.name)?3600*1e3:900*1e3;return p>w},c=u=>u?new Date(u).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",d=u=>u==="NSE 50"||u==="50"?"NIFTY 50":u==="BSE SENSEX"?"SENSEX":u,h=()=>{if(!e)return{};let u="transparent";return e===1?u="rgba(144, 238, 144, 0.2)":e===2?u="rgba(60, 179, 113, 0.2)":e===3&&(u="rgba(34, 139, 34, 0.2)"),{background:`linear-gradient(to bottom, transparent, ${u})`,transition:"background 0.5s ease"}};return s&&o.length===0||o.length===0?null:t.jsxs("div",{className:"market-ticker-container",style:h(),children:[t.jsx("div",{className:"ticker-label",children:"ðŸ“ˆ"}),t.jsx("div",{className:"ticker-track-wrapper",ref:a,onMouseEnter:()=>r.current=!0,onMouseLeave:()=>r.current=!1,onTouchStart:()=>r.current=!0,onTouchEnd:()=>r.current=!1,children:t.jsx("div",{className:"ticker-track",children:[...o,...o].map((u,g)=>{const p=l(u);return t.jsxs("div",{className:`ticker-item ${p?"stale-data":""}`,children:[t.jsx("span",{className:"ticker-name",children:d(u.name)}),t.jsxs("span",{className:"ticker-price",children:[u.name==="Gold"||u.name==="Silver"?u.value:typeof u.value=="number"?u.value.toFixed(2):u.value,u.unit?t.jsx("span",{style:{fontSize:"0.7em",marginLeft:"2px"},children:u.unit}):""]}),t.jsxs("span",{className:`ticker-change ${parseFloat(u.change)>=0?"positive":"negative"}`,children:[parseFloat(u.change)>=0?"â–²":"â–¼"," ",Math.abs(parseFloat(u.changePercent)).toFixed(2),"%"]})]},`${u.name}-${g}`)})})}),i&&t.jsxs("div",{className:"ticker-updated",children:[t.jsx("span",{style:{marginRight:"4px"},children:"ðŸ•’"})," ",c(i)]})]})},Wn=y.createContext();function yi({children:e}){const[n,s]=y.useState(()=>V()),[i,a]=y.useState(0),r=y.useCallback(l=>{We(l),s(l),a(c=>c+1)},[]),o=y.useCallback(()=>{const l=V();s(l),a(c=>c+1)},[]);return y.useEffect(()=>{(async()=>{try{const c=await Ps();if(c){const d=V(),h=c.lastUpdated||0,u=d.lastUpdated||0;if(h>u)console.log("[Settings] Syncing from server (Remote is newer)..."),localStorage.setItem("dailyEventAI_settings",JSON.stringify(c)),o();else if(!d.upAhead?.keywords?.shopping){console.log("[Settings] Patching missing keywords from remote...");const g={...c,...d,upAhead:{...c.upAhead,...d.upAhead}};g.upAhead.keywords||(g.upAhead.keywords=c.upAhead.keywords),localStorage.setItem("dailyEventAI_settings",JSON.stringify(g)),o()}}}catch(c){console.warn("[Settings] Failed to sync with server",c)}})()},[o]),y.useEffect(()=>{const l=c=>{c.key==="dailyEventAI_settings"&&(console.log("[SettingsContext] Storage changed in another tab, reloading"),o())};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[o]),y.useEffect(()=>{n.fontSize&&(document.documentElement.style.fontSize=n.fontSize+"px")},[n.fontSize]),y.useEffect(()=>{document.documentElement.setAttribute("data-theme",n.theme||"dark")},[n.theme]),t.jsx(Wn.Provider,{value:{settings:n,updateSettings:r,reloadSettings:o,settingsVersion:i},children:e})}function se(){const e=y.useContext(Wn);if(!e)throw new Error("useSettings must be used within SettingsProvider");return e}const xi=()=>{const{settings:e,updateSettings:n}=se(),s=e.theme==="light",i=()=>{n({...e,theme:s?"dark":"light"})};return t.jsx("button",{onClick:i,className:"header__action-btn",title:s?"Switch to Dark Mode":"Switch to Light Mode",style:{background:"transparent",border:"none",cursor:"pointer",padding:"0 8px",color:"var(--text-primary)"},children:s?"ðŸŒ™":"â˜€ï¸"})};function _e({title:e,icon:n,showBack:s=!1,backTo:i="/",actions:a,pills:r,activePill:o,onPillChange:l,compact:c=!1,loadingPhase:d}){const[h,u]=y.useState(window.innerWidth>=1024);y.useEffect(()=>{const p=()=>u(window.innerWidth>=1024);return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const g=p=>p.includes("Morning")?"ðŸŒ…":p.includes("Midday")?"â˜€ï¸":p.includes("Evening")?"ðŸŒ™":p;return t.jsxs("header",{className:`header ${c?"header--compact":""}`,children:[s?t.jsxs(De,{to:i,className:"header__back",children:[t.jsx("span",{children:"â†"}),t.jsx("span",{children:e})]}):t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[h&&t.jsx(xi,{}),t.jsx("h1",{className:"header__title"})]}),!s&&t.jsx(Un,{loadingPhase:d}),r&&t.jsx("div",{className:"header__pills",children:r.map(p=>t.jsx("button",{className:`time-pill time-pill--matte ${o===p?"time-pill--active":""}`,onClick:()=>l&&l(p),title:p,children:g(p)},p))}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:a})]})}const Fe={bbc:{name:"BBC",credibility:2,staffSize:5500,bureaus:50,avgArticleLength:800,updateFrequency:"continuous",weight:1.8,categories:["world","business","technology","entertainment"]},reuters:{name:"Reuters",credibility:1.95,staffSize:2500,bureaus:200,avgArticleLength:600,updateFrequency:"continuous",weight:1.8,categories:["world","business"]},apnews:{name:"AP News",credibility:1.9,staffSize:2500,bureaus:250,avgArticleLength:500,updateFrequency:"continuous",weight:1.75,categories:["world","business","sports"]},aljazeera:{name:"Al Jazeera",credibility:1.7,staffSize:2e3,bureaus:60,avgArticleLength:900,updateFrequency:"hourly",weight:1.6,categories:["world","business"]},cnn:{name:"CNN",credibility:1.6,staffSize:3e3,bureaus:40,avgArticleLength:400,updateFrequency:"continuous",weight:1.5,categories:["world","business","technology"]},ndtv:{name:"NDTV",credibility:1.75,staffSize:1200,bureaus:15,avgArticleLength:600,updateFrequency:"continuous",weight:1.6,categories:["india","business","technology"]},thehindu:{name:"The Hindu",credibility:1.8,staffSize:800,bureaus:12,avgArticleLength:800,updateFrequency:"hourly",weight:1.65,categories:["india","world","business","technology"]},toi:{name:"Times of India",credibility:1.6,staffSize:1500,bureaus:25,avgArticleLength:500,updateFrequency:"continuous",weight:1.5,categories:["india","entertainment","sports"]},financialexpress:{name:"Financial Express",credibility:1.65,staffSize:300,bureaus:5,avgArticleLength:700,updateFrequency:"hourly",weight:1.55,categories:["business","technology"]},indianexpress:{name:"Indian Express",credibility:1.7,staffSize:400,bureaus:8,avgArticleLength:750,updateFrequency:"hourly",weight:1.6,categories:["india","world","business"]},techcrunch:{name:"TechCrunch",credibility:1.7,staffSize:200,bureaus:3,avgArticleLength:600,updateFrequency:"hourly",weight:1.6,categories:["technology"],specialization:"startups, VC"},theverge:{name:"The Verge",credibility:1.65,staffSize:100,bureaus:1,avgArticleLength:900,updateFrequency:"hourly",weight:1.55,categories:["technology"],specialization:"gadgets, consumer tech"},espn:{name:"ESPN",credibility:1.7,staffSize:500,bureaus:10,avgArticleLength:500,updateFrequency:"continuous",weight:1.6,categories:["sports"]},bollywoodhungama:{name:"Bollywood Hungama",credibility:1.4,staffSize:100,bureaus:2,avgArticleLength:400,updateFrequency:"hourly",weight:1.3,categories:["entertainment"],specialization:"Indian cinema"},googlenews:{name:"Google News",credibility:1.5,staffSize:0,bureaus:0,avgArticleLength:0,updateFrequency:"continuous",weight:1,categories:["world","india","business","technology","entertainment","sports"]},default:{name:"Default Source",credibility:1,staffSize:50,bureaus:1,avgArticleLength:400,updateFrequency:"daily",weight:.9,categories:[]}},wi=e=>{const n=Object.keys(Fe).find(c=>e.toLowerCase().replace(/\s+/g,"").includes(c))||"default",s=Fe[n],i=s.credibility/2*.4,r=Math.min(s.staffSize/5500,1)*.3,l=Math.min(s.bureaus/250,1)*.3;return i+r+l},vi=(e,n)=>{const s=Object.keys(Fe).find(a=>e.toLowerCase().replace(/\s+/g,"").includes(a))||"default",i=Fe[s];return!i.categories||i.categories.includes(n)?i.weight:i.weight*.7},Bt="https://news.google.com/rss",bi="https://news.google.com/rss/search",Pt={WORLD:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx1YlY4U0JXVnVMVlZUR2dKVlV5Z0FQAQ",BUSINESS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx6TVdZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",TECHNOLOGY:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGRqTVhZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",ENTERTAINMENT:"CAAqJggKIiBDQkFTRWvfSkwyMHZNREpxYW5RU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SPORTS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp1ZEdvU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SCIENCE:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp0Y1RjU0JXVnVMVlZUR2dKVlV5Z0FQAQ",HEALTH:"CAAqJggKIiBDQkFTRWvfSkwyMHZNR3QwTlRFU0JXVnVMVlZUR2dKVlV5Z0FQAQ"};function xe({category:e,query:n,country:s="IN",lang:i="en"}){const a=`${i}-${s}`,r=s,o=`${s}:${i}`,l=`hl=${a}&gl=${r}&ceid=${o}`;if(n)return`${bi}?q=${encodeURIComponent(n)}&${l}`;if(e){const c=e.toUpperCase();if(Pt[c])return`${Bt}/topics/${Pt[c]}?${l}`}return`${Bt}?${l}`}const Ae={WORLD_IN:xe({category:"world",country:"IN",lang:"en"}),BUSINESS_IN:xe({category:"business",country:"IN",lang:"en"}),BUSINESS_IN_SEARCH:xe({query:"Business Economy India",country:"IN",lang:"en"}),TECH_IN:xe({category:"technology",country:"IN",lang:"en"}),TECH_IN_SEARCH:xe({query:"Technology Startups India",country:"IN",lang:"en"}),TAMIL_NADU:xe({query:"Tamil Nadu",country:"IN",lang:"ta"}),CHENNAI:xe({query:"Chennai",country:"IN",lang:"en"}),WORLD_US:xe({category:"world",country:"US",lang:"en"})},rt={tamil:["https://www.thenewsminute.com/tamil-nadu/entertainment/feed","https://www.behindwoods.com/tamil-movies/rss-feeds/news.xml","https://timesofindia.indiatimes.com/rssfeeds/1081479906.cms","https://www.filmibeat.com/rss/filmibeat-tamil-fb.xml"],hindi:["https://www.bollywoodhungama.com/rss/news.xml","https://www.filmfare.com/feeds/bollywood.xml","https://timesofindia.indiatimes.com/rssfeeds/-2128936835.cms"],hollywood:["https://www.hollywoodreporter.com/feed/","https://variety.com/feed/","https://deadline.com/feed/"],ott:["https://www.whats-on-netflix.com/feed/","https://www.cordcuttersnews.com/feed/","https://www.streamingmedia.com/RSS/Articles.aspx"]};function Si(e){const n=["horoscope","rasipalan","zodiac","astrology","prediction","numerology"];return e.filter(s=>{const i=(s.title+" "+s.description).toLowerCase();return!n.some(a=>i.includes(a))})}async function ji(){console.log("[EntertainmentService] Fetching Tamil/Kollywood news...");const e=[];for(const s of rt.tamil)try{const i=await Se(s,"entertainment");e.push(...i.map(a=>({...a,category:"Tamil Cinema",region:"tamil"})))}catch(i){console.warn(`[EntertainmentService] Failed to fetch ${s}:`,i.message)}return Si(e).sort((s,i)=>(i.publishedAt||0)-(s.publishedAt||0)).slice(0,20)}async function Ni(){console.log("[EntertainmentService] Fetching Hindi/Bollywood news...");const e=[];for(const n of rt.hindi)try{const s=await Se(n,"entertainment");e.push(...s.map(i=>({...i,category:"Hindi Cinema",region:"hindi"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function ki(){console.log("[EntertainmentService] Fetching Hollywood news...");const e=[];for(const n of rt.hollywood)try{const s=await Se(n,"entertainment");e.push(...s.map(i=>({...i,category:"Hollywood",region:"hollywood"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function _i(){console.log("[EntertainmentService] Fetching OTT/Streaming news...");const e=[];for(const n of rt.ott)try{const s=await Se(n,"entertainment");e.push(...s.map(i=>({...i,category:"OTT & Streaming",region:"ott"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function Ci(e={}){console.log("[EntertainmentService] ðŸŽ¬ Fetching all entertainment news...");const{tamilPercent:n=40,hindiPercent:s=35,hollywoodPercent:i=15,ottPercent:a=10}=e,[r,o,l,c]=await Promise.allSettled([ji(),Ni(),ki(),_i()]),d=r.status==="fulfilled"?r.value:[],h=o.status==="fulfilled"?o.value:[],u=l.status==="fulfilled"?l.value:[],g=c.status==="fulfilled"?c.value:[],p=40,m={tamil:Math.round(p*(n/100)),hindi:Math.round(p*(s/100)),hollywood:Math.round(p*(i/100)),ott:Math.round(p*(a/100))},v=[...d.slice(0,m.tamil),...h.slice(0,m.hindi),...u.slice(0,m.hollywood),...g.slice(0,m.ott)].sort(()=>Math.random()-.5);return console.log("[EntertainmentService] âœ… Entertainment news fetched:",{tamil:m.tamil,hindi:m.hindi,hollywood:m.hollywood,ott:m.ott,total:v.length}),v}const zt={abandon:-2,accident:-2,alert:-1,ambitious:2,asset:2,active:1,advance:2,agree:1,amazing:4,approve:2,award:3,awesome:4,bad:-3,bailout:-2,beautiful:3,benefit:2,best:3,boost:1,breakthrough:3,bright:1,bull:2,bullish:2,buy:1,calm:2,cancel:-1,care:2,celebrate:3,challenge:-1,champion:2,cheap:-1,clean:2,collapse:-2,climb:1,comfort:2,commit:1,confidence:2,conflict:-2,congrats:2,congratulate:2,cool:1,correct:1,crash:-2,crisis:-3,criticize:-2,danger:-2,dead:-3,debt:-2,decline:-1,defeat:-2,deficit:-2,denied:-2,depression:-2,destroy:-3,devastate:-3,difficult:-1,disaster:-2,disease:-1,dispute:-2,doubt:-1,down:-1,drop:-1,dump:-1,earn:1,earnings:1,ease:2,easy:1,effective:2,efficient:2,emergency:-2,encourage:2,enjoy:2,error:-2,excellent:3,cite:2,expand:1,fail:-2,failure:-2,fake:-3,fall:-1,fantastic:4,fear:-2,fight:-1,fine:2,fraud:-4,free:1,fresh:1,fun:4,gain:2,good:3,great:3,growth:2,happy:3,hard:-1,harm:-2,hate:-3,healthy:2,help:2,hero:2,high:1,hope:2,hurt:-2,ignore:-1,ill:-2,improve:2,increase:1,infect:-2,inflation:-2,injury:-2,innovate:1,innovative:2,inspire:2,intelligent:2,invest:1,joke:2,joy:3,jump:1,kill:-3,lack:-2,lag:-1,lead:1,leader:1,legal:1,lie:-2,like:2,loss:-3,love:3,low:-1,luck:3,lucky:3,market:1,merger:2,miss:-1,mistake:-2,murder:-3,negative:-2,nice:3,outperform:2,outstanding:5,panic:-3,perfect:3,plunge:-2,poor:-2,positive:2,praise:3,problem:-2,profit:2,progress:2,promise:1,proud:2,protect:1,rally:2,recession:-2,record:2,recover:1,reject:-1,reliable:2,relief:1,rescue:2,resolve:2,restore:1,reward:2,rich:2,risk:-2,safe:1,save:2,scandal:-3,scare:-2,secure:2,sell:-1,shares:1,shortage:-2,sick:-2,significant:1,smart:1,smile:2,solid:2,solve:1,spark:1,stable:2,stock:1,stop:-1,strength:2,strong:2,success:2,suffer:-2,surge:1,surprise:2,sweet:2,tech:1,terrible:-3,terrified:-3,threat:-2,top:2,tough:-1,tragedy:-2,trouble:-2,trust:1,ugly:-3,uncertain:-1,unemployment:-2,unfair:-2,up:1,upset:-2,urgent:-1,useful:2,value:1,victory:3,violation:-2,violence:-3,volatile:-1,vulnerable:-2,weak:-2,wealth:3,win:4,winner:4,wonderful:4,worry:-3,worst:-3,wow:4,wrong:-2,yes:1},Ei=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>0),Ht=e=>{if(!e||e.trim().length===0)return{score:0,comparative:0,label:"neutral"};const n=Ei(e);let s=0;n.forEach(r=>{zt[r]&&(s+=zt[r])});const i=n.length>0?s/n.length:0;let a="neutral";return i>.05?a="positive":i<-.05&&(a="negative"),{score:s,comparative:i,label:a}},Ti=(e,n)=>{const s=Ht(e),i=Ht(n),a=s.comparative*.6+i.comparative*.4;let r="neutral";return a>.05?r="positive":a<-.05&&(r="negative"),{label:r,comparative:a,titleSentiment:s,descriptionSentiment:i}};var Ii=Ds();const Ai=Ts(Ii),Mi=(e,n=.75)=>{if(!e||e.length===0)return[];const s=[],i=new Set;for(let a=0;a<e.length;a++){if(i.has(a))continue;const r=[e[a]];i.add(a);for(let o=a+1;o<e.length;o++){if(i.has(o))continue;Ai.compareTwoStrings(e[a].title.toLowerCase(),e[o].title.toLowerCase())>n&&(r.push(e[o]),i.add(o))}s.push(r)}return s},Ri=e=>{if(!e||e.length===0)return null;const s=[...e].sort((o,l)=>l.impactScore-o.impactScore)[0],i=[...new Set(e.map(o=>o.source))],a=i.length,r=1+(a-1)*.1;return{...s,sourceCount:a,allSources:i,clusteredItems:e.length,impactScore:s.impactScore*r,clusterRepresentative:!0}},Di=(e,n=.75)=>{const s=new Set,i=[];for(const o of e)!o.id||s.has(o.id)||(s.add(o.id),i.push(o));return Mi(i,n).map(Ri).filter(o=>o!==null)};function Li(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}class Oi{constructor(){this.newsMap=new Map,this.breaking=new Set}checkBreakingNews(n,s=Date.now()){if(!n||!n.title||!n.publishedAt)return{isBreaking:!1,breakingScore:0,multiplier:1};const i=Li(n.title),a=(s-n.publishedAt)/1e3/60;let r=!1,o=0;for(const[l,c]of this.newsMap.entries())if(this.calculateSimilarity(i,l)>.7){(s-c.firstSeen)/1e3/60<60&&!c.sources.has(n.source)&&(c.sources.add(n.source),c.count++),c.count>=2&&a<60&&(r=!0,o=Math.log(60/Math.max(1,a))||1,o=Math.min(o,3),this.breaking.add(i));break}return this.newsMap.has(i)||this.newsMap.set(i,{firstSeen:n.publishedAt,sources:new Set([n.source]),count:1,title:n.title}),{isBreaking:r,breakingScore:o,multiplier:r?o:1}}calculateSimilarity(n,s){const i=new Set(n.split(/\s+/)),a=new Set(s.split(/\s+/)),r=[...i].filter(l=>a.has(l)).length,o=new Set([...i,...a]).size;return r/Math.max(o,1)}cleanup(n=120){const s=Date.now(),i=[];for(const[a,r]of this.newsMap.entries())(s-r.firstSeen)/1e3/60>n&&i.push(a);return i.forEach(a=>{this.newsMap.delete(a),this.breaking.delete(a)}),i.length}getBreakingStories(){const n=[];for(const[s,i]of this.newsMap.entries())i.count>=2&&n.push({title:i.title,sourceCount:i.count,sources:[...i.sources],firstSeen:i.firstSeen});return n}}const Fi=new Oi;function $i(e,n,s){const i=`${e} ${n}`.toLowerCase();let a=1;/\b(world|international|global|planet|earth|un|united nations)\b/.test(i)?a=1.5:/\b(india|country|nation|nationwide|federal|central govt|modi|parliament)\b/.test(i)?a=1.3:/\b(state|tamil nadu|kerala|karnataka|region|district)\b/.test(i)&&(a=1.1);let r=1;/\b(billions?|trillions?)\b/.test(i)?r=1.5:/\b(millions?|lakhs?|crores?)\b/.test(i)?r=1.3:/\b(thousands?|hundreds of thousands?)\b/.test(i)&&(r=1.1);let o=1;return s&&s.highImpactKeywords&&Array.isArray(s.highImpactKeywords)&&s.highImpactKeywords.some(c=>c?new RegExp(`\\b${c.toLowerCase()}\\b`,"i").test(i):!1)&&(o=s.rankingWeights?.impact?.highImpactBoost||2.5),a*r*o}const Bi={chennai:{lat:13.0827,lon:80.2707,boost:2},trichy:{lat:10.7905,lon:78.7047,boost:1.8},"tamil nadu":{lat:11.1271,lon:78.6569,boost:1.6},muscat:{lat:23.588,lon:58.3829,boost:1.5},india:{lat:20.5937,lon:78.9629,boost:1.3}};function Pi(e,n){const s=V();if(s.enableProximityScoring===!1)return 1;const i=`${e} ${n}`.toLowerCase();let a=1;const r=s.rankingWeights?.geo?.cityMatch||1.5,o=s.rankingWeights?.geo?.maxScore||5;for(const[l,c]of Object.entries(Bi))i.includes(l.toLowerCase())&&c.boost>a&&(a=c.boost);if(s.weather?.cities)for(const l of s.weather.cities)i.includes(l.toLowerCase())&&r>a&&(a=r);return Math.min(a,o)}const Ut=new Map;function zi(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>3)}function Hi(e,n,s){const i=`${e} ${n}`,a=zi(i);if(a.length===0)return 1;let r=0;a.forEach(c=>{const d=Ut.get(c)||{count:0};d.count<2&&r++,Ut.set(c,{count:d.count+1,lastSeen:Date.now()})});const o=r/a.length;return 1+Math.min(o*.5,.5)}function Ui(e,n=[]){const i=V().followedTopics||[];if(i.length===0)return 1;const a=e.toLowerCase();return i.some(o=>{const l=typeof o=="string"?o:o.name;if(!l)return!1;const c=l.toLowerCase();return a.includes(c)||n&&n.some(d=>d.toLowerCase().includes(c))})?1.5:1}const Wi=["hero","rescue","miracle","triumph","tragedy","survival","family","child","mother","father","couple","wedding","journey","struggle","overcome","inspire","brave","courage","heartbreak","reunion","loss","hope","dream","volunteer","charity","donation","help","saved","lifeline","community","spirit","kindness"];function Gi(e,n){const s=`${e} ${n}`.toLowerCase();let i=0;Wi.forEach(r=>{s.includes(r.toLowerCase())&&i++});const a=1+i*.2;return Math.min(a,2)}function Ki(e,n=null){if(!e)return 1;const s=n?.rankingWeights?.visual?.videoBoost||1.3,i=n?.rankingWeights?.visual?.imageBoost||1.15;return/youtube|vimeo|video|youtu\.be/i.test(e)?s:/\.(jpg|jpeg|png|gif|webp|svg)/i.test(e)||/images|img|photo|static/i.test(e)?i:Math.min(i,1.1)}const Wt={world:["UN","NATO","United Nations","international","embassy","foreign","global","war","peace talks","summit","G7","G20","EU","European Union","Middle East","Ukraine","Russia","Gaza","Israel","Palestine","Hamas","Hezbollah","Iran","China","USA","UK","Biden","Trump","Putin","Zelenskyy","Netanyahu","diplomacy","geopolitical","sanctions","treaty","United States","Britain","France","Germany","Australia","Canada","Japan","South Korea","North Korea"],india:["Delhi","New Delhi","Modi","BJP","Congress","Parliament","Supreme Court","India","Indian","Lok Sabha","Rajya Sabha","PM","President","RBI","central government","nationwide","union minister","Amit Shah","Rahul Gandhi","AAP","Kejriwal","Mamata Banerjee","Trinamool","CPM","Elections","ECI","Election Commission","CBI","ED","Enforcement Directorate","UPSC","NEET","census","aadhaar","pan card","railways","vande bharat","isro","chandrayaan","aditya-l1","gaganyaan","defence","army","navy","air force"],chennai:["Chennai","Madras","Marina Beach","TN Assembly","MTC","CMDA","Anna University","Kauvery Hospital","Apollo Chennai","Tambaram","Egmore","T Nagar","Adyar","Velachery","Guindy","Mylapore","Triplicane","Chromepet","Pallavaram","OMR","ECR","Old Mahabalipuram Road","East Coast Road","Koyambedu","Anna Nagar","Besant Nagar","Thiruvanmiyur","IIT Madras","Loyola College","Presidency College","Ripon Building","Greater Chennai Corporation","GCC","Chennai Metro","CMRL","Central Station","Egmore Station","Meenambakkam","Chennai Airport","Nungambakkam","Kodambakkam"],trichy:["Trichy","Tiruchirappalli","Srirangam","BHEL Trichy","NIT Trichy","Rock Fort","Kaveri","Cauvery","Thanjavur","Delta districts","Samayapuram","Manapparai","Thiruverumbur","Lalgudi","Musiri","Thuraiyur","Pudukkottai","Karur","Perambalur","Ariyalur","Kallanai","Mukkombu","Butterfly Park","Tiruchirapalli"],business:["stock","market","economy","GDP","inflation","RBI","Sensex","Nifty","shares","BSE","NSE","earnings","revenue","profit","loss","IPO","merger","acquisition","startup","funding","investment","corporate","CEO","CFO","bank","finance","fiscal","monetary","repo rate","tax","GST","income tax","customs","export","import","trade","rupee","dollar","gold","silver","oil","crude","brent","crypto","bitcoin","ethereum","blockchain","mutual fund","SIP","dividend","quarterly results","Adani","Ambani","Tata","Reliance","Infosys","TCS","Wipro","HDFC","ICICI","SBI"],technology:["AI","tech","technology","Google","Apple","Microsoft","software","hardware","cyber","crypto","blockchain","iPhone","Android","app","cloud","data","algorithm","machine learning","artificial intelligence","ChatGPT","OpenAI","Gemini","LLM","neural network","robotics","automation","5G","6G","telecom","semiconductor","chip","processor","Intel","AMD","Nvidia","Samsung","OnePlus","Xiaomi","cybersecurity","hacker","malware","ransomware","virus","SpaceX","NASA","satellite","rocket","drone","electric vehicle","EV","Tesla","Elon Musk","Mark Zuckerberg","Sundar Pichai","Satya Nadella","Tim Cook"],entertainment:["film","movie","actor","actress","director","box office","OTT","Netflix","Amazon Prime","Disney+","cinema","theatre","Kollywood","Bollywood","Hollywood","music","album","concert","award","Oscar","Emmy","Grammy","celebrity","release","trailer","teaser","review","blockbuster","star","superstar","hero","heroine","villain","script","screenplay","cinematography","Rajinikanth","Kamal Haasan","Vijay","Ajith","Suriya","Dhanush","Vikram","Nayanthara","Trisha","Anirudh","AR Rahman","Shah Rukh Khan","Salman Khan","Aamir Khan","Deepika Padukone","Alia Bhatt","Ranbir Kapoor","Karan Johar","Tollywood","Mollywood"],sports:["cricket","football","IPL","Olympics","match","championship","FIFA","World Cup","player","coach","team","goal","wicket","run","tennis","badminton","hockey","trophy","medal","CSK","MI","RCB","stadium","tournament","league","series","test match","ODI","T20","century","half-century","hat-trick","penalty","corner","free kick","grand slam","Wimbledon","US Open","French Open","Australian Open","F1","Formula 1","racing","driver","athlete","gold medal","silver medal","bronze medal","BCCI","ICC","Virat Kohli","Rohit Sharma","Dhoni","MS Dhoni","Messi","Ronaldo","Neymar","Mbappe"]},Gn={"Narendra Modi":"india","Rahul Gandhi":"india","Amit Shah":"india","Arvind Kejriwal":"india","Mamata Banerjee":"india","Droupadi Murmu":"india","Jagdeep Dhankhar":"india","Nirmala Sitharaman":"india","S. Jaishankar":"india","Rajnath Singh":"india","Nitin Gadkari":"india","Mallikarjun Kharge":"india","MK Stalin":"chennai","Edappadi Palaniswami":"chennai","K. Annamalai":"chennai",Annamalai:"chennai","Udhayanidhi Stalin":"chennai","Thol. Thirumavalavan":"chennai",Seeman:"chennai","Kamal Haasan":"entertainment",Rajinikanth:"entertainment",Vijay:"entertainment","Thalapathy Vijay":"entertainment","Ajith Kumar":"entertainment",Suriya:"entertainment","Shah Rukh Khan":"entertainment","Salman Khan":"entertainment","Alia Bhatt":"entertainment","Deepika Padukone":"entertainment","Taylor Swift":"entertainment",Beyonce:"entertainment","Chennai Super Kings":"sports",CSK:"sports","Mumbai Indians":"sports","Royal Challengers Bangalore":"sports",RCB:"sports","Indian Cricket Team":"sports","Virat Kohli":"sports","MS Dhoni":"sports","Rohit Sharma":"sports","Ravindra Jadeja":"sports","R Ashwin":"sports","Jasprit Bumrah":"sports","Lionel Messi":"sports","Cristiano Ronaldo":"sports","Novak Djokovic":"sports","Rafael Nadal":"sports","Carlos Alcaraz":"sports","PV Sindhu":"sports","Neeraj Chopra":"sports","R Praggnanandhaa":"sports","D Gukesh":"sports",OpenAI:"technology",Tesla:"technology",SpaceX:"technology",Nvidia:"technology","Sam Altman":"technology","Mark Zuckerberg":"technology","Sundar Pichai":"technology","Satya Nadella":"technology","Tim Cook":"technology","Gautam Adani":"business","Mukesh Ambani":"business","Ratan Tata":"business","N Chandrasekaran":"business","Uday Kotak":"business","Nifty 50":"business",Sensex:"business"};function Vi(e,n,s=""){const i=`${e} ${n}`.toLowerCase();for(const[c,d]of Object.entries(Gn)){const h=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${h}\\b`,"i").test(i))return d}const a={};Object.keys(Wt).forEach(c=>a[c]=0);for(const[c,d]of Object.entries(Wt))d.forEach(h=>{const u=h.toLowerCase(),g=["star","hero","mass","play","act","cast","plot","vijay","ajith","suriya","vikram","release"];u.length<=3||g.includes(u)?new RegExp(`\\b${u}\\b`,"i").test(i)&&a[c]++:i.includes(u)&&a[c]++});const o=Object.keys(a).sort((c,d)=>a[d]-a[c])[0];return a[o]>=2?o:null}const qi=300,te={entries:[],subscribers:new Set,stats:{totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}}};function Gt(){te.subscribers.forEach(e=>e())}function Yi(e){te.stats.byService[e]||(te.stats.byService[e]={ok:0,fail:0,totalMs:0,lastStatus:null,lastTime:null})}const he={add(e,n,s,i={}){const a={ts:Date.now(),level:e,service:n,message:s,...i};te.entries.push(a),te.entries.length>qi&&te.entries.shift(),te.stats.totalFetches++,Yi(n);const r=te.stats.byService[n];e==="error"?(te.stats.failures++,r.fail++,r.lastStatus="fail"):(te.stats.successes++,r.ok++,r.lastStatus="ok"),i.durationMs&&(te.stats.totalMs+=i.durationMs,r.totalMs+=i.durationMs),r.lastTime=Date.now(),Gt()},info(e,n,s){this.add("info",e,n,s)},warn(e,n,s){this.add("warn",e,n,s)},error(e,n,s){this.add("error",e,n,s)},success(e,n,s){this.add("success",e,n,s)},getEntries(){return te.entries},getStats(){return te.stats},subscribe(e){return te.subscribers.add(e),()=>te.subscribers.delete(e)},clear(){te.entries.length=0,te.stats={totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}},Gt()}},ft=[{name:"rss2json",url:"https://api.rss2json.com/v1/api.json",format:e=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(n.status==="ok")return{title:n.feed?.title,items:n.items||[]};throw new Error("rss2json status not ok")}},{name:"codetabs",url:"https://api.codetabs.com/v1/proxy",format:e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.text();if(!n)throw new Error("Empty response from codetabs");return Kt(n)}},{name:"allorigins",url:"https://api.allorigins.win/get",format:e=>`https://api.allorigins.win/get?url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(!n.contents)throw new Error("No content from allorigins");return Kt(n.contents)}}];function Kt(e){const s=new DOMParser().parseFromString(e,"text/xml");if(s.getElementsByTagName("parsererror").length>0)throw new Error("XML Parsing Error");const i=s.querySelector("channel > title")?.textContent||"Unknown Source",a=Array.from(s.querySelectorAll("item")).map(r=>{const o=r.querySelector("title")?.textContent,l=r.querySelector("link")?.textContent,c=r.querySelector("pubDate")?.textContent,d=r.querySelector("description")?.textContent,h=r.querySelector("guid")?.textContent,u=r.querySelector("author")?.textContent||r.querySelector("dc\\:creator")?.textContent,g=r.querySelector("enclosure"),p=g?{url:g.getAttribute("url"),type:g.getAttribute("type")}:null,m=r.querySelector("media\\:content")||r.querySelector("content"),w=m?{url:m.getAttribute("url")}:null,v=r.querySelector("media\\:thumbnail")||r.querySelector("thumbnail"),j=v?v.getAttribute("url"):null;return{title:o,link:l,pubDate:c,description:d,guid:h,author:u,enclosure:p,"media:content":w,thumbnail:j}});return{title:i,items:a}}class Ji{constructor(){this.currentIndex=0,this.failureCounts=new Map,this.lastSuccess=new Map}async fetchViaProxy(n){const s=ft.length;let i=null;for(let a=0;a<s;a++){const r=(this.currentIndex+a)%s,o=ft[r];try{const l=o.format(n),c=new AbortController,d=setTimeout(()=>c.abort(),8e3);let h;try{h=await fetch(l,{signal:c.signal})}finally{clearTimeout(d)}if(!h.ok)throw new Error(`HTTP ${h.status}`);const u=await o.parse(h);if(!u||!u.items||u.items.length===0)throw new Error("No items returned");return this.failureCounts.set(o.name,0),this.lastSuccess.set(o.name,Date.now()),this.currentIndex=r,he.info("proxy",`${o.name} OK (${u.items.length} items)`),u}catch(l){console.warn(`[ProxyManager] ${o.name} failed for ${n}:`,l.message),i=l;const c=(this.failureCounts.get(o.name)||0)+1;this.failureCounts.set(o.name,c)}}throw he.error("proxy",`All proxies failed: ${i?.message}`),new Error(`All proxies failed. Last error: ${i?.message}`)}getProxyHealth(){return ft.map(n=>({name:n.name,failures:this.failureCounts.get(n.name)||0,lastSuccess:this.lastSuccess.get(n.name)||null}))}}const Kn=new Ji,bt="news_section_health",Vt=3;function qt(e,n){if(e)try{const s=localStorage.getItem(bt),i=s?JSON.parse(s):{},a=i[e]||[];a.unshift(n),a.length>Vt&&(a.length=Vt),i[e]=a,localStorage.setItem(bt,JSON.stringify(i))}catch(s){console.warn("[SectionHealth] Failed to record fetch count:",s)}}function Xi(e,n){try{const s=localStorage.getItem(bt),a=(s?JSON.parse(s):{})[e]||[];if(a.length===0)return{status:"ok",ratio:1,avg:n,history:[]};const o=a.reduce((d,h)=>d+h,0)/a.length;if(o===0)return{status:"ok",ratio:1,avg:0,history:a};const l=n/o;let c="ok";return l<.1?c="critical":l<.5&&(c="warning"),{status:c,ratio:l,avg:o,history:a}}catch(s){return console.warn("[SectionHealth] Failed to compute health:",s),{status:"ok",ratio:1,avg:0,history:[]}}}function Qi(e){if(!e||e.length<=3)return!1;const n=e[0].source;return e.every(s=>s.source===n)}const Zi={world:[Ae.WORLD_IN,"https://feeds.bbci.co.uk/news/rss.xml","https://feeds.bbci.co.uk/news/world/rss.xml","https://www.aljazeera.com/xml/rss/all.xml",Ae.WORLD_US],india:[Ae.TAMIL_NADU,"https://feeds.feedburner.com/ndtvnews-top-stories","https://www.thehindu.com/news/national/feeder/default.rss","https://timesofindia.indiatimes.com/rssfeedstopstories.cms"],chennai:[Ae.CHENNAI,"https://www.thehindu.com/news/cities/chennai/feeder/default.rss"],trichy:["https://www.thehindu.com/news/cities/Tiruchirapalli/feeder/default.rss"],local:["https://news.google.com/rss/search?q=Muscat+Oman&hl=en-OM&gl=OM&ceid=OM:en","https://www.muscatdaily.com/feed"],business:[Ae.BUSINESS_IN_SEARCH,"https://economictimes.indiatimes.com/rssfeedstopstories.cms","https://www.moneycontrol.com/rss/business.xml","https://www.livemint.com/rss/money","https://feeds.bbci.co.uk/news/business/rss.xml","https://www.cnbc.com/id/10001147/device/rss/rss.html"],technology:[Ae.TECH_IN_SEARCH,"https://gadgets360.com/rss/news","https://techcrunch.com/feed/","https://www.theverge.com/rss/index.xml"],sports:["https://www.espn.com/espn/rss/news"],entertainment:["https://www.bollywoodhungama.com/rss/news.xml","https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml","https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/telugu-cinema/rssfeed.xml","https://www.pinkvilla.com/rss/feed/entertainment"],social:["https://www.theverge.com/rss/index.xml"]},ea={bbc:"BBC",ndtv:"NDTV",theHindu:"The Hindu",toi:"Times of India",financialExpress:"Financial Express",dtNext:"DT Next",omanObserver:"Oman Observer",moneyControl:"Moneycontrol",indiaToday:"India Today",variety:"Variety",hollywoodReporter:"Hollywood Reporter",bollywoodHungama:"Bollywood Hungama",alJazeera:"Al Jazeera"},ta=["breaking","election","war","crisis","ai","market","inflation","conflict","gold","storm","rain"],na=new RegExp(ta.join("|"),"i"),sa=300*1e3,it=new Map;function Vn(e,n){if(!e&&!n)return!1;const s=(e||"")+" "+(n||"");return na.test(s)}function Yt(e,n){if(!e||!n||n.length===0)return 0;const s=e.toLowerCase();let i=0;return n.forEach(a=>{a&&s.includes(a.toLowerCase())&&i++}),i}function yt(e){return e?e.replace(/<[^>]*>?/gm,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim():""}function ia(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function aa(e){if(!e)return"Unknown";if(e.includes(" - Google News"))return"Google News";const n=Object.keys(Fe).find(s=>s!=="default"&&e.toLowerCase().includes(s.toLowerCase()));return n?Fe[n].name:e}function ra(e,n,s){if(!n)return null;const i=n.match(/(?:["â€œ])([^"â€]{30,150})(?:["â€])/);if(i&&i[1]){let a=i[1].trim();if(a.length>0)return`"${a}"`}return null}function _t(e,n,s=0,i=null){const a=i||V(),r=a.rankingWeights||{},o=(Date.now()-e.publishedAt)/(1e3*60*60),l=r.freshness?.maxBoost||3;let c;if(a.rankingMode==="smart")c=l/(1+Math.exp(.5*(o-12)));else{const z=r.freshness?.decayHours||26;c=Math.max(0,(z-o)/z)*l}const d=wi(e.source),h=vi(e.source,n),u=r.source?.tier1Boost||.5,g=d*h,p=r.keyword?.matchBoost||2,m=Vn(e.title,e.description)?p:0,w=n==="world"?1.5:n==="business"?1.2:1;let v=0;e.sentiment&&(e.sentiment.label==="positive"?v=r.sentiment?.positiveBoost||.5:e.sentiment.label==="negative"&&(v=r.sentiment?.negativeBoost||.3));const f=/\b(live|updates|ongoing|developing)\b/i.test(e.title)?1.5:1,N=Fi.checkBreakingNews(e);e.isBreaking=N.isBreaking,e.breakingScore=N.breakingScore;const A=N.multiplier;if(a.enableNewScoring===!1)return(c+g+m+v)*w*A*f;const _=$i(e.title,e.description,a),L=Pi(e.title,e.description),P=Hi(e.title,e.description),M=Ui(e.title,null),B=Gi(e.title,e.description),O=Ki(e.imageUrl,a),D=c+m+v,I=1+d*h*u,S=D*I,$=_*L*P*M*B*O;let T=0,H=1;const W=a.buzz?.[n];if(W&&W.enabled){const z=e.title+" "+e.description,K=Yt(z,W.positiveKeywords),q=Yt(z,W.negativeKeywords),X=K*(W.positiveMultiplier||1),ie=q*(W.negativeMultiplier||1),le=X-ie;le<(W.filterThreshold||0)?H=.01:T=le*2}let E=1;const R=new Date().getDay(),b=R===0||R===6||R===5;if(["entertainment","social","movies"].includes(n)||e.section==="entertainment"){const z=a.rankingWeights?.temporal?.entertainmentBoost||2.5;E*=z}if(b&&["entertainment","social","local","chennai","trichy","events"].includes(n)){const z=a.rankingWeights?.temporal?.weekendBoost||2;E*=z}const C=r.viewedPenalty||.4;let k=1;s>0&&(k=C,s>3&&(k=C/2));const F=(S+T)*$*E*w*A*f*k*H;return(a.debugLogs||i)&&(e._scoreBreakdown={freshness:c,sourceScore:d,categoryWeight:h,keywordBoost:m,sentimentBoost:v,impact:_,proximity:L,novelty:P,currency:M,visual:O,sectionPriority:w,breakingBoost:A,seenPenalty:k,total:F}),F}function oa(e,n){let s=null;for(const[i,a]of Object.entries(ea))if(e.includes(a)||a.includes(e)){s=i;break}return s?n[s]!==!1:!0}async function St(e,n=10,s=null){const i=Date.now();if(n===0)return[];const a=e;let r=[];const o=V();if(o.enableCache!==!1){const d=it.get(a);if(d&&Date.now()-d.timestamp<sa){const h=Math.round((Date.now()-d.timestamp)/1e3);return console.log(`[RSS] âœ… Cache HIT for ${e} (age: ${h}s)`),Jt(d.data,e,n,s)}console.log(`[RSS] âš ï¸ Cache MISS for ${e} - Fetching fresh data`)}else console.log(`[RSS] â„¹ï¸ Cache DISABLED by user settings for ${e}`);if(e==="entertainment"){console.log("[RSS] Using entertainmentService for entertainment section");try{const h=V()?.entertainment||{},u=await Ci(h);return console.log(`[RSS] Entertainment: Got ${u.length} articles with distribution`),u.slice(0,n)}catch(d){console.error("[RSS] Entertainment service failed:",d)}}const c=Zi[e]||[];if(c.length===0)return console.warn(`[RSS] No feeds defined for section: ${e}`),[];try{console.log(`[RSS] Feeds for ${e}:`,c);const d=await Promise.allSettled(c.map(p=>Se(p,e))),h=[],u=[];d.forEach((p,m)=>{p.status==="fulfilled"&&p.value?(h.push(p.value),console.log(`[RSS] âœ… Feed ${m+1}/${c.length} succeeded`)):(u.push(c[m]),console.warn(`[RSS] âš ï¸ Feed ${m+1}/${c.length} failed: ${p.reason?.message||"Unknown error"}`))}),u.length>0&&h.length>0&&(console.log(`[RSS] Retrying ${u.length} failed feed(s) for ${e}...`),await new Promise(m=>setTimeout(m,2e3)),(await Promise.allSettled(u.map(m=>Se(m,e)))).forEach((m,w)=>{m.status==="fulfilled"&&m.value?(h.push(m.value),console.log(`[RSS] âœ… Retry succeeded: ${u[w]}`)):console.error(`[RSS] âŒ Retry also failed: ${u[w]}`)})),r=h.flat();const g=Date.now()-i;console.log(`[RSS] Section '${e}' stats:`,{totalFeeds:c.length,successCount:h.length,failureCount:c.length-h.length,totalItems:r.length}),he.success("rss",`${e}: ${r.length} items from ${h.length}/${c.length} feeds`,{durationMs:g}),o.enableCache!==!1&&(it.set(a,{timestamp:Date.now(),data:r}),console.log(`[RSS] ðŸ’¾ Cached ${r.length} items for ${e}`))}catch(d){return console.error(`[RSS] Unexpected error fetching section ${e}:`,{errorMessage:d.message,errorStack:d.stack,section:e}),he.error("rss",`${e}: ${d.message}`,{durationMs:Date.now()-i}),r.length>0?r:[]}try{let d=null;if(e==="social"){const g=V();g.buzzRankingWeights&&(d={...g,rankingWeights:{...g.rankingWeights,...g.buzzRankingWeights}})}const h=await Jt(r,e,n,s,d);h.forEach(g=>{g.sourceCount||(g.sourceCount=1)});const u=Xi(e,h.length);return qt(e,h.length),h.health=u,h.isSingleSource=Qi(h),h}catch(d){console.error(`[RSS] Ranking failed for ${e}:`,d);const h=r.slice(0,n);return qt(e,h.length),h}}async function Se(e,n){const{title:s,items:i}=await Kn.fetchViaProxy(e);return i.map(a=>la(a,s,n))}function la(e,n,s="general"){const i=e.pubDate||e.created||new Date().toISOString(),a=Date.parse(i)||Date.now();let r=n;e.author&&(r=e.author),r=aa(r);const o=ia(e.link||e.guid||e.title),l=e.description||"",d=Vi(e.title||"",l||"",r)||s;let h=null;if(e.enclosure&&e.enclosure.url)h=e.enclosure.url;else if(e.thumbnail)h=e.thumbnail;else if(e["media:content"]&&e["media:content"].url)h=e["media:content"].url;else if(l.includes("<img")){const p=l.match(/<img[^>]+src="([^">]+)"/);p&&(h=p[1])}h&&!h.startsWith("http")&&(h=null);const u=["business","market"].includes(s)||/\b(stock|market|shares|trading|sensex|nifty|bank|economy|crypto|ipo|revenue|profit)\b/i.test(e.title+l);let g=null;return u&&(g=Ti(e.title,yt(l))),{id:o,title:e.title,headline:e.title,description:l,summary:yt(l),link:e.link,url:e.link,source:r,publishedAt:a,fetchedAt:Date.now(),time:new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),impactScore:0,section:d,criticsView:ra(e.title,yt(l)),sentiment:g?{label:g.label,comparative:g.comparative,titleSentiment:g.titleSentiment,descriptionSentiment:g.descriptionSentiment}:null,imageUrl:h}}async function Jt(e,n,s,i,a=null){try{const r=new Set,o=Date.now(),l=a||V(),c=l.hideOlderThanHours||l.freshnessLimitHours||60,d=c*60*60*1e3,h=l.strictFreshness===!1,u=l.rankingMode!=="legacy";console.log(`[RSSDebug] filtering for ${n}: Limit=${c}h. Items=${e.length}`);const g=l.feedBlockedKeywords||[],p=e.filter(w=>{if(g.length>0){const f=(w.title+" "+w.description).toLowerCase();if(g.some(N=>f.includes(N.toLowerCase())))return!1}const j=/\b(live|updates)\b/i.test(w.title)?d*3:d;if(!h&&o-w.publishedAt>j)return!1;if(l.filteringMode==="keyword"){if(!Vn(w.title,w.description))return!1}else if(l.topWebsitesOnly){if(!["BBC","Reuters","NDTV","The Hindu","Times of India","Moneycontrol"].some(N=>w.source.includes(N)))return!1}else if(i&&!oa(w.source,i))return!1;return!0}).map(w=>{const v=w.section||n,j=Bn(w.id),f=u?_t(w,v,j,l):0;return{...w,section:v,impactScore:f}}).filter(w=>r.has(w.id)?!1:(r.add(w.id),!0)),m=Di(p,.75);return l.rankingMode==="legacy"?m.sort((w,v)=>v.publishedAt-w.publishedAt):m.sort((w,v)=>v.impactScore-w.impactScore),console.log(`[RSS] Final count for ${n}: ${m.length} (requested ${s})`),m.slice(0,s)}catch(r){throw console.error(`[RSS] Ranking error for ${n}:`,r),r}}function ca(){const e=it.size;return it.clear(),console.log(`[RSS] ðŸ—‘ï¸ Cleared ${e} cache entries`),e}function da(e,n=20,s=40,i=30){const a=[],r=new Map,o=new Map,l=[...e].sort((c,d)=>(d.impactScore||0)-(c.impactScore||0));for(const c of l){if(a.length>=n)break;const d=c.section||"general",h=ua(c.title,c.description),u=r.get(d)||0,g=o.get(h)||0,p=Math.floor(n*(s/100)),m=Math.floor(n*(i/100));u>=p||g>=m||(a.push(c),r.set(d,u+1),o.set(h,g+1))}return console.log("[Composer] Final composition:",{total:a.length,byTopic:Object.fromEntries(r),byGeo:Object.fromEntries(o)}),a}function ua(e,n){const s=`${e||""} ${n||""}`.toLowerCase();return/chennai|madras/i.test(s)?"chennai":/trichy|tiruchirappalli/i.test(s)?"trichy":/tamil nadu|tn /i.test(s)?"tamil-nadu":/india|delhi|mumbai|bangalore/i.test(s)?"india":"global"}const Xt="news_audit_history";function ha(e){if(e.length===0)return 0;const n=[...e].sort((i,a)=>i-a),s=Math.floor(n.length/2);return n.length%2!==0?n[s]:(n[s-1]+n[s])/2}function qn(e){return e.length===0?0:e.reduce((n,s)=>n+s,0)/e.length}function pa(e,n){if(e.length===0)return 0;const s=e.map(a=>Math.pow(a-n,2)),i=qn(s);return Math.sqrt(i)}function ma(e,n){const s={},i=n?.rankingWeights?.audit?.consensusThreshold||2;return e.forEach(a=>{const r=a.sourceCount||1;let o=null;r>=i+1?o="âš¡âš¡":r>=i&&(o="âš¡"),s[a.id]={count:r,sources:a.allSources||[a.source],badge:o}}),s}function ga(e,n){const s={};if(!n)return s;const i=new Set;n.followedTopics&&n.followedTopics.forEach(r=>i.add(r.query.toLowerCase())),n.upAhead&&n.upAhead.keywords&&Object.values(n.upAhead.keywords).flat().forEach(r=>{r&&i.add(r.toLowerCase())});const a=Object.entries(n.newsSources||{}).filter(([r,o])=>o).map(([r])=>r.toLowerCase());return e.forEach(r=>{const o=(r.title||"").toLowerCase(),l=(r.source||"").toLowerCase();let c=[],d=0;i.forEach(g=>{o.includes(g)&&(c.push(g),d+=1)});const h=a.some(g=>l.includes(g)||g.includes(l));let u=null;c.length>0&&(u=h?"ðŸŽ¯":"ðŸ“Œ"),s[r.id]={score:d,matches:c,badge:u}}),s}function fa(e,n){const s={};if(e.length<3)return s;const i=Date.now(),a=e.map(l=>(i-new Date(l.publishedAt).getTime())/(1e3*60*60)),r=ha(a),o=n?.rankingWeights?.freshness?.anomalyThreshold||2;return e.forEach((l,c)=>{const d=a[c];let h="none",u=null;d>6&&d>r*o&&(h="age",u="ðŸ•°ï¸"),s[l.id]={type:h,badge:u}}),s}function ya(e,n){const s={};if(e.length<5)return s;const i=e.map(l=>l.impactScore||0),a=qn(i),r=pa(i,a),o=n?.rankingWeights?.audit?.anomalySigma||2;return e.forEach(l=>{const c=l.impactScore||0;let d="none",h=null;c>a+o*r?(d="score_high",h="ðŸ“Šâ†‘"):c<a-1.5*r&&(d="score_low",h="ðŸ“Šâ†“"),s[l.id]={type:d,badge:h}}),s}async function xa(e,n){const s={};let i={};try{const r=localStorage.getItem(Xt);i=r?JSON.parse(r):{}}catch(r){console.warn("Failed to load audit history",r)}const a={};Object.entries(e).forEach(([r,o])=>{if(!Array.isArray(o)||o.length===0)return;const l=ma(o,n),c=ga(o,n),d=fa(o,n),h=ya(o,n),u=o.slice(0,10).map(p=>p.id),g=new Set(i[r]||[]);a[r]=u,o.forEach(p=>{const m=p.id,w=u.includes(m)&&g.has(m)?"ðŸŒ©ï¸":null;let v=null;p.isBreaking&&l[m]?.count>1?v="âœ…":p.isBreaking&&(v="â“"),s[m]={consensus:l[m],relevance:c[m],anomaly:h[m]?.badge?h[m]:d[m]?.badge?d[m]:{type:"none",badge:null},persistenceBadge:w,breakingVerified:v}})});try{localStorage.setItem(Xt,JSON.stringify(a))}catch(r){console.warn("Failed to save audit history",r)}return s}const Yn=y.createContext(),Qe=["world","india","chennai","trichy"];function wa({children:e}){const{settingsVersion:n}=se(),s=y.useRef(n),[i,a]=y.useState({}),[r,o]=y.useState([]),[l,c]=y.useState(!0),[d,h]=y.useState([]),[u,g]=y.useState({}),[p,m]=y.useState(0),[w,v]=y.useState({}),j=y.useCallback(async N=>{if(!d.includes(N)){console.log(`[NewsContext] Lazy loading section: ${N}`);try{const A=V();if(A.sections[N]&&!A.sections[N].enabled){console.log(`[NewsContext] Skipping lazy load for disabled section: ${N}`);return}const _=A.sections[N]?.count||10,L=await St(N,_+5,A.newsSources);a(P=>({...P,[N]:L||[]}))}catch(A){console.error(`[NewsContext] Failed to load section ${N}:`,A),g(_=>({..._,[N]:A.message}))}finally{h(A=>[...new Set([...A,N])])}}},[d]),f=y.useCallback(async(N=null)=>{c(!0);const A=Date.now();try{const _=V();if(!_){console.error("[NewsContext] Settings not available");return}const P=N||["world","india","chennai","trichy","local","social","entertainment","business","technology"],M=P.filter(S=>Qe.includes(S)),B=P.filter(S=>!Qe.includes(S)),O=[M,B].filter(S=>S.length>0);let D={};for(const S of O){const $={},T={};console.log(`[NewsContext] Fetching batch: ${S.join(", ")}`),await Promise.all(S.map(async b=>{if(_.sections[b]?.enabled!==!1)try{const C=_.sections[b]?.count||10,k=await St(b,C+5,_.newsSources);k&&Array.isArray(k)?$[b]=k:$[b]=[]}catch(C){console.error(`[NewsContext] Error ${b}:`,C),T[b]=C.message,$[b]=[]}})),Object.assign(D,$);const H=Object.values(D).flat(),W={};Object.keys(D).forEach(b=>W[b]=[]),H.forEach(b=>{const C=b.section||"uncategorized";W[C]||(W[C]=[]),W[C].push(b)}),Object.keys(W).forEach(b=>{W[b].sort((C,k)=>(k.impactScore||0)-(C.impactScore||0))});const E=Object.values(W).flat(),x=da(E,20,_.maxTopicPercent||40,_.maxGeoPercent||30);if(x&&x.length>0){const b=x.map(C=>C.id);Gs(b)}a(b=>({...b,...W,frontPage:x})),g(b=>({...b,...T})),h(b=>[...new Set([...b,...Object.keys($)])]);const R=H.filter(b=>b.isBreaking||b.breakingScore&&b.breakingScore>1.5).sort((b,C)=>(C.breakingScore||0)-(b.breakingScore||0)).slice(0,3);o(R)}m(Date.now());const I=Date.now()-A;console.log(`[NewsContext] âœ… Refresh complete in ${I}ms`)}catch(_){console.error("[NewsContext] âŒ Fatal refresh error:",{errorMessage:_.message,errorStack:_.stack,timestamp:new Date().toISOString()})}finally{c(!1)}},[]);return y.useEffect(()=>{if(p===0)return;console.log("[NewsContext] Scheduling audit...");const N=setTimeout(async()=>{try{const A=V(),_=await xa(i,A);v(L=>({...L,..._}))}catch(A){console.error("[NewsContext] Audit failed:",A)}},3e3);return()=>clearTimeout(N)},[p]),y.useEffect(()=>{s.current!==n&&(console.log("[NewsContext] Settings changed (v"+n+") - refreshing"),ca(),s.current=n,f())},[n,f]),y.useEffect(()=>{console.log("[NewsContext] Mounting - Initial fetch (Priority Only)");const N=setTimeout(()=>{f(Qe)},500),A=setInterval(()=>{console.log("[NewsContext] Auto-refresh (5min cycle)"),f(Qe)},300*1e3);return()=>{clearTimeout(N),clearInterval(A),console.log("[NewsContext] Unmounting")}},[f]),t.jsx(Yn.Provider,{value:{newsData:i,loading:l,errors:u,refreshNews:f,breakingNews:r,lastFetch:p,loadSection:j,loadedSections:d,auditResults:w},children:e})}function Ge(){return y.useContext(Yn)}const fe=({active:e=!1,color:n="var(--accent-primary)",style:s={}})=>e?t.jsxs("div",{style:{position:"relative",height:"2px",width:"100%",overflow:"hidden",backgroundColor:"rgba(255,255,255,0.1)",...s},children:[t.jsx("div",{className:"progress-bar-shim",style:{position:"absolute",top:0,left:0,bottom:0,width:"100%",background:`linear-gradient(90deg, transparent, ${n}, transparent)`,transform:"translateX(-100%)",animation:"shim-infinite 1.5s infinite linear"}}),t.jsx("style",{children:`
                @keyframes shim-infinite {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            `})]}):null;function ue({id:e,title:n,icon:s,colorClass:i,news:a=[],maxDisplay:r=3,showExpand:o=!0,error:l=null,extraContent:c=null,onArticleClick:d=null,showCritics:h=!0,loading:u=!1}){const[g,p]=y.useState(!1),[m,w]=y.useState(!1),{auditResults:v}=Ge(),f=V().rankingWeights?.trending?.threshold||12,N=g?a.length:Math.min(r,a.length),A=a.slice(0,N),_=a.length>r,L=a.health||{status:"ok"},P=a.isSingleSource,M=S=>!S&&S!==0?"":S>15?"â­â­â­â­â­":S>10?"â­â­â­â­":S>6?"â­â­â­":S>3?"â­â­":"â­",B=S=>{switch(S?.toUpperCase()){case"HIGH":return"news-item__confidence--high";case"MEDIUM":return"news-item__confidence--medium";case"LOW":return"news-item__confidence--low";default:return""}},O=S=>{if(!S)return"";const $=Math.floor((Date.now()-S)/1e3);let T=$/31536e3;return T>1?Math.floor(T)+"y ago":(T=$/2592e3,T>1?Math.floor(T)+"mo ago":(T=$/86400,T>1?Math.floor(T)+"d ago":(T=$/3600,T>1?Math.floor(T)+"h ago":(T=$/60,T>1?Math.floor(T)+"m ago":"Just now"))))},D=S=>{Pn(S),d&&d(S),S.url&&window.open(S.url,"_blank","noopener,noreferrer")},I=()=>l?t.jsxs("div",{className:"empty-state",style:{borderColor:"rgba(255, 87, 87, 0.3)"},children:[t.jsx("div",{className:"empty-state__icon",children:"âŒ"}),t.jsx("p",{style:{color:"#ff5757"},children:l})]}):u?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-muted)"},children:"Loading stories..."}):a.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"ðŸ“­"}),t.jsx("p",{children:"No news available for this section"})]}):t.jsxs(t.Fragment,{children:[c,t.jsx("div",{className:"news-list",children:A.map((S,$)=>t.jsxs("article",{className:"news-item",onClick:()=>D(S),style:{cursor:S.url?"pointer":"default"},children:[t.jsxs("div",{className:"news-item__badges",style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",fontSize:"0.85rem"},children:[M(S.impactScore)&&t.jsx("span",{title:`Impact Score: ${S.impactScore?.toFixed(1)}`,children:M(S.impactScore)}),S.isBreaking&&t.jsx("span",{title:"Breaking News",children:"âš¡"}),!S.isBreaking&&S.impactScore>f&&t.jsx("span",{title:"Trending",children:"ðŸ”¥"}),v[S.id]&&t.jsxs("span",{className:"audit-badges",style:{display:"flex",gap:"4px"},children:[v[S.id].consensus?.badge&&t.jsx("span",{title:`Corroborated by ${v[S.id].consensus.count} sources`,children:v[S.id].consensus.badge}),v[S.id].persistenceBadge&&t.jsx("span",{title:"Persistence",children:v[S.id].persistenceBadge}),v[S.id].relevance?.badge&&t.jsx("span",{title:"Relevance",children:v[S.id].relevance.badge}),v[S.id].anomaly?.badge&&t.jsx("span",{title:`Anomaly: ${v[S.id].anomaly.type}`,children:v[S.id].anomaly.badge}),v[S.id].breakingVerified&&t.jsx("span",{title:"Verified",children:v[S.id].breakingVerified})]})]}),t.jsxs("h3",{className:"news-item__headline",children:["â€¢ ",S.headline,S.url&&t.jsx("span",{style:{fontSize:"0.7rem",marginLeft:"8px",color:"var(--accent-secondary)"},children:"â†—"})]}),S.summary&&t.jsx("p",{className:"news-item__summary",children:S.summary}),h&&S.criticsView&&t.jsxs("div",{className:"news-item__critics",children:[t.jsx("span",{children:"ðŸ’¬"}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--accent-secondary)",display:"block",marginBottom:"2px"},children:"Critics Take:"}),S.criticsView]})]}),t.jsxs("div",{className:"news-item__meta",children:[S.sentiment&&t.jsx("span",{className:`sentiment-badge sentiment--${S.sentiment.label}`,title:`Sentiment: ${S.sentiment.label}`,children:S.sentiment.label==="positive"?"ðŸŸ¢":S.sentiment.label==="negative"?"ðŸ”´":"âšª"}),t.jsx("span",{className:"news-item__source",children:S.source}),S.sourceCount>1&&t.jsxs("span",{className:"news-item__consensus",title:`Reported by ${S.sourceCount} sources`,children:["ðŸ”” ",S.sourceCount," sources"]}),t.jsx("span",{children:"|"}),t.jsx("span",{children:O(S.publishedAt)||S.time}),S.sourceCount&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"|"}),t.jsxs("span",{children:["#",S.sourceCount," Sources"]})]}),t.jsx("span",{children:"|"}),t.jsx("span",{className:`news-item__confidence ${B(S.confidence)}`,children:S.confidence})]})]},S.id||$))}),o&&_&&t.jsxs("div",{className:"news-more",onClick:()=>p(!g),children:[t.jsx("span",{style:{fontSize:"1.2rem"},children:g?"â–²":"â–¼"}),t.jsx("span",{children:g?"Collapse":`See ${a.length-r} more stories`})]})]});return t.jsxs("section",{className:"news-section",id:e,children:[t.jsxs("h2",{className:`news-section__title ${i}`,onClick:()=>w(!m),style:{cursor:"pointer"},title:`Tap to fold/unfold. Health: ${L.status.toUpperCase()}`,children:[t.jsx("span",{children:s}),n,L.status==="critical"&&t.jsx("span",{title:"Critical: Feed yield < 10% of average",style:{marginLeft:"8px"},children:"ðŸ”´"}),L.status==="warning"&&t.jsx("span",{title:"Warning: Feed yield < 50% of average",style:{marginLeft:"8px"},children:"âš ï¸"}),P&&a.length>3&&t.jsx("span",{title:"Single Source: Potential echo chamber",style:{marginLeft:"8px"},children:"ðŸ“¡"}),a.length>0&&t.jsxs("span",{style:{opacity:.6,fontSize:"0.9em",marginLeft:"6px"},children:["(",a.length,")"]}),t.jsx("span",{style:{marginLeft:"8px",fontSize:"0.8em",opacity:.5},children:m?"â–¼":"â–²"}),a.length>0&&a[0].fetchedAt&&t.jsx("span",{style:{fontSize:"0.65rem",marginLeft:"auto",padding:"2px 6px",borderRadius:"4px",background:Date.now()-a[0].fetchedAt<36e5?"rgba(0, 255, 0, 0.2)":"rgba(255, 165, 0, 0.2)",color:Date.now()-a[0].fetchedAt<36e5?"#4caf50":"#ffa726",border:"1px solid currentColor",fontWeight:"normal"},children:Date.now()-a[0].fetchedAt<3e5?"LIVE":O(a[0].fetchedAt)})]}),t.jsx(fe,{active:u}),!m&&I()]})}const Ct=({sections:e})=>{const n=s=>{const i=document.getElementById(s);if(i){const o=i.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:o,behavior:"smooth"})}};return!e||e.length===0?null:t.jsx("div",{className:"section-navigator",children:e.map(({id:s,icon:i,label:a})=>t.jsx("button",{className:"section-navigator__btn",onClick:()=>n(s),title:a,children:t.jsx("span",{className:"section-navigator__icon",children:i})},s))})},va=({items:e})=>{const[n,s]=y.useState(0);if(y.useEffect(()=>{if(!e||e.length<2)return;const a=setInterval(()=>{s(r=>(r+1)%e.length)},5e3);return()=>clearInterval(a)},[e]),!e||e.length===0)return null;const i=e[n];return t.jsxs("div",{className:"breaking-news-banner",children:[t.jsxs("div",{className:"breaking-label",children:[t.jsx("span",{className:"pulse-icon",children:"ðŸ”´"})," BREAKING"]}),t.jsxs("div",{className:"breaking-content",children:[t.jsx("a",{href:i.link,target:"_blank",rel:"noopener noreferrer",className:"breaking-link",children:i.title}),t.jsxs("span",{className:"breaking-time",children:[i.time," â€¢ ",i.source]})]}),e.length>1&&t.jsx("div",{className:"breaking-controls",children:e.map((a,r)=>t.jsx("span",{className:`control-dot ${r===n?"active":""}`,onClick:()=>s(r)},r))})]})},ba=({title:e,icon:n,actions:s,loadingPhase:i})=>{const a=e!=="Market Brief";return t.jsxs("header",{className:"header timeline-header",children:[a&&t.jsx("h1",{className:"header__title",style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:t.jsx("span",{children:e})}),t.jsx(Un,{loadingPhase:i}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:s})]})};function Sa(e){const n=e.filter(c=>c?.precipitation_probability!=null);if(n.length===0)return null;const s=n.map(c=>c.precipitation_probability),i=Math.round(s.reduce((c,d)=>c+d,0)/s.length),a=Math.min(...s),r=Math.max(...s),o=r-a,l=o>30;return{avg:i,min:a,max:r,range:o,isWideRange:l,displayString:`${l?"!":"~"}${i}% (${a}-${r}%)`,symbol:l?"!":"~",models:n.length}}function Qt(e){const n=e.filter(r=>r?.temperature_2m!=null);if(n.length===0)return null;let s=0,i=0;const a={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=a[r.modelName]||1;i+=r.temperature_2m*o,s+=o}),Math.round(s===0?n.reduce((r,o)=>r+o.temperature_2m,0)/n.length:i/s)}function Zt(e){const n=e.filter(i=>i?.apparent_temperature!=null);if(n.length===0)return null;const s=n.map(i=>i.apparent_temperature);return Math.round(s.reduce((i,a)=>i+a,0)/s.length)}function en(e){const n=e.filter(o=>o?.weather_code!=null);if(n.length===0)return null;const s=n.map(o=>o.weather_code),i={};s.forEach(o=>{i[o]=(i[o]||0)+1});let a=0,r=s[0];for(const[o,l]of Object.entries(i))l>a&&(a=l,r=parseInt(o));return r}function ja(e){const n=e.filter(r=>r?.precipitation!=null);if(n.length===0)return 0;let s=0,i=0;const a={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=a[r.modelName]||1;i+=r.precipitation*o,s+=o}),s===0?0:parseFloat((i/s).toFixed(1))}function Jn(e){return Object.entries(e).filter(([n,s])=>s!==null).map(([n,s])=>n)}function Xn(e){const n={ecmwf:"ECMWF",gfs:"GFS",icon:"ICON"};return e.map(s=>n[s]||s).join(", ")}function Na(e,n,s,i){const a=ka(n),r=_a(e),o=`${a}_${r}`,l={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};return l[o]?l[o]:o}function ka(e){return e>=6&&e<8?"dawn":e>=8&&e<17?"day":e>=17&&e<19?"dusk":"night"}function _a(e){return e===0||e<=1?"clear":e===2?"partlyCloudy":e===3?"overcast":e>=45&&e<=48?"fog":e>=51&&e<=55||e>=56&&e<=57?"drizzle":e===61?"lightRain":e===63?"rain":e===65?"heavyRain":e>=66&&e<=67?"rain":e>=71&&e<=77?"snow":e>=80&&e<=82?"rain":e===85||e===86?"snow":e>=95&&e<=99?"storm":"cloudy"}const Qn={ecmwf:"https://api.open-meteo.com/v1/ecmwf",gfs:"https://api.open-meteo.com/v1/gfs",icon:"https://api.open-meteo.com/v1/dwd-icon"},tn={chennai:{lat:13.0827,lon:80.2707},trichy:{lat:10.7905,lon:78.7047},muscat:{lat:23.5859,lon:58.4059}};async function Ca(e){const n=e.toLowerCase();if(tn[n])return tn[n];try{const s=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");if(s[n])return s[n]}catch{console.warn("Geocode cache read failed")}try{console.log(`[WeatherService] Geocoding ${e}...`);const i=await(await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(e)}&count=1&language=en&format=json`)).json();if(i.results&&i.results.length>0){const a={lat:i.results[0].latitude,lon:i.results[0].longitude};try{const r=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");r[n]=a,localStorage.setItem("weather_geo_cache",JSON.stringify(r))}catch{}return a}}catch(s){console.error("Geocoding failed:",s)}throw new Error(`Location not found: ${e}`)}async function Ea(e,n,s){const i=Qn[e];if(!i)throw new Error(`Unknown model: ${e}`);const a=new URLSearchParams({latitude:n,longitude:s,current:"temperature_2m,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m",hourly:"temperature_2m,precipitation_probability,precipitation,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m,uv_index,cloud_cover,visibility,dew_point_2m",daily:"precipitation_probability_max,precipitation_sum,uv_index_max",timezone:"auto"}),r=`${i}?${a}`;console.log(`[WeatherService] Fetching ${e.toUpperCase()}...`);const o=await fetch(r);if(!o.ok)throw new Error(`${e.toUpperCase()} API request failed: ${o.status}`);const l=await o.json();return console.log(`[WeatherService] âœ… ${e.toUpperCase()}: Success`),l}async function Ta(e){const n=Date.now();let s,i;try{const l=await Ca(e);s=l.lat,i=l.lon}catch{throw new Error(`Unknown location: ${e}`)}const r=V().weather?.models||{ecmwf:!0,gfs:!0,icon:!0},o=Object.keys(Qn).filter(l=>r[l]!==!1);o.length===0&&(console.warn("[WeatherService] No models enabled, using all models"),o.push("ecmwf","gfs","icon")),console.log(`[WeatherService] Fetching from models: ${o.join(", ")}`);try{const l=await Promise.allSettled(o.map(u=>Ea(u,s,i))),c={};o.forEach((u,g)=>{c[u]=l[g].status==="fulfilled"?l[g].value:null,l[g].status==="rejected"&&console.warn(`[WeatherService] âš ï¸ ${u.toUpperCase()} failed:`,l[g].reason?.message)});const d=Jn(c);if(d.length===0)throw new Error("All weather models failed to fetch data");const h=Date.now()-n;return console.log(`[WeatherService] âœ… ${d.length}/${o.length} models succeeded: ${Xn(d)}`),he.success("weather",`${e}: ${d.length}/${o.length} models OK`,{durationMs:h}),Ia(c,e)}catch(l){throw console.error(`[WeatherService] âŒ Error fetching weather for ${e}:`,l),he.error("weather",`${e}: ${l.message}`,{durationMs:Date.now()-n}),l}}function Ia(e,n){const s=[e.ecmwf?.current,e.gfs?.current,e.icon?.current].filter(Boolean),i=(E,x)=>Na(E,x??new Date().getHours()),a=E=>E<=1?"â˜€ï¸":E<=3?"â›…":E<=67?"ðŸŒ§ï¸":E<=99?"â›ˆï¸":"â“",r={0:"Clear",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",48:"Fog",51:"Light Drizzle",61:"Light Rain",63:"Rain",65:"Heavy Rain",80:"Rain Showers",95:"Thunderstorm"},o=E=>r[E]||"Unknown",l=(E,x)=>{const R=[];for(let U=E;U<=x;U++)R.push(U);const b=[];e.ecmwf?.hourly&&b.push(e.ecmwf.hourly),e.gfs?.hourly&&b.push(e.gfs.hourly),e.icon?.hourly&&b.push(e.icon.hourly);const C={},k=[],F=[],z=[],K=[],q=[],X=[],ie=[],le=[],je=[];R.forEach(U=>{e.ecmwf?.hourly?.precipitation_probability?.[U]!=null&&(C.ecmwf||(C.ecmwf=[]),C.ecmwf.push(e.ecmwf.hourly.precipitation_probability[U])),e.gfs?.hourly?.precipitation_probability?.[U]!=null&&(C.gfs||(C.gfs=[]),C.gfs.push(e.gfs.hourly.precipitation_probability[U])),e.icon?.hourly?.precipitation_probability?.[U]!=null&&(C.icon||(C.icon=[]),C.icon.push(e.icon.hourly.precipitation_probability[U]));const Q=b.map(Y=>({modelName:Y._modelName,temperature_2m:Y.temperature_2m?.[U],apparent_temperature:Y.apparent_temperature?.[U],precipitation:Y.precipitation?.[U],precipitation_probability:Y.precipitation_probability?.[U],weather_code:Y.weather_code?.[U],relative_humidity_2m:Y.relative_humidity_2m?.[U],wind_speed_10m:Y.wind_speed_10m?.[U],uv_index:Y.uv_index?.[U],cloud_cover:Y.cloud_cover?.[U]})),Ie=Qt(Q),ce=Zt(Q),Ye=ja(Q),Je=en(Q);Ie!==null&&k.push(Ie),ce!==null&&F.push(ce),Ye!==null&&z.push(Ye),Je!==null&&q.push(Je),Q.forEach(Y=>{Y.precipitation_probability!=null&&K.push({precipitation_probability:Y.precipitation_probability}),Y.relative_humidity_2m!=null&&X.push(Y.relative_humidity_2m),Y.wind_speed_10m!=null&&ie.push(Y.wind_speed_10m),Y.uv_index!=null&&le.push(Y.uv_index),Y.cloud_cover!=null&&je.push(Y.cloud_cover)})});const G=k.length>0?Math.round(k.reduce((U,Q)=>U+Q,0)/k.length):null,ae=F.length>0?Math.round(F.reduce((U,Q)=>U+Q,0)/F.length):G,ct=z.reduce((U,Q)=>U+Q,0),ys=Sa(K),qe=[];Object.values(C).forEach(U=>{if(U.length>0){const Q=Math.round(U.reduce((Ie,ce)=>Ie+ce,0)/U.length);qe.push(Q)}});let It=0,dt=0,ut=0;qe.length>0&&(dt=Math.min(...qe),ut=Math.max(...qe),It=ut-dt);let At=ct.toFixed(1)+"mm";ct<1&&(At="-");const Mt=q.length>0?q[Math.floor(q.length/2)]:0,xs=a(Mt),ws=Math.floor((E+x)/2)%24,vs=i(Mt,ws),bs=X.length>0?Math.round(X.reduce((U,Q)=>U+Q,0)/X.length):null,Ss=ie.length>0?Math.round(ie.reduce((U,Q)=>U+Q,0)/ie.length):null,js=le.length>0?Math.max(...le):null,Ns=je.length>0?Math.round(je.reduce((U,Q)=>U+Q,0)/je.length):null,ks=R.map((U,Q)=>{const Ie=e.ecmwf?"ecmwf":e.gfs?"gfs":"icon",ce=e[Ie]?.hourly;if(!ce)return null;const Ye=ce.temperature_2m?.[U],Je=ce.precipitation?.[U],Y=ce.precipitation_probability?.[U],Rt=ce.weather_code?.[U],ht=U%24,_s=ht>=12?"p":"a";return{time:`${ht%12===0?12:ht%12}${_s}`,temp:Ye,precip:Je,prob:Y,icon:a(Rt),iconId:i(Rt,U%24)}}).filter(Boolean);return{temp:G,feelsLike:ae,icon:xs,iconId:vs,rainMm:At,rainProb:ys||{avg:0,min:0,max:0,displayString:"~0%",isWideRange:!1},probSpread:It,minModelAvg:dt,maxModelAvg:ut,humidity:bs,windSpeed:Ss,uvIndex:js,cloudCover:Ns,hourly:ks}},c=E=>{const x=E*24;return{morning:l(6+x,11+x),noon:l(12+x,16+x),evening:l(17+x,22+x)}},d=c(0),h=c(1),u=Qt(s),g=Zt(s),p=en(s),m=s.length>0&&s[0].relative_humidity_2m!=null?Math.round(s.reduce((E,x)=>E+(x.relative_humidity_2m||0),0)/s.length):null,w=s.length>0&&s[0].wind_speed_10m!=null?Math.round(s.reduce((E,x)=>E+(x.wind_speed_10m||0),0)/s.length):null,v=s.length>0&&s[0].wind_direction_10m!=null?Math.round(s.reduce((E,x)=>E+(x.wind_direction_10m||0),0)/s.length):null,j=[e.ecmwf?.daily?.precipitation_probability_max?.[0],e.gfs?.daily?.precipitation_probability_max?.[0],e.icon?.daily?.precipitation_probability_max?.[0]].filter(E=>E!=null),f=j.length>0?Math.round(j.reduce((E,x)=>E+x,0)/j.length):0,N=[e.ecmwf?.daily?.precipitation_sum?.[0],e.gfs?.daily?.precipitation_sum?.[0],e.icon?.daily?.precipitation_sum?.[0]].filter(E=>E!=null),A=N.length>0?(N.reduce((E,x)=>E+x,0)/N.length).toFixed(1):0,_=[e.ecmwf?.daily?.uv_index_max?.[0],e.gfs?.daily?.uv_index_max?.[0],e.icon?.daily?.uv_index_max?.[0]].filter(E=>E!=null),L=_.length>0?Math.round(_.reduce((E,x)=>E+x,0)/_.length):null,P=Jn(e),M=new Date().getHours(),B=[];e.ecmwf?.hourly&&B.push(e.ecmwf.hourly),e.gfs?.hourly&&B.push(e.gfs.hourly),e.icon?.hourly&&B.push(e.icon.hourly);const O=[],D=[],I=E=>{const x=M+E,R=(M+E)%24,b=B.map(G=>G.temperature_2m?.[x]).filter(G=>G!=null),C=B.map(G=>G.precipitation?.[x]).filter(G=>G!=null),k=B.map(G=>G.precipitation_probability?.[x]).filter(G=>G!=null),F=B.map(G=>G.weather_code?.[x]).filter(G=>G!=null),z=B.map(G=>G.cloud_cover?.[x]).filter(G=>G!=null),K=b.length>0?Math.round(b.reduce((G,ae)=>G+ae,0)/b.length):null,q=C.length>0?parseFloat((C.reduce((G,ae)=>G+ae,0)/C.length).toFixed(1)):0,X=k.length>0?Math.round(k.reduce((G,ae)=>G+ae,0)/k.length):0,ie=F.length>0?F[Math.floor(F.length/2)]:0,le=z.length>0?Math.round(z.reduce((G,ae)=>G+ae,0)/z.length):0;return{hour:R,label:E===0?"Now":(G=>{const ae=G>=12?"p":"a";return`${G%12===0?12:G%12}${ae}`})(R),temp:K,precip:q,prob:X,cloud:le,icon:a(ie),iconId:i(ie,R),code:ie}};for(let E=0;E<24;E+=3)O.push(I(E));for(let E=0;E<8;E++)D.push(I(E));const S=[e.ecmwf?.daily?.temperature_2m_max?.[0],e.gfs?.daily?.temperature_2m_max?.[0],e.icon?.daily?.temperature_2m_max?.[0]].filter(E=>E!=null),$=[e.ecmwf?.daily?.temperature_2m_min?.[0],e.gfs?.daily?.temperature_2m_min?.[0],e.icon?.daily?.temperature_2m_min?.[0]].filter(E=>E!=null);let T=S.length>0?Math.round(S.reduce((E,x)=>E+x,0)/S.length):null,H=$.length>0?Math.round($.reduce((E,x)=>E+x,0)/$.length):null;T===null&&O.length>0&&(T=Math.max(...O.map(E=>E.temp||-999)),T===-999&&(T=null)),H===null&&O.length>0&&(H=Math.min(...O.map(E=>E.temp||999)),H===999&&(H=null));let W="";return parseFloat(A)>0&&(W+=`Today's max rain probability: ${f}%. Total precip: ${A}mm. `),W+=`Condition: ${o(p)}. UV Index: ${L||"N/A"}.`,{name:n.charAt(0).toUpperCase()+n.slice(1),icon:n==="muscat"?"ðŸ“":"ðŸ›ï¸",fetchedAt:Date.now(),models:{successful:P,count:P.length,names:Xn(P)},current:{temp:u,feelsLike:g,high:T,low:H,condition:o(p),icon:a(p),iconId:i(p,new Date().getHours()),humidity:m,windSpeed:w,windDirection:v},morning:d.morning,noon:d.noon,evening:d.evening,tomorrow:h,hourly24:O,next8Hours:D,summary:W}}const Zn=y.createContext();function Aa({children:e}){const{settingsVersion:n}=se(),s=y.useRef(n),[i,a]=y.useState(null),[r,o]=y.useState(!0),[l,c]=y.useState(null),[d,h]=y.useState(0),u=y.useCallback(async(g=!1)=>{const p=V(),m=(p?.weatherFreshnessLimit||4)*60*60*1e3;if(!g&&i){const w=Date.now()-d;if(w<900*1e3)return;p?.strictFreshness&&w>m&&a(null)}if(o(!0),p?.sections?.weather===!1){o(!1);return}try{const w=p?.weather?.cities||["chennai","trichy","muscat"],v=await Promise.allSettled(w.map(f=>Ta(f))),j={};w.forEach((f,N)=>{j[f]=v[N].status==="fulfilled"?v[N].value:null}),a(j),h(Date.now()),c(null)}catch(w){console.error("Weather Context Error:",w),c(w),a(null)}finally{o(!1)}},[i,d]);return y.useEffect(()=>{u()},[u]),y.useEffect(()=>{s.current!==n&&(s.current=n,u(!0))},[n,u]),t.jsx(Zn.Provider,{value:{weatherData:i,loading:r,error:l,refreshWeather:u},children:e})}function Ke(){return y.useContext(Zn)}const nn=32,xt={day_clear:t.jsxs("g",{children:[t.jsx("circle",{cx:"16",cy:"16",r:"6",fill:"#FFD93D"}),[0,45,90,135,180,225,270,315].map(e=>t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"7",stroke:"#FFD93D",strokeWidth:"2",strokeLinecap:"round",transform:`rotate(${e} 16 16)`},e))]}),night_clear:t.jsxs("g",{children:[t.jsx("path",{d:"M20 6 A10 10 0 1 0 26 20 A7 7 0 1 1 20 6Z",fill:"#B8C5E8"}),t.jsx("circle",{cx:"24",cy:"7",r:"1",fill:"#FFE"}),t.jsx("circle",{cx:"27",cy:"12",r:"0.7",fill:"#FFE"})]}),dawn_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#FF9F43",opacity:"0.3",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FFD93D"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),dusk_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#E74C3C",opacity:"0.25",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FF6B6B"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FF6B6B",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),day_partlyCloudy:t.jsxs("g",{children:[t.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD93D"}),[0,60,120,180,240,300].map(e=>t.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"3",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 12 12)`},e)),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#DFE6ED"})]}),night_partlyCloudy:t.jsxs("g",{children:[t.jsx("path",{d:"M10 6 A6 6 0 1 0 14 12 A4 4 0 1 1 10 6Z",fill:"#B8C5E8"}),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#636E83"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#778CA3"})]}),day_cloudy:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"11",ry:"6",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"6",ry:"5",fill:"#DFE6ED"}),t.jsx("ellipse",{cx:"20",cy:"16",rx:"5",ry:"4",fill:"#DFE6ED"})]}),day_overcast:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"12",ry:"6",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"7",ry:"5",fill:"#A4B0BE"}),t.jsx("ellipse",{cx:"21",cy:"16",rx:"5",ry:"4",fill:"#A4B0BE"})]}),day_fog:t.jsxs("g",{children:[[14,18,22].map((e,n)=>t.jsx("line",{x1:"4",y1:e,x2:"28",y2:e,stroke:"#B0BEC5",strokeWidth:"2.5",strokeLinecap:"round",opacity:.5+n*.15},n)),t.jsx("circle",{cx:"16",cy:"9",r:"4",fill:"#FFD93D",opacity:"0.4"})]}),day_drizzle:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"14",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"11",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("line",{x1:e,y1:"21",x2:e-1,y2:"25",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_lightRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#B0BEC5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#C8D6E5"}),[9,14,19,24].map((e,n)=>t.jsx("line",{x1:e,y1:"20",x2:e-1.5,y2:"26",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_rain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"12",rx:"11",ry:"5",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"9",rx:"6",ry:"4",fill:"#A4B0BE"}),[8,13,18,23].map((e,n)=>t.jsx("line",{x1:e,y1:"19",x2:e-2,y2:"27",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_heavyRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"11",rx:"12",ry:"5",fill:"#636E72"}),t.jsx("ellipse",{cx:"12",cy:"8",rx:"6",ry:"4",fill:"#778CA3"}),[7,12,17,22,27].map((e,n)=>t.jsx("line",{x1:e,y1:"18",x2:e-3,y2:"28",stroke:"#0984E3",strokeWidth:"2.5",strokeLinecap:"round"},n))]}),day_storm:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"10",rx:"12",ry:"5",fill:"#4A4A4A"}),t.jsx("ellipse",{cx:"12",cy:"7",rx:"6",ry:"4",fill:"#636E72"}),t.jsx("polygon",{points:"17,14 13,22 16,22 14,29 21,20 17,20 19,14",fill:"#FDCB6E"}),[8,24].map((e,n)=>t.jsx("line",{x1:e,y1:"17",x2:e-2,y2:"25",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_snow:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("text",{x:e,y:25,textAnchor:"middle",fontSize:"6",fill:"#74B9FF",children:"*"},n))]}),day_wind:t.jsxs("g",{children:[t.jsx("path",{d:"M4 14 Q12 10, 20 14 Q26 16, 28 12",fill:"none",stroke:"#78909C",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("path",{d:"M6 20 Q14 16, 22 20 Q27 22, 29 18",fill:"none",stroke:"#90A4AE",strokeWidth:"1.8",strokeLinecap:"round"}),t.jsx("path",{d:"M8 26 Q15 22, 24 26",fill:"none",stroke:"#B0BEC5",strokeWidth:"1.5",strokeLinecap:"round"})]})},Ma={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};function at({id:e,size:n=32,className:s=""}){const i=xt[e]||xt[Ma[e]]||xt.day_cloudy;return t.jsx("svg",{viewBox:`0 0 ${nn} ${nn}`,width:n,height:n,className:s,"aria-label":e?.replace(/_/g," "),children:i})}const ot=24,es=({size:e=ot,className:n=""})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"currentColor",className:n,style:{color:"#60a5fa",verticalAlign:"middle"},children:[t.jsx("path",{d:"M12,2 C12,2 7,7 7,10 C7,12.76 9.24,15 12,15 C14.76,15 17,12.76 17,10 C17,7 12,2 12,2 Z",opacity:"0.9"}),t.jsx("path",{d:"M6,12 C6,12 4,14 4,15.5 C4,16.6 4.9,17.5 6,17.5 C7.1,17.5 8,16.6 8,15.5 C8,14 6,12 6,12 Z",opacity:"0.7"}),t.jsx("path",{d:"M18,12 C18,12 16,14 16,15.5 C16,16.6 16.9,17.5 18,17.5 C19.1,17.5 20,16.6 20,15.5 C20,14 18,12 18,12 Z",opacity:"0.7"})]}),ts=({size:e=ot,className:n=""})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,style:{color:"#cbd5e1",verticalAlign:"middle"},children:t.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),Ra=({size:e=ot,className:n="",color:s="currentColor"})=>t.jsxs("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:[t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12h20c0-5.52-4.48-10-10-10z",opacity:"1"}),t.jsx("path",{d:"M11 12h2v7c0 1.1.9 2 2 2s2-.9 2-2h-2c0 .55-.45 1-1 1s-1-.45-1-1v-7z",opacity:"0.8"})]}),sn=({size:e=ot,className:n="",color:s="currentColor"})=>t.jsx("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})}),an=()=>{const{weatherData:e,loading:n,error:s}=Ke(),[i,a]=y.useState(()=>{try{return localStorage.getItem("weather_active_city")||"chennai"}catch{return"chennai"}});if(y.useEffect(()=>{try{localStorage.setItem("weather_active_city",i)}catch{}},[i]),n)return t.jsx("div",{className:"quick-weather-card qw-bg-day",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Loading weather..."})});if(s||!e)return t.jsx("div",{className:"quick-weather-card qw-bg-night",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Weather unavailable"})});const{settings:r}=se(),o=(r.weather?.cities||["chennai","trichy","muscat"]).map(m=>m.toLowerCase()),l={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[o[2]]:o[2].charAt(0).toUpperCase()+o[2].slice(1)},c={chennai:"ðŸ›ï¸",trichy:"ðŸ¯",muscat:"ðŸ“",[o[2]]:"ðŸ“"},d=new Date().getHours();let h="qw-bg-day";d>=6&&d<11?h="qw-bg-morning":d>=11&&d<17?h="qw-bg-day":d>=17&&d<20?h="qw-bg-evening":h="qw-bg-night";const u=e[i],g=La(u),p=Oa(u);return t.jsxs("section",{className:`quick-weather-card ${h}`,children:[t.jsx("div",{className:"qw-cities-grid",children:o.map(m=>{const w=e[m];if(!w?.current)return null;const v=w.current,j=m===i;return t.jsxs("div",{className:`qw-city-card ${j?"qw-city-card--active":""}`,onClick:()=>a(m),children:[t.jsxs("div",{className:"qw-city-header",children:[t.jsx("span",{className:"qw-city-icon",children:c[m]}),t.jsx("span",{className:"qw-city-name",children:l[m]})]}),t.jsxs("div",{className:"qw-city-temp-row",children:[t.jsxs("span",{className:"qw-city-temp",style:{fontSize:"0.9rem"},children:[v.temp,"Â°"]}),t.jsx("span",{className:"qw-city-weather-icon",children:v.iconId?t.jsx(at,{id:v.iconId,size:48}):t.jsx("span",{style:{fontSize:"2.5rem"},children:v.icon})})]}),t.jsx("div",{className:"qw-city-condition",children:v.condition}),t.jsxs("div",{className:"qw-city-meta",children:[t.jsxs("span",{children:[t.jsx(es,{size:"0.85em"})," ",v.humidity??"--","%"]}),t.jsxs("span",{children:[t.jsx(ts,{size:"0.85em"})," ",v.windSpeed??"--"]})]})]},m)})}),u?.hourly24&&t.jsxs("div",{className:"qw-timeline-section",children:[t.jsx("div",{className:"qw-timeline-label",style:{fontWeight:600,fontSize:"0.85rem"},children:Da(u,l[i])}),t.jsx("div",{className:"qw-timeline-strip",children:u.hourly24.map((m,w)=>t.jsxs("div",{className:"qw-timeline-slot",children:[t.jsx("div",{className:"qw-slot-time",children:m.label}),t.jsx("div",{className:"qw-slot-icon",children:m.iconId?t.jsx(at,{id:m.iconId,size:40}):m.icon}),t.jsxs("div",{className:"qw-slot-temp",style:{fontSize:"0.9rem"},children:[m.temp,"Â°"]}),m.precip>.5&&t.jsxs("div",{className:"qw-slot-rain",children:[m.precip,"mm"]})]},w))})]}),g&&t.jsxs("div",{className:"qw-headsup",children:[t.jsx("span",{className:"qw-headsup-icon",children:g.icon}),t.jsx("span",{children:g.message})]}),p&&t.jsxs("div",{className:"qw-severe",style:{background:"rgba(220,38,38,0.15)",border:"1px solid rgba(220,38,38,0.4)",borderRadius:"8px",padding:"8px 12px",margin:"8px 0 0",display:"flex",alignItems:"center",gap:"8px",fontSize:"0.78rem",color:"#fca5a5"},children:[t.jsx("span",{style:{fontSize:"1.1rem"},children:"âš ï¸"}),t.jsx("span",{children:p})]})]})};function Da(e,n){if(!e?.hourly24)return`${n} â€¢ Forecast`;const i=e.hourly24.filter(r=>r.precip>.5||r.prob>40),a=e.current;return i.length>=3?`${n} â€¢ Rainy spells ahead`:i.length>0?`${n} â€¢ Scattered showers`:a?.condition?`${n} â€¢ ${a.condition}`:`${n} â€¢ Clear Skies`}function La(e){if(!e?.hourly24)return null;const s=e.hourly24.filter(g=>g.precip>.5||g.prob>40);if(s.length===0)return null;const i=s.reduce((g,p)=>g+(p.precip||0),0),a=Math.max(...s.map(g=>g.prob||0)),r=g=>{const p=g>=12?"p":"a";return`${g%12===0?12:g%12}${p}`},o=r(s[0].hour),l=s.length>1?r(s[s.length-1].hour):null;let c="Rain",d="ðŸŒ§ï¸";i>=10||a>=80?(c="Heavy rain",d="â›ˆï¸"):i<2&&a<50&&(c="Light showers possible",d="ðŸŒ¦ï¸");const h=l?`${o}â€“${l}`:`around ${o}`,u=i>.5?` (~${i.toFixed(1)}mm)`:"";return{icon:d,message:`${c} expected ${h}${u}`}}function Oa(e){if(!e?.hourly24)return null;const n=e.hourly24,s=n.filter(o=>o.precip>=10),i=n.filter(o=>o.prob>=80),a=n.map(o=>o.temp).filter(o=>o!=null),r=a.length>0?Math.max(...a):null;return s.length>0?`Heavy rainfall warning: ${s.reduce((l,c)=>l+c.precip,0).toFixed(1)}mm expected`:i.length>=2?"Thunderstorm activity likely in the next 24 hours":r!=null&&r>=42?`Extreme heat warning: Temperatures may reach ${r}Â°C`:null}const rn={MORNING_WEATHER:{id:"morning_weather",name:"Morning Weather",icon:"ðŸŒ…",startHour:6,startMinute:55,endHour:7,endMinute:0,sections:["weather"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MORNING_NEWS:{id:"morning_news",name:"Morning News",icon:"ðŸŒ„",startHour:7,startMinute:0,endHour:9,endMinute:0,sections:["weather","world","india","chennai","trichy","local","dtNext"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MARKET_BRIEF:{id:"market_brief",name:"Market Brief",icon:"ðŸ“Š",startHour:9,startMinute:0,endHour:11,endMinute:55,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},MIDDAY_BRIEF:{id:"midday_brief",name:"Midday Brief",icon:"â˜€ï¸",startHour:11,startMinute:55,endHour:14,endMinute:30,sections:["india","world","chennai","trichy"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!1,social:!1,weather:!0,market:!0}},MARKET_MOVERS:{id:"market_movers",name:"Market Movers",icon:"ðŸ“ˆ",startHour:14,startMinute:30,endHour:16,endMinute:20,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},EVENING_NEWS:{id:"evening_news",name:"Evening News",icon:"ðŸŒ†",startHour:16,startMinute:20,endHour:16,endMinute:45,sections:["world","india","chennai","trichy","local","social"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},LOCAL_EVENTS:{id:"local_events",name:"Local Events",icon:"ðŸ“",startHour:16,startMinute:45,endHour:19,endMinute:30,sections:["chennai","trichy","local","social"],recommended:{world:!1,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!1}},NIGHT_WRAP_UP:{id:"night_wrap_up",name:"Night Wrap-Up",icon:"ðŸŒ™",startHour:19,startMinute:30,endHour:20,endMinute:0,sections:["world","india","chennai","trichy","local","social","market"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},URGENT_ONLY:{id:"urgent_only",name:"Urgent Alerts Only",icon:"ðŸ””",startHour:20,startMinute:0,endHour:6,endMinute:55,sections:["urgent"],recommended:{world:!1,india:!1,chennai:!1,trichy:!1,local:!1,social:!1,weather:!0,market:!1}}};function tt(e=new Date){const n=e.getHours(),s=e.getMinutes(),i=n*60+s,a=Object.values(rn);for(const r of a){const o=r.startHour*60+r.startMinute;let l=r.endHour*60+r.endMinute;if(r.id==="urgent_only"){if(i>=o||i<l)return r}else if(i>=o&&i<l)return r}return rn.URGENT_ONLY}function on(e){return e?.recommended||{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}}function Fa(e){if(!e)return"Welcome to Daily Event AI";switch(e.id){case"morning_weather":return"Good Morning! Here's your weather start.";case"morning_news":return"Your Morning Headlines are ready.";case"market_brief":return"Market Open: Sensex & Nifty Updates.";case"midday_brief":return"Midday Update: Top stories so far.";case"market_movers":return"Market Movers: Gainers & Losers.";case"evening_news":return"Evening Wrap: Catch up on the day.";case"local_events":return"How your evening looks around town.";case"night_wrap_up":return"The Day in Review.";case"urgent_only":return"Urgent Updates Only.";default:return"Daily Event AI: Live Updates."}}function $a({breakingNews:e}){const n=tt(),s=new Date;return t.jsxs("div",{className:"newspaper-masthead",children:[t.jsxs("div",{className:"masthead__header",children:[t.jsxs("div",{className:"masthead__title",children:[t.jsx("h1",{className:"masthead__logo",children:"Daily News AI"}),t.jsx("div",{className:"masthead__tagline",children:"Your Intelligent News Digest"})]}),t.jsxs("div",{className:"masthead__meta",children:[t.jsx("div",{className:"masthead__date",children:s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),t.jsx("div",{className:"masthead__segment",children:n.name})]})]}),e?.length>0&&t.jsxs("div",{className:"masthead__breaking",children:[t.jsx("span",{className:"breaking-badge",children:"BREAKING"}),t.jsx("span",{className:"breaking-text",children:e[0].title})]})]})}function nt({article:e,size:n="medium",onClick:s,href:i,badge:a}){const{settings:r}=se(),[o,l]=y.useState(!1),[c,d]=y.useState(!1),[h,u]=y.useState(!1);`${encodeURIComponent(e.source)}`;const g=e.imageUrl&&!o,p=i?"a":"article",m=i?{href:i,target:"_blank",rel:"noopener noreferrer"}:{};return t.jsxs(p,{className:`image-card image-card--${n}`,onClick:s,...m,style:{position:"relative"},children:[r?.debugLogs&&e._scoreBreakdown&&t.jsxs("div",{className:"debug-badge",onClick:w=>{w.preventDefault(),w.stopPropagation(),u(!h)},style:{position:"absolute",top:"5px",right:"5px",zIndex:20,background:"rgba(0,0,0,0.7)",color:"#00ff41",fontSize:"0.6rem",padding:"2px 4px",borderRadius:"4px",cursor:"help",border:"1px solid #00ff41"},children:[e._scoreBreakdown.total.toFixed(1),h&&t.jsx("div",{style:{position:"absolute",top:"100%",right:0,width:"200px",background:"#111",border:"1px solid #333",padding:"8px",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",pointerEvents:"none"},children:Object.entries(e._scoreBreakdown).map(([w,v])=>w!=="total"&&typeof v=="number"&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[t.jsx("span",{style:{color:"#aaa",textTransform:"capitalize"},children:w}),t.jsx("span",{style:{color:"#fff"},children:v.toFixed(2)})]},w))})]}),g&&t.jsxs("div",{className:"image-card__media",children:[!c&&t.jsx("div",{className:"image-card__skeleton"}),t.jsx("img",{src:e.imageUrl,alt:e.title,className:`image-card__image ${c?"loaded":""}`,onLoad:()=>d(!0),onError:()=>l(!0),loading:"lazy"}),a&&t.jsx("div",{className:"image-card__badge",children:a}),t.jsx("div",{className:"image-card__overlay",children:t.jsx("span",{className:"image-card__source",children:e.source})})]}),t.jsxs("div",{className:"image-card__content",children:[t.jsx("h3",{className:"image-card__headline",children:e.title}),e.summary&&t.jsxs("p",{className:"image-card__summary",children:[e.summary.substring(0,150),"..."]}),t.jsxs("div",{className:"image-card__meta",children:[t.jsx("span",{className:"meta__time",children:e.time}),e.sentiment&&t.jsx("span",{className:`meta__sentiment meta__sentiment--${e.sentiment.label}`,children:e.sentiment.label==="positive"?"ðŸ“ˆ":e.sentiment.label==="negative"?"ðŸ“‰":"ï¿½"})]})]})]})}function Ba({newsData:e,breakingNews:n,settings:s}){const{settings:i}=se(),a=Object.entries(e).filter(([u,g])=>u!=="frontPage"&&i?.sections?.[u]?.enabled!==!1).map(([u,g])=>{const p=i?.sections?.[u]?.count;return typeof p=="number"?g.slice(0,p):g}).flat();let r=a;if(e.frontPage&&Array.isArray(e.frontPage)){const u=new Set(e.frontPage.map(p=>p.title)),g=a.filter(p=>!u.has(p.title));r=[...e.frontPage,...g]}const o=r.filter(u=>u.imageUrl),l=r.filter(u=>!u.imageUrl),c=o.slice(0,s?.headlinesCount||3),d=o.slice(3,3+(s?.leadsCount||6)),h=l.slice(0,s?.briefsCount||12);return t.jsxs("div",{className:"newspaper-layout",children:[t.jsx($a,{breakingNews:n}),c.length>0&&t.jsxs("section",{className:"headlines-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸ“° Top Stories"}),t.jsxs("div",{className:"headlines-grid",children:[c[0]&&t.jsx("div",{className:"headline-lead",children:t.jsx(nt,{article:c[0],size:"large",onClick:()=>window.open(c[0].link,"_blank")})}),c.length>1&&t.jsx("div",{className:"headline-supporting",children:c.slice(1).map(u=>t.jsx(nt,{article:u,size:"medium",onClick:()=>window.open(u.link,"_blank")},u.id))})]})]}),d.length>0&&t.jsxs("section",{className:"leads-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸŒ More From Today"}),t.jsx("div",{className:"leads-scroll",children:d.map(u=>t.jsx(nt,{article:u,size:"medium",onClick:()=>window.open(u.link,"_blank")},u.id))})]}),h.length>0&&t.jsxs("section",{className:"briefs-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸ“‹ News Briefs"}),t.jsx("div",{className:"briefs-list",children:h.map(u=>t.jsxs("article",{className:"brief-item",onClick:()=>window.open(u.link,"_blank"),children:[t.jsx("h4",{className:"brief-title",children:u.title}),t.jsxs("div",{className:"brief-meta",children:[t.jsx("span",{className:"brief-source",children:u.source}),t.jsx("span",{className:"brief-time",children:u.time})]})]},u.id))})]})]})}const Pa="https://en.wikipedia.org/api/rest_v1/feed/onthisday/selected",za={fetchDailyFacts:async()=>{const e=new Date,n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=`${Pa}/${n}/${s}`;try{console.log(`[QuickFacts] Fetching from ${i}`);const a=await fetch(i);if(!a.ok)throw new Error("Wiki API Failed");const r=await a.json();return!r.selected||r.selected.length===0?[]:r.selected.sort(()=>.5-Math.random()).slice(0,5).map(c=>({text:c.text,year:c.year,pages:c.pages}))}catch(a){return console.warn("[QuickFacts] Fetch failed:",a),[{year:"1969",text:"The internet (ARPANET) sent its first message."},{year:"1990",text:"The first web page was published by Tim Berners-Lee."},{year:"2004",text:"Facebook was launched by Mark Zuckerberg."}]}}},ln=["Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.","Octopuses have three hearts. Two pump blood to the gills, while one pumps it to the rest of the body.","Bananas are berries, but strawberries aren't.","The Eiffel Tower can be 15 cm taller during the summer due to thermal expansion.","A group of flamingos is called a 'flamboyance'.","Wombat poop is cube-shaped.","The shortest war in history lasted 38 minutes between Britain and Zanzibar in 1896.","Cleopatra lived closer in time to the Moon landing than to the construction of the Great Pyramid of Giza.","Sloths can hold their breath longer than dolphins (up to 40 minutes).","A cloud can weigh more than a million pounds.","The first computer bug was an actual moth trapped in a relay of the Harvard Mark II computer in 1947."];async function Ha(){try{const e=await za.fetchDailyFacts();if(e&&e.length>0){const n=e[Math.floor(Math.random()*e.length)];return{text:`On this day in ${n.year}: ${n.text}`,year:n.year,isDynamic:!0}}return null}catch(e){return console.warn("OnThisDay fetch failed:",e),null}}function Ua(e){const n=[],s=new Set(["the","and","for","with","that","this","from","dead","kills","says","india","world","chennai","tamil","nadu"]),i=[...e.world||[],...e.india||[],...e.tech||[]];if(i.length===0)return null;i.forEach(l=>{if(!l.title)return;l.title.replace(/[^\w\s]/gi,"").toLowerCase().split(/\s+/).forEach(d=>{d.length>3&&!s.has(d)&&n.push(d)})});const a={};n.forEach(l=>a[l]=(a[l]||0)+1);const o=Object.entries(a).sort((l,c)=>c[1]-l[1]).slice(0,3).map(l=>l[0]);return o.length===0?null:{type:"TRENDING",icon:"ðŸ”¥",text:`Trending now: #${o.join(", #")}`}}function Wa(e){if(!e||Object.keys(e).length===0)return null;const n=Object.keys(e)[0],s=e[n];if(!s||!s.current)return null;const i=s.current.temp,a=s.current.condition.toLowerCase();let r="";return i>35?r=`It's a scorcher today at ${i}Â°C. Stay hydrated!`:i<20?r=`Cooler vibes today at ${i}Â°C.`:a.includes("rain")?r="Rainy skies today. Don't forget your umbrella.":r=`Currently ${i}Â°C and ${a}. A pleasant day ahead?`,{type:"WEATHER INSIGHT",icon:"ðŸŒ¤ï¸",text:r}}function Ga(e,n,s=null){const i=[];if(s&&s.isDynamic){const o={type:"ON THIS DAY",icon:"ðŸ“…",text:s.text};i.push(o),i.push(o),i.push(o)}else i.push({type:"DID YOU KNOW?",icon:"ðŸ’¡",text:ln[Math.floor(Math.random()*ln.length)]});const a=Ua(e);a&&i.push(a);const r=Wa(n);return r&&i.push(r),i[Math.floor(Math.random()*i.length)]}const Ne=[{start:"06:55",id:"morning_weather",label:"Morning Weather",name:"Morning Weather",icon:"ðŸŒ¤ï¸",focus:"weather"},{start:"07:00",id:"morning_news",label:"Morning News",name:"Morning News",icon:"â˜•",focus:"news_top"},{start:"09:00",id:"market_brief",label:"Market Brief",name:"Market Brief",icon:"ðŸ“ˆ",focus:"market"},{start:"11:55",id:"midday_brief",label:"Midday Brief",name:"Midday Brief",icon:"â˜€ï¸",focus:"news_all"},{start:"14:30",id:"market_movers",label:"Market Movers",name:"Market Movers",icon:"ðŸ“‰",focus:"market"},{start:"16:20",id:"evening_news",label:"Evening News",name:"Evening News",icon:"ðŸŒ†",focus:"news_all"},{start:"16:45",id:"local_events",label:"Local Events",name:"Local Events",icon:"ðŸ“",focus:"local"},{start:"19:30",id:"night_wrap",label:"Night Wrap-Up",name:"Night Wrap-Up",icon:"ðŸŒ™",focus:"summary"},{start:"20:00",id:"urgent_only",label:"Urgent Alerts Only",name:"Urgent Alerts Only",icon:"âš ï¸",focus:"breaking"}];function cn(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=Ne[Ne.length-1];for(let i=0;i<Ne.length;i++){const a=Ne[i],[r,o]=a.start.split(":").map(Number),l=r*60+o;if(n>=l)s=a;else break}return s}function Ka(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=null;for(const a of Ne){const[r,o]=a.start.split(":").map(Number);if(r*60+o>n){s=a;break}}let i=new Date(e);if(s){const[a,r]=s.start.split(":").map(Number);i.setHours(a,r,0,0)}else{const[a,r]=Ne[0].start.split(":").map(Number);i.setDate(i.getDate()+1),i.setHours(a,r,0,0)}return Math.max(0,i.getTime()-e.getTime())}function ns(e,n={}){Notification.permission==="granted"&&(navigator.serviceWorker&&navigator.serviceWorker.ready?navigator.serviceWorker.ready.then(s=>{s.showNotification(e,{icon:"./vite.svg",badge:"./vite.svg",vibrate:[200,100,200],requireInteraction:!0,...n})}):new Notification(e,{icon:"./vite.svg",...n}))}const ss=y.createContext();function Va({children:e}){const[n,s]=y.useState(()=>cn());return y.useEffect(()=>{let i;const a=()=>{const r=Ka()+2e3;console.log(`[Segment] Next switch in ${(r/6e4).toFixed(1)} min`),i=setTimeout(()=>{const o=cn();console.log(`[Segment] Switching to ${o.label}`),s(o),ns(`${o.icon} ${o.label}`,{body:"New content available. Tap to refresh.",tag:"segment-update",renotify:!0}),a()},r)};return a(),()=>clearTimeout(i)},[]),t.jsx(ss.Provider,{value:{currentSegment:n,SEGMENTS:Ne},children:e})}function qa(){return y.useContext(ss)}function lt(){const[e,n]=y.useState(!1),[s,i]=y.useState(!1),[a,r]=y.useState(!1),[o,l]=y.useState(typeof window<"u"?window.innerWidth:0);return y.useEffect(()=>{const c=()=>{const d=window.innerWidth;l(d);const h=d>=1024,u=d>=768&&d<1024;n(h),i(u),r(h),console.log(`[Layout] Width: ${d}px, Mode: ${h?"desktop":u?"tablet":"mobile"}`)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),{isDesktop:e,isTablet:s,isWebView:a,screenWidth:o}}const Ya=({threshold:e=0,root:n=null,rootMargin:s="0px",freezeOnceVisible:i=!0}={})=>{const[a,r]=y.useState(null),o=a?.isIntersecting&&i,l=y.useRef(null),c=([d])=>{r(d)};return y.useEffect(()=>{const d=l.current;if(!!!window.IntersectionObserver||o||!d)return;const u={threshold:e,root:n,rootMargin:s},g=new IntersectionObserver(c,u);return g.observe(d),()=>g.disconnect()},[l,e,n,s,o]),[l,a]},Ja=({children:e,onVisible:n,isLoaded:s,placeholderHeight:i="200px"})=>{const[a,r]=Ya({threshold:.1,rootMargin:"200px",freezeOnceVisible:!0});return y.useEffect(()=>{r?.isIntersecting&&n&&n()},[r,n]),s?t.jsx("div",{children:e}):t.jsx("div",{ref:a,style:{minHeight:i,display:"flex",alignItems:"center",justifyContent:"center",margin:"20px 0"},children:r?.isIntersecting?t.jsxs("div",{className:"loading-state",style:{opacity:.6},children:[t.jsx("div",{className:"loading-spinner",style:{border:"3px solid rgba(255,255,255,0.1)",borderTop:"3px solid var(--accent-primary)",width:"24px",height:"24px",borderRadius:"50%",animation:"spin 1s linear infinite"}}),t.jsx("span",{style:{marginLeft:"10px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Loading section..."}),t.jsx("style",{children:`
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    `})]}):null})};function Xa(e){return Te({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"},child:[]}]})(e)}function Qa(e){return Te({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function Za(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(e)}function er(e){return Te({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"},child:[]}]})(e)}function tr(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"},child:[]}]})(e)}function nr(e){return Te({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H88c-13.255 0-24 10.745-24 24v8H24c-13.255 0-24 10.745-24 24v272c0 30.928 25.072 56 56 56h472c26.51 0 48-21.49 48-48V88c0-13.255-10.745-24-24-24zM56 400a8 8 0 0 1-8-8V144h16v248a8 8 0 0 1-8 8zm236-16H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm-208-96H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm0-96H140c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h360c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12z"},child:[]}]})(e)}function sr(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(e)}const ir=({news:e=[],title:n="Global Headlines"})=>{if(!e||e.length===0)return null;const s=e.slice(0,10);return t.jsxs("div",{className:"card",style:{padding:"var(--spacing-md)",background:"var(--bg-card)",border:"1px solid var(--border-default)"},children:[t.jsx("h3",{style:{fontFamily:"'Playfair Display', serif",fontSize:"1.2rem",marginBottom:"var(--spacing-md)",paddingBottom:"var(--spacing-sm)",borderBottom:"2px solid var(--accent-primary)",color:"var(--text-primary)"},children:n}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:s.map((i,a)=>t.jsx("article",{style:{paddingBottom:"var(--spacing-sm)",borderBottom:"1px solid var(--border-default)"},children:t.jsxs("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("h4",{style:{fontSize:"0.95rem",fontWeight:"600",lineHeight:"1.4",marginBottom:"4px",color:"var(--text-primary)"},children:i.headline||i.title}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--text-muted)"},children:[t.jsx("span",{children:i.source}),t.jsx("span",{children:i.time||new Date(i.publishedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},a))}),t.jsx("div",{style:{marginTop:"var(--spacing-md)",textAlign:"center",fontSize:"0.8rem",color:"var(--accent-secondary)"},children:"Top Stories"})]})},ar=()=>{const{settings:e}=se(),{currentSegment:n}=qa(),[s,i]=y.useState(Notification.permission),[a,r]=y.useState(null),[o,l]=y.useState(null),{isWebView:c,isDesktop:d}=lt(),{weatherData:h,loading:u,refreshWeather:g}=Ke(),{newsData:p,loading:m,errors:w,breakingNews:v,refreshNews:j,loadSection:f,loadedSections:N}=Ge(),{sections:A,uiMode:_="timeline"}=e,[L,P]=y.useState([]);y.useEffect(()=>{if(!p.frontPage){P([]);return}if(e.customSortTopStories){let E=p.frontPage.filter(R=>!(Ks(R.id)||Bn(R.id)>3));E.sort((R,b)=>(b.impactScore||0)-(R.impactScore||0));const x=10;if(E.length<x){const R=new Set(E.map(k=>k.id)),b=p.frontPage.filter(k=>!R.has(k.id));b.sort((k,F)=>(F.impactScore||0)-(k.impactScore||0));const C=x-E.length;E=[...E,...b.slice(0,C)]}P(E)}else P(p.frontPage)},[p.frontPage,e.customSortTopStories]),y.useEffect(()=>{g(),j()},[n.id,j,g]),y.useEffect(()=>{Ha().then(E=>{E&&l(E)})},[]),y.useEffect(()=>{const E=p&&Object.keys(p).length>0,x=h&&Object.keys(h).length>0;(E||x||o)&&r(Ga(p,h,o))},[m,u,p,h,o]);const[M,B]=y.useState(!1);y.useEffect(()=>{const E=()=>{window.scrollY>400?B(!0):B(!1)};return window.addEventListener("scroll",E),()=>window.removeEventListener("scroll",E)},[]);const O=()=>{window.scrollTo({top:0,behavior:"smooth"})};y.useEffect(()=>{let E=0,x=!1;const R=k=>{window.scrollY===0&&(E=k.touches[0].clientY,x=!0)},b=k=>{x&&k.touches[0].clientY},C=k=>{if(!x)return;k.changedTouches[0].clientY-E>150&&window.scrollY===0&&(j(),g()),x=!1};return d||(document.addEventListener("touchstart",R),document.addEventListener("touchmove",b),document.addEventListener("touchend",C)),()=>{document.removeEventListener("touchstart",R),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",C)}},[j,g,d]);const D=u&&!h||m&&Object.keys(p).length===0,I=D?1:3,S=_==="timeline",$=_==="newspaper",T=n.id==="urgent_only",H=[{id:"world-news",icon:"ðŸŒ",label:"World"},A.india?.enabled&&{id:"india-news",icon:"ðŸ‡®ðŸ‡³",label:"India"},A.chennai?.enabled&&{id:"chennai-news",icon:"ðŸ›ï¸",label:"Tamil Nadu"},A.local?.enabled&&{id:"local-news",icon:"ðŸ“",label:"Muscat"}].filter(Boolean),W=t.jsxs("div",{className:"header__actions",children:[t.jsx(De,{to:"/refresh",className:"header__action-btn",children:"ðŸ”„"}),t.jsx(De,{to:"/settings",className:"header__action-btn",children:"âš™ï¸"})]});return t.jsxs("div",{className:`page-container mode-${_} ${c?"page-container--desktop":""}`,children:[S?t.jsx(ba,{title:n.id==="market_brief"?"":n.label,icon:n.icon,actions:W,loadingPhase:I}):t.jsx(_e,{title:n.label,icon:n.icon,actions:W,loadingPhase:I}),t.jsxs("main",{className:`main-content ${c?"main-content--desktop":""}`,children:[c&&t.jsxs("div",{className:"desktop-sidebar",children:[t.jsx(an,{}),t.jsx(ir,{news:p.world&&p.world.length>0?p.world:p.chennai&&p.chennai.length>0?p.chennai:p.frontPage,title:"Global Headlines"})]}),t.jsxs("div",{className:"content-wrapper",children:[D&&t.jsxs("div",{className:"loading",style:{padding:"40px"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Updates..."})]}),!S&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"topline",children:[t.jsxs("div",{className:"topline__label",style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:a?.icon||"ðŸ“°"}),t.jsx("span",{children:a?.type||"TOPLINE"})]}),t.jsx("div",{className:"topline__text",children:a?.text||Fa(n)})]}),t.jsx(va,{items:v})]}),!c&&t.jsx(an,{}),$?t.jsx(Ba,{newsData:p,breakingNews:v,settings:e.newspaper}):t.jsxs("div",{className:"news-sections news-sections--grid",children:[(!T||v.length===0)&&t.jsxs(t.Fragment,{children:[L.length>0?t.jsx(ue,{id:"top-stories",title:"Top Stories",icon:"â­",colorClass:"news-section__title--world",news:L,maxDisplay:10,loading:m&&L.length===0}):e.customSortTopStories&&p.frontPage?.length>0&&t.jsxs("div",{className:"empty-state",style:{padding:"20px",marginBottom:"20px",background:"var(--bg-card)",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:"âœ…"}),t.jsx("p",{style:{color:"var(--text-muted)"},children:"You're all caught up with top stories!"}),t.jsx("button",{onClick:()=>j(),className:"btn btn--secondary",style:{marginTop:"10px",fontSize:"0.8rem",padding:"6px 12px"},children:"Check for new updates"})]}),t.jsx(ue,{id:"world-news",title:"Global Updates",icon:"ðŸŒ",colorClass:"news-section__title--world",news:p.world,maxDisplay:A.world?.count||5}),A.india?.enabled&&t.jsx(ue,{id:"india-news",title:S?"India":"India News",icon:"ðŸ‡®ðŸ‡³",colorClass:"news-section__title--india",news:p.india,maxDisplay:A.india.count||5,error:w.india}),A.chennai?.enabled&&t.jsx(ue,{id:"chennai-news",title:"Tamil Nadu",icon:"ðŸ›ï¸",colorClass:"news-section__title--chennai",news:p.chennai,maxDisplay:A.chennai.count||5,error:w.chennai}),A.trichy?.enabled&&t.jsx(ue,{id:"trichy-news",title:"Trichy",icon:"ðŸ›ï¸",colorClass:"news-section__title--trichy",news:p.trichy,maxDisplay:A.trichy.count||5,error:w.trichy}),A.local?.enabled&&t.jsx(Ja,{id:"local-news",onVisible:()=>f("local"),isLoaded:N.includes("local"),children:t.jsx(ue,{id:"local-news",title:"Local â€” Muscat",icon:"ðŸ“",colorClass:"news-section__title--local",news:p.local,maxDisplay:A.local.count||5,error:w.local})})]}),T&&v.length===0&&t.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-muted)"},children:[t.jsx("h3",{children:"Urgent Alerts Mode"}),t.jsx("p",{children:"Monitoring for critical updates..."})]})]}),e.debugLogs&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"var(--spacing-md)",padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:"var(--radius-sm)",fontSize:"0.7rem",color:"var(--text-muted)",flexWrap:"wrap"},children:[t.jsxs("span",{title:"Segment",children:[n.icon," ",n.label]}),t.jsx("span",{title:"Notifications",children:s==="granted"?"ðŸ””":"ðŸ”•"}),t.jsxs("span",{title:"UI Mode",children:["ðŸ“± ",_]}),t.jsx("span",{title:"Strict Mode",children:e.strictFreshness?"ðŸ›¡ï¸":"ðŸ”“"}),t.jsx(De,{to:"/settings",onClick:()=>{},style:{marginLeft:"auto",color:"var(--accent-primary)",fontSize:"0.7rem"},children:"Debug â†’"})]})]})]}),t.jsx(Ct,{sections:H}),t.jsx("button",{onClick:O,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:M?1:0,pointerEvents:M?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},className:"back-to-top",children:"â†‘"})]})};function rr(e="ua_watchlist"){const[n,s]=y.useState(()=>{try{return JSON.parse(localStorage.getItem(e))||[]}catch{return[]}});return{watchlist:n,toggleWatchlist:r=>{let o;n.includes(r)?o=n.filter(l=>l!==r):o=[...n,r],s(o),localStorage.setItem(e,JSON.stringify(o))},isWatched:r=>n.includes(r)}}const or=(e,n)=>{const s=new Date,i=s.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",a=new Date(s.getTime()+3600*1e3).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",r=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${e}
DESCRIPTION:${n}
DTSTART:${i}
DTEND:${a}
END:VEVENT
END:VCALENDAR`,o=new Blob([r],{type:"text/calendar"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`${e.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.ics`,c.click(),URL.revokeObjectURL(l)},is={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},wt=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Ce=Object.keys(is).filter(e=>e.length>2).join("|"),lr=/\b(\d{4})-(\d{1,2})-(\d{1,2})\b/,cr=/\b(\d{1,2})[/-](\d{1,2})[/-](\d{4})\b/,dr=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s-]+(\\d{4}))?\\b`,"i"),ur=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${Ce})(?:[-\\s,]+(\\d{4}))?\\b`,"i"),hr=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),pr=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),mr=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-)\\s*(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${Ce})\\b`,"i"),gr=/\bnext\s+(\d+)\s+(day|week)s?\b/,fr=new RegExp(`\\b(?:ends?|last date|deadline|valid (?:till|until)|expires?|before)\\s+(?:on\\s+)?(${Ce})\\s+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s]+(\\d{4}))?\\b`,"i");function ke(e){return is[e.toLowerCase().slice(0,3)]??null}function ye(e,n,s){const i=new Date(s.getFullYear(),e,n);return i<s&&s-i>30*864e5&&i.setFullYear(i.getFullYear()+1),i}function yr(e,n){const s=e.match(lr);if(s)return{start:new Date(+s[1],+s[2]-1,+s[3]),end:null,type:"iso"};const i=e.match(cr);return i?{start:new Date(+i[3],+i[2]-1,+i[1]),end:null,type:"numeric"}:null}function xr(e,n){const s=e.match(dr);if(s){const a=ke(s[1]),r=+s[2],o=s[3]?+s[3]:null;return{start:o?new Date(o,a,r):ye(a,r,n),end:null,type:"named"}}const i=e.match(ur);if(i){const a=ke(i[2]),r=+i[1],o=i[3]?+i[3]:null;return{start:o?new Date(o,a,r):ye(a,r,n),end:null,type:"named"}}return null}function wr(e,n){const s=e.match(hr);if(s)return{start:ye(ke(s[1]),+s[2],n),end:ye(ke(s[3]),+s[4],n),type:"range"};const i=e.match(pr);if(i){const r=ke(i[1]);return{start:ye(r,+i[2],n),end:ye(r,+i[3],n),type:"range"}}const a=e.match(mr);if(a){const r=ke(a[3]);return{start:ye(r,+a[1],n),end:ye(r,+a[2],n),type:"range"}}return null}function vr(e,n){const s=e.toLowerCase();if(!/tomorrow|today|next|this|week|weekend/.test(s))return null;if(/\btomorrow\b/.test(s)){const a=new Date(n);return a.setDate(a.getDate()+1),{start:a,end:null,type:"relative"}}if(/\btoday\b/.test(s))return{start:new Date(n),end:null,type:"relative"};const i=s.match(gr);if(i){const a=+i[1],r=i[2]==="week"?7:1,o=new Date(n);return o.setDate(o.getDate()+a*r),{start:new Date(n),end:o,type:"relative"}}if(/\bnext week\b/.test(s)){const a=new Date(n);a.setDate(a.getDate()+(7-a.getDay()+1));const r=new Date(a);return r.setDate(r.getDate()+6),{start:a,end:r,type:"relative"}}for(let a=0;a<wt.length;a++){if(!s.includes(wt[a]))continue;if(new RegExp(`\\b(?:this|next|coming)\\s+${wt[a]}\\b`,"i").test(e)){const o=new Date(n);let l=(a-o.getDay()+7)%7;return l===0&&(l=7),o.setDate(o.getDate()+l),{start:o,end:null,type:"relative"}}}if(/\bthis weekend\b/.test(s)){const a=new Date(n);a.setDate(a.getDate()+(6-a.getDay()+7)%7);const r=new Date(a);return r.setDate(r.getDate()+1),{start:a,end:r,type:"relative"}}return null}function br(e,n){const s=e.match(fr);if(s){const i=ke(s[1]),a=+s[2],r=s[3]?+s[3]:null,o=r?new Date(r,i,a):ye(i,a,n);return{start:new Date(n),end:o,type:"deadline"}}return null}function Et(e,n){if(!e)return null;const s=n?new Date(n):new Date;return isNaN(s.getTime())?null:yr(e)||wr(e,s)||br(e,s)||xr(e,s)||vr(e,s)}function Sr(e,n=14){if(!e?.start)return[];const s=[],i=new Date(e.start);i.setHours(0,0,0,0);const a=e.end?new Date(e.end):new Date(i);a.setHours(0,0,0,0);let r=new Date(i);for(;r<=a&&s.length<n;)s.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return s}const pe="upAhead_planner",Ze="upAhead_blacklist",et="/api",re={sync:async()=>{try{const e=await fetch(`${et}/blacklist`);if(e.ok){const s=await e.json(),i=re.getBlacklist(),a=new Set([...i,...s]);localStorage.setItem(Ze,JSON.stringify([...a]))}const n=await fetch(`${et}/user_plan`);if(n.ok){const s=await n.json(),i=localStorage.getItem(pe),r={...i?JSON.parse(i):{},...s};localStorage.setItem(pe,JSON.stringify(r))}console.log("[PlannerStorage] Synced with server")}catch(e){console.warn("[PlannerStorage] Sync failed",e)}},getUpcomingDays:(e=14)=>{try{const n=localStorage.getItem(pe);if(!n)return[];const s=JSON.parse(n),i=new Date().toISOString().split("T")[0];return Object.entries(s).filter(([r])=>r>=i).sort((r,o)=>r[0].localeCompare(o[0])).slice(0,e).map(([r,o])=>({date:r,items:o}))}catch(n){return console.error("Failed to read planner storage",n),[]}},addItem:(e,n)=>{try{const s=localStorage.getItem(pe),i=s?JSON.parse(s):{};return i[e]||(i[e]=[]),i[e].some(a=>a.id===n.id)?!1:(i[e].push(n),localStorage.setItem(pe,JSON.stringify(i)),re.savePlanToApi(i),!0)}catch(s){return console.error("Failed to add item to planner",s),!1}},removeItem:(e,n)=>{try{const s=localStorage.getItem(pe),i=s?JSON.parse(s):{};return i[e]?(i[e]=i[e].filter(a=>a.id!==n),i[e].length===0&&delete i[e],localStorage.setItem(pe,JSON.stringify(i)),re.savePlanToApi(i),!0):!1}catch(s){return console.error("Failed to remove item",s),!1}},merge:(e,n)=>{try{const s=localStorage.getItem(pe),i=s?JSON.parse(s):{};let a=!1;e.forEach(r=>{i[r]||(i[r]=[]);const o=new Set(i[r].map(l=>l.id));n.forEach(l=>{o.has(l.id)||(i[r].push(l),a=!0)})}),a&&(localStorage.setItem(pe,JSON.stringify(i)),re.savePlanToApi(i))}catch(s){console.error("Merge failed",s)}},savePlanToApi:async e=>{try{await fetch(`${et}/user_plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save plan error:",n)}},addToBlacklist:e=>{try{const n=JSON.parse(localStorage.getItem(Ze)||"[]");n.includes(e)||(n.push(e),localStorage.setItem(Ze,JSON.stringify(n)),re.saveBlacklistToApi(n))}catch(n){console.error("Failed to blacklist",n)}},getBlacklist:()=>{try{return new Set(JSON.parse(localStorage.getItem(Ze)||"[]"))}catch{return new Set}},saveBlacklistToApi:async e=>{try{await fetch(`${et}/blacklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save blacklist error:",n)}}},as="upAhead_cache";function jr(){try{const e=localStorage.getItem(as);if(e){const n=JSON.parse(e);return Date.now()-new Date(n.lastUpdated||0).getTime()>480*60*1e3&&console.log("[UpAheadService] Cache is older than 8 hours."),n}}catch(e){console.warn("Cache read error",e)}return null}function Nr(e){try{localStorage.setItem(as,JSON.stringify(e))}catch(n){console.warn("Cache write error",n)}}const dn=new Map;function kr(e,n){let s=dn.get(n);if(!s){const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=new RegExp(`\\b${i}\\b`,"i"),dn.set(n,s)}return s.test(e)}function _r(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function Cr(e,n){const s=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");return _r(`${s}-${n}`)}function Pe(e,n){const s=e.toLowerCase(),i=n.toLowerCase();return n.includes(" ")?s.includes(i):kr(s,i)}const Er={movies:["Tamil movie release this week","new movie release OTT","BookMyShow Chennai movies","upcoming movies Kollywood","movie tickets showtimes"],events:["Chennai events this week","LiveChennai events","concert tickets Chennai","standup comedy show Chennai","exhibition workshops Chennai","things to do Chennai weekend","Muscat events this week","Muscat concerts exhibitions","theatre shows Chennai this week","art exhibition Chennai","food festival Chennai","cultural event Chennai","music sabha Chennai","Muscat Royal Opera House events"],festivals:["Maha Shivaratri 2025 date","upcoming festivals Tamil Nadu 2025","bank holidays India upcoming","public holidays Tamil Nadu","religious festivals this month India","Oman festivals holidays"],alerts:["TANGEDCO power cut Chennai tomorrow","TNEB power shutdown schedule","Chennai traffic advisory today","Chennai metro maintenance","water supply disruption Chennai","road closure Chennai"],weather_alerts:["IMD Chennai weather warning","Tamil Nadu heavy rain alert","cyclone warning Chennai","heat wave advisory Tamil Nadu","Oman weather warning Muscat"],sports:["IPL 2026 schedule matches","cricket match Chennai CSK","ISL football match schedule","Pro Kabaddi schedule","sports events Chennai this week"],shopping:["Chennai sale offers discount today","exhibition sale Chennai","Pongal sale Tamil Nadu","Diwali offers Chennai","end of season sale Chennai mall","Muscat shopping festival offers"],airlines:["Oman Air flight offers","Indigo Airlines offers","Salam Air ticket offers","Air India sale","flight ticket offers India"],civic:["VIP visit Chennai road closure","minister visit Tamil Nadu traffic","protest bandh Chennai tomorrow","Chennai corporation announcement","Muscat road closure traffic"]},un={movies:["https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/bollywood/rssfeed.xml"],sports:["https://www.espn.com/espn/rss/news"],festivals:["https://www.timeanddate.com/holidays/india/feed"],events:["https://www.thehindu.com/news/cities/chennai/feeder/default.rss"]};async function Tr(){try{const s=`${"./".endsWith("/")?"./":".//"}data/up_ahead.json`,i=await fetch(s);if(!i.ok)return console.warn(`[UpAheadService] Static fetch failed: ${i.status}`),null;const a=await i.json();return a.error?(console.warn(`[UpAheadService] Static data has error: ${a.error}`),null):a}catch(e){return console.error("[UpAheadService] Static fetch exception:",e),null}}function hn(e,n){if(!e)return n;if(!n)return e;const s={...e},i=new Map;return e.timeline&&e.timeline.forEach(a=>{i.set(a.date,{...a,items:[...a.items||[]]})}),n.timeline&&n.timeline.forEach(a=>{if(!i.has(a.date))i.set(a.date,a);else{const r=i.get(a.date),o=new Set(r.items.map(l=>l.id));a.items.forEach(l=>{o.has(l.id)||(r.items.push(l),o.add(l.id))})}}),s.timeline=Array.from(i.values()).sort((a,r)=>a.date.localeCompare(r.date)),n.sections&&(s.sections||(s.sections={}),Object.keys(n.sections).forEach(a=>{const r=s.sections[a]||[],o=n.sections[a]||[],l=new Set(r.map(d=>d.title)),c=[...r];o.forEach(d=>{l.has(d.title)||(c.push(d),l.add(d.title))}),s.sections[a]=c})),s.weekly_plan=os(s.timeline,new Set),s.lastUpdated=n.lastUpdated||e.lastUpdated,s}async function Ir(e){const n=Date.now();console.log("[UpAheadService] Fetching LIVE data with settings:",e);const s=e?.categories||{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0},i=e?.locations&&e.locations.length>0?e.locations:["Chennai","India"],a=e?.keywords||oe.upAhead.keywords;let r=[];const o=[],l=m=>{const w=encodeURIComponent(m);o.push({url:`https://news.google.com/rss/search?q=${w}+when:7d&hl=en-IN&gl=IN&ceid=IN:en`,type:"search",originalQuery:m})};for(const[m,w]of Object.entries(s)){if(!w)continue;un[m]&&un[m].forEach(j=>{o.push({url:j,type:"static",category:m})}),(Er[m]||[]).forEach(j=>{m==="events"||m==="alerts"||m==="movies"?i.forEach(f=>{f.toLowerCase()==="india"&&(m==="alerts"||m==="events")||l(`${j} ${f}`)}):m==="shopping"||m==="airlines"?i.forEach(f=>{l(`${j} ${f}`)}):l(`${j}`)})}const c=[...new Map(o.map(m=>[m.url,m])).values()];console.log(`[UpAheadService] Prepared ${c.length} feeds to fetch.`);const d=c.map(async m=>{try{const{items:w}=await Kn.fetchViaProxy(m.url);return w.map(v=>Ar(v,m,a))}catch(w){return console.warn(`[UpAheadService] Failed to fetch ${m.url}:`,w.message),[]}}),h=await Promise.allSettled(d);for(let m=0;m<h.length;m++)h[m].status==="fulfilled"?r.push(...h[m].value):console.warn("[UpAheadService] A feed failed to load:",h[m].reason);const u=Dr(r,e);try{for(const m of r)if(m.extractedDate){const w=Et(`${m.title} ${m.description||""}`,m.pubDate);if(w){const v=Sr(w);v.length>0&&re.merge(v,[{id:m.id,title:m.title,category:m.category,link:m.link}])}}}catch(m){console.warn("[UpAhead] Planner storage write failed",m)}const g=Date.now()-n,p=u?.timeline?.reduce((m,w)=>m+(w.items?.length||0),0)||0;return he.success("upAhead",`LIVE: ${p} items from ${c.length} feeds`,{durationMs:g}),u}function jt(e){if(!e)return"";let n=e.toString();const s={"&nbsp;":" ","&amp;":"&","&quot;":'"',"&#39;":"'","&lt;":"<","&gt;":">"};return n=n.replace(/&[a-z0-9#]+;/gi,i=>s[i]||i),n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,""),n=n.replace(/<style[^>]*>([\S\s]*?)<\/style>/gmi,""),n=n.replace(/<\/?[^>]+(>|$)/g,""),n.trim()}function Ar(e,n,s=null){const i=jt(e.title||""),a=e.description||"",r=jt(a),o=`${i} ${r}`;let l=e.pubDate?new Date(e.pubDate):null;l&&isNaN(l.getTime())&&(l=null);let c=n.category;(!c||n.type==="search")&&(c=Rr(o,s));let d=null;const h=Et(o,l);h?.start?c==="shopping"&&h.end?d=h.end:d=h.start:d=rs(o,l);let u=[],g=!1;/ott|releases|week/i.test(i)&&/\d+ new/i.test(i)&&(g=!0),g&&c==="movies"&&(u=Mr(a,l));const p=d?d.toISOString().slice(0,10):l?l.toISOString().slice(0,10):"nodate",m=Cr(i,p);return{id:e.guid||e.link||i,canonicalId:m,title:i,link:e.link,description:r,pubDate:l,extractedDate:d,category:c,rawSource:n.originalQuery||"feed",isRoundup:g,subItems:u}}function Mr(e,n){const s=[],i=e.split(/<br\s*\/?>|\n|<\/li>|<\/p>|â€¢/i),a=["netflix","prime","prime video","hotstar","sony liv","zee5","jiocinema","aha","sunnxt","hulu","disney"],r=new RegExp(`\\b(${a.sort((o,l)=>l.length-o.length).join("|")})\\b`,"i");return i.forEach(o=>{const l=jt(o).trim();if(l.length<5)return;const c=r.test(l),d=rs(l,n);if(c||d){let h=l.replace(/^\d+\.\s*/,"").replace(/^[-\u2013\u2014]\s*/,"").replace(/\(.*\)/g,"").trim();if(h.length<3)return;const u=l.match(r),g=u?u[0]:"OTT";s.push({title:h,date:d,originalText:l,platform:g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()})}}),s}function Rr(e,n=null){const s=e.toLowerCase(),i=n||oe.upAhead.keywords,a=r=>r&&r.some(o=>Pe(s,o));return s.includes("arrest")||s.includes("held for")||s.includes("police")||s.includes("seized")||s.includes("murder")||s.includes("crime")||s.includes("jail")||s.includes("court")||s.includes("bail")||s.includes("clinic")&&s.includes("unregistered")?"general":a(i.weather_alerts)?"weather_alerts":a(i.alerts)?"alerts":a(i.movies)?(i.movies_negative||[]).some(o=>Pe(s,o))?"general":"movies":a(i.sports)?(i.sports_negative||[]).some(o=>Pe(s,o))?"general":"sports":a(i.airlines)?"airlines":a(i.shopping)?"shopping":a(i.festivals)?"festivals":a(i.civic)?"civic":a(i.events)?"events":"general"}function rs(e,n){return Et(e,n)?.start||null}function Dr(e,n){const s=new Date;s.setHours(0,0,0,0);const i=new Map,a={movies:[],festivals:[],alerts:[],events:[],sports:[],shopping:[],civic:[],weather_alerts:[],airlines:[]},r=new Set,l=(n?.hideOlderThanHours||336)*60*60*1e3,c={weather_alerts:6,alerts:12,festivals:336},d=n?.keywords||n?.upAhead?.keywords||oe.upAhead.keywords,h=f=>{let N=d.negative&&d.negative.length>0?d.negative:oe.upAhead.keywords.negative;const A=`${f}_negative`,_=d[A]&&d[A].length>0?d[A]:oe.upAhead.keywords[A]||[];return[...new Set([...N,..._])]},u=n?.signals||oe.upAhead.signals,g={};["movies","events","festivals","alerts","sports","shopping","civic","weather_alerts","airlines"].forEach(f=>{g[f]=d[f]&&d[f].length>0?d[f]:oe.upAhead.keywords[f]||[]});const m=(n?.locations||n?.upAhead?.locations||["Chennai","Muscat","Trichy"]).map(f=>f.toLowerCase());e.forEach(f=>{if(r.has(f.id)||(r.add(f.id),!f.pubDate||isNaN(f.pubDate.getTime())))return;const N=Date.now()-f.pubDate.getTime();let A=l;if(c[f.category]){const k=c[f.category]*60*60*1e3;A=Math.min(l,k)}const _=["movies","events","sports","shopping","civic","festivals","airlines"].includes(f.category),L=f.extractedDate&&f.extractedDate>=s;if(!_&&!L&&N>A)return;const P=(f.title+" "+f.description).toLowerCase(),M=/(?:â€¢|-|published)\s*(\d+)\s*(mo|month|months|w|week|weeks|y|year|years)\s*(?:ago)?/i,B=P.match(M);if(B){const k=parseInt(B[1]),F=B[2].toLowerCase();if(F.startsWith("mo")||F.startsWith("y")||F.startsWith("w")&&k>=1)return}const O=/ott|releases|week|weekend/i.test(P)&&/\d+ new/i.test(P);let D=0;const I=n?.ranking?.[f.category]||n?.upAhead?.ranking?.[f.category]||{},S=I.positiveMultiplier||1,$=I.negativeMultiplier||1,T=I.filterThreshold||0,H=g[f.category]||[],W=h(f.category),E=H.reduce((k,F)=>Pe(P,F.toLowerCase())?k+1:k,0),x=W.reduce((k,F)=>Pe(P,F.toLowerCase())?k+1:k,0);D=E*S-x*$;const R=u.reduce((k,F)=>P.includes(F)?k+1:k,0);if(D+=R*.5,["movies","events","shopping","airlines","sports","festivals"].includes(f.category)&&D<T||!O&&x>0&&D<=0||_&&!f.extractedDate&&!f.isRoundup&&E===0&&R===0||(f.category==="alerts"||f.category==="civic")&&!m.some(F=>P.includes(F)))return;if(f._forwardScore=D,f.category&&a[f.category]){if((f.category==="movies"||f.category==="events"||f.category==="festivals")&&!f.extractedDate&&!f.isRoundup||_&&!f.extractedDate&&!f.isRoundup&&D<=0)return;if(f.category==="festivals"&&f.extractedDate){if((f.extractedDate.getTime()-s.getTime())/(1e3*3600*24)<-3)return}else if(_&&f.extractedDate&&f.extractedDate<s)return;let k=null;!f.extractedDate&&["shopping","alerts","weather_alerts","civic"].includes(f.category)&&(k=f.pubDate?f.pubDate.toDateString():null);const F={title:f.title,link:f.link,releaseDate:f.extractedDate?f.extractedDate.toDateString():k,date:f.extractedDate?f.extractedDate.toDateString():k,text:f.title,severity:"medium",language:"Unknown",isRoundup:f.isRoundup,subItemsCount:f.subItems?f.subItems.length:0};a[f.category].push(F)}let C=f.extractedDate;if(!C&&(f.category==="alerts"||f.category==="weather_alerts")){const k=f.category==="weather_alerts"?12:24;if(f.pubDate&&Date.now()-f.pubDate.getTime()<k*60*60*1e3)C=s;else return}if(!C&&f.isRoundup&&(C=s),!C&&D>0&&_&&["shopping","airlines","alerts","weather_alerts","civic"].includes(f.category)&&f.pubDate&&Date.now()-f.pubDate.getTime()<2880*60*1e3&&(C=s),C&&C>=s){const k=C.toISOString().split("T")[0];i.has(k)||i.set(k,{date:k,dayLabel:Lr(C),items:[]});const F={id:f.id,type:Or(f.category),title:f.title,subtitle:f.isRoundup?`${f.subItems?.length||"Multiple"} ITEMS`:f.category.toUpperCase(),description:f.description,tags:[f.category],link:f.link,isRoundup:f.isRoundup,subItems:f.subItems,_forwardScore:f._forwardScore||0};i.get(k).items.push(F)}});const w=Array.from(i.values()).sort((f,N)=>f.date.localeCompare(N.date));w.forEach(f=>{f.items.sort((N,A)=>(A._forwardScore||0)-(N._forwardScore||0)),f.items.forEach(N=>delete N._forwardScore)}),Object.keys(a).forEach(f=>{a[f].sort((N,A)=>N.date&&A.date?new Date(N.date)-new Date(A.date):0),a[f]=a[f].slice(0,10)});const v=re.getBlacklist?re.getBlacklist():new Set,j=os(w,v);return{timeline:w,sections:a,weekly_plan:j,lastUpdated:new Date().toISOString()}}function Lr(e){const n=new Date;n.setHours(0,0,0,0);const s=new Date(n);s.setDate(s.getDate()+1);const i=new Date(e);return i.setHours(0,0,0,0),i.getTime()===n.getTime()?"Today":i.getTime()===s.getTime()?"Tomorrow":i.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}function Or(e){return{movies:"movie",events:"event",festivals:"festival",alerts:"alert",sports:"sport",shopping:"shopping",civic:"civic",weather_alerts:"weather_alert",airlines:"airline"}[e]||"event"}function os(e,n=new Set){const s=[],i=new Date,a=r=>{const o=["th","st","nd","rd"],l=r%100;return r+(o[(l-20)%10]||o[l]||o[0])};for(let r=0;r<7;r++){const o=new Date(i);o.setDate(i.getDate()+r);const l=o.toISOString().split("T")[0],c=o.toLocaleDateString("en-US",{weekday:"long"}),d=o.toLocaleDateString("en-US",{month:"short"}),h=o.getDate(),u=`${a(h)} ${d}`,g=e.find(m=>m.date===l);let p=[];g&&g.items.length>0&&(p=g.items.filter(w=>!(w.type==="festival"||n.has(w.id))).slice(0,10).map(w=>({id:w.id,title:w.title,type:w.type,icon:Fr(w.type),link:w.link,description:w.description,isOffer:w.type==="shopping"||w.type==="airline"}))),s.push({day:c,date:u,items:p})}return s}function Fr(e){return{movie:"ðŸŽ¬",event:"ðŸŽ­",festival:"ðŸŽŠ",alert:"âš ï¸",sport:"âš½",shopping:"ðŸ›’",civic:"ðŸ›ï¸",entertainment:"ðŸŽ¶",weather_alert:"ðŸŒªï¸",airline:"âœˆï¸",general:"ðŸ“…"}[e]||"ðŸ“…"}function $r(){const{settings:e}=se(),[n,s]=y.useState(null),[i,a]=y.useState(!0),[r,o]=y.useState(!1),[l,c]=y.useState(0),[d,h]=y.useState("plan"),[,u]=y.useState(re.getBlacklist?re.getBlacklist():new Set),{toggleWatchlist:g,isWatched:p}=rr(),m=y.useCallback(async(O=!1)=>{if(O?(o(!0),c(1)):(a(!0),c(0)),!O){const D=jr();D&&(s(D),a(!1),c(1))}try{const D=await Tr();D&&(s(I=>hn(I,D)),O||c(2),a(!1))}catch(D){console.warn("Static fetch failed",D)}o(!0);try{const D=e.upAhead||{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},locations:["Chennai"]},I=await Ir(D);s(S=>{const $=hn(S,I);return Nr($),$}),c(3)}catch(D){console.error("Failed to load Live Up Ahead data",D)}finally{o(!1),a(!1)}},[e.upAhead]);y.useEffect(()=>{m(!1)},[m]);const w=O=>{O&&re.addToBlacklist&&(re.addToBlacklist(O),u(re.getBlacklist()),m(!1))},v=(O,D)=>{re.addItem(D,{id:O.id,title:O.title,category:O.tags?.[0]||"event",link:O.link,description:O.description}),alert("Added to Plan!")},j=O=>{if(!O)return"Coming Soon";const D=new Date(O);if(isNaN(D.getTime()))return O;const I=D.toLocaleDateString("en-US",{weekday:"short"}),S=D.getDate().toString().padStart(2,"0"),$=D.toLocaleDateString("en-US",{month:"short"});return`${I}, ${S} ${$}`},f=({items:O,colorClass:D,emptyMessage:I,isOffer:S=!1})=>!O||O.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:I})}):t.jsx("div",{className:"ua-wk-card",style:{border:"none",background:"transparent",padding:0},children:t.jsx("ul",{className:"ua-wk-list",children:O.map(($,T)=>{const H=j($.date||$.releaseDate);return t.jsxs("li",{className:"ua-wk-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px",background:"var(--bg-secondary)",padding:"12px",borderRadius:"12px",marginBottom:"8px"},children:[t.jsxs("a",{href:$.link,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",flex:1,overflow:"hidden",display:"flex",alignItems:"center",gap:"8px"},children:[S&&t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ·ï¸"}),t.jsx("span",{className:"ua-wk-text",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.95rem",fontWeight:500},children:$.title})]}),t.jsx("span",{className:`ua-wk-date ${D}`,style:{whiteSpace:"nowrap",flexShrink:0,fontSize:"0.8rem",fontWeight:600},children:H})]},T)})})});if(i&&!n)return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Scanning horizon..."})]})]});if(!n||!n.timeline||n.timeline.length===0)return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"empty-state",children:[t.jsx("span",{style:{fontSize:"3rem"},children:"ðŸ”­"}),t.jsx("h3",{children:"Nothing on the radar"}),t.jsx("p",{children:"No upcoming events found."}),t.jsx("button",{onClick:()=>m(!0),className:"btn btn--primary",style:{marginTop:"1rem"},children:"Retry Scan"}),t.jsx("div",{style:{marginTop:"0.75rem"},children:t.jsxs("small",{children:["Try adding more locations or categories in ",t.jsx(De,{to:"/settings",style:{color:"var(--accent-primary)"},children:"Settings"}),"."]})})]})]});const N=n.sections?.weather_alerts||[],A=n.sections?.alerts||[],_=n.sections?.civic||[],L=[...N,...A,..._],P=N[0]||A[0]||null,M=N.length>0?"ðŸŒªï¸":"âš ï¸",B=N.length>0?"Weather Warning":"Worth Knowing";return t.jsxs("div",{className:"page-container up-ahead-page",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l,rightElement:r?t.jsx("div",{className:"scanning-indicator",style:{fontSize:"0.7rem",color:"var(--accent-primary)"},children:"Scanning..."}):null}),t.jsx("div",{style:{textAlign:"center",fontSize:"0.7rem",color:"var(--text-muted)",padding:"6px",background:"var(--bg-secondary)",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:r?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading__spinner",style:{width:"12px",height:"12px",borderWidth:"2px"}}),t.jsx("span",{children:"Scanning horizon..."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:["Live Feed â€¢ ",e.upAhead?.locations?.join(", ")||"All Locations"]}),t.jsx("button",{onClick:()=>m(!0),style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.8rem"},children:"ðŸ”„"})]})}),P&&t.jsxs("div",{className:`ua-alert-banner ${N.length>0?"weather-alert":""}`,children:[t.jsx("span",{className:"ua-alert-icon",children:M}),t.jsxs("div",{className:"ua-alert-content",children:[t.jsx("h4",{children:B}),t.jsx("p",{children:P.text})]})]}),t.jsxs("div",{className:"ua-view-toggle scrollable-tabs",children:[t.jsx("button",{className:`ua-toggle-btn ${d==="plan"?"active":""}`,onClick:()=>h("plan"),children:"Plan My Week"}),t.jsx("button",{className:`ua-toggle-btn ${d==="offers"?"active":""}`,onClick:()=>h("offers"),children:"Offers"}),t.jsx("button",{className:`ua-toggle-btn ${d==="movies"?"active":""}`,onClick:()=>h("movies"),children:"Releasing Soon"}),t.jsx("button",{className:`ua-toggle-btn ${d==="events"?"active":""}`,onClick:()=>h("events"),children:"Upcoming Events"}),t.jsx("button",{className:`ua-toggle-btn ${d==="alerts"?"active":""}`,onClick:()=>h("alerts"),children:"Alerts"}),t.jsx("button",{className:`ua-toggle-btn ${d==="festivals"?"active":""}`,onClick:()=>h("festivals"),children:"Festivals"}),t.jsx("button",{className:`ua-toggle-btn ${d==="feed"?"active":""}`,onClick:()=>h("feed"),children:"Timeline"})]}),d==="plan"&&t.jsxs("div",{className:"ua-weekly-plan",children:[t.jsx(fe,{active:i||r,style:{marginBottom:"10px",borderRadius:"4px"}}),n.weekly_plan&&Array.isArray(n.weekly_plan)?n.weekly_plan.map((O,D)=>t.jsxs("div",{className:"ua-plan-day-row",children:[t.jsx("div",{className:"ua-plan-ribbon",children:t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:800,whiteSpace:"nowrap"},children:[O.day," ",t.jsx("span",{style:{opacity:.8,fontWeight:400},children:O.date})]})}),t.jsx("div",{className:"ua-plan-day-content",children:O.items&&O.items.length>0?O.items.map((I,S)=>t.jsxs("div",{className:"ua-plan-event-item",children:[t.jsx("button",{className:"ua-plan-delete-btn",onClick:$=>{$.preventDefault(),w(I.id)},"aria-label":"Remove event",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:"0.9rem",padding:"0 8px 0 0"},children:"âœ•"}),t.jsxs("a",{href:I.link,target:"_blank",rel:"noopener noreferrer",style:{flex:1,display:"flex",alignItems:"center",gap:"10px",textDecoration:"none",color:"inherit"},children:[t.jsx("span",{className:"ua-event-icon",children:I.icon}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{className:"ua-event-title",children:I.title}),I.isOffer&&t.jsx("span",{className:"ua-offer-badge",children:"ðŸ›’ Ends Today"})]})]}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsx("button",{className:"ua-plan-action-btn",onClick:$=>{$.preventDefault(),or(I.title,I.description||I.title)},title:"Add to Calendar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.1rem"},children:"ðŸ“…"})})]},S)):t.jsx("span",{className:"ua-plan-empty",style:{padding:"10px",color:"var(--text-muted)",fontSize:"0.9rem"},children:"-"})})]},D)):t.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"Data unavailable."})]}),d==="movies"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(fe,{active:i||r}),t.jsx(f,{items:n.sections?.movies,colorClass:"text-accent-info",emptyMessage:"No upcoming movie releases found."})]}),d==="offers"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(fe,{active:i||r}),t.jsx(f,{items:[...n.sections?.shopping||[],...n.sections?.airlines||[]],colorClass:"text-accent-success",emptyMessage:"No offers found.",isOffer:!0}),t.jsx("div",{style:{textAlign:"center",marginTop:"10px",fontSize:"0.8rem",color:"var(--text-muted)"},children:"Including Airline Offers"})]}),d==="events"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(fe,{active:i||r}),t.jsx(f,{items:[...n.sections?.events||[],...n.sections?.sports||[]],colorClass:"text-accent-primary",emptyMessage:"No upcoming events found."})]}),d==="alerts"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(fe,{active:i||r}),t.jsx(f,{items:L,colorClass:"text-accent-error",emptyMessage:"No alerts found."})]}),d==="festivals"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(fe,{active:i||r}),t.jsx(f,{items:n.sections?.festivals,colorClass:"text-accent-warning",emptyMessage:"No festivals found."})]}),d==="feed"&&t.jsx("div",{className:"ua-timeline",children:n.timeline.map(O=>t.jsxs("div",{className:"ua-day-section",children:[t.jsxs("div",{className:"ua-day-header",children:[t.jsx("div",{className:"ua-day-label",children:O.dayLabel}),t.jsx("div",{className:"ua-date-sub",children:O.date})]}),O.items?.map(D=>t.jsx("div",{className:"ua-media-card",children:t.jsxs("div",{className:"ua-media-content",children:[t.jsxs("div",{className:"ua-media-header",children:[t.jsx("span",{className:`ua-badge type-${D.type}`,children:D.type.toUpperCase()}),t.jsx("button",{className:`ua-watch-btn ${p(D.id)?"active":""}`,onClick:()=>g(D.id),children:p(D.id)?"â˜…":"â˜†"})]}),t.jsx("h3",{className:"ua-media-title",children:D.title}),t.jsx("p",{className:"ua-media-desc",children:D.description?D.description.length>100?D.description.substring(0,100)+"...":D.description:""}),t.jsxs("div",{className:"ua-media-footer",children:[D.link&&t.jsx("a",{href:D.link,target:"_blank",rel:"noopener noreferrer",className:"ua-source-link",children:"Read Source â†—"}),t.jsx("button",{className:"ua-cal-btn",onClick:()=>v(D,O.date),title:"Add to Plan My Week",children:"ðŸ“Œ Plan"})]})]})},D.id))]},O.date))})]})}const Br=({weatherData:e,activeCity:n,onRefresh:s,loading:i,isDesktop:a})=>{const r=n||Object.keys(e)[0]||"chennai",o=e[r]||e[r.toLowerCase()],l=y.useMemo(()=>{if(!o)return"Loading weather data...";const c=o.current||{},d=o.next8Hours||[],h=o.hourly24||[];let u=c.high;if((u==null||u===void 0)&&h.length>0){const v=Math.max(...h.map(j=>j.temp||-999));v!==-999&&(u=v)}const g=u!=null?`${u}Â°`:"--";let p="";const m=d.slice(0,4).find(v=>v.precip>.5||v.prob>=40);m?p=`Rain likely at ${m.label}`:c.windSpeed>25?p=`Windy (${c.windSpeed} km/h)`:c.temp>38||u>38?p="Heatwave Alert":c.humidity>85&&c.temp>30?p="High Humidity":c.condition&&c.condition.toLowerCase().includes("rain")&&(p="Raining Now");let w=`${c.condition||"Clear"} â€¢ High ${g}`;return p?`${w} â€¢ ${p}`:w},[o]);return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"linear-gradient(to bottom, var(--bg-card), var(--bg-primary))",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 20px rgba(0,0,0,0.4)",padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("h2",{style:{fontSize:"1.4rem",margin:0,fontWeight:800,background:"linear-gradient(135deg, #fff 0%, #aaa 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textTransform:"capitalize",letterSpacing:"-0.02em",lineHeight:1.1},children:r}),i&&t.jsx("span",{className:"pulse-dot",style:{width:"8px",height:"8px",borderRadius:"50%",background:"var(--accent-primary)",display:"inline-block",boxShadow:"0 0 10px var(--accent-primary)"}})]}),t.jsx("div",{style:{fontSize:"0.95rem",color:"var(--accent-info)",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:a?"auto":"280px",opacity:.9},children:l})]}),t.jsx("button",{onClick:s,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"var(--text-primary)",opacity:i?.7:1,transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},title:"Refresh Weather",children:t.jsx("span",{style:{display:"block",transform:i?"rotate(360deg)":"none",transition:"transform 1s linear infinite",fontSize:"18px"},children:i?"âŸ³":"â†»"})})]})};function Pr({weatherData:e,activeCity:n,setActiveCity:s}){const{settings:i}=se(),a=(i.weather?.cities||["chennai","trichy","muscat"]).map(p=>p.toLowerCase()),r={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[a[2]]:a[2].charAt(0).toUpperCase()+a[2].slice(1)},o={chennai:"ðŸ›ï¸",trichy:"ðŸ¯",muscat:"ðŸ“",[a[2]]:"ðŸ“"},[l,c]=y.useState(null);if(!e)return null;const d=e[n]||e.chennai;if(!d)return t.jsx("div",{className:"dw-container",children:"Data unavailable"});const h=new Date().getHours();let u=[];const g=(p,m,w=null)=>{p==="today"||d.tomorrow;const v=p==="today"?d[m]:d.tomorrow?.[m];let j=w;return j||(m==="morning"?j="Morning":m==="noon"?j="Afternoon":j="Evening",p==="tomorrow"&&(j="Tomorrow "+j)),{id:`${p}-${m}`,label:j,data:v}};return h<11?u=[g("today","morning","This Morning"),g("today","noon"),g("today","evening")]:h<17?u=[g("today","noon","This Afternoon"),g("today","evening"),g("tomorrow","morning")]:h<21?u=[g("today","evening","Tonight"),g("tomorrow","morning"),g("tomorrow","noon")]:u=[g("tomorrow","morning","Tomorrow Morning"),g("tomorrow","noon"),g("tomorrow","evening")],t.jsxs("div",{className:"dw-container",children:[t.jsx("div",{className:"dw-sidebar",children:a.map(p=>t.jsxs("button",{className:`dw-city-tab ${p===n?"active":""}`,onClick:()=>s(p),"aria-label":`Select ${r[p]}`,children:[t.jsx("span",{className:"dw-city-icon",children:o[p]||"ðŸ“"}),t.jsx("span",{className:"dw-city-name",children:r[p]||p})]},p))}),t.jsxs("div",{className:"dw-content",children:[t.jsxs("div",{className:"dw-header",children:[t.jsxs("div",{className:"dw-header-main",children:[t.jsx("h2",{className:"dw-city-title",children:d.name}),t.jsxs("span",{className:"dw-current-temp",children:[d.current?.temp,"Â°"]})]}),t.jsx("div",{className:"dw-header-sub",children:d.summary})]}),t.jsx("div",{className:"dw-cards-list",children:u.map((p,m)=>p.data?t.jsx(zr,{segment:p,isExpanded:l===m,onToggle:()=>c(l===m?null:m)},p.id):null)}),t.jsxs("div",{className:"dw-footer",children:["Forecast based on ",d.models?.count," models (",d.models?.names,")."]})]})]})}function zr({segment:e,isExpanded:n,onToggle:s}){const{label:i,data:a}=e,r=parseFloat(a.rainMm==="-"?0:a.rainMm),o=a.rainProb?.avg||0,l=r>=1,c=r>0||o>0;let d=sn,h="var(--text-secondary)",u="No significant rain";c&&(l?(d=Ra,h="#3b82f6"):(d=sn,h="#94a3b8"),u=`${r>0?r.toFixed(1)+"mm":"Trace"} (${o}%)`);const g=Hr(a);return t.jsxs("div",{className:`dw-card ${n?"expanded":""}`,onClick:s,children:[t.jsxs("div",{className:"dw-card-header",children:[t.jsx("span",{className:"dw-period-badge",children:i}),t.jsx("span",{className:"dw-expand-hint",children:n?"Collapse":"Touch for Hourly"})]}),t.jsxs("div",{className:"dw-card-main",children:[t.jsx("div",{className:"dw-main-icon",children:a.iconId?t.jsx(at,{id:a.iconId,size:56}):t.jsx("span",{style:{fontSize:"3rem"},children:a.icon})}),t.jsxs("div",{className:"dw-main-temp",children:[t.jsxs("div",{className:"dw-temp-val",children:[a.temp,"Â°"]}),t.jsxs("div",{className:"dw-temp-feels",children:["Feels like ",a.feelsLike,"Â°"]})]})]}),t.jsxs("div",{className:"dw-details-grid",children:[t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(d,{size:20,color:h})}),t.jsx("div",{className:"dw-detail-text",children:u})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(es,{size:20})}),t.jsxs("div",{className:"dw-detail-text",children:[a.humidity,"% ",t.jsx("span",{className:"dw-sep",children:"|"})," ",t.jsx(ts,{size:16})," ",a.windSpeed," km/h"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â˜€ï¸"}),t.jsxs("div",{className:"dw-detail-text",children:["UV: ",a.uvIndex||"-"," ",t.jsx("span",{className:"dw-sep",children:"|"})," PM 2.5: -"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â„¹ï¸"}),t.jsx("div",{className:"dw-detail-text dw-desc",children:g})]})]}),n&&a.hourly&&t.jsx("div",{className:"dw-hourly-container hide-scrollbar",onClick:p=>p.stopPropagation(),children:a.hourly.map((p,m)=>t.jsxs("div",{className:"dw-hourly-slot",children:[t.jsx("span",{className:"dw-slot-time",children:p.time}),t.jsx("div",{className:"dw-slot-icon",children:p.iconId?t.jsx(at,{id:p.iconId,size:28}):p.icon}),t.jsxs("strong",{className:"dw-slot-temp",children:[p.temp,"Â°"]}),p.precip>0&&t.jsxs("span",{className:"dw-slot-precip",children:[p.precip>=1&&t.jsx("span",{style:{fontSize:"0.7rem"},children:"â˜‚ï¸"}),p.precip,"mm"]})]},m))})]})}function Hr(e){const n=[];return e.rainProb?.avg>40?n.push("Rain expected."):e.cloudCover>70?n.push("Cloudy."):e.cloudCover<20&&n.push("Clear skies."),e.windSpeed>20&&n.push("Breezy."),e.uvIndex>8&&n.push("High UV."),n.length===0?"Pleasant conditions.":n.join(" ")}function Ur(){const{weatherData:e,loading:n,error:s,refreshWeather:i}=Ke(),{settings:a}=se(),{isDesktop:r}=lt(),o=e,l=(a.weather?.cities||["chennai","trichy","muscat"]).map(u=>u.toLowerCase()),[c,d]=y.useState(()=>localStorage.getItem("dw_active_city")||"chennai");y.useEffect(()=>{localStorage.setItem("dw_active_city",c)},[c]);const h=()=>{i(!0)};return n&&!e?t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Forecast..."})]})}):t.jsxs("div",{className:"page-container",style:{padding:0},children:[o&&t.jsx(Br,{weatherData:o,activeCity:c,cities:l,onRefresh:h,loading:n,isDesktop:r}),t.jsxs("main",{className:"main-content",style:{padding:0,marginTop:0},children:[s&&t.jsxs("div",{className:"topline",style:{borderLeftColor:"var(--accent-danger)",margin:"16px"},children:[t.jsx("div",{className:"topline__label",style:{color:"var(--accent-danger)"},children:"Error"}),t.jsx("div",{className:"topline__text",children:"Failed to update weather. Showing cached data."})]}),o?t.jsx(Pr,{weatherData:o,activeCity:c,setActiveCity:d}):t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"â˜ï¸"}),t.jsx("p",{children:"Weather data unavailable."}),t.jsx("button",{onClick:h,className:"btn btn--secondary mt-md",children:"Retry"})]})]})]})}const Wr=({indices:e,onRefresh:n,loading:s,lastUpdated:i})=>{const r=["NIFTY 50","SENSEX","NIFTY BANK"].map(c=>e?.find(d=>d.name.toUpperCase().includes(c))).filter(Boolean),o=r.length>0?r:e?.slice(0,3)||[],l=c=>c?new Date(c).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):"";return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-primary)",paddingBottom:"8px",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"var(--gradient-header)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ“ˆ"}),t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"1.1rem",margin:0,fontWeight:700,color:"var(--text-primary)",lineHeight:1.2},children:"Indian Markets"}),i&&t.jsxs("div",{style:{fontSize:"0.65rem",color:"rgba(255,255,255,0.7)",fontWeight:400},children:["Updated ",l(i)]})]})]}),t.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem",padding:"4px",color:"var(--text-primary)",opacity:s?.5:1,transition:"transform 0.3s"},title:"Refresh Markets",className:s?"spin":"",children:s?"âŸ³":"ðŸ”„"})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${o.length}, 1fr)`,gap:"1px",background:"var(--border-default)",marginTop:"0"},children:o.map((c,d)=>{const h=c.direction==="up"||c.change>0,u=h?"var(--accent-success)":"var(--accent-danger)",g=h?"â–²":"â–¼";return t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"10px 4px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",fontWeight:600,marginBottom:"2px",textTransform:"uppercase"},children:c.name.replace("NIFTY","").replace("SENSEX","SENSEX").trim()||c.name}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,color:"var(--text-primary)",marginBottom:"2px"},children:c.value}),t.jsxs("div",{style:{fontSize:"0.75rem",color:u,fontWeight:600,display:"flex",alignItems:"center",gap:"2px"},children:[t.jsx("span",{children:g}),t.jsx("span",{children:Math.abs(c.change).toFixed(2)}),t.jsxs("span",{style:{opacity:.8},children:["(",Math.abs(c.changePercent).toFixed(2),"%)"]})]})]},d)})}),t.jsx("style",{children:`
                .spin { animation: spin 1s linear infinite; }
                @keyframes spin { 100% { transform: rotate(360deg); } }
            `})]})};function Gr({funds:e}){const[n,s]=y.useState(!1);if(!e||e.length===0)return t.jsxs("div",{className:"mf-card mf-card--empty",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Funds"]}),t.jsx("p",{className:"mf-card__empty-text",children:"NAV data unavailable"})]});const i=n?e:e.slice(0,4);return t.jsxs("div",{className:"mf-card",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]}),t.jsx("span",{className:"mf-card__date",children:e[0]?.navDate||"Latest"})]}),t.jsx("div",{className:"mf-card__list",children:i.map((a,r)=>t.jsxs("div",{className:"mf-fund",children:[t.jsxs("div",{className:"mf-fund__info",children:[t.jsx("div",{className:"mf-fund__name",children:a.name}),t.jsx("div",{className:"mf-fund__category",children:a.category})]}),t.jsxs("div",{className:"mf-fund__nav",children:[t.jsxs("div",{className:"mf-fund__value",children:["â‚¹",a.nav]}),t.jsxs("div",{className:`mf-fund__change mf-fund__change--${a.direction}`,children:[a.direction==="up"?"â–²":"â–¼"," ",a.changePercent,"%"]})]})]},a.code||r))}),e.length>4&&t.jsx("button",{className:"mf-card__toggle",onClick:()=>s(!n),children:n?"Show Less â–²":`Show All (${e.length}) â–¼`})]})}function Kr({ipoData:e}){const[n,s]=y.useState("upcoming");if(!e)return t.jsxs("div",{className:"ipo-card ipo-card--empty",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),t.jsx("p",{children:"IPO data unavailable"})]});const i=[{key:"upcoming",label:"Upcoming",icon:"ðŸ“…"},{key:"live",label:"Live",icon:"ðŸ”´"},{key:"recent",label:"Recent",icon:"âœ…"}],a=e[n]||[];return t.jsxs("div",{className:"ipo-card",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),e.isFallback&&t.jsx("span",{className:"ipo-card__fallback-badge",children:"Demo Data"})]}),t.jsx("div",{className:"ipo-card__tabs",children:i.map(r=>t.jsxs("button",{className:`ipo-tab ${n===r.key?"ipo-tab--active":""}`,onClick:()=>s(r.key),children:[r.icon," ",r.label,t.jsx("span",{className:"ipo-tab__count",children:e[r.key]?.length||0})]},r.key))}),t.jsx("div",{className:"ipo-card__list",children:a.length===0?t.jsxs("div",{className:"ipo-card__empty",children:["No ",n," IPOs at the moment"]}):a.map((r,o)=>t.jsxs("div",{className:"ipo-item",children:[t.jsxs("div",{className:"ipo-item__header",children:[t.jsxs("div",{className:"ipo-item__name",children:[r.name,r.isSME&&t.jsx("span",{style:{fontSize:"0.6rem",marginLeft:"6px",background:"#333",padding:"2px 4px",borderRadius:"4px"},children:"SME"})]}),t.jsx("div",{className:`ipo-item__status ipo-item__status--${r.status||n}`,children:r.status||n})]}),t.jsxs("div",{className:"ipo-item__details",children:[r.issuePrice&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Price Band:"}),t.jsx("span",{className:"ipo-item__value",children:r.issuePrice})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Open:"}),t.jsx("span",{className:"ipo-item__value",children:r.openDate})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Close:"}),t.jsx("span",{className:"ipo-item__value",children:r.closeDate})]}),r.issueSize&&r.issueSize!=="-"&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Size:"}),t.jsx("span",{className:"ipo-item__value",children:r.issueSize})]})]})]},o))})]})}function Vr(){const{marketData:e,loading:n,error:s,refreshMarket:i,lastFetch:a}=Hn(),{settings:r}=se(),o=r?.market||{},[l,c]=y.useState(()=>Date.now());y.useEffect(()=>{const M=setInterval(()=>c(Date.now()),6e4);return()=>clearInterval(M)},[]);const d=()=>{i()},h=M=>{const B=M?.timestamp||a;return B?l-B:1/0},u=M=>{const B=h(M),O=B>900*1e3;return B>14400*1e3?{opacity:.3,filter:"grayscale(1) brightness(0.7)",transition:"all 0.3s ease"}:O?{opacity:.6,filter:"grayscale(0.5)",transition:"all 0.3s ease"}:{opacity:1,filter:"none",transition:"all 0.3s ease"}},[g,p]=y.useState(!1);y.useEffect(()=>{const M=()=>{p(window.scrollY>400)};return window.addEventListener("scroll",M),()=>window.removeEventListener("scroll",M)},[]);const m=[(o.showGainers!==!1||o.showLosers!==!1)&&{id:"market-movers",icon:"ðŸ“ˆ",label:"Top Movers"},o.showSectorals!==!1&&{id:"sectoral-indices",icon:"ðŸ›ï¸",label:"Sectorals"},o.showCommodities!==!1&&{id:"commodities",icon:"ðŸª™",label:"Commodities"},o.showCurrency!==!1&&{id:"currency",icon:"ðŸ’±",label:"Currency"},o.showFIIDII!==!1&&{id:"fiidii",icon:"ðŸ¦",label:"FII/DII"},o.showMutualFunds!==!1&&{id:"mutual-funds",icon:"ðŸ’°",label:"Mutual Funds"},o.showIPO!==!1&&{id:"ipo-tracker",icon:"ðŸŽ¯",label:"IPO Watch"}].filter(Boolean);if(n&&!e)return t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Market Data..."})]})});const{indices:w,mutualFunds:v,ipo:j,movers:f,sectorals:N,commodities:A,currencies:_,fiidii:L}=e||{},P=()=>{window.scrollTo({top:0,behavior:"smooth"})};return t.jsxs("div",{className:"page-container",style:{padding:0},children:[t.jsx(Wr,{indices:w,onRefresh:d,loading:n,lastUpdated:a}),t.jsxs("main",{className:"main-content market-page",style:{padding:"16px",marginTop:0},children:[s&&t.jsx("div",{className:"error-state",style:{marginBottom:"16px",padding:"12px",background:"rgba(255, 71, 87, 0.1)",border:"1px solid var(--accent-danger)",borderRadius:"8px",color:"var(--accent-danger)"},children:t.jsx("p",{style:{margin:0},children:"Failed to load market data. Showing cached data."})}),(o.showGainers!==!1||o.showLosers!==!1)&&t.jsxs("section",{id:"market-movers",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ“ˆ"})," Top Movers"]}),t.jsxs("div",{className:"movers-grid",children:[o.showGainers!==!1&&t.jsxs("div",{className:"movers-column movers-column--gainers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”¼ Top Gainers"}),f?.gainers?.slice(0,5).map((M,B)=>t.jsxs("div",{className:"mover-item",style:u(M),children:[t.jsx("div",{className:"mover-item__symbol",children:M.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",M.price]}),t.jsxs("div",{className:"mover-item__change text-success",children:["+",M.changePercent,"%"]})]},B))]}),o.showLosers!==!1&&t.jsxs("div",{className:"movers-column movers-column--losers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”½ Top Losers"}),f?.losers?.slice(0,5).map((M,B)=>t.jsxs("div",{className:"mover-item",style:u(M),children:[t.jsx("div",{className:"mover-item__symbol",children:M.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",M.price]}),t.jsxs("div",{className:"mover-item__change text-danger",children:[M.changePercent,"%"]})]},B))]})]})]}),o.showSectorals!==!1&&t.jsxs("section",{id:"sectoral-indices",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ›ï¸"})," Sectoral Indices"]}),t.jsx("div",{className:"sectoral-grid",children:N?.map((M,B)=>t.jsxs("div",{className:"sectoral-card",style:u(M),children:[t.jsx("div",{className:"sectoral-card__name",children:M.name}),t.jsx("div",{className:"sectoral-card__value",children:M.value}),t.jsxs("div",{className:`sectoral-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,children:[M.changePercent>=0?"â–²":"â–¼"," ",M.changePercent,"%"]})]},B))})]}),o.showCommodities!==!1&&t.jsxs("section",{id:"commodities",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸª™"})," Commodity Watch"]}),t.jsx("div",{className:"commodity-grid",children:A?.map((M,B)=>t.jsxs("div",{className:"commodity-card",style:u(M),children:[t.jsx("div",{className:"commodity-card__name",children:M.name}),t.jsxs("div",{className:"commodity-card__value",children:[M.value," ",t.jsx("span",{className:"commodity-card__unit",children:M.unit})]}),t.jsxs("div",{className:`commodity-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,children:[M.changePercent>=0?"+":"",M.changePercent,"%"]})]},B))})]}),o.showCurrency!==!1&&t.jsxs("section",{id:"currency",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ’±"})," Currency Rates"]}),t.jsx("div",{className:"currency-grid",children:_?.map((M,B)=>t.jsxs("div",{className:"currency-card",style:u(M),children:[t.jsx("div",{className:"currency-card__name",children:M.name}),t.jsxs("div",{className:"currency-card__value",children:["â‚¹",M.value]}),t.jsxs("div",{className:`currency-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,children:[M.changePercent>=0?"+":"",M.changePercent,"%"]})]},B))})]}),o.showFIIDII!==!1&&t.jsxs("section",{id:"fiidii",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ¦"})," FII/DII Activity"]}),t.jsxs("div",{className:"fiidii-container",children:[t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"FII (Foreign Investors)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",L?.fii?.buy," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",L?.fii?.sell," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${L?.fii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",L?.fii?.net," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"DII (Domestic Investors)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",L?.dii?.buy," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",L?.dii?.sell," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${L?.dii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",L?.dii?.net," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-date",children:["As of: ",L?.date]})]})]}),o.showMutualFunds!==!1&&t.jsxs("section",{id:"mutual-funds",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]}),t.jsx(Gr,{funds:v})]}),o.showIPO!==!1&&t.jsxs("section",{id:"ipo-tracker",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),t.jsx(Kr,{ipoData:j})]}),t.jsxs("div",{className:"market-disclaimer",children:[t.jsx("div",{children:"* Data is for informational purposes only. Not investment advice."}),e?.fetchedAt&&t.jsxs("div",{style:{fontSize:"0.7rem",opacity:.7,marginTop:"4px"},children:["Last Updated: ",new Date(e.fetchedAt).toLocaleString()]})]})]}),t.jsx(Ct,{sections:m}),t.jsx("button",{onClick:P,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:g?1:0,pointerEvents:g?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:"â†‘"})]})}const pn="buzz_page_cache";function qr(){const{newsData:e,refreshNews:n,loading:s,loadSection:i}=Ge(),{settings:a}=se(),[r,o]=y.useState("tamil"),[l,c]=y.useState(null),[d,h]=y.useState(0);y.useEffect(()=>{try{const _=localStorage.getItem(pn);if(_){const L=JSON.parse(_);Date.now()-(L.timestamp||0)<480*60*1e3?(c(L),h(1)):(console.log("[Buzz] Cache expired, showing anyway until live loads"),c(L),h(1))}}catch(_){console.warn("Buzz Cache read error",_)}},[]),y.useEffect(()=>{["entertainment","social","technology","local","world","india","chennai"].forEach(L=>i(L))},[i]);const u=Ln.useCallback(_=>{if(!_)return[];const L=(a.freshnessLimitHours||72)*36e5,P=Date.now();return _.filter(M=>P-(M.publishedAt||0)<L)},[a.freshnessLimitHours]),g=e.entertainment&&e.entertainment.length>0;y.useEffect(()=>{g&&h(3)},[g]);const p=g?e:l?.data||{},m=y.useMemo(()=>{const _=p.entertainment||[],L={tamil:["vijay","ajith","rajini","kamal","dhanush","suriya","vikram","simbu","siva karthikeyan","trisha","nayanthara","anirudh","ar rahman","kollywood","thalapathy","thala","udhayanidhi","vetri maaran","lokesh","nelson","jailer","leo","kanguva","indian 2","vettaiyan","goat","viduthalai","karthi","sethupathi","tamil","chennai"],hindi:["shah rukh","srk","salman","aamir","ranbir","alia","deepika","ranveer","kareena","akshay","bachchan","bollywood","hrithik","katrina","vicky kaushal","karan johar","yrf","dharma","pathaan","jawan","tiger 3","animal","dunki","war 2","singham","hindi","mumbai"],hollywood:["oscar","grammy","emmy","golden globe","marvel","dc","disney","warner bros","universal","tom cruise","dicaprio","nolan","avengers","spider-man","batman","superman","taylor swift","beyonce","kim kardashian","kanye","justin bieber","selena gomez","zendaya","hollywood","bad bunny","rihanna","drake"],ott:["netflix","prime video","hotstar","sonyliv","zee5","aha","streaming","web series","season","episode","ott"]};return _.map(P=>{const M=(P.title+" "+(P.summary||"")).toLowerCase();return L.tamil.some(B=>M.includes(B))?{...P,region:"tamil"}:L.hindi.some(B=>M.includes(B))?{...P,region:"hindi"}:L.hollywood.some(B=>M.includes(B))?{...P,region:"hollywood"}:L.ott.some(B=>M.includes(B))?{...P,region:"ott"}:P})},[p.entertainment]),w=y.useMemo(()=>{const _={india:["india","indian","bollywood","cricket","modi","delhi","mumbai","bangalore","hyderabad","ipl","bcci"],tamilnadu:["chennai","tamil","tamilnadu","kollywood","rajini","kamal","vijay","trichy","coimbatore","madurai","tn"],muscat:["muscat","oman","gulf","gcc","uae","dubai","arab","middle east","expat","omani"]},L=T=>{const H=(T.title+" "+(T.summary||"")).toLowerCase();return _.tamilnadu.some(W=>H.includes(W))?"tamilnadu":_.muscat.some(W=>H.includes(W))?"muscat":_.india.some(W=>H.includes(W))?"india":"world"},P=u(p.social||[]),M=u(p.world||[]),B=u(p.india||[]),O=u(p.chennai||[]),D=u(p.local||[]),I={world:[],india:[],tamilnadu:[],muscat:[]};P.forEach(T=>{const H=L(T);I[H].push({...T,source:"social"})}),M.filter(T=>T.title?.toLowerCase().includes("trend")||T.title?.toLowerCase().includes("viral")||T.title?.toLowerCase().includes("social")).forEach(T=>I.world.push({...T,source:"world"})),B.filter(T=>T.title?.toLowerCase().includes("trend")||T.title?.toLowerCase().includes("viral")||T.title?.toLowerCase().includes("social")).forEach(T=>I.india.push({...T,source:"india"})),O.forEach(T=>{I.tamilnadu.push({...T,source:"chennai"})}),D.forEach(T=>{I.muscat.push({...T,source:"local"})});const S={world:a.socialTrends?.worldCount??8,india:a.socialTrends?.indiaCount??8,tamilnadu:a.socialTrends?.tamilnaduCount??5,muscat:a.socialTrends?.muscatCount??4},$=[];return Object.entries(S).forEach(([T,H])=>{const W=I[T];W.sort((x,R)=>(R.publishedAt||0)-(x.publishedAt||0)),W.slice(0,H).forEach(x=>{$.push({...x,region:T,regionLabel:T==="world"?"ðŸŒ World":T==="india"?"ðŸ‡®ðŸ‡³ India":T==="tamilnadu"?"ðŸ›ï¸ Tamil Nadu":"ðŸï¸ Muscat"})})}),$.sort((T,H)=>(H.publishedAt||0)-(T.publishedAt||0)),$},[p,a.freshnessLimitHours,a.socialTrends,u]);y.useEffect(()=>{if(g)try{const _={timestamp:Date.now(),data:{entertainment:e.entertainment,social:e.social,technology:e.technology,world:e.world,india:e.india,chennai:e.chennai,local:e.local}};localStorage.setItem(pn,JSON.stringify(_))}catch(_){console.warn("Buzz Cache write error",_)}},[g,e]);const v=()=>{h(3),n(["technology","social","world","india","chennai","local"])},j=[{id:"entertainment",icon:"ðŸŽ¬",label:"Entertainment"},{id:"social-trends",icon:"ðŸ‘¥",label:"Social Trends"},{id:"tech-news",icon:"ðŸš€",label:"Tech & Startups"},{id:"ai-innovation",icon:"ðŸ¤–",label:"AI & Innovation"}],[f,N]=y.useState(!1);y.useEffect(()=>{const _=()=>{window.scrollY>400?N(!0):N(!1)};return window.addEventListener("scroll",_),()=>window.removeEventListener("scroll",_)},[]);const A=()=>{window.scrollTo({top:0,behavior:"smooth"})};return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Buzz Hub",icon:"ðŸŽ­",onRefresh:v,loadingPhase:d||(s?3:0)}),t.jsxs("main",{className:"main-content",children:[t.jsxs("section",{id:"entertainment",className:"news-section entertainment-hub",children:[t.jsxs("h2",{className:"news-section__title news-section__title--entertainment",children:[t.jsx("span",{children:"ðŸŽ¬"})," Entertainment"]}),t.jsx(fe,{active:s&&d>1,style:{marginBottom:"16px"}}),t.jsxs("div",{className:"entertainment-tabs",children:[t.jsx("button",{className:`ent-tab ${r==="tamil"?"ent-tab--active":""}`,onClick:()=>o("tamil"),children:"ðŸŽ­ Tamil"}),t.jsx("button",{className:`ent-tab ${r==="hindi"?"ent-tab--active":""}`,onClick:()=>o("hindi"),children:"ðŸŽª Hindi"}),t.jsx("button",{className:`ent-tab ${r==="hollywood"?"ent-tab--active":""}`,onClick:()=>o("hollywood"),children:"ðŸŽ¬ Hollywood"}),t.jsx("button",{className:`ent-tab ${r==="ott"?"ent-tab--active":""}`,onClick:()=>o("ott"),children:"ðŸ“º OTT"})]}),t.jsx("div",{className:"entertainment-content",children:t.jsx(ue,{title:r==="tamil"?"Tamil Cinema":r==="hindi"?"Hindi Cinema":r==="hollywood"?"Hollywood":"OTT & Streaming",icon:r==="tamil"?"ðŸŽ­":r==="hindi"?"ðŸŽª":r==="hollywood"?"ðŸŽ¬":"ðŸ“º",news:u(m.filter(_=>_.region===r)),maxDisplay:r==="tamil"?a.entertainment?.tamilCount??5:r==="hindi"?a.entertainment?.hindiCount??5:r==="hollywood"?a.entertainment?.hollywoodCount??3:a.entertainment?.ottCount??2,hideTitle:!0,showCritics:!1})})]}),t.jsxs("section",{id:"social-trends",className:"news-section",children:[t.jsxs("h2",{className:"news-section__title news-section__title--social",children:[t.jsx("span",{children:"ðŸ‘¥"})," Social Trends"]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px",padding:"0 16px"},children:[w.map((_,L)=>t.jsx(nt,{article:{..._,time:_.time||"Recently"},href:_.link,badge:_.regionLabel,size:"medium"},L)),w.length===0&&t.jsx("div",{className:"empty-state",style:{gridColumn:"1/-1"},children:t.jsx("p",{children:"No social trends available"})})]})]}),t.jsx(ue,{id:"tech-news",title:"Tech & Startups",icon:"ðŸš€",colorClass:"news-section__title--world",news:u(p.technology),maxDisplay:a.sections?.technology?.count||5,showCritics:!1}),t.jsx(ue,{id:"ai-innovation",title:"AI & Innovation",icon:"ðŸ¤–",colorClass:"news-section__title--entertainment",news:u(p.technology?.filter(_=>_.title?.toLowerCase().includes("ai")||_.title?.toLowerCase().includes("innovation")||_.title?.toLowerCase().includes("machine learning")||_.title?.toLowerCase().includes("chatgpt")||_.title?.toLowerCase().includes("gemini"))),maxDisplay:6,showCritics:!1})]}),t.jsx(Ct,{sections:j}),t.jsx("button",{onClick:A,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(var(--bg-card), 0.6)",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:f?1:0,pointerEvents:f?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},className:"back-to-top",children:"â†‘"})]})}const Yr=({article:e,sourceName:n,isTranslated:s})=>{const i=s&&e.title_en?e.title_en:e.title;return t.jsxs("article",{className:"newspaper-card",children:[n&&t.jsx("div",{className:"newspaper-card__source",children:n}),t.jsx("h3",{className:"newspaper-card__title",children:t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:i})}),t.jsx("div",{className:"newspaper-card__footer",children:t.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"newspaper-card__link",children:["Read Full Story ",t.jsx(Za,{size:10})]})})]})};var mn;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(mn||(mn={}));var gn;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(gn||(gn={}));var fn;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(fn||(fn={}));const yn=["user","model","function","system"];var xn;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(xn||(xn={}));var wn;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(wn||(wn={}));var vn;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(vn||(vn={}));var bn;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(bn||(bn={}));var ze;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(ze||(ze={}));var Sn;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(Sn||(Sn={}));var jn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(jn||(jn={}));var Nn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Nn||(Nn={}));class ne extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class Me extends ne{constructor(n,s){super(n),this.response=s}}class ls extends ne{constructor(n,s,i,a){super(n),this.status=s,this.statusText=i,this.errorDetails=a}}class ve extends ne{}class cs extends ne{}const Jr="https://generativelanguage.googleapis.com",Xr="v1beta",Qr="0.24.1",Zr="genai-js";var Ee;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ee||(Ee={}));class eo{constructor(n,s,i,a,r){this.model=n,this.task=s,this.apiKey=i,this.stream=a,this.requestOptions=r}toString(){var n,s;const i=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Xr;let r=`${((s=this.requestOptions)===null||s===void 0?void 0:s.baseUrl)||Jr}/${i}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}function to(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${Zr}/${Qr}`),n.join(" ")}async function no(e){var n;const s=new Headers;s.append("Content-Type","application/json"),s.append("x-goog-api-client",to(e.requestOptions)),s.append("x-goog-api-key",e.apiKey);let i=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(a){throw new ve(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${a.message}`)}for(const[a,r]of i.entries()){if(a==="x-goog-api-key")throw new ve(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new ve(`Header name ${a} can only be set using the apiClient field`);s.append(a,r)}}return s}async function so(e,n,s,i,a,r){const o=new eo(e,n,s,i,r);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},oo(r)),{method:"POST",headers:await no(o),body:a})}}async function Ve(e,n,s,i,a,r={},o=fetch){const{url:l,fetchOptions:c}=await so(e,n,s,i,a,r);return io(l,c,o)}async function io(e,n,s=fetch){let i;try{i=await s(e,n)}catch(a){ao(a,e)}return i.ok||await ro(i,e),i}function ao(e,n){let s=e;throw s.name==="AbortError"?(s=new cs(`Request aborted when fetching ${n.toString()}: ${e.message}`),s.stack=e.stack):e instanceof ls||e instanceof ve||(s=new ne(`Error fetching from ${n.toString()}: ${e.message}`),s.stack=e.stack),s}async function ro(e,n){let s="",i;try{const a=await e.json();s=a.error.message,a.error.details&&(s+=` ${JSON.stringify(a.error.details)}`,i=a.error.details)}catch{}throw new ls(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,i)}function oo(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const s=new AbortController;e?.timeout>=0&&setTimeout(()=>s.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{s.abort()}),n.signal=s.signal}return n}function Tt(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),st(e.candidates[0]))throw new Me(`${we(e)}`,e);return lo(e)}else if(e.promptFeedback)throw new Me(`Text not available. ${we(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),st(e.candidates[0]))throw new Me(`${we(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),kn(e)[0]}else if(e.promptFeedback)throw new Me(`Function call not available. ${we(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),st(e.candidates[0]))throw new Me(`${we(e)}`,e);return kn(e)}else if(e.promptFeedback)throw new Me(`Function call not available. ${we(e)}`,e)},e}function lo(e){var n,s,i,a;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(a=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||a===void 0?void 0:a.parts)o.text&&r.push(o.text),o.executableCode&&r.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&r.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}function kn(e){var n,s,i,a;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(a=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||a===void 0?void 0:a.parts)o.functionCall&&r.push(o.functionCall);if(r.length>0)return r}const co=[ze.RECITATION,ze.SAFETY,ze.LANGUAGE];function st(e){return!!e.finishReason&&co.includes(e.finishReason)}function we(e){var n,s,i;let a="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)a+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(a+=` due to ${e.promptFeedback.blockReason}`),!((s=e.promptFeedback)===null||s===void 0)&&s.blockReasonMessage&&(a+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((i=e.candidates)===null||i===void 0)&&i[0]){const r=e.candidates[0];st(r)&&(a+=`Candidate was blocked due to ${r.finishReason}`,r.finishMessage&&(a+=`: ${r.finishMessage}`))}return a}function He(e){return this instanceof He?(this.v=e,this):new He(e)}function uo(e,n,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=s.apply(e,n||[]),a,r=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(g){i[g]&&(a[g]=function(p){return new Promise(function(m,w){r.push([g,p,m,w])>1||l(g,p)})})}function l(g,p){try{c(i[g](p))}catch(m){u(r[0][3],m)}}function c(g){g.value instanceof He?Promise.resolve(g.value.v).then(d,h):u(r[0][2],g)}function d(g){l("next",g)}function h(g){l("throw",g)}function u(g,p){g(p),r.shift(),r.length&&l(r[0][0],r[0][1])}}const _n=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ho(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),s=go(n),[i,a]=s.tee();return{stream:mo(i),response:po(a)}}async function po(e){const n=[],s=e.getReader();for(;;){const{done:i,value:a}=await s.read();if(i)return Tt(fo(n));n.push(a)}}function mo(e){return uo(this,arguments,function*(){const s=e.getReader();for(;;){const{value:i,done:a}=yield He(s.read());if(a)break;yield yield He(Tt(i))}})}function go(e){const n=e.getReader();return new ReadableStream({start(i){let a="";return r();function r(){return n.read().then(({value:o,done:l})=>{if(l){if(a.trim()){i.error(new ne("Failed to parse stream"));return}i.close();return}a+=o;let c=a.match(_n),d;for(;c;){try{d=JSON.parse(c[1])}catch{i.error(new ne(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(d),a=a.substring(c[0].length),c=a.match(_n)}return r()}).catch(o=>{let l=o;throw l.stack=o.stack,l.name==="AbortError"?l=new cs("Request aborted when reading from the stream"):l=new ne("Error reading from the stream"),l})}}})}function fo(e){const n=e[e.length-1],s={promptFeedback:n?.promptFeedback};for(const i of e){if(i.candidates){let a=0;for(const r of i.candidates)if(s.candidates||(s.candidates=[]),s.candidates[a]||(s.candidates[a]={index:a}),s.candidates[a].citationMetadata=r.citationMetadata,s.candidates[a].groundingMetadata=r.groundingMetadata,s.candidates[a].finishReason=r.finishReason,s.candidates[a].finishMessage=r.finishMessage,s.candidates[a].safetyRatings=r.safetyRatings,r.content&&r.content.parts){s.candidates[a].content||(s.candidates[a].content={role:r.content.role||"user",parts:[]});const o={};for(const l of r.content.parts)l.text&&(o.text=l.text),l.functionCall&&(o.functionCall=l.functionCall),l.executableCode&&(o.executableCode=l.executableCode),l.codeExecutionResult&&(o.codeExecutionResult=l.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),s.candidates[a].content.parts.push(o)}a++}i.usageMetadata&&(s.usageMetadata=i.usageMetadata)}return s}async function ds(e,n,s,i){const a=await Ve(n,Ee.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(s),i);return ho(a)}async function us(e,n,s,i){const r=await(await Ve(n,Ee.GENERATE_CONTENT,e,!1,JSON.stringify(s),i)).json();return{response:Tt(r)}}function hs(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Ue(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const s of e)typeof s=="string"?n.push({text:s}):n.push(s);return yo(n)}function yo(e){const n={role:"user",parts:[]},s={role:"function",parts:[]};let i=!1,a=!1;for(const r of e)"functionResponse"in r?(s.parts.push(r),a=!0):(n.parts.push(r),i=!0);if(i&&a)throw new ne("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!a)throw new ne("No content is provided for sending chat message.");return i?n:s}function xo(e,n){var s;let i={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(s=n?.cachedContent)===null||s===void 0?void 0:s.name,contents:[]};const a=e.generateContentRequest!=null;if(e.contents){if(a)throw new ve("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(a)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{const r=Ue(e);i.contents=[r]}return{generateContentRequest:i}}function Cn(e){let n;return e.contents?n=e:n={contents:[Ue(e)]},e.systemInstruction&&(n.systemInstruction=hs(e.systemInstruction)),n}function wo(e){return typeof e=="string"||Array.isArray(e)?{content:Ue(e)}:e}const En=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],vo={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function bo(e){let n=!1;for(const s of e){const{role:i,parts:a}=s;if(!n&&i!=="user")throw new ne(`First content should be with role 'user', got ${i}`);if(!yn.includes(i))throw new ne(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(yn)}`);if(!Array.isArray(a))throw new ne("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new ne("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of a)for(const c of En)c in l&&(r[c]+=1);const o=vo[i];for(const l of En)if(!o.includes(l)&&r[l]>0)throw new ne(`Content with role '${i}' can't contain '${l}' part`);n=!0}}function Tn(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const s=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(s===void 0||s.parts===void 0||s.parts.length===0)return!1;for(const i of s.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}const In="SILENT_ERROR";class So{constructor(n,s,i,a={}){this.model=s,this.params=i,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,i?.history&&(bo(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,s={}){var i,a,r,o,l,c;await this._sendPromise;const d=Ue(n),h={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},u=Object.assign(Object.assign({},this._requestOptions),s);let g;return this._sendPromise=this._sendPromise.then(()=>us(this._apiKey,this.model,h,u)).then(p=>{var m;if(Tn(p.response)){this._history.push(d);const w=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(w)}else{const w=we(p.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}g=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,g}async sendMessageStream(n,s={}){var i,a,r,o,l,c;await this._sendPromise;const d=Ue(n),h={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},u=Object.assign(Object.assign({},this._requestOptions),s),g=ds(this._apiKey,this.model,h,u);return this._sendPromise=this._sendPromise.then(()=>g).catch(p=>{throw new Error(In)}).then(p=>p.response).then(p=>{if(Tn(p)){this._history.push(d);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=we(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==In&&console.error(p)}),g}}async function jo(e,n,s,i){return(await Ve(n,Ee.COUNT_TOKENS,e,!1,JSON.stringify(s),i)).json()}async function No(e,n,s,i){return(await Ve(n,Ee.EMBED_CONTENT,e,!1,JSON.stringify(s),i)).json()}async function ko(e,n,s,i){const a=s.requests.map(o=>Object.assign(Object.assign({},o),{model:n}));return(await Ve(n,Ee.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:a}),i)).json()}class An{constructor(n,s,i={}){this.apiKey=n,this._requestOptions=i,s.model.includes("/")?this.model=s.model:this.model=`models/${s.model}`,this.generationConfig=s.generationConfig||{},this.safetySettings=s.safetySettings||[],this.tools=s.tools,this.toolConfig=s.toolConfig,this.systemInstruction=hs(s.systemInstruction),this.cachedContent=s.cachedContent}async generateContent(n,s={}){var i;const a=Cn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return us(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},a),r)}async generateContentStream(n,s={}){var i;const a=Cn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return ds(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},a),r)}startChat(n){var s;return new So(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),this._requestOptions)}async countTokens(n,s={}){const i=xo(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),s);return jo(this.apiKey,this.model,i,a)}async embedContent(n,s={}){const i=wo(n),a=Object.assign(Object.assign({},this._requestOptions),s);return No(this.apiKey,this.model,i,a)}async batchEmbedContents(n,s={}){const i=Object.assign(Object.assign({},this._requestOptions),s);return ko(this.apiKey,this.model,n,i)}}class _o{constructor(n){this.apiKey=n}getGenerativeModel(n,s){if(!n.model)throw new ne("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new An(this.apiKey,n,s)}getGenerativeModelFromCachedContent(n,s,i){if(!n.name)throw new ve("Cached content must contain a `name` field.");if(!n.model)throw new ve("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const o of a)if(s?.[o]&&n[o]&&s?.[o]!==n[o]){if(o==="model"){const l=s.model.startsWith("models/")?s.model.replace("models/",""):s.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(l===c)continue}throw new ve(`Different value for "${o}" specified in modelParams (${s[o]}) and cachedContent (${n[o]})`)}const r=Object.assign(Object.assign({},s),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new An(this.apiKey,r,i)}}let Mn=null,Nt=null;const Rn=e=>{if(!e)return!1;try{return Mn=new _o(e),Nt=Mn.getGenerativeModel({model:"gemini-1.5-flash"}),!0}catch(n){return console.error("Failed to initialize Gemini AI:",n),!1}},vt={generateSummary:async(e,n,s=!1)=>{if(!Rn(n))throw new Error("Invalid or missing API Key");let a=`You are a professional news editor. Summarize the following news headlines into a concise, insightful daily briefing (3-4 bullet points).

Headlines:
${e.slice(0,15).map(r=>`- ${r.title}`).join(`
`)}`;s?a+=`

REQUIREMENTS:
1. Provide the summary in TWO languages: English and Tamil.
2. SEPARATE the English summary and Tamil summary with the exact delimiter "|||".

OUTPUT FORMAT:
<English Summary>
|||
<Tamil Summary>`:a+=`

REQUIREMENTS:
1. Language: English ONLY.
2. No introductory text.`;try{const l=(await(await Nt.generateContent(a)).response).text().trim();if(s&&l.includes("|||")){const c=l.split("|||");return{summary:c[0].trim(),summary_ta:c[1].trim()}}return{summary:l}}catch(r){throw console.error("Summary generation failed:",r),new Error("AI Generation Failed. Check your API Key or Quota.")}},translateTexts:async(e,n)=>{if(!Rn(n))throw new Error("Invalid or missing API Key");const i=`Translate the following news headlines to English. Maintain journalistic style. Return ONLY the translated list, numbered exactly as input.

${e.map((a,r)=>`${r+1}. ${a}`).join(`
`)}`;try{const l=(await(await Nt.generateContent(i)).response).text().split(`
`),c=new Array(e.length).fill(null);return l.forEach(d=>{const h=d.match(/^(\d+)\.\s+(.*)/);if(h){const u=parseInt(h[1])-1;u>=0&&u<e.length&&(c[u]=h[2].trim())}}),c}catch(a){throw console.error("Translation failed:",a),a}}},Co="https://api.allorigins.win/raw?url=";async function Eo(e){if(!e)return"";try{const n=Co+encodeURIComponent(e),s=await fetch(n,{signal:AbortSignal.timeout(12e3)});if(!s.ok)return"";const i=await s.text();return To(i)}catch{return""}}function To(e){const s=new DOMParser().parseFromString(e,"text/html");s.querySelectorAll("script, style, nav, footer, header, aside, .ad, .advertisement, .social-share, .comments").forEach(o=>o.remove());const i=["article",'[itemprop="articleBody"]',".article-body",".story-content",".article-content",".post-content",".entry-content",".td-post-content","#article-body",".story-element","main"];for(const o of i){const l=s.querySelector(o);if(l){const c=l.textContent.trim();if(c.length>200)return c.slice(0,5e3)}}return Array.from(s.querySelectorAll("p")).map(o=>o.textContent.trim()).filter(o=>o.length>40).join(`

`).slice(0,5e3)}async function Io(e,n=5){if(!e||e.length<100)return e||"";const s=await Ao(e);return s||Mo(e,n)}async function Ao(e){try{if(!("ai"in self)||!("summarizer"in self.ai)||(await self.ai.summarizer.capabilities()).available==="no")return null;const s=await self.ai.summarizer.create({type:"key-points",format:"plain-text",length:"medium"}),i=await s.summarize(e);return s.destroy(),i}catch{return null}}function Mo(e,n=5){const s=e.replace(/([.!?])\s+/g,`$1
`).split(`
`).map(l=>l.trim()).filter(l=>l.length>20&&l.length<500);if(s.length<=n)return s.join(" ");const i=e.toLowerCase().split(/\W+/).filter(l=>l.length>3),a={};for(const l of i)a[l]=(a[l]||0)+1;const r=s.map((l,c)=>{const d=l.toLowerCase().split(/\W+/).filter(u=>u.length>3);let h=0;for(const u of d)h+=a[u]||0;return h=h/Math.max(d.length,1),c<3&&(h*=1.3),c===s.length-1&&(h*=1.1),{sentence:l,score:h,index:c}});r.sort((l,c)=>c.score-l.score);const o=r.slice(0,n);return o.sort((l,c)=>l.index-c.index),o.map(l=>l.sentence).join(" ")}const Ro={THE_HINDU:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"International",limit:6},{id:"business",title:"Business",limit:5},{id:"sports",title:"Sport",limit:5}]},INDIAN_EXPRESS:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"World",limit:5},{id:"technology",title:"Explained / Tech",limit:5}]},DINAMANI:{sections:[{id:"chennai",title:"Tamil Nadu",limit:10},{id:"entertainment",title:"Cinema",limit:5}]},DAILY_THANTHI:{sections:[{id:"chennai",title:"Headlines",limit:10},{id:"local",title:"District News",limit:5}]}},Do={getVirtualPaper:async e=>{const n=Ro[e];if(!n)return console.warn(`[VirtualPaper] No config for ${e}`),[];console.log(`[VirtualPaper] Generating for ${e}...`);const s=n.sections.map(async a=>{try{const r=await St(a.id,a.limit);return{page:a.title,articles:r.map(o=>({title:o.title,link:o.link,description:o.description,source:o.source,publishedAt:o.publishedAt}))}}catch(r){return console.error(`[VirtualPaper] Failed to fetch section ${a.id}`,r),{page:a.title,articles:[],error:"Failed to load section"}}});return(await Promise.all(s)).filter(a=>a.articles.length>0)}},Lo="./data/epaper_data.json",me={THE_HINDU:{id:"THE_HINDU",label:"The Hindu",lang:"en"},INDIAN_EXPRESS:{id:"INDIAN_EXPRESS",label:"Indian Express",lang:"en"},DINAMANI:{id:"DINAMANI",label:"Dinamani",lang:"ta"},DAILY_THANTHI:{id:"DAILY_THANTHI",label:"Daily Thanthi",lang:"ta"}},Oo=()=>{const{settings:e}=se(),{isWebView:n}=lt(),[s,i]=y.useState(me.THE_HINDU.id),[a,r]=y.useState(null),[o,l]=y.useState(null),[c,d]=y.useState(!0),[h,u]=y.useState(null),[g,p]=y.useState(!1),[m,w]=y.useState({}),[v,j]=y.useState({}),[f,N]=y.useState(!1),[A,_]=y.useState(!1),[L,P]=y.useState(!1),[M,B]=y.useState({}),[O,D]=y.useState(!1),I=e.newspaper?.summaryLineLimit||50,S=y.useCallback(async()=>{d(!0),u(null);try{const b=await fetch(`${Lo}?t=${Date.now()}`);if(!b.ok)throw new Error("Failed to fetch data");const C=await b.json();if(!C||!C.sources)throw new Error("Invalid data format");r(C.sources),l(C.lastUpdated)}catch(b){console.warn("JSON fetch failed, trying RSS fallback...",b);try{const C=await $();r(C),l(new Date().toISOString())}catch(C){console.error("Fallback failed:",C),u("Failed to load today's paper. Please check your internet connection.")}}finally{d(!1)}},[]),$=async()=>{const b={},C=new Promise((F,z)=>setTimeout(()=>z(new Error("Timeout")),15e3)),k=Object.keys(me).map(async F=>{try{const z=await Do.getVirtualPaper(F);z&&z.length>0&&(b[F]=z)}catch(z){console.warn(`Virtual Paper failed for ${F}:`,z.message)}});try{await Promise.race([Promise.all(k),C])}catch(F){console.warn("Virtual Paper fetch timed out or failed:",F)}if(Object.keys(b).length===0)throw new Error("Failed to generate Virtual Paper. Please check connection.");return b};y.useEffect(()=>{S()},[S]),y.useEffect(()=>{(async()=>{if(!a||!a[s]||!e.geminiKey)return;const C=a[s],k=me[s].lang==="ta";for(const F of C){const z=!F.summary&&!F.summary_ta||F.error,K=m[F.page];if(z&&!K&&!f){N(!0);try{console.log(`Generating fallback summary for ${F.page}...`);const q=await vt.generateSummary(F.articles,e.geminiKey,k);w(X=>({...X,[F.page]:q}))}catch(q){console.error(`Failed to generate summary for ${F.page}:`,q)}finally{N(!1)}}}})()},[a,s,e.geminiKey,m,f]);const T=y.useCallback(async(b,C)=>{const k=`${s}_${b}`;if(M[k])return;const F=C?.[0];if(F?.link)try{const z=await Eo(F.link);if(z&&z.length>200){const K=await Io(z,6);K&&B(q=>({...q,[k]:K}))}}catch{}},[s,M]);y.useEffect(()=>{(async()=>{if(!g||!a||!a[s]||me[s].lang==="en"||!e.geminiKey)return;const C=a[s];let k=[],F=[];if(C.forEach(z=>{z.articles.forEach(K=>{const q=K.title_en,X=v[K.link];!q&&!X&&(k.push(K.title),F.push(K.link))})}),k.length>0&&!A){_(!0);try{console.log(`Translating ${k.length} titles...`);const z=15;for(let K=0;K<k.length;K+=z){const q=k.slice(K,K+z),X=await vt.translateTexts(q,e.geminiKey);j(ie=>{const le={...ie};return X.forEach((je,G)=>{const ae=K+G;F[ae]&&(le[F[ae]]=je)}),le})}}catch(z){console.error("Translation failed:",z)}finally{_(!1)}}})()},[g,a,s,e.geminiKey,v,A]);const H=b=>{const C=m[b.page];if(C){if(g&&C.summary)return{text:C.summary,method:"gemini"};if(!g&&C.summary_ta)return{text:C.summary_ta,method:"gemini"};if(C.summary)return{text:C.summary,method:"gemini"}}if(g){if(b.summary)return{text:b.summary,method:b.summary_method||"server"};if(b.summary_ta)return{text:b.summary_ta,method:b.summary_method||"server"}}else{if(b.summary_ta)return{text:b.summary_ta,method:b.summary_method||"server"};if(b.summary)return{text:b.summary,method:b.summary_method||"server"}}const k=`${s}_${b.page}`;return M[k]?{text:M[k],method:"extractive"}:null},W=async()=>{if(!a||!a[s])return;D(!0);const C=a[s].map(async k=>{const F=`${s}_${k.page}`,z=m[k.page],K=M[F],q=me[s].lang==="ta"&&!g?k.summary_ta:k.summary;if(!(z||K||q))if(e.geminiKey)try{const X=await vt.generateSummary(k.articles,e.geminiKey,me[s].lang==="ta");w(ie=>({...ie,[k.page]:X}))}catch(X){console.error(`Gemini Gen Failed for ${k.page}:`,X)}else try{await T(k.page,k.articles)}catch(X){console.error(`Client Summary Failed for ${k.page}:`,X)}});await Promise.allSettled(C),D(!1)};y.useEffect(()=>{if(!a||!a[s])return;const b=a[s][0];b&&!b.summary&&!b.summary_ta&&!e.geminiKey&&T(b.page,b.articles)},[a,s,e.geminiKey,T]);const E=a?a[s]:[],R=me[s].lang==="ta";return t.jsxs("div",{className:`page-container mode-newspaper ${n?"page-container--desktop":""}`,children:[t.jsxs("div",{className:"header",children:[t.jsxs("div",{className:"header__title",children:[t.jsx(nr,{className:"header__title-icon"}),t.jsx("span",{children:"Daily Brief"})]}),t.jsxs("div",{className:"header__actions",style:{gap:"8px"},children:[t.jsx("button",{onClick:W,className:`btn-icon ${O?"pulse":""}`,title:"Generate All Summaries",disabled:O,style:{color:O?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(Xa,{size:18})}),t.jsx("button",{onClick:()=>P(!L),className:`btn-icon ${L?"active":""}`,title:L?"Card View":"Digest View",style:{color:L?"var(--accent-primary)":"var(--text-secondary)",fontSize:"1.1rem"},children:L?"ðŸ“°":"ðŸ“–"}),R&&t.jsx("button",{onClick:()=>p(!g),className:`btn-icon ${g?"active":""}`,title:g?"Show Original (Tamil)":"Translate to English",style:{color:g?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(er,{size:24})}),t.jsx("button",{onClick:S,className:"btn-icon","aria-label":"Refresh",children:t.jsx(sr,{className:c?"spin":""})})]})]}),t.jsxs("div",{className:"topline",style:{borderRadius:0,margin:0,borderLeft:"none",borderBottom:"1px solid var(--border-default)",overflowX:"auto"},children:[t.jsx("div",{style:{display:"flex",gap:"8px",minWidth:"max-content"},children:Object.values(me).map(b=>t.jsx("button",{onClick:()=>{i(b.id),p(!1)},className:`btn ${s===b.id?"btn--primary":"btn--secondary"}`,style:{padding:"8px 12px",fontSize:"0.85rem",whiteSpace:"nowrap"},children:b.label},b.id))}),o&&t.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"8px",textAlign:"center"},children:["Updated: ",new Date(o).toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),t.jsx("div",{className:"main-content",style:{padding:"16px"},children:c&&!a?t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching Today's Brief..."})]}):h?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"âš ï¸"}),t.jsx("p",{children:h}),t.jsx("button",{onClick:S,className:"btn btn--primary mt-md",children:"Retry"})]}):t.jsxs("div",{className:"newspaper-content",children:[!E||E.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:"No content available for this source today."})}):E.map((b,C)=>{const k=H(b),F={gemini:"AI Summary",server:"Summary",extractive:"Auto-Summary",headlines:"Headlines"};return t.jsxs("div",{className:"newspaper-section",style:{marginBottom:"32px"},children:[t.jsxs("h2",{className:"zone-title",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{children:b.page}),A&&g&&t.jsx("span",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",fontWeight:"normal"},children:"Translating..."})]}),k?t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"16px",borderRadius:"8px",marginBottom:"20px",borderLeft:"4px solid var(--accent-primary)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--accent-primary)",fontWeight:"bold",marginBottom:"8px"},children:[t.jsx(tr,{}),t.jsx("span",{children:F[k.method]||"Summary"}),k.method==="extractive"&&t.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"normal",color:"var(--text-muted)",marginLeft:"4px"},children:"(no API key needed)"})]}),t.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.95rem",lineHeight:"1.6",fontFamily:"serif",display:"-webkit-box",WebkitLineClamp:I,WebkitBoxOrient:"vertical",overflow:"hidden"},children:k.text})]}):t.jsxs("div",{style:{padding:"12px",marginBottom:"20px",background:"rgba(255, 0, 0, 0.05)",borderLeft:"4px solid var(--accent-danger)",borderRadius:"4px",fontSize:"0.85rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(Qa,{color:"var(--accent-danger)"}),t.jsx("span",{children:b.error==="Quota Exceeded"?"Daily AI Limit Reached.":b.error==="API Key Missing"?"AI Summary Unavailable.":"Summary not generated."})]}),!e.geminiKey&&t.jsx(De,{to:"/settings",style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"Add Key to Enable"}),e.geminiKey&&f&&t.jsx("span",{style:{color:"var(--accent-primary)"},children:"Generating..."})]}),L?t.jsx("div",{style:{fontSize:"0.9rem",lineHeight:"1.7"},children:b.articles.map((z,K)=>{const q=g&&(v[z.link]||z.title_en)||z.title;return t.jsx("div",{style:{padding:"8px 0",borderBottom:"1px solid var(--border-default)"},children:t.jsx("a",{href:z.link,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--text-primary)",textDecoration:"none",fontWeight:500},children:q})},K)})}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px"},children:b.articles.map((z,K)=>{const q={...z,title_en:v[z.link]||z.title_en};return t.jsx(Yr,{article:q,sourceName:me[s].label,isTranslated:g},K)})})]},C)}),t.jsx("div",{className:"market-disclaimer",style:{marginTop:"32px"},children:"Content aggregated from official sources. Summaries generated by AI. Verify important details from original articles."})]})})]})};function ge({checked:e,onChange:n,recommended:s=!1,disabled:i=!1}){return t.jsxs("label",{className:`toggle ${s?"toggle--recommended":""}`,children:[t.jsx("input",{type:"checkbox",className:"toggle__input",checked:e,onChange:a=>n(a.target.checked),disabled:i}),t.jsx("span",{className:"toggle__slider"})]})}const Fo="https://api.allorigins.win/get?url=",$o=e=>/\.(xml|rss|atom)$/i.test(e)||/feed|rss|atom/i.test(e),Bo=async e=>{try{if(!e)return[];if($o(e))return[{title:"Custom Feed",url:e}];const n=encodeURIComponent(e),i=await(await fetch(`${Fo}${n}`)).json();if(!i.contents)throw new Error("Failed to fetch page content");const r=new DOMParser().parseFromString(i.contents,"text/html"),o=[];if(r.querySelectorAll('link[rel="alternate"][type="application/rss+xml"], link[rel="alternate"][type="application/atom+xml"]').forEach(c=>{let d=c.getAttribute("href");const h=c.getAttribute("title")||"RSS Feed";if(d&&!d.startsWith("http")){const u=new URL(e);d=new URL(d,u.origin).href}d&&o.push({title:h,url:d})}),o.length===0){const c=["/feed","/rss","/rss.xml","/atom.xml"],d=new URL(e).origin;c.forEach(h=>{o.push({title:`Possible Feed (${h})`,url:`${d}${h}`})})}return o}catch(n){return console.error("Feed discovery failed:",n),[]}},Po="ver.12-02-26 time 17.41",zo=()=>{const{settings:e}=se(),[n,s]=y.useState([]),[i,a]=y.useState(null);y.useEffect(()=>{try{he&&typeof he.getLogs=="function"?s(he.getLogs()):s([])}catch(o){console.error("Failed to load logs",o),a(o.message)}},[]);const r=o=>{if(typeof o=="object")try{return JSON.stringify(o)}catch{return"[Circular Object]"}return String(o)};return i?t.jsxs("div",{className:"error-state",children:["Debug Error: ",i]}):t.jsxs("div",{className:"settings-tab-content",children:[t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ›"})," Debug Info"]}),t.jsxs("div",{className:"settings-card",children:[t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"App Version:"})," ",e?.appVersion||"Unknown"]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"User Agent:"})," ",navigator.userAgent]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"Screen:"})," ",window.innerWidth,"x",window.innerHeight]})]}),t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ“œ"})," Recent Logs"]}),t.jsx("div",{className:"settings-card",style:{maxHeight:"300px",overflowY:"auto",background:"black",color:"#0f0",fontFamily:"monospace",fontSize:"0.7rem",padding:"10px"},children:n.length===0?t.jsx("div",{children:"No logs available."}):n.map((o,l)=>t.jsxs("div",{style:{marginBottom:"4px",borderBottom:"1px solid #333",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[t.jsxs("span",{style:{color:"#888"},children:["[",new Date(o.timestamp).toLocaleTimeString(),"]"]})," ",t.jsxs("span",{style:{color:o.level==="error"?"red":o.level==="warn"?"orange":"#0f0"},children:[o.level.toUpperCase(),":"]})," ",r(o.message),o.details&&t.jsx("div",{style:{marginLeft:"15px",color:"#aaa",fontSize:"0.65rem"},children:r(o.details)})]},l))}),t.jsx("div",{className:"settings-card",children:t.jsx("button",{className:"btn btn--danger",onClick:()=>{window.confirm("Clear all data?")&&(localStorage.clear(),window.location.reload())},style:{width:"100%"},children:"Clear All Local Storage & Reload"})})]})},Ho=e=>{const n=e||{},s=n.freshness?.maxBoost||3,i=n.source?.tier1Boost||5,a=n.visual?.videoBoost||1.3,r=n.geo?.cityMatch||1.5;let o=0;return s>=2.5&&s<=4?o+=1.5:s>1&&(o+=1),i>=4&&i<=7?o+=1.5:i>=2&&(o+=1),a>=1.2&&a<=1.5?o+=1:o+=.5,r>=1.3&&r<=2?o+=1:o+=.5,Math.min(5,Math.max(1,Math.round(o)))};function Uo(){const{settings:e,updateSettings:n,reloadSettings:s}=se(),[i,a]=y.useState("general"),[r,o]=y.useState(!1),[l,c]=y.useState(""),[d,h]=y.useState(!1),[u,g]=y.useState(null),[p,m]=y.useState({}),[w,v]=y.useState(null),[j,f]=y.useState({tier1:"",tier2:"",tier3:""}),[N,A]=y.useState({title:"Breaking: Major Economic Reforms Announced",description:"Government unveils new policy to boost GDP growth by 2%. Markets rally on the news.",source:"BBC News",age:2,section:"business",result:null});if(y.useEffect(()=>{if(!e?.rankingWeights)return;const x={title:N.title,description:N.description,source:N.source,publishedAt:Date.now()-N.age*60*60*1e3,section:N.section,imageUrl:null},R={...e,debugLogs:!0},b=_t(x,N.section,0,R);A(C=>({...C,result:{score:b,breakdown:x._scoreBreakdown}}))},[N.title,N.description,N.source,N.age,N.section,e]),!e)return t.jsx("div",{className:"loading",children:"Loading..."});const _=(x,R)=>{const b=x.split("."),C={...e};let k=C;for(let F=0;F<b.length-1;F++)k[b[F]]={...k[b[F]]},k=k[b[F]];k[b[b.length-1]]=R,n(C)},L=()=>{o(!0),setTimeout(()=>o(!1),2e3),s()},P=()=>{window.confirm("Reset all settings to defaults?")&&(n({...oe}),s())},M=(x,R)=>{if(!R||!R.trim())return;const b=x.split(".");let C=e;for(const k of b)C=C?.[k]||[];Array.isArray(C)||(C=[]),C.includes(R.trim())||_(x,[...C,R.trim()])},B=(x,R)=>{const b=x.split(".");let C=e;for(const k of b)C=C?.[k]||[];Array.isArray(C)&&_(x,C.filter(k=>k!==R))},O=(x,R)=>{M(x,R),m({...p,[x]:""})},D=(x,R)=>{if(!R||!R.trim())return;const b=e.sourceTiers?.[x]||[];b.some(C=>C.toLowerCase()===R.trim().toLowerCase())||_(`sourceTiers.${x}`,[...b,R.trim()]),f({...j,[x]:""})},I=(x,R)=>{const b=e.sourceTiers?.[x]||[];_(`sourceTiers.${x}`,b.filter(C=>C!==R))},S=async()=>{if(l){h(!0),g(null);try{const x=await Bo(l);if(x.length>0){const R=x[0];n({...e,customFeeds:[...e.customFeeds||[],{title:R.title,url:R.url}]}),c("")}else g("No feeds found.")}catch{g("Error discovering feeds.")}finally{h(!1)}}},$=x=>{const R=[...e.customFeeds||[]];R.splice(x,1),n({...e,customFeeds:R})},T=()=>{const x={settings:e,hiddenEvents:JSON.parse(localStorage.getItem("upAhead_hiddenEvents")||"[]"),watchlist:JSON.parse(localStorage.getItem("upAhead_watchlist")||"[]"),readingHistory:e.readingHistory||[]},R="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(x,null,2)),b=document.createElement("a");b.setAttribute("href",R),b.setAttribute("download","news_app_full_backup.json"),document.body.appendChild(b),b.click(),b.remove()},H=x=>{const R=x.target.files[0];if(!R)return;const b=new FileReader;b.onload=C=>{try{const k=JSON.parse(C.target.result);window.confirm("Replace current settings, hidden events, and watchlist with imported data?")&&(k.settings?(n(k.settings),k.hiddenEvents&&localStorage.setItem("upAhead_hiddenEvents",JSON.stringify(k.hiddenEvents)),k.watchlist&&localStorage.setItem("upAhead_watchlist",JSON.stringify(k.watchlist))):n(k),s())}catch{alert("Invalid backup file")}},b.readAsText(R)},W=[{id:"general",label:"General",icon:"âš™ï¸"},{id:"ranking",label:"Ranking & Logic",icon:"ðŸ§ "},{id:"weather",label:"Weather",icon:"ðŸŒ¤ï¸"},{id:"sources",label:"Sources",icon:"ðŸ“¡"},{id:"market",label:"Market",icon:"ðŸ“ˆ"},{id:"sandbox",label:"Sandbox",icon:"ðŸ§ª"},{id:"advanced",label:"Advanced",icon:"ðŸ”§"},{id:"debug",label:"Debug",icon:"ðŸ›"}],E=()=>{switch(i){case"general":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“±",title:"Interface"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Home Layout",subLabel:"Timeline / Classic / Newspaper",children:t.jsxs("select",{value:e.uiMode||"timeline",onChange:x=>n({...e,uiMode:x.target.value}),className:"settings-select",children:[t.jsx("option",{value:"timeline",children:"ðŸ“± Timeline"}),t.jsx("option",{value:"classic",children:"ðŸ“Š Classic"}),t.jsx("option",{value:"newspaper",children:"ðŸ“° Newspaper"})]})}),t.jsx(J,{label:"Font Size",subLabel:`${e.fontSize||26}px`,children:t.jsx("input",{type:"range",min:"14",max:"34",step:"1",value:e.fontSize||26,onChange:x=>n({...e,fontSize:parseInt(x.target.value)}),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ¤–",title:"AI Configuration"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:"Gemini API Key"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)",fontSize:"0.65rem"},children:"Required for client-side fallback."})]}),t.jsx("input",{type:"password",value:e.geminiKey||"",onChange:x=>n({...e,geminiKey:x.target.value}),className:"settings-input",placeholder:"Enter API Key"})]})}),t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Data"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsx("div",{className:"settings-item__label",children:t.jsx("span",{children:"Alpha Vantage API Key"})}),t.jsx("input",{type:"password",value:e.alphaVantageKey||"",onChange:x=>n({...e,alphaVantageKey:x.target.value}),className:"settings-input",placeholder:"Enter AV Key"})]})})]});case"ranking":return t.jsx(Wo,{settings:e,updateNested:_,updateSettings:n,addToList:M,removeFromList:B});case"weather":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“",title:"Locations"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"10px"},children:"Active Cities"}),t.jsxs("div",{style:{display:"grid",gap:"10px",marginBottom:"10px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"1."}),t.jsx("input",{type:"text",value:"Chennai",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"2."}),t.jsx("input",{type:"text",value:"Trichy",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"3."}),t.jsx("input",{type:"text",value:e.weather?.cities?.[2]||"Muscat",onChange:x=>{const R=[...e.weather?.cities||["chennai","trichy","muscat"]];R[2]=x.target.value,_("weather.cities",R)},className:"settings-input",placeholder:"Enter city..."})]})]})]}),t.jsx(Z,{icon:"ðŸŒ¤ï¸",title:"Weather Models"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ECMWF (European)",children:t.jsx(ge,{checked:e.weather?.models?.ecmwf!==!1,onChange:x=>_("weather.models.ecmwf",x)})}),t.jsx(J,{label:"GFS (NOAA)",children:t.jsx(ge,{checked:e.weather?.models?.gfs!==!1,onChange:x=>_("weather.models.gfs",x)})}),t.jsx(J,{label:"ICON (DWD)",children:t.jsx(ge,{checked:e.weather?.models?.icon!==!1,onChange:x=>_("weather.models.icon",x)})})]})]});case"sources":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“¡",title:"News Sources"}),t.jsxs(ee,{children:[t.jsxs("div",{className:"settings-item",style:{borderBottom:"1px solid var(--accent-danger)",background:"rgba(220, 38, 38, 0.15)",padding:"10px"},children:[t.jsxs("div",{className:"settings-item__label",style:{color:"var(--accent-danger)"},children:[t.jsx("span",{children:"ðŸ† Top Websites Only"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)"},children:"BBC, Reuters, NDTV, Hindu, TOI..."})]}),t.jsx(ge,{checked:e.topWebsitesOnly===!0,onChange:x=>n({...e,topWebsitesOnly:x})})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",padding:"10px"},children:Object.keys(e.newsSources||{}).map(x=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.8rem"},children:[t.jsx("input",{type:"checkbox",checked:e.newsSources?.[x]!==!1,onChange:R=>_(`newsSources.${x}`,R.target.checked),disabled:e.topWebsitesOnly}),x]},x))})]}),t.jsx(Z,{icon:"ðŸ†",title:"Source Tiers"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Classify sources to boost their ranking score."}),t.jsx(Re,{label:`Tier 1 (High Boost: ${e.rankingWeights?.source?.tier1Boost||.5}x)`,placeholder:"e.g. BBC, Reuters",value:j.tier1,onChange:x=>f({...j,tier1:x}),onAdd:()=>D("tier1",j.tier1),items:e.sourceTiers?.tier1||[],onRemove:x=>I("tier1",x)}),t.jsx(Re,{label:`Tier 2 (Medium Boost: ${e.rankingWeights?.source?.tier2Boost||.2}x)`,placeholder:"e.g. NDTV, Hindu",value:j.tier2,onChange:x=>f({...j,tier2:x}),onAdd:()=>D("tier2",j.tier2),items:e.sourceTiers?.tier2||[],onRemove:x=>I("tier2",x)}),t.jsx(Re,{label:`Tier 3 (No Boost: ${e.rankingWeights?.source?.tier3Boost||0}x)`,placeholder:"e.g. Local Blogs",value:j.tier3,onChange:x=>f({...j,tier3:x}),onAdd:()=>D("tier3",j.tier3),items:e.sourceTiers?.tier3||[],onRemove:x=>I("tier3",x)})]}),t.jsx(Z,{icon:"ðŸ”—",title:"Custom Feeds"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"10px"},children:[t.jsx("input",{type:"text",value:l,onChange:x=>c(x.target.value),placeholder:"RSS URL...",className:"settings-input"}),t.jsx("button",{className:"btn btn--primary",onClick:S,disabled:d,children:d?"...":"Add"})]}),u&&t.jsx("div",{style:{color:"red",fontSize:"0.75rem"},children:u}),e.customFeeds?.map((x,R)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",padding:"5px 0"},children:[t.jsx("span",{children:x.title||x.url}),t.jsx("button",{onClick:()=>$(R),style:{color:"red"},children:"âœ•"})]},R))]})]});case"upahead":return null;case"market":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Display"}),t.jsx(ee,{children:Object.keys(e.market||{}).filter(x=>x.startsWith("show")).map(x=>t.jsx(J,{label:x.replace("show",""),children:t.jsx(ge,{checked:e.market?.[x]!==!1,onChange:R=>_(`market.${x}`,R)})},x))})]});case"logic":return null;case"sandbox":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ§ª",title:"Ranking Sandbox"}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:`Simulate how the current settings affect an article's score. Change settings in the "Custom Ranking" tab to see impact here.`}),t.jsx(ee,{children:t.jsxs("div",{style:{display:"grid",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Title"}),t.jsx("input",{className:"settings-input",value:N.title,onChange:x=>A({...N,title:x.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Description"}),t.jsx("textarea",{className:"settings-input",style:{resize:"vertical",minHeight:"60px"},value:N.description,onChange:x=>A({...N,description:x.target.value})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Source"}),t.jsxs("select",{className:"settings-select",value:N.source,onChange:x=>A({...N,source:x.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"BBC News",children:"BBC (Tier 1)"}),t.jsx("option",{value:"Unknown Blog",children:"Blog (Tier 3)"}),t.jsx("option",{value:"NDTV",children:"NDTV (Tier 2)"}),t.jsx("option",{value:"TechCrunch",children:"TechCrunch"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Section"}),t.jsxs("select",{className:"settings-select",value:N.section,onChange:x=>A({...N,section:x.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"world",children:"World (High Priority)"}),t.jsx("option",{value:"business",children:"Business"}),t.jsx("option",{value:"technology",children:"Technology"}),t.jsx("option",{value:"general",children:"General"})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:["Age: ",N.age," hours"]}),t.jsx("input",{type:"range",min:"0",max:"72",step:"1",value:N.age,onChange:x=>A({...N,age:parseInt(x.target.value)}),style:{width:"100%"}})]})]})}),N.result&&t.jsxs("div",{className:"settings-card",style:{border:"1px solid var(--accent-primary)",background:"rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{textAlign:"center",padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:"CALCULATED SCORE"}),t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"var(--accent-primary)"},children:N.result.score.toFixed(1)})]}),t.jsx("div",{style:{padding:"10px",fontSize:"0.75rem"},children:t.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:t.jsx("tbody",{children:Object.entries(N.result.breakdown||{}).map(([x,R])=>x==="total"||typeof R!="number"?null:t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[t.jsx("td",{style:{padding:"4px",textTransform:"capitalize",color:"var(--text-secondary)"},children:x.replace(/([A-Z])/g," $1").trim()}),t.jsxs("td",{style:{padding:"4px",textAlign:"right",fontWeight:"bold",color:R>1.5?"#4f4":R<.5?"#f44":"#fff"},children:[R.toFixed(2),x.toLowerCase().includes("boost")||x.toLowerCase().includes("multiplier")?"x":""]})]},x))})})})]})]});case"advanced":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ”§",title:"Advanced"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Enable News Cache",subLabel:"Faster loads, 5min TTL",children:t.jsx(ge,{checked:e.enableCache!==!1,onChange:x=>n({...e,enableCache:x})})}),t.jsx(J,{label:"Crawler Mode",children:t.jsxs("select",{value:e.crawlerMode||"auto",onChange:x=>n({...e,crawlerMode:x.target.value}),className:"settings-select",children:[t.jsx("option",{value:"auto",children:"Auto"}),t.jsx("option",{value:"manual",children:"Manual"})]})}),t.jsx(J,{label:"Debug Logs",children:t.jsx(ge,{checked:e.debugLogs===!0,onChange:x=>n({...e,debugLogs:x})})})]}),t.jsx(Z,{icon:"ðŸ•µï¸",title:"Impact & Priority"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ’¥ Base Impact Weight",subLabel:"Multiplier",children:t.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:e.rankingWeights?.impact?.boost||1,onChange:x=>_("rankingWeights.impact.boost",parseFloat(x.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ High Impact Boost",subLabel:"Triggers on Major Event Keywords",children:t.jsx("input",{type:"range",min:"1.0",max:"5.0",step:"0.1",value:e.rankingWeights?.impact?.highImpactBoost||2.5,onChange:x=>_("rankingWeights.impact.highImpactBoost",parseFloat(x.target.value)),style:{width:"100%"}})}),t.jsx(Re,{label:"Major Event Keywords",placeholder:"e.g. Budget, Treaty, War",value:p.highImpact,onChange:x=>m({...p,highImpact:x}),onAdd:()=>O("highImpactKeywords",p.highImpact),items:e.highImpactKeywords||[],onRemove:x=>B("highImpactKeywords",x)}),t.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"5px"},children:["â„¹ï¸ Articles containing these words receive the ",t.jsx("strong",{children:"High Impact Boost"})," (above)."]})]}),t.jsx(Z,{icon:"âš¡",title:"Buzz Ranking"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:'Configuration for "Buzz" and "Social" sections.'}),t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:x=>_("buzzRankingWeights.visual.videoBoost",parseFloat(x.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:x=>_("buzzRankingWeights.trending.threshold",parseFloat(x.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ”„",title:"Backup & Sync"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{className:"btn btn--secondary",onClick:T,style:{flex:1},children:"Export Backup"}),t.jsxs("label",{className:"btn btn--secondary",style:{flex:1,cursor:"pointer",textAlign:"center"},children:["Import Backup",t.jsx("input",{type:"file",accept:".json",onChange:H,style:{display:"none"}})]})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"8px"},children:"Saves Settings, Hidden Events (Plan My Week), and Watchlist to a file."})]})]});case"debug":return t.jsx(zo,{});default:return null}};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[t.jsx(_e,{title:"Settings",showBack:!0,backTo:"/",compact:!0,style:{flex:"0 0 auto"}}),t.jsxs("div",{className:"settings-layout",children:[t.jsx("div",{className:"settings-sidebar",children:W.map(x=>t.jsxs("button",{className:`settings-tab-btn ${i===x.id?"active":""}`,onClick:()=>a(x.id),children:[t.jsx("span",{className:"tab-icon",children:x.icon}),t.jsx("span",{className:"tab-label",children:x.label})]},x.id))}),t.jsxs("div",{className:"settings-content",children:[t.jsx("div",{className:"settings-scroll-area",style:{overflowY:i==="ranking"?"hidden":"auto",padding:i==="ranking"?0:"15px"},children:E()}),t.jsxs("div",{className:"settings-footer",children:[t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx("button",{className:"btn btn--danger",onClick:P,style:{flex:1},children:"Reset"}),t.jsx("button",{className:"btn btn--primary",onClick:L,style:{flex:1},children:r?"âœ“ Saved":"Save"})]}),t.jsx("div",{className:"version-tag",children:Po})]})]})]}),t.jsx("style",{children:`
                .settings-layout { display: flex; flex: 1; overflow: hidden; background: var(--bg-primary); }
                .settings-sidebar { width: 60px; background: var(--bg-secondary); border-right: 1px solid var(--border-default); display: flex; flex-direction: column; padding: 10px 5px; overflow-y: auto; flex-shrink: 0; }
                .settings-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 5px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 8px; margin-bottom: 5px; }
                .settings-tab-btn.active { background: var(--accent-primary); color: #fff; }
                .tab-icon { font-size: 1.5rem; } .tab-label { display: none; }
                .settings-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
                .settings-scroll-area { flex: 1; overflow-y: auto; padding: 15px; }
                .settings-footer { flex-shrink: 0; background: var(--bg-secondary); border-top: 1px solid var(--border-default); padding: 15px; }
                .settings-card { background: var(--bg-card); border-radius: var(--radius-md); padding: 15px; margin-bottom: 20px; border: 1px solid var(--border-default); }
                .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
                .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
                .settings-item:last-child { border-bottom: none; }
                .settings-select, .settings-input, .settings-input-number { background: var(--bg-secondary); border: 1px solid var(--border-default); color: var(--text-primary); padding: 8px; border-radius: 4px; font-size: 0.85rem; }
                .settings-input { width: 100%; }
                .chip-checkbox { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 16px; border: 1px solid var(--border-default); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.8rem; cursor: pointer; }
                .chip-checkbox.active { background: var(--accent-primary); color: #fff; border-color: var(--accent-primary); }
                .keyword-chip { display: inline-flex; align-items: center; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; margin: 2px; font-size: 0.75rem; }
                .keyword-chip button { background: none; border: none; color: var(--accent-danger); margin-left: 6px; cursor: pointer; padding: 0; }
                .version-tag { text-align: right; font-size: 0.7rem; color: var(--text-muted); margin-top: 8px; font-family: monospace; opacity: 0.7; }
            `})]})}const Wo=({settings:e,updateNested:n,updateSettings:s,addToList:i,removeFromList:a})=>{const[r,o]=y.useState("main"),[l,c]=y.useState("entertainment"),[d,h]=y.useState("movies"),[u,g]=y.useState({}),p=(j,f)=>g(N=>({...N,[j]:f})),m=()=>{const j=Ho(e.rankingWeights||{});return t.jsxs("div",{children:[t.jsx("div",{className:"settings-card",style:{background:"linear-gradient(135deg, rgba(255,215,0,0.1), rgba(0,0,0,0))",border:"1px solid rgba(255,215,0,0.3)"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("div",{style:{fontWeight:600,color:"#FFD700"},children:"â˜… Quality Rating"})}),t.jsxs("div",{style:{fontSize:"1.8rem",color:"#FFD700"},children:["â˜…".repeat(j),"â˜†".repeat(5-j)]})]})}),t.jsx(Z,{icon:"ðŸ†",title:"Top Stories & Global"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ† Top Stories Boost",subLabel:"Min Score for Top Stories",children:t.jsx("input",{type:"range",min:"8",max:"30",step:"1",value:e.rankingWeights?.trending?.threshold||12,onChange:f=>n("rankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“Œ Keyword Match",subLabel:`+${(e.rankingWeights?.keyword?.matchBoost||2).toFixed(1)} Points`,children:t.jsx("input",{type:"range",min:"0",max:"5",step:"0.5",value:e.rankingWeights?.keyword?.matchBoost||2,onChange:f=>n("rankingWeights.keyword.matchBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“ Location Match",subLabel:`${(e.rankingWeights?.geo?.cityMatch||1.5).toFixed(1)}x Multiplier`,children:t.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:e.rankingWeights?.geo?.cityMatch||1.5,onChange:f=>n("rankingWeights.geo.cityMatch",parseFloat(f.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ“‰",title:"Freshness & Decay"}),t.jsxs(ee,{children:[t.jsxs(J,{label:"ðŸŽšï¸ Freshness Sensitivity",subLabel:"Left: Stricter (Newer) | Right: Relaxed",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",gap:"10px"},children:[t.jsx("span",{title:"Strict/Fresh",style:{fontSize:"1.2rem"},children:"âš¡"}),t.jsx("input",{type:"range",min:"6",max:"72",value:e.rankingWeights?.freshness?.decayHours||26,onChange:f=>n("rankingWeights.freshness.decayHours",parseInt(f.target.value)),style:{flex:1}}),t.jsx("span",{title:"Relaxed/Older",style:{fontSize:"1.2rem"},children:"ðŸ¢"})]}),t.jsxs("div",{style:{textAlign:"right",fontSize:"0.7rem",color:"var(--text-muted)"},children:["Decay over ",e.rankingWeights?.freshness?.decayHours||26,"h"]})]}),t.jsx(J,{label:"ðŸ“‰ Hide Stale News",subLabel:`> ${e.hideOlderThanHours||60}h`,children:t.jsx("input",{type:"number",min:1,max:168,value:e.hideOlderThanHours||60,onChange:f=>s({...e,hideOlderThanHours:parseInt(f.target.value)||60}),className:"settings-input-number",style:{width:"60px"}})})]}),t.jsx(Z,{icon:"ðŸ§ ",title:"Classification Logic"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Automatic categorization logic."}),t.jsx("div",{className:"settings-item__label",style:{color:"var(--accent-primary)",marginTop:"10px"},children:"Entity Overrides (Exact Matches)"}),t.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",margin:"5px 0 15px 0",fontSize:"0.75rem",fontFamily:"monospace"},children:Object.entries(Gn).map(([f,N])=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("span",{style:{color:"var(--text-primary)"},children:f}),t.jsxs("span",{style:{color:"var(--text-muted)"},children:["â†’ ",N]})]},f))})]})]})},w=()=>{const j=[{id:"entertainment",label:"Entertain",icon:"ðŸŽ¬"},{id:"technology",label:"Tech",icon:"ðŸ’»"},{id:"sports",label:"Sports",icon:"âš½"},{id:"social",label:"Social",icon:"ðŸ”¥"}];return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:j.map(f=>t.jsxs("button",{onClick:()=>c(f.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:l===f.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:l===f.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:f.icon}),f.label]},f.id))}),t.jsx("div",{style:{flex:1,overflowY:"auto"},children:l==="social"?t.jsxs("div",{children:[t.jsx(Z,{icon:"ðŸ”¥",title:"Social Trends"}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:["Uses ",t.jsx("strong",{children:"Legacy Scoring"})," (Freshness + Source)."]}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:f=>n("buzzRankingWeights.visual.videoBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:f=>n("buzzRankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})})]})]}):t.jsx(Dn,{title:l.charAt(0).toUpperCase()+l.slice(1),icon:j.find(f=>f.id===l).icon,configPath:`buzz.${l}`,configData:e.buzz?.[l]||{},updateNested:n,addToList:i,removeFromList:a,localInputs:u,handleLocalInput:p,subTab:l})})]})},v=()=>{const j=[{id:"movies",label:"Movies",icon:"ðŸŽ¬"},{id:"events",label:"Events",icon:"ðŸŽ¤"},{id:"festivals",label:"Festivals",icon:"ðŸª”"},{id:"sports",label:"Sports",icon:"âš½"},{id:"shopping",label:"Shopping",icon:"ðŸ›’"},{id:"airlines",label:"Airlines",icon:"âœˆï¸"},{id:"alerts",label:"Alerts",icon:"âš ï¸"},{id:"civic",label:"Civic",icon:"ðŸ›ï¸"}],f=e.upAhead?.ranking?.[d]||{},N=I=>{const S=I==="positive"?e.upAhead?.keywords?.[d]:e.upAhead?.keywords?.[`${d}_negative`];return S&&S.length>0?S:(I==="positive"?oe.upAhead.keywords[d]:oe.upAhead.keywords[`${d}_negative`])||[]},A=N("positive"),_=N("negative"),L=()=>{const I=e.upAhead?.keywords?.negative;return I&&I.length>0?I:oe.upAhead.keywords.negative||[]},P=L(),M={enabled:e.upAhead?.categories?.[d]!==!1,positiveMultiplier:f.positiveMultiplier||1,negativeMultiplier:f.negativeMultiplier||1,filterThreshold:f.filterThreshold||0,positiveKeywords:A,negativeKeywords:[...P,..._]},B=(I,S)=>{I==="enabled"?n(`upAhead.categories.${d}`,S):(I==="positiveMultiplier"||I==="negativeMultiplier"||I==="filterThreshold")&&n(`upAhead.ranking.${d}.${I}`,S)},O=(I,S)=>{if(!S||!S.trim())return;const $=S.trim();if(I==="positiveKeywords"){const T=N("positive");if(T.some(H=>H.toLowerCase()===$.toLowerCase()))return;n(`upAhead.keywords.${d}`,[...T,$])}else if(I==="negativeKeywords"){const T=N("negative");if(T.some(H=>H.toLowerCase()===$.toLowerCase()))return;n(`upAhead.keywords.${d}_negative`,[...T,$])}},D=(I,S)=>{if(I==="positiveKeywords"){const T=N("positive").filter(H=>H!==S);n(`upAhead.keywords.${d}`,T)}else if(I==="negativeKeywords"){const $=N("negative");if($.includes(S)){const T=$.filter(H=>H!==S);n(`upAhead.keywords.${d}_negative`,T)}else{const T=L();if(T.includes(S)&&window.confirm(`"${S}" is a global negative keyword. Remove it from ALL categories?`)){const H=T.filter(W=>W!==S);n("upAhead.keywords.negative",H)}}}};return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:j.map(I=>t.jsxs("button",{onClick:()=>h(I.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:d===I.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:d===I.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:I.icon}),I.label]},I.id))}),t.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[t.jsx(Z,{icon:"ðŸŒ",title:"Global Config"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"5px"},children:"Locations"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px"},children:["Chennai","Muscat","Trichy"].map(I=>t.jsxs("label",{className:`chip-checkbox ${e.upAhead?.locations?.includes(I)?"active":""}`,children:[t.jsx("input",{type:"checkbox",style:{display:"none"},checked:e.upAhead?.locations?.includes(I)||!1,onChange:S=>{const $=e.upAhead?.locations||[],T=S.target.checked?[...$,I]:$.filter(H=>H!==I);n("upAhead.locations",T)}}),I]},I))})]}),t.jsx(Dn,{title:j.find(I=>I.id===d).label,icon:j.find(I=>I.id===d).icon,configData:M,customUpdate:B,customAdd:O,customRemove:D,localInputs:u,handleLocalInput:p,subTab:`ua_${d}`})]})]})};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",padding:"0 15px",flexShrink:0},children:[t.jsx("button",{className:`btn ${r==="main"?"btn--primary":"btn--secondary"}`,onClick:()=>o("main"),style:{flex:1},children:"âš™ï¸ Main"}),t.jsx("button",{className:`btn ${r==="buzz"?"btn--primary":"btn--secondary"}`,onClick:()=>o("buzz"),style:{flex:1},children:"âš¡ Buzz"}),t.jsx("button",{className:`btn ${r==="upahead"?"btn--primary":"btn--secondary"}`,onClick:()=>o("upahead"),style:{flex:1},children:"ðŸ—“ï¸ Up Ahead"})]}),t.jsxs("div",{className:"settings-tab-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"0 15px 15px 15px"},children:[r==="main"&&m(),r==="buzz"&&w(),r==="upahead"&&v()]})]})},Dn=({title:e,icon:n,configPath:s,configData:i,updateNested:a,addToList:r,removeFromList:o,localInputs:l,handleLocalInput:c,subTab:d,customUpdate:h,customAdd:u,customRemove:g})=>{const p=(v,j)=>{h?h(v,j):a(`${s}.${v}`,j)},m=(v,j)=>{u?u(v,j):r(`${s}.${v}`,j)},w=(v,j)=>{g?g(v,j):o(`${s}.${v}`,j)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[t.jsx(Z,{icon:n,title:e}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:i.enabled!==!1?"Active":"Disabled"}),t.jsx(ge,{checked:i.enabled!==!1,onChange:v=>p("enabled",v)})]})]}),t.jsxs(ee,{children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:[t.jsx("strong",{children:"Ranking Formula:"})," (Positive Matches Ã— Multiplier) â€” (Negative Matches Ã— Multiplier)"]}),t.jsxs("div",{style:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#81c784"},children:"âœ… Positive Boost"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[i.positiveMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:i.positiveMultiplier||1,onChange:v=>p("positiveMultiplier",parseFloat(v.target.value)),style:{width:"80px"}})]})]}),t.jsx(Re,{label:"",placeholder:"Add positive keyword...",value:l[`${d}_pos`]||"",onChange:v=>c(`${d}_pos`,v),onAdd:()=>{m("positiveKeywords",l[`${d}_pos`]),c(`${d}_pos`,"")},items:i.positiveKeywords||[],onRemove:v=>w("positiveKeywords",v)})]}),t.jsxs("div",{style:{background:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#e57373"},children:"ðŸš« Negative Penalty"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[i.negativeMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:i.negativeMultiplier||1,onChange:v=>p("negativeMultiplier",parseFloat(v.target.value)),style:{width:"80px"}})]})]}),t.jsx(Re,{label:"",placeholder:"Add negative keyword...",value:l[`${d}_neg`]||"",onChange:v=>c(`${d}_neg`,v),onAdd:()=>{m("negativeKeywords",l[`${d}_neg`]),c(`${d}_neg`,"")},items:i.negativeKeywords||[],onRemove:v=>w("negativeKeywords",v)})]}),t.jsx(J,{label:"ðŸ›¡ï¸ Filter Threshold",subLabel:`Hide if Score < ${i.filterThreshold||0}`,children:t.jsx("input",{type:"range",min:"-5",max:"5",step:"1",value:i.filterThreshold||0,onChange:v=>p("filterThreshold",parseInt(v.target.value)),style:{width:"100%"}})})]})]})},Z=({icon:e,title:n})=>t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:e})," ",n]}),ee=({children:e})=>t.jsx("div",{className:"settings-card",children:e}),J=({label:e,subLabel:n,children:s})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:e}),n&&t.jsx("small",{children:n})]}),t.jsx("div",{style:{flex:"0 0 auto",marginLeft:"10px"},children:s})]}),Re=({label:e,placeholder:n,value:s,onChange:i,onAdd:a,items:r,onRemove:o})=>t.jsxs("div",{style:{marginBottom:"15px"},children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"6px"},children:e}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[t.jsx("input",{type:"text",value:s,onChange:l=>i(l.target.value),placeholder:n,className:"settings-input",onKeyDown:l=>l.key==="Enter"&&a()}),t.jsx("button",{className:"btn btn--secondary",onClick:a,style:{padding:"0 15px"},children:"Add"})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[r.map((l,c)=>t.jsxs("span",{className:"keyword-chip",children:[l,t.jsx("button",{onClick:()=>o(l),children:"Ã—"})]},c)),r.length===0&&t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Default keywords only"})]})]});function Go(){const e=kt(),[n,s]=y.useState(()=>on(tt())),[i,a]=y.useState(!1),[r,o]=y.useState(()=>zs()),[l]=y.useState(()=>on(tt())),{refreshWeather:c}=Ke(),{refreshNews:d}=Ge(),h=async()=>{a(!0);const m=Object.keys(n).filter(j=>n[j]),w=[],v=[];m.forEach(j=>{j==="weather"?(w.push(c(!0)),mt("weather")):j==="market"?mt("market"):(v.push(j),mt(j))}),v.length>0&&w.push(d(v));try{await Promise.all(w)}catch(j){console.error("Refresh failed",j)}o("Just now"),a(!1),setTimeout(()=>e("/"),500)},u=m=>{s({world:m,india:m,chennai:m,trichy:m,local:m,social:m,weather:m,market:m})},g=[{key:"world",icon:"ðŸŒ",label:"World News",desc:"International headlines"},{key:"india",icon:"ðŸ‡®ðŸ‡³",label:"India News",desc:"National news"},{key:"chennai",icon:"ðŸ›ï¸",label:"Chennai News",desc:"Chennai city updates"},{key:"trichy",icon:"ðŸ›ï¸",label:"Trichy News",desc:"Trichy local news"},{key:"local",icon:"ðŸ“",label:"Local (Muscat)",desc:"Muscat & Oman news"},{key:"social",icon:"ðŸ‘¥",label:"Social Trends",desc:"Trending topics"},{key:"weather",icon:"â˜ï¸",label:"Weather",desc:"Chennai, Trichy, Muscat"},{key:"market",icon:"ðŸ“ˆ",label:"Market",desc:"BSE, NSE, Movers"}],p=Object.values(n).filter(Boolean).length;return t.jsxs(t.Fragment,{children:[t.jsx(_e,{title:"Refresh Content",showBack:!0,backTo:"/"}),t.jsxs("div",{className:"refresh-page",children:[t.jsxs("div",{className:"refresh-info",children:[t.jsx("span",{children:"â±ï¸"}),t.jsxs("span",{children:["Last refresh: ",t.jsx("strong",{children:r})]})]}),t.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"},children:[t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>u(!0),children:"Select All"}),t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>u(!1),children:"Clear All"})]}),t.jsxs("section",{className:"settings-section",children:[t.jsxs("h2",{className:"settings-section__title",children:[t.jsx("span",{children:"ðŸ“‹"}),"Select Sections to Refresh",t.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.8rem",fontWeight:"normal",color:"var(--accent-primary)"},children:[p,"/",g.length]})]}),t.jsx("div",{className:"settings-card",children:g.map(({key:m,icon:w,label:v,desc:j})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",style:{flexDirection:"column",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-sm)"},children:[t.jsx("span",{className:"settings-item__icon",children:w}),v,l[m]&&t.jsx("span",{style:{color:"var(--weather-sun)",fontSize:"0.7rem"},children:"â˜…"})]}),t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginLeft:"28px"},children:j})]}),t.jsx(ge,{checked:n[m],onChange:f=>s(N=>({...N,[m]:f})),recommended:l[m]})]},m))})]}),t.jsxs("button",{className:`refresh-btn ${i?"refresh-btn--loading":""}`,onClick:h,disabled:i||p===0,children:[t.jsx("span",{className:"refresh-btn__icon",children:i?"âŸ³":"ðŸ”„"}),t.jsx("span",{children:i?"Refreshing...":"Refresh Now"})]}),t.jsxs("div",{className:"schedule-card",children:[t.jsxs("div",{className:"schedule-card__title",children:[t.jsx("span",{children:"ðŸ“Š"}),"Auto-Refresh Schedule"]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Forecast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 3 hours"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Nowcast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 1 hour"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"News Updates"}),t.jsx("span",{className:"schedule-item__value",children:"Every 30 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Market Data"}),t.jsx("span",{className:"schedule-item__value",children:"Every 5 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Social Trends"}),t.jsx("span",{className:"schedule-item__value",children:"Every 15 minutes"})]})]}),t.jsxs("div",{className:"card",style:{marginTop:"var(--spacing-md)",textAlign:"center"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:["Current Segment: ",t.jsx("strong",{style:{color:"var(--accent-primary)"},children:tt()?.name})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"4px"},children:"â˜… = Recommended sections for this time"})]})]})]})}function ps(e,n={}){const{country:s="IN",lang:i="en",timeRange:a="7d",excludeTerms:r=[]}=n;let o=encodeURIComponent(e);a&&(o+=`+when:${a}`),Array.isArray(r)&&r.forEach(h=>{o+=`+-${encodeURIComponent(h)}`});const l=`${i}-${s}`,c=s,d=`${s}:${i}`;return`https://news.google.com/rss/search?q=${o}&hl=${l}&gl=${c}&ceid=${d}`}async function ms(e){try{const n=ps(e.query||e.name,e.options||{});console.log(`[TopicService] Fetching news for "${e.name}"`);const s=await Se(n,"following");Ws(e.id);const i=V(),a=i.hideOlderThanHours||60,r=Date.now(),o=a*60*60*1e3,l=i.strictFreshness!==!1;let c=s;return l&&(c=s.filter(h=>h.publishedAt?r-h.publishedAt<=o:!1),console.log(`[TopicService] Filtered ${s.length-c.length} old articles for "${e.name}" (Limit: ${a}h)`)),c.map(h=>({...h,topicId:e.id,topicName:e.name,context:"following"}))}catch(n){return console.error(`[TopicService] Failed to fetch topic "${e.name}":`,n),[]}}async function Ko(e){if(!e||e.length===0)return{};const n=e.map(r=>ms(r)),i=(await Promise.all(n)).flat(),a={};return i.forEach(r=>{r&&r.topicId&&(a[r.topicId]||(a[r.topicId]=[]),a[r.topicId].push(r))}),a}const gs=y.createContext();function Vo({children:e}){const[n,s]=y.useState([]),[i,a]=y.useState({}),[r,o]=y.useState(!1),[l,c]=y.useState([]);y.useEffect(()=>{const v=V();s(v.followedTopics||[]),m()},[]),y.useEffect(()=>{if(n.length===0)return;d(!1);const v=setInterval(()=>{console.log("[TopicContext] Auto-refreshing topics..."),d(!0)},900*1e3);return()=>clearInterval(v)},[n.length]);const d=async(v=!1)=>{if(n.length!==0){v||o(!0);try{const j=await Ko(n);v&&h(j),a(j)}catch(j){console.error("[TopicContext] Failed to refresh topics:",j)}finally{v||o(!1)}}},h=v=>{let j=0,f="";if(Object.entries(v).forEach(([N,A])=>{const _=i[N]||[];if(A.length>0&&_.length>0&&A[0].id!==_[0].id){j++;const L=n.find(P=>P.id===N);L&&(f=L.name)}}),j>0){const N=j===1?`New update for ${f}`:`Updates in ${j} followed topics`;ns(N,{body:"Click to see the latest stories.",tag:"topic-update"})}},u=v=>{Hs(v);const j=V();s(j.followedTopics||[]),setTimeout(()=>d(!1),50)},g=v=>{Us(v),s(f=>f.filter(N=>N.id!==v));const j={...i};delete j[v],a(j)},p=v=>{Pn(v),m()},m=()=>{const v=Vs();c(v)},w={followedTopics:n,topicNews:i,loading:r,suggestions:l,addTopic:u,removeTopic:g,refreshTopics:d,addToHistory:p};return t.jsx(gs.Provider,{value:w,children:e})}function fs(){return y.useContext(gs)}function qo({topic:e,articleCount:n,onClick:s,onRemove:i}){const a=kt(),r=e.lastFetched?Yo(new Date(e.lastFetched)):"Never updated",o=()=>{s?s(e):a(`/following/${e.id}`)};return t.jsxs("div",{className:"topic-card",onClick:o,children:[t.jsx("div",{className:"topic-card__icon",children:e.icon||"ðŸ“°"}),t.jsxs("div",{className:"topic-card__content",children:[t.jsx("h3",{className:"topic-card__name",children:e.name}),t.jsxs("p",{className:"topic-card__update",children:["Last update: ",r]})]}),t.jsx("div",{className:"topic-card__badge",children:n>0&&t.jsxs("span",{className:"topic-card__count",children:[n," new"]})}),t.jsx("button",{className:"topic-card__menu",onClick:l=>{l.stopPropagation(),window.confirm(`Stop following "${e.name}"?`)&&i(e.id)},"aria-label":"Remove topic",children:"â‹®"})]})}function Yo(e){if(!e)return"Never";const n=Math.floor((Date.now()-e)/6e4);if(n<1)return"Just now";if(n<60)return`${n} min${n>1?"s":""} ago`;const s=Math.floor(n/60);return s<24?`${s} hour${s>1?"s":""} ago`:`${Math.floor(s/24)} days ago`}function Jo({onAddTopic:e}){const[n,s]=y.useState(""),[i,a]=y.useState([]),[r,o]=y.useState(!1),l=async d=>{if(d.preventDefault(),!!n.trim()){o(!0);try{const h=ps(n),u=await Se(h,"preview");a(u.slice(0,5))}catch(h){console.error("Search failed:",h),alert("Failed to find news for this topic. Try different keywords.")}finally{o(!1)}}},c=()=>{const d={name:n,query:n,icon:Xo(n),options:{country:"IN",lang:"en",timeRange:"30d"}};e(d),s(""),a([])};return t.jsxs("div",{className:"topic-search",children:[t.jsxs("form",{onSubmit:l,children:[t.jsx("input",{type:"text",placeholder:"Search topics... (e.g., Tamil Nadu Elections)",value:n,onChange:d=>s(d.target.value),className:"topic-search__input"}),t.jsx("button",{type:"submit",disabled:r,children:r?"...":"Search"})]}),i.length>0&&t.jsxs("div",{className:"topic-search__preview",children:[t.jsxs("h4",{children:['Preview: "',n,'"']}),t.jsx("ul",{children:i.map((d,h)=>t.jsx("li",{children:d.title},h))}),t.jsxs("button",{onClick:c,className:"topic-search__follow-btn",children:['âž• Follow "',n,'"']})]})]})}function Xo(e){const n=e.toLowerCase();return n.includes("election")?"ðŸ—³ï¸":n.includes("market")||n.includes("stock")||n.includes("sensex")?"ðŸ“Š":n.includes("film")||n.includes("movie")||n.includes("cinema")?"ðŸŽ¬":n.includes("sport")||n.includes("cricket")||n.includes("ipl")?"ðŸ":n.includes("tech")||/\bai\b/.test(n)||n.includes("startup")?"ðŸ’»":n.includes("weather")||n.includes("rain")?"â˜ï¸":"ðŸ“°"}function Qo(){const{followedTopics:e,topicNews:n,loading:s,suggestions:i,addTopic:a,removeTopic:r,refreshTopics:o}=fs();y.useEffect(()=>{},[]);const l=e.length>0,c=d=>{a({name:d,query:d,icon:"ðŸ”",options:{country:"IN",lang:"en",timeRange:"30d"}})};return t.jsxs("div",{className:"following-page",children:[t.jsx("header",{className:"following-page__header",children:t.jsx("h1",{children:"ðŸ“Œ Following"})}),t.jsxs("div",{className:"following-page__content",children:[t.jsx(Jo,{onAddTopic:a}),i.length>0&&t.jsxs("div",{className:"following-page__suggestions-section",children:[t.jsx("h4",{children:"Suggested for you"}),t.jsx("div",{className:"following-page__suggestions",children:i.map((d,h)=>t.jsxs("button",{className:"suggestion-chip",onClick:()=>c(d.word),children:["+ ",d.word]},h))})]}),s&&t.jsx("p",{children:"Loading updates..."}),l?t.jsxs("div",{className:"following-page__topics",children:[t.jsx("h2",{className:"following-page__section-title",children:"Your Topics"}),e.map(d=>t.jsx(qo,{topic:d,articleCount:n[d.id]?.length||0,onRemove:r},d.id))]}):t.jsxs("div",{className:"following-page__empty",children:[t.jsx("p",{children:"No topics followed yet."}),t.jsx("p",{children:"Search for topics above to get started!"})]})]})]})}function Zo(){const{topicId:e}=Is(),n=kt(),{followedTopics:s,addToHistory:i}=fs(),[a,r]=y.useState([]),[o,l]=y.useState(!0),c=s.find(d=>d.id===e);return y.useEffect(()=>{if(!c)return;(async()=>{l(!0);try{const h=await ms(c);r(h)}catch(h){console.error(h)}finally{l(!1)}})()},[e,c]),c?t.jsxs("div",{className:"page-container",children:[t.jsxs("header",{className:"header",style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-secondary)",borderBottom:"1px solid var(--border-color)",padding:"10px 15px",display:"flex",alignItems:"center",gap:"15px"},children:[t.jsx("button",{onClick:()=>n("/following"),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"var(--text-primary)"},children:"â†"}),t.jsxs("h1",{style:{margin:0,fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:c?.icon}),c?.name]})]}),t.jsx("main",{className:"main-content",style:{paddingTop:"0"},children:o?t.jsxs("div",{className:"loading",style:{padding:"20px",textAlign:"center"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching latest news..."})]}):t.jsx("div",{style:{padding:"10px"},children:t.jsx(ue,{id:`topic-${e}`,title:`Latest on ${c?.name}`,icon:c?.icon,news:a,maxDisplay:50,showExpand:!1,colorClass:"news-section__title--world",onArticleClick:d=>i(d)})})})]}):t.jsx("div",{className:"page-container",children:t.jsxs("div",{className:"loading",style:{padding:"20px"},children:[t.jsx("p",{children:"Loading topic..."}),t.jsx("button",{onClick:()=>n("/following"),children:"Back to List"})]})})}function el(){const{isWebView:e}=lt(),n=On(),s=[{path:"/",label:"Main",icon:"ðŸ "},{path:"/up-ahead",label:"Up Ahead",icon:"ðŸ—“ï¸"},{path:"/following",label:"Follow",icon:"ðŸ“Œ"},{path:"/newspaper",label:"Paper",icon:"ðŸ“°"},{path:"/markets",label:"Market",icon:"ðŸ“ˆ"},{path:"/tech-social",label:"Buzz",icon:"ðŸŽ­"},{path:"/weather",label:"Weather",icon:"â˜ï¸"},{path:"/settings",label:"Settings",icon:"âš™ï¸"}];return t.jsx("nav",{className:`bottom-nav ${e?"bottom-nav--desktop":""}`,children:s.map(i=>t.jsxs(As,{to:i.path,className:`bottom-nav__item ${n.pathname===i.path?"active":""}`,title:i.label,children:[t.jsx("span",{className:"bottom-nav__icon",children:i.icon}),t.jsx("span",{className:"bottom-nav__label",children:i.label})]},i.path))})}const tl=300*1e3;function nl(){const{pathname:e}=On();return y.useEffect(()=>{window.scrollTo(0,0)},[e]),y.useEffect(()=>{let n=null;const s=()=>{document.hidden?n=Date.now():n&&Date.now()-n>tl&&window.scrollTo(0,0)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[]),null}const sl=()=>{const{settings:e}=se(),[n,s]=y.useState(!1),[i,a]=y.useState([]),[r,o]=y.useState(0),l=y.useRef(null);return y.useEffect(()=>{const c=console.log,d=console.warn,h=console.error,u=(p,m)=>{const w=Array.from(m).map(v=>{try{return typeof v=="object"?JSON.stringify(v):String(v)}catch{return"[Circular/Object]"}}).join(" ");a(v=>[...v.slice(-99),{type:p,message:w,time:new Date().toLocaleTimeString()}]),n||o(v=>v+1)};console.log=(...p)=>{u("log",p),c.apply(console,p)},console.warn=(...p)=>{u("warn",p),d.apply(console,p)},console.error=(...p)=>{u("error",p),h.apply(console,p)};const g=p=>{u("error",[p.message||"Unknown Global Error"])};return window.addEventListener("error",g),window.addEventListener("unhandledrejection",p=>u("error",["Unhandled Promise:",p.reason])),()=>{console.log=c,console.warn=d,console.error=h,window.removeEventListener("error",g)}},[n]),y.useEffect(()=>{n&&l.current&&(l.current.scrollIntoView({behavior:"smooth"}),o(0))},[i,n]),e.showDebugConsole===!1?null:t.jsxs("div",{style:{position:"fixed",bottom:"80px",right:"20px",zIndex:9999},children:[t.jsxs("button",{onClick:()=>{s(!n),o(0)},style:{width:"48px",height:"48px",borderRadius:"50%",background:r>0?"#ff4757":"rgba(0,0,0,0.8)",color:"white",border:"2px solid rgba(255,255,255,0.2)",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:["ðŸž",r>0&&t.jsx("span",{style:{position:"absolute",top:"-5px",right:"-5px",background:"red",color:"white",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",border:"1px solid white"},children:r})]}),n&&t.jsxs("div",{style:{position:"absolute",bottom:"60px",right:"0",width:"320px",height:"400px",maxHeight:"60vh",background:"rgba(10, 13, 17, 0.95)",backdropFilter:"blur(10px)",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 8px 32px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"10px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#00D4AA"},children:"Debug Console"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>a([]),style:{background:"none",border:"none",color:"#aaa",cursor:"pointer",fontSize:"0.8rem"},children:"Clear"}),t.jsx("button",{onClick:()=>s(!1),style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},children:"âœ•"})]})]}),t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"10px",fontFamily:"monospace",fontSize:"0.75rem",display:"flex",flexDirection:"column",gap:"4px"},children:[i.map((c,d)=>t.jsxs("div",{style:{color:c.type==="error"?"#ff6b6b":c.type==="warn"?"#feca57":"#1dd1a1",borderBottom:"1px solid rgba(255,255,255,0.05)",paddingBottom:"2px",wordBreak:"break-word"},children:[t.jsxs("span",{style:{opacity:.5,marginRight:"6px"},children:["[",c.time,"]"]}),c.message]},d)),t.jsx("div",{ref:l})]})]})]})},il=()=>{const{loading:e}=Ge(),{loading:n}=Ke(),s=e||n;return t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:99999},children:t.jsx(fe,{active:s,color:"var(--accent-primary)",style:{height:"3px"}})})};function al(){return console.log("[App] Rendering root component..."),t.jsx(yi,{children:t.jsx(Va,{children:t.jsx(Aa,{children:t.jsx(wa,{children:t.jsx(fi,{children:t.jsx(Vo,{children:t.jsxs(Ms,{children:[t.jsx(nl,{}),t.jsx(il,{}),t.jsx(sl,{}),t.jsxs("div",{className:"app",children:[t.jsxs(Rs,{children:[t.jsx(de,{path:"/",element:t.jsx(ar,{})}),t.jsx(de,{path:"/up-ahead",element:t.jsx($r,{})}),t.jsx(de,{path:"/weather",element:t.jsx(Ur,{})}),t.jsx(de,{path:"/markets",element:t.jsx(Vr,{})}),t.jsx(de,{path:"/tech-social",element:t.jsx(qr,{})}),t.jsx(de,{path:"/newspaper",element:t.jsx(Oo,{})}),t.jsx(de,{path:"/settings",element:t.jsx(Uo,{})}),t.jsx(de,{path:"/refresh",element:t.jsx(Go,{})}),t.jsx(de,{path:"/following",element:t.jsx(Qo,{})}),t.jsx(de,{path:"/following/:topicId",element:t.jsx(Zo,{})})]}),t.jsx(el,{})]})]})})})})})})})}class rl extends Ln.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){this.setState({error:n,errorInfo:s}),console.error("Uncaught error:",n,s)}render(){return this.state.hasError?t.jsxs("div",{style:{padding:"20px",color:"red",background:"#333",minHeight:"100vh"},children:[t.jsx("h1",{children:"Something went wrong."}),t.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),t.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}function ol(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})})}const ll=[{title:"Millions affected by Chennai floods",description:"Heavy rains in Tamil Nadu capital have caused massive flooding affecting 5 million people.",imageUrl:"https://example.com/floods.jpg",section:"chennai",publishedAt:Date.now()-3600*1e3,source:"The Hindu"},{title:"Hero rescues child from burning building",description:"A brave firefighter in Mumbai saved a child from a tragic fire, creating a moment of hope.",imageUrl:"https://youtube.com/watch?v=abc",section:"india",publishedAt:Date.now()-7200*1e3,source:"NDTV"},{title:"Tech company announces new CEO",description:"Silicon Valley startup announces John Doe as new CEO replacing the founder.",imageUrl:null,section:"technology",publishedAt:Date.now()-300*60*1e3,source:"TechCrunch"}];function cl(){const e=V();console.log(`
=== SCORING TEST (New Scoring: ${e.enableNewScoring}) ===`),ll.forEach(n=>{const s={...n,sentiment:{label:"neutral"},keywords:[]},i=_t(s,n.section);console.log(`
Title: ${n.title}`),console.log(`Section: ${n.section}`),console.log(`Score: ${i.toFixed(2)}`)}),console.log(`
=================================================
`)}console.log("[Main] Application starting...");typeof window<"u"&&(window.runScoringTests=cl);ol();try{const e=document.getElementById("root");if(!e)throw new Error("Root element not found");$s.createRoot(e).render(t.jsx(y.StrictMode,{children:t.jsx(rl,{children:t.jsx(al,{})})}))}catch(e){console.error("Critical Application Failure:",e);const n=document.getElementById("root");n&&(n.innerHTML=`
      <div style="color: red; padding: 20px; text-align: center;">
        <h1>Application Failed to Start</h1>
        <p>${e.message}</p>
        <pre>${e.stack}</pre>
      </div>
    `)}
//# sourceMappingURL=index-DO-FEzOk.js.map
