import{r as Ns,a as _s,b as x,L as ze,g as ks,R as Dn,u as Nt,c as Cs,d as Ln,N as Es,H as Ts,e as As,f as ue}from"./vendor-react-hF7JAobB.js";import{r as Is}from"./utils-sentiment-EAYl0nxh.js";import{G as Te}from"./vendor-ui-Dm16880k.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();var ut={exports:{}},Fe={};var Rt;function Ms(){if(Rt)return Fe;Rt=1;var e=Ns(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var u,m={},g=null,p=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(p=c.ref);for(u in c)a.call(c,u)&&!r.hasOwnProperty(u)&&(m[u]=c[u]);if(l&&l.defaultProps)for(u in c=l.defaultProps,c)m[u]===void 0&&(m[u]=c[u]);return{$$typeof:n,type:l,key:g,ref:p,props:m,_owner:i.current}}return Fe.Fragment=s,Fe.jsx=o,Fe.jsxs=o,Fe}var Dt;function Rs(){return Dt||(Dt=1,ut.exports=Ms()),ut.exports}var t=Rs(),Xe={},Lt;function Ds(){if(Lt)return Xe;Lt=1;var e=_s();return Xe.createRoot=e.createRoot,Xe.hydrateRoot=e.hydrateRoot,Xe}var Ls=Ds();const be={SETTINGS:"dailyEventAI_settings",LAST_REFRESH:"dailyEventAI_lastRefresh",CACHED_DATA:"dailyEventAI_cachedData",ARTICLE_VIEWS:"dailyEventAI_articleViews"},On="/api",oe={uiMode:"timeline",customSortTopStories:!0,theme:"dark",fontSize:26,freshnessLimitHours:36,hideOlderThanHours:60,weatherFreshnessLimit:4,strictFreshness:!0,filteringMode:"source",rankingMode:"smart",rankingWeights:{temporal:{weekendBoost:2,entertainmentBoost:2.5},geo:{cityMatch:1.5,maxScore:5},freshness:{decayHours:26,maxBoost:3},impact:{boost:1,highImpactBoost:2.5},visual:{videoBoost:1.3,imageBoost:1.15},sentiment:{positiveBoost:.5,negativeBoost:.3},keyword:{matchBoost:2},source:{tier1Boost:.25,tier2Boost:.15,tier3Boost:0},viewedPenalty:.4,trending:{threshold:12},audit:{consensusThreshold:2,anomalySigma:2}},buzzRankingWeights:{visual:{videoBoost:2,imageBoost:1.5},freshness:{decayHours:12,maxBoost:2},trending:{threshold:10}},buzz:{entertainment:{enabled:!0,positiveKeywords:["tamil","kollywood","hindi","bollywood","hollywood","ott","netflix","prime video","disney","hotstar"],positiveMultiplier:2,negativeKeywords:["gossip","rumour","dating","spotted"],negativeMultiplier:2,filterThreshold:0},technology:{enabled:!0,positiveKeywords:["startup","ai","artificial intelligence","innovation","funding","launch","generative ai","llm"],positiveMultiplier:2,negativeKeywords:["rumour","leak","speculation"],negativeMultiplier:2,filterThreshold:0},sports:{enabled:!0,positiveKeywords:["cricket","football","ipl","world cup","india vs","final","highlights"],positiveMultiplier:2,negativeKeywords:["opinion","blog"],negativeMultiplier:2,filterThreshold:0}},weather:{models:{ecmwf:!0,gfs:!0,icon:!0},cities:["chennai","trichy","muscat"],showHumidity:!0,showWind:!1},sections:{world:{enabled:!0,count:5},india:{enabled:!0,count:5},chennai:{enabled:!0,count:5},trichy:{enabled:!0,count:5},local:{enabled:!0,count:5},social:{enabled:!0,count:25},entertainment:{enabled:!0,count:5},business:{enabled:!0,count:5},technology:{enabled:!0,count:5},sports:{enabled:!0,count:5}},newsSources:{bbc:!0,reuters:!0,ndtv:!0,theHindu:!0,toi:!0,financialExpress:!0,dtNext:!0,omanObserver:!0,moneyControl:!0,variety:!0,hollywoodReporter:!0,bollywoodHungama:!0,filmCompanion:!0,indiaToday:!0,timesOfOman:!0},sourceTiers:{tier1:["BBC","Reuters","TechCrunch","The Verge","ESPN"],tier2:["NDTV","The Hindu","Times of India","Moneycontrol","Indian Express"],tier3:["Oman Observer","DT Next","Bollywood Hungama"]},market:{showIndices:!0,showGainers:!0,showLosers:!0,showMutualFunds:!0,showIPO:!0,showSectorals:!0,showCommodities:!0,showCurrency:!0,showFIIDII:!0,cacheMinutes:15},entertainment:{tamilCount:5,hindiCount:5,hollywoodCount:3,ottCount:2},socialTrends:{worldCount:8,indiaCount:8,tamilnaduCount:5,muscatCount:4},customFeeds:[],feedBlockedKeywords:[],highImpactKeywords:["Budget","Election","Summit","Treaty","War","Crash","Landfall","Verdict","Resigns","Assassination"],upAhead:{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},ranking:{movies:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},events:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},festivals:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},sports:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},shopping:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},airlines:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},weather_alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},civic:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0}},locations:["Chennai","Muscat"],customLocation:"",signals:["upcoming","scheduled","starting","launches","opens","begins","commences","from today","this weekend","next week","releasing","premieres","debuts","kicks off","set to","slated for","expected on","effective from","valid till","last date","deadline","registrations open","bookings open","doors open","book now","tickets available","grab your","register","rsvp","sign up","enroll","apply before","limited seats","early bird","pre-order","advance booking","buy tickets","entry free","venue","stadium","auditorium","convention centre","exhibition hall","multiplex","arena","grounds","schedule","timetable","lineup","itinerary","match day","race day","show timings","showtimes","time slot","batch"],keywords:{movies:["release date","releasing","release","in theatres","in theaters","first day","advance booking","fdfs","premiere","preview","sneak peek","special screening","ott release","streaming from","now streaming","available on","direct to ott","digital premiere","tickets","showtimes","book now","bookmyshow","ticketnew","paytm movies","trailer launch","teaser release","motion poster"],events:["concert","live music","standup","comedy show","theatre","theater","drama","stage play","dance recital","sabha","kutcheri","kutchery","exhibition","expo","book fair","trade fair","flea market","art gallery","trade show","workshop","masterclass","bootcamp","seminar","webinar","hackathon","meetup","food festival","pop-up","tasting","brunch","food walk","heritage walk","night market","entry fee","passes available","gate open","limited slots","registration"],sports:[" vs "," v/s ","match","fixture","squad announced","playing xi","toss","innings","schedule","points table","qualifier","semi final","final","playoffs","stadium","live on","broadcast","streaming","start time","kick off","first ball"],festivals:["holiday","bank holiday","gazetted","declared holiday","government holiday","pongal","diwali","deepavali","navratri","dussehra","eid","ramadan","christmas","onam","vishu","ugadi","holi","ganesh","jayanti","puja","pooja","thai pusam","observed on","falls on","celebrated on","auspicious","muhurtham","tithi"],shopping:["sale","mega sale","flash sale","clearance","end of season","flat discount","upto off","cashback","coupon","promo code","shopping festival","exhibition sale","trade fair","grand opening","limited period","ends today","last day","offer valid","while stocks last","hurry"],airlines:["oman air","goindigo","salam air","ticket offer","flight deal","air india","vistara","akasa air","fare sale","booking open"],alerts:["power cut","power shutdown","load shedding","tangedco","tneb","scheduled maintenance","water cut","water supply","disruption","traffic advisory","road closure","diversion","metro shutdown","bus route change","train cancelled","flight delayed","boil water advisory","mosquito fogging","tree trimming","construction zone"],weather_alerts:["warning","alert","advisory","watch","red alert","orange alert","yellow alert","heavy rain","very heavy rain","cyclone","thunderstorm","heat wave","cold wave","fog","flooding","high tide","storm surge","imd","met department","weather bulletin"],civic:["vip movement","vip visit","road block","security arrangement","route change","bandh","hartal","strike","protest march","rasta roko","rail roko","corporation notice","tender","public hearing","ward meeting","grievance day"],movies_negative:["review","reviewed","reviews","opinion","editorial","column","interview","gossip","rumour","rumor","spotted","dating","controversy","trolled","slammed","reacts","reaction","leaked","wardrobe malfunction","breakup","case explained","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","promo shoot","shooting begins","wrapped up","schedule wrap","title reveal","first look","motion poster","cast revealed","plot leaked","producer","director","music director","remuneration","salary","budget","rights sold","satellite rights","audio launch","pre-release event","success meet","press meet","renamed","casts","court","petition","arrested","stealing","sewage","overflow","warns against","talks","deal","financial results","board meeting","did for free","bank holiday alert","check full list","divorce","decommission","released crore","schedules board meeting","fog","mist"],events_negative:["cancelled","postponed","webinar","virtual only","legacy","tribute","obituary"],sports_negative:["rumour","speculation","opinion","prediction","predictions","bracketology","power rankings","fantasy value"],festivals_negative:[],shopping_negative:["expired","sold out"],airlines_negative:["accident","crash","emergency landing","technical snag"],alerts_negative:["rumour","hoax","fake news"],civic_negative:["clinic","surgery","transplant","arrested","held"],negative:["review","reviewed","reviews","opinion","editorial","column","op-ed","analysis","deep dive","explainer","explained","interview","memoir","podcast","recap","retrospective","lookback","throwback","gossip","rumour","rumor","spotted","dating","divorce","controversy","trolled","slammed","reacts","reaction","claps back","feud","leaked","wardrobe malfunction","breakup","arrested","murder","stabbed","robbery","scam","fraud","accused","chargesheet","sentenced","bail","fir filed","kidnap","suicide","death toll","fatal","quarterly results","earnings call","dividend","stock split","ipo allotment","listing gains","shareholding pattern","promoter stake","mutual fund nav","portfolio rebalancing","alleges","slams","hits out","war of words","defamation","no confidence","horse trading","exit poll","poll prediction","meme","was held","concluded","wrapped up","came to an end","successfully completed","inaugurated by","flagged off","took place","was celebrated","passes away","passed away","demise","rip","condolences","last rites","funeral","pays tribute","mourns","obituary","top 10","top 5","best of","worst of","reasons why","things you","ranked","all you need to know","everything we know","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","shocking","you won't believe","jaw dropping","gone viral","breaks the internet","exclusive","board meeting","financial results","quarterly results","dividend","earnings call","stock split","bonus issue","record date","schedules board meeting","to consider","fund raising","petrol price","price hike","title reveal","first look","renamed","locks release date","casts","producer","court","petition","arrested","stealing","sewage","warns","talks","deal","did for free","bank holiday alert","check full list","decommission","fog","mist","opens office","launches","inaugurated","reveals"]}},sectionOverrides:{},newspaper:{enableImages:!0,headlinesCount:3,leadsCount:6,briefsCount:12},enableNewScoring:!0,enableProximityScoring:!1,maxTopicPercent:40,maxGeoPercent:30,followedTopics:[],readingHistory:[],topicSuggestions:{enabled:!0,basedOnReadingHistory:!0},enableCache:!0,crawlerMode:"auto",debugLogs:!1,showDebugConsole:!0,lastUpdated:0};function V(){let e=oe.fontSize;typeof window<"u"&&(e=window.innerWidth>=1024?18:26);const n={...oe,fontSize:e};try{const s=localStorage.getItem(be.SETTINGS);if(s){const a=JSON.parse(s);return Fn(n,a)}}catch(s){console.error("Error reading settings:",s)}return{...n}}function We(e){try{const n={...e,lastUpdated:Date.now()};return localStorage.setItem(be.SETTINGS,JSON.stringify(n)),Os(n),!0}catch(n){return console.error("Error saving settings:",n),!1}}async function Os(e){try{(await fetch(`${On}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok||console.warn("Failed to save settings to API")}catch(n){console.warn("API save error:",n)}}async function Fs(){try{const e=await fetch(`${On}/settings`);return e.ok?await e.json():null}catch(e){return console.warn("API fetch error:",e),null}}function ht(e){try{const n=localStorage.getItem(be.LAST_REFRESH),s=n?JSON.parse(n):{};s[e]=new Date().toISOString(),localStorage.setItem(be.LAST_REFRESH,JSON.stringify(s))}catch(n){console.error("Error setting last refresh:",n)}}function $s(e=null){try{const n=localStorage.getItem(be.LAST_REFRESH);if(!n)return"Never";const s=JSON.parse(n);let a=null;if(e&&s[e])a=new Date(s[e]);else{const c=Object.values(s).map(d=>new Date(d).getTime());c.length>0&&(a=new Date(Math.max(...c)))}if(!a)return"Never";const r=new Date-a,o=Math.floor(r/6e4),l=Math.floor(r/36e5);return o<1?"Just now":o<60?`${o} min${o>1?"s":""} ago`:l<24?`${l} hour${l>1?"s":""} ago`:a.toLocaleDateString()}catch{return"Unknown"}}function Fn(e,n){const s={...e};for(const a in n){const i=n[a];i!=null&&(typeof i=="object"&&!Array.isArray(i)?s[a]=Fn(e[a]||{},i):s[a]=i)}return s}function Bs(e){const n=V();n.followedTopics=n.followedTopics||[],n.followedTopics.push({...e,id:`topic_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,created:new Date().toISOString(),lastFetched:null}),We(n)}function Ps(e){const n=V();n.followedTopics=n.followedTopics.filter(s=>s.id!==e),We(n)}function zs(e){const n=V(),s=n.followedTopics.find(a=>a.id===e);s&&(s.lastFetched=new Date().toISOString(),We(n))}function Hs(e){if(!(!e||e.length===0))try{const n=localStorage.getItem(be.ARTICLE_VIEWS),s=n?JSON.parse(n):{};e.forEach(a=>{s[a]=(s[a]||0)+1}),localStorage.setItem(be.ARTICLE_VIEWS,JSON.stringify(s))}catch(n){console.error("[Storage] Error incrementing views",n)}}function $n(e){try{const n=localStorage.getItem(be.ARTICLE_VIEWS);return(n?JSON.parse(n):{})[e]||0}catch{return 0}}function Us(e){return V().readingHistory?.some(s=>s.id===e)||!1}function Bn(e){if(!e||!e.title)return;const n=V(),s=n.readingHistory||[];s.some(a=>a.id===e.id)||(s.unshift({id:e.id,title:e.title,description:e.description||"",timestamp:Date.now()}),s.length>50&&(s.length=50),n.readingHistory=s,We(n))}function Ws(){const n=V().readingHistory||[];if(n.length===0)return[];const s=n.map(l=>`${l.title} ${l.description}`).join(" ").toLowerCase(),a=["the","and","in","of","to","a","is","for","on","with","at","from","by","an","be","as","it","has","that","are","was","will","says","said","after","over","new","more","about","can","top","best","india","news","update","latest","today","live"],i=s.match(/\b[a-z]{4,}\b/g)||[],r={};return i.forEach(l=>{a.includes(l)||(r[l]=(r[l]||0)+1)}),Object.entries(r).sort((l,c)=>c[1]-l[1]).slice(0,5).map(([l,c])=>({word:l.charAt(0).toUpperCase()+l.slice(1),count:c}))}const $e={nifty50:"^NSEI",sensex:"^BSESN",niftyBank:"^NSEBANK",niftyIT:"^CNXIT",niftyMidcap:"NIFTYMIDCAP150.NS",niftyPharma:"^CNXPHARMA",niftyAuto:"^CNXAUTO"},Gs="https://query1.finance.yahoo.com/v8/finance/chart/",Ks=[e=>`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`];async function De(e){const n=`${Gs}${encodeURIComponent(e)}?interval=1d&range=1d`,s=async(a,i={})=>{const r=new AbortController,o=setTimeout(()=>r.abort(),1e4);try{const l=await fetch(a,{...i,signal:r.signal});return clearTimeout(o),l}catch(l){throw clearTimeout(o),l}};for(const a of Ks)try{const i=a(n),r=await s(i);if(r.ok)return await r.json()}catch(i){console.warn(`[MarketService] Proxy failed: ${i.message}`)}throw new Error(`Failed to fetch market data for ${e}`)}async function Vs(e,n,s){if(!s)return null;const a=`https://www.alphavantage.co/query?function=${e}&symbol=${n}&apikey=${s}`;try{const r=await(await fetch(a)).json();if(r["Global Quote"])return r["Global Quote"];if(r["Top Gainers, Losers, and Most Active"])return r}catch(i){console.warn("Alpha Vantage fetch failed",i)}return null}function Le(e){const n=e.chart?.result?.[0]||e.finance?.result?.[0];if(!n||!n.meta)return null;const s=n.meta,a=s.regularMarketPrice,i=s.chartPreviousClose||s.previousClose,r=a-i,o=i?r/i*100:0,l=s.regularMarketTime?s.regularMarketTime*1e3:Date.now();return{price:a,change:r,changePercent:o.toFixed(2),timestamp:l}}async function qs(){console.log("[MarketService] Fetching Indian indices...");const e=Object.entries($e).map(async([a,i])=>{try{const r=await De(i),o=Le(r);return o?(console.log(`[MarketService] âœ… ${a}: ${o.price}`),{name:a==="nifty50"?"NIFTY 50":a==="sensex"?"SENSEX":a==="niftyBank"?"BANK NIFTY":a==="niftyIT"?"NIFTY IT":a==="niftyPharma"?"NIFTY PHARMA":a==="niftyAuto"?"NIFTY AUTO":"MIDCAP 150",symbol:i,value:o.price.toLocaleString("en-IN"),change:o.change.toFixed(2),changePercent:o.changePercent,direction:o.change>=0?"up":"down",currency:"â‚¹",timestamp:o.timestamp}):null}catch(r){return console.warn(`[MarketService] âš ï¸ Failed to fetch ${a}:`,r.message),null}}),s=(await Promise.all(e)).filter(a=>a!==null);return s.length===0?(console.warn("[MarketService] Yahoo Indices failed, trying backup..."),await Ys()):s}async function Ys(){const e={"NIFTY 50":"INDEXNSE:NIFTY_50",SENSEX:"INDEXBOM:SENSEX"};try{const n=Object.entries(e).map(async([a,i])=>{const r=`https://www.google.com/finance/quote/${i}`,o=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r)}`,d=(await(await fetch(o)).text()).match(/<div[^>]*class="[^"]*YMlKec[^"]*"[^>]*>([^<]+)<\/div>/);if(d&&d[1]){const u=d[1].replace(/,/g,""),m=parseFloat(u);return{name:a,symbol:i,value:m.toLocaleString("en-IN"),change:"0.00",changePercent:"0.00",direction:"neutral",currency:"â‚¹",timestamp:Date.now(),source:"Google (Backup)"}}return null});return(await Promise.all(n)).filter(a=>a!==null)}catch(n){return console.error("Backup indices fetch failed",n),[]}}const Js="https://api.mfapi.in/mf/",Xs=[{code:"119551",name:"SBI Bluechip Fund"},{code:"120503",name:"HDFC Mid-Cap Opportunities"},{code:"118834",name:"ICICI Prudential Value Discovery"},{code:"122639",name:"Axis Long Term Equity Fund"},{code:"125354",name:"Mirae Asset Large Cap Fund"},{code:"118989",name:"Kotak Emerging Equity Fund"}];async function Qs(){return console.log("[MarketService] Fetching Mutual Fund NAVs..."),(await Promise.allSettled(Xs.map(async s=>{const i=await(await fetch(`${Js}${s.code}`)).json();if(!i.data||i.data.length===0)throw new Error("No NAV data");const r=parseFloat(i.data[0].nav),o=i.data.length>1?parseFloat(i.data[1].nav):r,l=r-o,c=(l/o*100).toFixed(2);return{code:s.code,name:i.meta?.scheme_name||s.name,category:i.meta?.scheme_category||"Equity",fundHouse:i.meta?.fund_house||"Unknown",nav:r.toFixed(2),navDate:i.data[0].date,change:l.toFixed(2),changePercent:c,direction:l>=0?"up":"down"}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function Zs(){console.log("[MarketService] Fetching IPO data from IPOWatch...");const n=`https://api.allorigins.win/get?url=${encodeURIComponent("https://ipowatch.in/upcoming-ipo-calendar-ipo-list/")}`;try{const s=await fetch(n);if(!s.ok)throw new Error("Proxy failed");const i=(await s.json()).contents,l=new DOMParser().parseFromString(i,"text/html").querySelectorAll("table");let c=null;for(const h of l){const w=h.textContent.toLowerCase();if(w.includes("ipo")&&w.includes("price")||w.includes("ipo name")){c=h;break}}if(!c)throw new Error("No IPO table found");const d=Array.from(c.querySelectorAll("tr")),u=[];for(let h=1;h<d.length;h++){const w=d[h].querySelectorAll("td");if(w.length<3)continue;const v=w[0]?.textContent?.trim()||"Unknown";let S="Upcoming",f="TBA";const _=w[1]?.textContent?.trim(),T=w[2]?.textContent?.trim();_&&(S=_),T&&(f=T);let L="upcoming";const k=S.toLowerCase();k.includes("live")||k.includes("open")?L="live":k.includes("close")?L="recent":k.includes("upcoming")&&(L="upcoming");const O=v.includes("SME")||c.textContent.includes("SME");u.push({name:v,openDate:f,closeDate:"",status:L,isSME:O,issueSize:"-"})}const m=u.filter(h=>h.status==="upcoming").slice(0,5),g=u.filter(h=>h.status==="live"),p=u.filter(h=>h.status==="recent").slice(0,5);return{upcoming:m.length?m:u.slice(0,3),live:g,recent:p.length?p:u.slice(3,6),fetchedAt:Date.now()}}catch(s){return console.error("[MarketService] IPO Fetch Failed:",s),{upcoming:[],live:[],recent:[],fetchedAt:Date.now(),error:s.message}}}const ei="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_gainers&count=5",ti="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_losers&count=5";async function Ot(e){const n=`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`;try{const s=await fetch(n);return s.ok?((await s.json()).finance?.result?.[0]?.quotes||[]).map(r=>({symbol:r.symbol.replace(".NS","").replace(".BO",""),price:r.regularMarketPrice?.toFixed(2)||"0.00",change:r.regularMarketChange?.toFixed(2)||"0.00",changePercent:r.regularMarketChangePercent?.toFixed(2)||"0.00",direction:(r.regularMarketChange||0)>=0?"up":"down",volume:r.regularMarketVolume})).filter(r=>r.symbol):[]}catch(s){return console.warn("[MarketService] Screener fetch failed:",s),[]}}const ni=["RELIANCE.NS","TCS.NS","HDFCBANK.NS","INFY.NS","ICICIBANK.NS","HINDUNILVR.NS","SBIN.NS","BHARTIARTL.NS","ITC.NS","KOTAKBANK.NS","LT.NS","AXISBANK.NS","ASIANPAINT.NS","MARUTI.NS","BAJFINANCE.NS"];async function si(){console.log("[MarketService] Using fallback for movers...");const e=ni.slice(0,10).map(async i=>{try{const r=await De(i),o=Le(r);return o?{symbol:i.replace(".NS",""),price:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:parseFloat(o.changePercent),direction:o.change>=0?"up":"down"}:null}catch{return null}}),a=(await Promise.all(e)).filter(i=>i!==null).sort((i,r)=>r.changePercent-i.changePercent);return{gainers:a.filter(i=>i.changePercent>0).slice(0,5),losers:a.filter(i=>i.changePercent<0).slice(-5).reverse()}}async function ii(){console.log("[MarketService] Fetching top movers...");const n=V().alphaVantageKey;if(n)try{console.log("[MarketService] Trying Alpha Vantage for Movers...");const s=await Vs("TOP_GAINERS_LOSERS","",n);if(s&&s.top_gainers&&s.top_losers){const a=i=>i.slice(0,5).map(r=>({symbol:r.ticker,price:parseFloat(r.price).toFixed(2),change:parseFloat(r.change_amount).toFixed(2),changePercent:parseFloat(r.change_percentage.replace("%","")).toFixed(2),direction:parseFloat(r.change_amount)>=0?"up":"down"}));return{gainers:a(s.top_gainers),losers:a(s.top_losers)}}}catch(s){console.warn("[MarketService] Alpha Vantage failed:",s)}try{const[s,a]=await Promise.all([Ot(ei),Ot(ti)]);if(s.length>0||a.length>0)return console.log("[MarketService] âœ… Used Screener API"),{gainers:s.slice(0,5),losers:a.slice(0,5)}}catch{console.warn("[MarketService] Screener API failed, trying fallback...")}return await si()}async function ai(){console.log("[MarketService] Fetching sectoral indices...");const e=[{key:"niftyBank",name:"Bank Nifty",symbol:$e.niftyBank},{key:"niftyIT",name:"Nifty IT",symbol:$e.niftyIT},{key:"niftyPharma",name:"Nifty Pharma",symbol:$e.niftyPharma},{key:"niftyAuto",name:"Nifty Auto",symbol:$e.niftyAuto}];return(await Promise.allSettled(e.map(async s=>{const a=await De(s.symbol),i=Le(a);if(!i)throw new Error("No data");return{name:s.name,value:i.price.toFixed(2),change:i.change.toFixed(2),changePercent:i.changePercent,timestamp:i.timestamp}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function ri(){console.log("[MarketService] Fetching commodities...");try{const e=await De("INR=X"),n=Le(e),s=n?n.price:84,a=[{name:"Gold",symbol:"GC=F",type:"gold"},{name:"Silver",symbol:"SI=F",type:"silver"},{name:"Crude Oil",symbol:"CL=F",type:"crude"}];return(await Promise.allSettled(a.map(async r=>{let o=null;try{const u=await De(r.symbol);o=Le(u)}catch{console.warn(`[MarketService] Failed to fetch ${r.name} (${r.symbol})`)}if(!o)throw new Error("No data");let l,c,d;return r.type==="gold"?(l=o.price*s/31.1035*10,c=o.change*s/31.1035*10,d="â‚¹/10g"):r.type==="silver"?(l=o.price*s/31.1035*1e3,c=o.change*s/31.1035*1e3,d="â‚¹/kg"):(l=o.price*s,c=o.change*s,d="â‚¹/bbl"),{name:r.name,value:l.toFixed(2),change:c.toFixed(2),changePercent:o.changePercent,unit:d,direction:c>=0?"up":"down",timestamp:o.timestamp}}))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}}async function oi(){console.log("[MarketService] Fetching currency rates...");const e=[{name:"USD/INR",symbol:"INR=X"},{name:"OMR/INR",symbol:"OMRINR=X"}],n=e.map(async i=>{try{const r=await De(i.symbol),o=Le(r);if(!o)throw new Error("No data");return{name:i.name,value:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:o.changePercent,timestamp:o.timestamp,source:"yahoo"}}catch{return null}}),a=(await Promise.all(n)).filter(i=>i!==null);if(a.length===e.length)return a;console.log("[MarketService] âš ï¸ Yahoo Currency failed, using fallback...");try{const r=await(await fetch("https://open.er-api.com/v6/latest/USD")).json();if(!r||!r.rates)throw new Error("Fallback API failed");const o=r.rates.INR,l=r.rates.OMR,c=[];if(c.push({name:"USD/INR",value:o.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"}),l){const d=o/l;c.push({name:"OMR/INR",value:d.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"})}return c}catch(i){return console.error("[MarketService] âŒ All currency sources failed:",i),a}}async function li(){return{fii:{buy:12500.5,sell:11800.3,net:700.2},dii:{buy:8900.7,sell:9200.4,net:-299.7},date:new Date().toISOString().split("T")[0]}}const Ft="indian_market_data",ci=14400*1e3;async function di(){try{const e=await fetch("/data/market_snapshot.json");if(e.ok)return await e.json()}catch(e){console.warn("[MarketService] Failed to load static snapshot",e)}return null}async function ui(){console.log("[MarketService] ðŸš€ Fetching all market data...");const[e,n,s,a,i,r,o,l]=await Promise.allSettled([qs(),Qs(),Zs(),ii(),ai(),ri(),oi(),li()]),c={indices:e.status==="fulfilled"?e.value:[],mutualFunds:n.status==="fulfilled"?n.value:[],ipo:s.status==="fulfilled"?s.value:{upcoming:[],live:[],recent:[]},movers:a.status==="fulfilled"?a.value:{gainers:[],losers:[]},sectorals:i.status==="fulfilled"?i.value:[],commodities:r.status==="fulfilled"?r.value:[],currencies:o.status==="fulfilled"?o.value:[],fiidii:l.status==="fulfilled"?l.value:{fii:{},dii:{},date:""},fetchedAt:Date.now(),errors:{indices:e.status==="rejected"?e.reason?.message:null}};if(c.indices.length>0){try{localStorage.setItem(Ft,JSON.stringify(c)),console.log("[MarketService] âœ… Fresh data cached")}catch(u){console.warn("[MarketService] Cache write failed",u)}return c}console.warn("[MarketService] Critical data (Indices) missing. Checking cache...");try{const u=localStorage.getItem(Ft);if(u){const m=JSON.parse(u),g=Date.now()-(m.fetchedAt||0);if(g<ci)return console.log(`[MarketService] âš ï¸ Returning cached data (${(g/6e4).toFixed(0)} mins old)`),{...m,isStale:!0,staleReason:"Network/Proxy Failure - Showing cached data"};console.warn("[MarketService] Cache expired")}}catch(u){console.error("[MarketService] Cache read failed",u)}console.warn("[MarketService] Cache unavailable/expired. Attempting static snapshot...");const d=await di();return d?(console.log("[MarketService] âœ… Loaded snapshot data"),{...d,isSnapshot:!0,fetchedAt:d.generated_at?new Date(d.generated_at).getTime():Date.now()}):c}const Pn=x.createContext(null),mt="market_cache",hi=900*1e3;function mi({children:e}){const[n,s]=x.useState(null),[a,i]=x.useState(!0),[r,o]=x.useState(null),[l,c]=x.useState(null),d=x.useCallback(async(m=!1)=>{if(!m)try{const g=localStorage.getItem(mt);if(g){const p=JSON.parse(g);if(Date.now()-p.fetchedAt<hi){console.log("[MarketContext] Using cached data"),s(p),i(!1),c(p.fetchedAt);return}}}catch{console.warn("[MarketContext] Cache read failed")}i(!0),o(null);try{const g=await ui();s(g),c(Date.now()),localStorage.setItem(mt,JSON.stringify(g)),console.log("[MarketContext] âœ… Market data loaded")}catch(g){console.error("[MarketContext] âŒ Failed to load market data:",g);try{const p=localStorage.getItem(mt);if(p){const h=JSON.parse(p),w=Date.now()-h.fetchedAt;console.log(`[MarketContext] Using stale cache due to fetch error (Age: ${(w/6e4).toFixed(0)}m)`),s(h),c(h.fetchedAt),w>14400*1e3?o("Network error. Data is expired (>4h)."):o("Network error. Showing cached data.")}else{try{const h=await fetch("/data/market_snapshot.json");if(h.ok){const w=await h.json();if(w&&w.indices&&w.indices.length>0){console.log("[MarketContext] Using static snapshot fallback"),s(w),c(new Date(w.generated_at).getTime()),o("Using offline snapshot (Live data failed)");return}}}catch(h){console.warn("Static fallback failed",h)}o(g.message)}}catch{o(g.message)}}finally{i(!1)}},[]);x.useEffect(()=>{d()},[d]);const u=x.useCallback(()=>d(!0),[d]);return t.jsx(Pn.Provider,{value:{marketData:n,loading:a,error:r,lastFetch:l,refreshMarket:u},children:e})}function zn(){const e=x.useContext(Pn);if(!e)throw new Error("useMarket must be used within MarketProvider");return e}const Hn=({loadingPhase:e})=>{const{marketData:n,loading:s,lastFetch:a}=zn(),i=x.useRef(null),r=x.useRef(!1),o=x.useMemo(()=>{if(!n)return[];const{indices:m=[],commodities:g=[]}=n,p=[...m,...g];return["NIFTY 50","NSE 50","50","SENSEX","BSE SENSEX","Gold","Silver"].map(w=>p.find(v=>v.name===w)).filter(Boolean)},[n]);x.useEffect(()=>{let m,g=0;const p=40;let h=0;const w=S=>{g||(g=S);const f=S-g;if(g=S,i.current&&!r.current){const _=p*f/1e3;if(h+=_,h>=1){const T=Math.floor(h);h-=T;const{scrollLeft:L,scrollWidth:k}=i.current;L>=k/2?i.current.scrollLeft=0:i.current.scrollLeft+=T}}else g=S;m=requestAnimationFrame(w)},v=setTimeout(()=>{m=requestAnimationFrame(w)},1e3);return()=>{cancelAnimationFrame(m),clearTimeout(v)}},[o]);const l=m=>{if(!m.timestamp)return!0;const p=Date.now()-m.timestamp,w=["Gold","Silver","Crude Oil"].includes(m.name)?3600*1e3:900*1e3;return p>w},c=m=>m?new Date(m).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",d=m=>m==="NSE 50"||m==="50"?"NIFTY 50":m==="BSE SENSEX"?"SENSEX":m,u=()=>{if(!e)return{};let m="transparent";return e===1?m="rgba(144, 238, 144, 0.2)":e===2?m="rgba(60, 179, 113, 0.2)":e===3&&(m="rgba(34, 139, 34, 0.2)"),{background:`linear-gradient(to bottom, transparent, ${m})`,transition:"background 0.5s ease"}};return s&&o.length===0||o.length===0?null:t.jsxs("div",{className:"market-ticker-container",style:u(),children:[t.jsx("div",{className:"ticker-label",children:"ðŸ“ˆ"}),t.jsx("div",{className:"ticker-track-wrapper",ref:i,onMouseEnter:()=>r.current=!0,onMouseLeave:()=>r.current=!1,onTouchStart:()=>r.current=!0,onTouchEnd:()=>r.current=!1,children:t.jsx("div",{className:"ticker-track",children:[...o,...o].map((m,g)=>{const p=l(m);return t.jsxs("div",{className:`ticker-item ${p?"stale-data":""}`,children:[t.jsx("span",{className:"ticker-name",children:d(m.name)}),t.jsxs("span",{className:"ticker-price",children:[m.name==="Gold"||m.name==="Silver"?m.value:typeof m.value=="number"?m.value.toFixed(2):m.value,m.unit?t.jsx("span",{style:{fontSize:"0.7em",marginLeft:"2px"},children:m.unit}):""]}),t.jsxs("span",{className:`ticker-change ${parseFloat(m.change)>=0?"positive":"negative"}`,children:[parseFloat(m.change)>=0?"â–²":"â–¼"," ",Math.abs(parseFloat(m.changePercent)).toFixed(2),"%"]})]},`${m.name}-${g}`)})})}),a&&t.jsxs("div",{className:"ticker-updated",children:[t.jsx("span",{style:{marginRight:"4px"},children:"ðŸ•’"})," ",c(a)]})]})},Un=x.createContext();function pi({children:e}){const[n,s]=x.useState(()=>V()),[a,i]=x.useState(0),r=x.useCallback(l=>{We(l),s(l),i(c=>c+1)},[]),o=x.useCallback(()=>{const l=V();s(l),i(c=>c+1)},[]);return x.useEffect(()=>{(async()=>{try{const c=await Fs();if(c){const d=V(),u=c.lastUpdated||0,m=d.lastUpdated||0;if(u>m)console.log("[Settings] Syncing from server (Remote is newer)..."),localStorage.setItem("dailyEventAI_settings",JSON.stringify(c)),o();else if(!d.upAhead?.keywords?.shopping){console.log("[Settings] Patching missing keywords from remote...");const g={...c,...d,upAhead:{...c.upAhead,...d.upAhead}};g.upAhead.keywords||(g.upAhead.keywords=c.upAhead.keywords),localStorage.setItem("dailyEventAI_settings",JSON.stringify(g)),o()}}}catch(c){console.warn("[Settings] Failed to sync with server",c)}})()},[o]),x.useEffect(()=>{const l=c=>{c.key==="dailyEventAI_settings"&&(console.log("[SettingsContext] Storage changed in another tab, reloading"),o())};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[o]),x.useEffect(()=>{n.fontSize&&(document.documentElement.style.fontSize=n.fontSize+"px")},[n.fontSize]),x.useEffect(()=>{document.documentElement.setAttribute("data-theme",n.theme||"dark")},[n.theme]),t.jsx(Un.Provider,{value:{settings:n,updateSettings:r,reloadSettings:o,settingsVersion:a},children:e})}function se(){const e=x.useContext(Un);if(!e)throw new Error("useSettings must be used within SettingsProvider");return e}const gi=()=>{const{settings:e,updateSettings:n}=se(),s=e.theme==="light",a=()=>{n({...e,theme:s?"dark":"light"})};return t.jsx("button",{onClick:a,className:"header__action-btn",title:s?"Switch to Dark Mode":"Switch to Light Mode",style:{background:"transparent",border:"none",cursor:"pointer",padding:"0 8px",color:"var(--text-primary)"},children:s?"ðŸŒ™":"â˜€ï¸"})};function ke({title:e,icon:n,showBack:s=!1,backTo:a="/",actions:i,pills:r,activePill:o,onPillChange:l,compact:c=!1,loadingPhase:d}){const[u,m]=x.useState(window.innerWidth>=1024);x.useEffect(()=>{const p=()=>m(window.innerWidth>=1024);return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const g=p=>p.includes("Morning")?"ðŸŒ…":p.includes("Midday")?"â˜€ï¸":p.includes("Evening")?"ðŸŒ™":p;return t.jsxs("header",{className:`header ${c?"header--compact":""}`,children:[s?t.jsxs(ze,{to:a,className:"header__back",children:[t.jsx("span",{children:"â†"}),t.jsx("span",{children:e})]}):t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[u&&t.jsx(gi,{}),t.jsx("h1",{className:"header__title"})]}),!s&&t.jsx(Hn,{loadingPhase:d}),r&&t.jsx("div",{className:"header__pills",children:r.map(p=>t.jsx("button",{className:`time-pill time-pill--matte ${o===p?"time-pill--active":""}`,onClick:()=>l&&l(p),title:p,children:g(p)},p))}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:i})]})}const $t="https://news.google.com/rss",fi="https://news.google.com/rss/search",Bt={WORLD:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx1YlY4U0JXVnVMVlZUR2dKVlV5Z0FQAQ",BUSINESS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx6TVdZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",TECHNOLOGY:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGRqTVhZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",ENTERTAINMENT:"CAAqJggKIiBDQkFTRWvfSkwyMHZNREpxYW5RU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SPORTS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp1ZEdvU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SCIENCE:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp0Y1RjU0JXVnVMVlZUR2dKVlV5Z0FQAQ",HEALTH:"CAAqJggKIiBDQkFTRWvfSkwyMHZNR3QwTlRFU0JXVnVMVlZUR2dKVlV5Z0FQAQ"};function ye({category:e,query:n,country:s="IN",lang:a="en"}){const i=`${a}-${s}`,r=s,o=`${s}:${a}`,l=`hl=${i}&gl=${r}&ceid=${o}`;if(n)return`${fi}?q=${encodeURIComponent(n)}&${l}`;if(e){const c=e.toUpperCase();if(Bt[c])return`${$t}/topics/${Bt[c]}?${l}`}return`${$t}?${l}`}const Ie={WORLD_IN:ye({category:"world",country:"IN",lang:"en"}),BUSINESS_IN:ye({category:"business",country:"IN",lang:"en"}),BUSINESS_IN_SEARCH:ye({query:"Business Economy India",country:"IN",lang:"en"}),TECH_IN:ye({category:"technology",country:"IN",lang:"en"}),TECH_IN_SEARCH:ye({query:"Technology Startups India",country:"IN",lang:"en"}),TAMIL_NADU:ye({query:"Tamil Nadu",country:"IN",lang:"ta"}),CHENNAI:ye({query:"Chennai",country:"IN",lang:"en"}),WORLD_US:ye({category:"world",country:"US",lang:"en"})},it={tamil:["https://www.thenewsminute.com/tamil-nadu/entertainment/feed","https://www.behindwoods.com/tamil-movies/rss-feeds/news.xml","https://timesofindia.indiatimes.com/rssfeeds/1081479906.cms","https://www.filmibeat.com/rss/filmibeat-tamil-fb.xml"],hindi:["https://www.bollywoodhungama.com/rss/news.xml","https://www.filmfare.com/feeds/bollywood.xml","https://timesofindia.indiatimes.com/rssfeeds/-2128936835.cms"],hollywood:["https://www.hollywoodreporter.com/feed/","https://variety.com/feed/","https://deadline.com/feed/"],ott:["https://www.whats-on-netflix.com/feed/","https://www.cordcuttersnews.com/feed/","https://www.streamingmedia.com/RSS/Articles.aspx"]};function yi(e){const n=["horoscope","rasipalan","zodiac","astrology","prediction","numerology"];return e.filter(s=>{const a=(s.title+" "+s.description).toLowerCase();return!n.some(i=>a.includes(i))})}async function xi(){console.log("[EntertainmentService] Fetching Tamil/Kollywood news...");const e=[];for(const s of it.tamil)try{const a=await Se(s,"entertainment");e.push(...a.map(i=>({...i,category:"Tamil Cinema",region:"tamil"})))}catch(a){console.warn(`[EntertainmentService] Failed to fetch ${s}:`,a.message)}return yi(e).sort((s,a)=>(a.publishedAt||0)-(s.publishedAt||0)).slice(0,20)}async function wi(){console.log("[EntertainmentService] Fetching Hindi/Bollywood news...");const e=[];for(const n of it.hindi)try{const s=await Se(n,"entertainment");e.push(...s.map(a=>({...a,category:"Hindi Cinema",region:"hindi"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function vi(){console.log("[EntertainmentService] Fetching Hollywood news...");const e=[];for(const n of it.hollywood)try{const s=await Se(n,"entertainment");e.push(...s.map(a=>({...a,category:"Hollywood",region:"hollywood"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function bi(){console.log("[EntertainmentService] Fetching OTT/Streaming news...");const e=[];for(const n of it.ott)try{const s=await Se(n,"entertainment");e.push(...s.map(a=>({...a,category:"OTT & Streaming",region:"ott"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function Si(e={}){console.log("[EntertainmentService] ðŸŽ¬ Fetching all entertainment news...");const{tamilPercent:n=40,hindiPercent:s=35,hollywoodPercent:a=15,ottPercent:i=10}=e,[r,o,l,c]=await Promise.allSettled([xi(),wi(),vi(),bi()]),d=r.status==="fulfilled"?r.value:[],u=o.status==="fulfilled"?o.value:[],m=l.status==="fulfilled"?l.value:[],g=c.status==="fulfilled"?c.value:[],p=40,h={tamil:Math.round(p*(n/100)),hindi:Math.round(p*(s/100)),hollywood:Math.round(p*(a/100)),ott:Math.round(p*(i/100))},v=[...d.slice(0,h.tamil),...u.slice(0,h.hindi),...m.slice(0,h.hollywood),...g.slice(0,h.ott)].sort(()=>Math.random()-.5);return console.log("[EntertainmentService] âœ… Entertainment news fetched:",{tamil:h.tamil,hindi:h.hindi,hollywood:h.hollywood,ott:h.ott,total:v.length}),v}const Pt={abandon:-2,accident:-2,alert:-1,ambitious:2,asset:2,active:1,advance:2,agree:1,amazing:4,approve:2,award:3,awesome:4,bad:-3,bailout:-2,beautiful:3,benefit:2,best:3,boost:1,breakthrough:3,bright:1,bull:2,bullish:2,buy:1,calm:2,cancel:-1,care:2,celebrate:3,challenge:-1,champion:2,cheap:-1,clean:2,collapse:-2,climb:1,comfort:2,commit:1,confidence:2,conflict:-2,congrats:2,congratulate:2,cool:1,correct:1,crash:-2,crisis:-3,criticize:-2,danger:-2,dead:-3,debt:-2,decline:-1,defeat:-2,deficit:-2,denied:-2,depression:-2,destroy:-3,devastate:-3,difficult:-1,disaster:-2,disease:-1,dispute:-2,doubt:-1,down:-1,drop:-1,dump:-1,earn:1,earnings:1,ease:2,easy:1,effective:2,efficient:2,emergency:-2,encourage:2,enjoy:2,error:-2,excellent:3,cite:2,expand:1,fail:-2,failure:-2,fake:-3,fall:-1,fantastic:4,fear:-2,fight:-1,fine:2,fraud:-4,free:1,fresh:1,fun:4,gain:2,good:3,great:3,growth:2,happy:3,hard:-1,harm:-2,hate:-3,healthy:2,help:2,hero:2,high:1,hope:2,hurt:-2,ignore:-1,ill:-2,improve:2,increase:1,infect:-2,inflation:-2,injury:-2,innovate:1,innovative:2,inspire:2,intelligent:2,invest:1,joke:2,joy:3,jump:1,kill:-3,lack:-2,lag:-1,lead:1,leader:1,legal:1,lie:-2,like:2,loss:-3,love:3,low:-1,luck:3,lucky:3,market:1,merger:2,miss:-1,mistake:-2,murder:-3,negative:-2,nice:3,outperform:2,outstanding:5,panic:-3,perfect:3,plunge:-2,poor:-2,positive:2,praise:3,problem:-2,profit:2,progress:2,promise:1,proud:2,protect:1,rally:2,recession:-2,record:2,recover:1,reject:-1,reliable:2,relief:1,rescue:2,resolve:2,restore:1,reward:2,rich:2,risk:-2,safe:1,save:2,scandal:-3,scare:-2,secure:2,sell:-1,shares:1,shortage:-2,sick:-2,significant:1,smart:1,smile:2,solid:2,solve:1,spark:1,stable:2,stock:1,stop:-1,strength:2,strong:2,success:2,suffer:-2,surge:1,surprise:2,sweet:2,tech:1,terrible:-3,terrified:-3,threat:-2,top:2,tough:-1,tragedy:-2,trouble:-2,trust:1,ugly:-3,uncertain:-1,unemployment:-2,unfair:-2,up:1,upset:-2,urgent:-1,useful:2,value:1,victory:3,violation:-2,violence:-3,volatile:-1,vulnerable:-2,weak:-2,wealth:3,win:4,winner:4,wonderful:4,worry:-3,worst:-3,wow:4,wrong:-2,yes:1},ji=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>0),zt=e=>{if(!e||e.trim().length===0)return{score:0,comparative:0,label:"neutral"};const n=ji(e);let s=0;n.forEach(r=>{Pt[r]&&(s+=Pt[r])});const a=n.length>0?s/n.length:0;let i="neutral";return a>.05?i="positive":a<-.05&&(i="negative"),{score:s,comparative:a,label:i}},Ni=(e,n)=>{const s=zt(e),a=zt(n),i=s.comparative*.6+a.comparative*.4;let r="neutral";return i>.05?r="positive":i<-.05&&(r="negative"),{label:r,comparative:i,titleSentiment:s,descriptionSentiment:a}};var _i=Is();const ki=ks(_i),Ci=(e,n=.75)=>{if(!e||e.length===0)return[];const s=[],a=new Set;for(let i=0;i<e.length;i++){if(a.has(i))continue;const r=[e[i]];a.add(i);for(let o=i+1;o<e.length;o++){if(a.has(o))continue;ki.compareTwoStrings(e[i].title.toLowerCase(),e[o].title.toLowerCase())>n&&(r.push(e[o]),a.add(o))}s.push(r)}return s},Ei=e=>{if(!e||e.length===0)return null;const s=[...e].sort((o,l)=>l.impactScore-o.impactScore)[0],a=[...new Set(e.map(o=>o.source))],i=a.length,r=1+(i-1)*.1;return{...s,sourceCount:i,allSources:a,clusteredItems:e.length,impactScore:s.impactScore*r,clusterRepresentative:!0}},Ti=(e,n=.75)=>{const s=new Set,a=[];for(const o of e)!o.id||s.has(o.id)||(s.add(o.id),a.push(o));return Ci(a,n).map(Ei).filter(o=>o!==null)};function Ai(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}class Ii{constructor(){this.newsMap=new Map,this.breaking=new Set}checkBreakingNews(n,s=Date.now()){if(!n||!n.title||!n.publishedAt)return{isBreaking:!1,breakingScore:0,multiplier:1};const a=Ai(n.title),i=(s-n.publishedAt)/1e3/60;let r=!1,o=0;for(const[l,c]of this.newsMap.entries())if(this.calculateSimilarity(a,l)>.7){(s-c.firstSeen)/1e3/60<60&&!c.sources.has(n.source)&&(c.sources.add(n.source),c.count++),c.count>=2&&i<60&&(r=!0,o=Math.log(60/Math.max(1,i))||1,o=Math.min(o,3),this.breaking.add(a));break}return this.newsMap.has(a)||this.newsMap.set(a,{firstSeen:n.publishedAt,sources:new Set([n.source]),count:1,title:n.title}),{isBreaking:r,breakingScore:o,multiplier:r?o:1}}calculateSimilarity(n,s){const a=new Set(n.split(/\s+/)),i=new Set(s.split(/\s+/)),r=[...a].filter(l=>i.has(l)).length,o=new Set([...a,...i]).size;return r/Math.max(o,1)}cleanup(n=120){const s=Date.now(),a=[];for(const[i,r]of this.newsMap.entries())(s-r.firstSeen)/1e3/60>n&&a.push(i);return a.forEach(i=>{this.newsMap.delete(i),this.breaking.delete(i)}),a.length}getBreakingStories(){const n=[];for(const[s,a]of this.newsMap.entries())a.count>=2&&n.push({title:a.title,sourceCount:a.count,sources:[...a.sources],firstSeen:a.firstSeen});return n}}const Mi=new Ii,Oe={bbc:{name:"BBC",credibility:2,staffSize:5500,bureaus:50,avgArticleLength:800,updateFrequency:"continuous",weight:1.8,categories:["world","business","technology","entertainment"]},reuters:{name:"Reuters",credibility:1.95,staffSize:2500,bureaus:200,avgArticleLength:600,updateFrequency:"continuous",weight:1.8,categories:["world","business"]},apnews:{name:"AP News",credibility:1.9,staffSize:2500,bureaus:250,avgArticleLength:500,updateFrequency:"continuous",weight:1.75,categories:["world","business","sports"]},aljazeera:{name:"Al Jazeera",credibility:1.7,staffSize:2e3,bureaus:60,avgArticleLength:900,updateFrequency:"hourly",weight:1.6,categories:["world","business"]},cnn:{name:"CNN",credibility:1.6,staffSize:3e3,bureaus:40,avgArticleLength:400,updateFrequency:"continuous",weight:1.5,categories:["world","business","technology"]},ndtv:{name:"NDTV",credibility:1.75,staffSize:1200,bureaus:15,avgArticleLength:600,updateFrequency:"continuous",weight:1.6,categories:["india","business","technology"]},thehindu:{name:"The Hindu",credibility:1.8,staffSize:800,bureaus:12,avgArticleLength:800,updateFrequency:"hourly",weight:1.65,categories:["india","world","business","technology"]},toi:{name:"Times of India",credibility:1.6,staffSize:1500,bureaus:25,avgArticleLength:500,updateFrequency:"continuous",weight:1.5,categories:["india","entertainment","sports"]},financialexpress:{name:"Financial Express",credibility:1.65,staffSize:300,bureaus:5,avgArticleLength:700,updateFrequency:"hourly",weight:1.55,categories:["business","technology"]},indianexpress:{name:"Indian Express",credibility:1.7,staffSize:400,bureaus:8,avgArticleLength:750,updateFrequency:"hourly",weight:1.6,categories:["india","world","business"]},techcrunch:{name:"TechCrunch",credibility:1.7,staffSize:200,bureaus:3,avgArticleLength:600,updateFrequency:"hourly",weight:1.6,categories:["technology"],specialization:"startups, VC"},theverge:{name:"The Verge",credibility:1.65,staffSize:100,bureaus:1,avgArticleLength:900,updateFrequency:"hourly",weight:1.55,categories:["technology"],specialization:"gadgets, consumer tech"},espn:{name:"ESPN",credibility:1.7,staffSize:500,bureaus:10,avgArticleLength:500,updateFrequency:"continuous",weight:1.6,categories:["sports"]},bollywoodhungama:{name:"Bollywood Hungama",credibility:1.4,staffSize:100,bureaus:2,avgArticleLength:400,updateFrequency:"hourly",weight:1.3,categories:["entertainment"],specialization:"Indian cinema"},googlenews:{name:"Google News",credibility:1.5,staffSize:0,bureaus:0,avgArticleLength:0,updateFrequency:"continuous",weight:1,categories:["world","india","business","technology","entertainment","sports"]},default:{name:"Default Source",credibility:1,staffSize:50,bureaus:1,avgArticleLength:400,updateFrequency:"daily",weight:.9,categories:[]}},Ri=e=>{const n=Object.keys(Oe).find(c=>e.toLowerCase().replace(/\s+/g,"").includes(c))||"default",s=Oe[n],a=s.credibility/2*.4,r=Math.min(s.staffSize/5500,1)*.3,l=Math.min(s.bureaus/250,1)*.3;return a+r+l},Di=(e,n)=>{const s=Object.keys(Oe).find(i=>e.toLowerCase().replace(/\s+/g,"").includes(i))||"default",a=Oe[s];return!a.categories||a.categories.includes(n)?a.weight:a.weight*.7};function Li(e,n,s){const a=`${e} ${n}`.toLowerCase();let i=1;/\b(world|international|global|planet|earth|un|united nations)\b/.test(a)?i=1.5:/\b(india|country|nation|nationwide|federal|central govt|modi|parliament)\b/.test(a)?i=1.3:/\b(state|tamil nadu|kerala|karnataka|region|district)\b/.test(a)&&(i=1.1);let r=1;/\b(billions?|trillions?)\b/.test(a)?r=1.5:/\b(millions?|lakhs?|crores?)\b/.test(a)?r=1.3:/\b(thousands?|hundreds of thousands?)\b/.test(a)&&(r=1.1);let o=1;return s&&s.highImpactKeywords&&Array.isArray(s.highImpactKeywords)&&s.highImpactKeywords.some(c=>c?new RegExp(`\\b${c.toLowerCase()}\\b`,"i").test(a):!1)&&(o=s.rankingWeights?.impact?.highImpactBoost||2.5),i*r*o}const Oi={chennai:{lat:13.0827,lon:80.2707,boost:2},trichy:{lat:10.7905,lon:78.7047,boost:1.8},"tamil nadu":{lat:11.1271,lon:78.6569,boost:1.6},muscat:{lat:23.588,lon:58.3829,boost:1.5},india:{lat:20.5937,lon:78.9629,boost:1.3}};function Fi(e,n){const s=V();if(s.enableProximityScoring===!1)return 1;const a=`${e} ${n}`.toLowerCase();let i=1;const r=s.rankingWeights?.geo?.cityMatch||1.5,o=s.rankingWeights?.geo?.maxScore||5;for(const[l,c]of Object.entries(Oi))a.includes(l.toLowerCase())&&c.boost>i&&(i=c.boost);if(s.weather?.cities)for(const l of s.weather.cities)a.includes(l.toLowerCase())&&r>i&&(i=r);return Math.min(i,o)}const Ht=new Map;function $i(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>3)}function Bi(e,n,s){const a=`${e} ${n}`,i=$i(a);if(i.length===0)return 1;let r=0;i.forEach(c=>{const d=Ht.get(c)||{count:0};d.count<2&&r++,Ht.set(c,{count:d.count+1,lastSeen:Date.now()})});const o=r/i.length;return 1+Math.min(o*.5,.5)}function Pi(e,n=[]){const a=V().followedTopics||[];if(a.length===0)return 1;const i=e.toLowerCase();return a.some(o=>{const l=typeof o=="string"?o:o.name;if(!l)return!1;const c=l.toLowerCase();return i.includes(c)||n&&n.some(d=>d.toLowerCase().includes(c))})?1.5:1}const zi=["hero","rescue","miracle","triumph","tragedy","survival","family","child","mother","father","couple","wedding","journey","struggle","overcome","inspire","brave","courage","heartbreak","reunion","loss","hope","dream","volunteer","charity","donation","help","saved","lifeline","community","spirit","kindness"];function Hi(e,n){const s=`${e} ${n}`.toLowerCase();let a=0;zi.forEach(r=>{s.includes(r.toLowerCase())&&a++});const i=1+a*.2;return Math.min(i,2)}function Ui(e,n=null){if(!e)return 1;const s=n?.rankingWeights?.visual?.videoBoost||1.3,a=n?.rankingWeights?.visual?.imageBoost||1.15;return/youtube|vimeo|video|youtu\.be/i.test(e)?s:/\.(jpg|jpeg|png|gif|webp|svg)/i.test(e)||/images|img|photo|static/i.test(e)?a:Math.min(a,1.1)}const Ut={world:["UN","NATO","United Nations","international","embassy","foreign","global","war","peace talks","summit","G7","G20","EU","European Union","Middle East","Ukraine","Russia","Gaza","Israel","Palestine","Hamas","Hezbollah","Iran","China","USA","UK","Biden","Trump","Putin","Zelenskyy","Netanyahu","diplomacy","geopolitical","sanctions","treaty","United States","Britain","France","Germany","Australia","Canada","Japan","South Korea","North Korea"],india:["Delhi","New Delhi","Modi","BJP","Congress","Parliament","Supreme Court","India","Indian","Lok Sabha","Rajya Sabha","PM","President","RBI","central government","nationwide","union minister","Amit Shah","Rahul Gandhi","AAP","Kejriwal","Mamata Banerjee","Trinamool","CPM","Elections","ECI","Election Commission","CBI","ED","Enforcement Directorate","UPSC","NEET","census","aadhaar","pan card","railways","vande bharat","isro","chandrayaan","aditya-l1","gaganyaan","defence","army","navy","air force"],chennai:["Chennai","Madras","Marina Beach","TN Assembly","MTC","CMDA","Anna University","Kauvery Hospital","Apollo Chennai","Tambaram","Egmore","T Nagar","Adyar","Velachery","Guindy","Mylapore","Triplicane","Chromepet","Pallavaram","OMR","ECR","Old Mahabalipuram Road","East Coast Road","Koyambedu","Anna Nagar","Besant Nagar","Thiruvanmiyur","IIT Madras","Loyola College","Presidency College","Ripon Building","Greater Chennai Corporation","GCC","Chennai Metro","CMRL","Central Station","Egmore Station","Meenambakkam","Chennai Airport","Nungambakkam","Kodambakkam"],trichy:["Trichy","Tiruchirappalli","Srirangam","BHEL Trichy","NIT Trichy","Rock Fort","Kaveri","Cauvery","Thanjavur","Delta districts","Samayapuram","Manapparai","Thiruverumbur","Lalgudi","Musiri","Thuraiyur","Pudukkottai","Karur","Perambalur","Ariyalur","Kallanai","Mukkombu","Butterfly Park","Tiruchirapalli"],business:["stock","market","economy","GDP","inflation","RBI","Sensex","Nifty","shares","BSE","NSE","earnings","revenue","profit","loss","IPO","merger","acquisition","startup","funding","investment","corporate","CEO","CFO","bank","finance","fiscal","monetary","repo rate","tax","GST","income tax","customs","export","import","trade","rupee","dollar","gold","silver","oil","crude","brent","crypto","bitcoin","ethereum","blockchain","mutual fund","SIP","dividend","quarterly results","Adani","Ambani","Tata","Reliance","Infosys","TCS","Wipro","HDFC","ICICI","SBI"],technology:["AI","tech","technology","Google","Apple","Microsoft","software","hardware","cyber","crypto","blockchain","iPhone","Android","app","cloud","data","algorithm","machine learning","artificial intelligence","ChatGPT","OpenAI","Gemini","LLM","neural network","robotics","automation","5G","6G","telecom","semiconductor","chip","processor","Intel","AMD","Nvidia","Samsung","OnePlus","Xiaomi","cybersecurity","hacker","malware","ransomware","virus","SpaceX","NASA","satellite","rocket","drone","electric vehicle","EV","Tesla","Elon Musk","Mark Zuckerberg","Sundar Pichai","Satya Nadella","Tim Cook"],entertainment:["film","movie","actor","actress","director","box office","OTT","Netflix","Amazon Prime","Disney+","cinema","theatre","Kollywood","Bollywood","Hollywood","music","album","concert","award","Oscar","Emmy","Grammy","celebrity","release","trailer","teaser","review","blockbuster","star","superstar","hero","heroine","villain","script","screenplay","cinematography","Rajinikanth","Kamal Haasan","Vijay","Ajith","Suriya","Dhanush","Vikram","Nayanthara","Trisha","Anirudh","AR Rahman","Shah Rukh Khan","Salman Khan","Aamir Khan","Deepika Padukone","Alia Bhatt","Ranbir Kapoor","Karan Johar","Tollywood","Mollywood"],sports:["cricket","football","IPL","Olympics","match","championship","FIFA","World Cup","player","coach","team","goal","wicket","run","tennis","badminton","hockey","trophy","medal","CSK","MI","RCB","stadium","tournament","league","series","test match","ODI","T20","century","half-century","hat-trick","penalty","corner","free kick","grand slam","Wimbledon","US Open","French Open","Australian Open","F1","Formula 1","racing","driver","athlete","gold medal","silver medal","bronze medal","BCCI","ICC","Virat Kohli","Rohit Sharma","Dhoni","MS Dhoni","Messi","Ronaldo","Neymar","Mbappe"]},Wn={"Narendra Modi":"india","Rahul Gandhi":"india","Amit Shah":"india","Arvind Kejriwal":"india","Mamata Banerjee":"india","Droupadi Murmu":"india","Jagdeep Dhankhar":"india","Nirmala Sitharaman":"india","S. Jaishankar":"india","Rajnath Singh":"india","Nitin Gadkari":"india","Mallikarjun Kharge":"india","MK Stalin":"chennai","Edappadi Palaniswami":"chennai","K. Annamalai":"chennai",Annamalai:"chennai","Udhayanidhi Stalin":"chennai","Thol. Thirumavalavan":"chennai",Seeman:"chennai","Kamal Haasan":"entertainment",Rajinikanth:"entertainment",Vijay:"entertainment","Thalapathy Vijay":"entertainment","Ajith Kumar":"entertainment",Suriya:"entertainment","Shah Rukh Khan":"entertainment","Salman Khan":"entertainment","Alia Bhatt":"entertainment","Deepika Padukone":"entertainment","Taylor Swift":"entertainment",Beyonce:"entertainment","Chennai Super Kings":"sports",CSK:"sports","Mumbai Indians":"sports","Royal Challengers Bangalore":"sports",RCB:"sports","Indian Cricket Team":"sports","Virat Kohli":"sports","MS Dhoni":"sports","Rohit Sharma":"sports","Ravindra Jadeja":"sports","R Ashwin":"sports","Jasprit Bumrah":"sports","Lionel Messi":"sports","Cristiano Ronaldo":"sports","Novak Djokovic":"sports","Rafael Nadal":"sports","Carlos Alcaraz":"sports","PV Sindhu":"sports","Neeraj Chopra":"sports","R Praggnanandhaa":"sports","D Gukesh":"sports",OpenAI:"technology",Tesla:"technology",SpaceX:"technology",Nvidia:"technology","Sam Altman":"technology","Mark Zuckerberg":"technology","Sundar Pichai":"technology","Satya Nadella":"technology","Tim Cook":"technology","Gautam Adani":"business","Mukesh Ambani":"business","Ratan Tata":"business","N Chandrasekaran":"business","Uday Kotak":"business","Nifty 50":"business",Sensex:"business"};function Wi(e,n,s=""){const a=`${e} ${n}`.toLowerCase();for(const[c,d]of Object.entries(Wn)){const u=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${u}\\b`,"i").test(a))return d}const i={};Object.keys(Ut).forEach(c=>i[c]=0);for(const[c,d]of Object.entries(Ut))d.forEach(u=>{const m=u.toLowerCase(),g=["star","hero","mass","play","act","cast","plot","vijay","ajith","suriya","vikram","release"];m.length<=3||g.includes(m)?new RegExp(`\\b${m}\\b`,"i").test(a)&&i[c]++:a.includes(m)&&i[c]++});const o=Object.keys(i).sort((c,d)=>i[d]-i[c])[0];return i[o]>=2?o:null}const Gi=300,te={entries:[],subscribers:new Set,stats:{totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}}};function Wt(){te.subscribers.forEach(e=>e())}function Ki(e){te.stats.byService[e]||(te.stats.byService[e]={ok:0,fail:0,totalMs:0,lastStatus:null,lastTime:null})}const he={add(e,n,s,a={}){const i={ts:Date.now(),level:e,service:n,message:s,...a};te.entries.push(i),te.entries.length>Gi&&te.entries.shift(),te.stats.totalFetches++,Ki(n);const r=te.stats.byService[n];e==="error"?(te.stats.failures++,r.fail++,r.lastStatus="fail"):(te.stats.successes++,r.ok++,r.lastStatus="ok"),a.durationMs&&(te.stats.totalMs+=a.durationMs,r.totalMs+=a.durationMs),r.lastTime=Date.now(),Wt()},info(e,n,s){this.add("info",e,n,s)},warn(e,n,s){this.add("warn",e,n,s)},error(e,n,s){this.add("error",e,n,s)},success(e,n,s){this.add("success",e,n,s)},getEntries(){return te.entries},getStats(){return te.stats},subscribe(e){return te.subscribers.add(e),()=>te.subscribers.delete(e)},clear(){te.entries.length=0,te.stats={totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}},Wt()}},pt=[{name:"rss2json",url:"https://api.rss2json.com/v1/api.json",format:e=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(n.status==="ok")return{title:n.feed?.title,items:n.items||[]};throw new Error("rss2json status not ok")}},{name:"codetabs",url:"https://api.codetabs.com/v1/proxy",format:e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.text();if(!n)throw new Error("Empty response from codetabs");return Gt(n)}},{name:"allorigins",url:"https://api.allorigins.win/get",format:e=>`https://api.allorigins.win/get?url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(!n.contents)throw new Error("No content from allorigins");return Gt(n.contents)}}];function Gt(e){const s=new DOMParser().parseFromString(e,"text/xml");if(s.getElementsByTagName("parsererror").length>0)throw new Error("XML Parsing Error");const a=s.querySelector("channel > title")?.textContent||"Unknown Source",i=Array.from(s.querySelectorAll("item")).map(r=>{const o=r.querySelector("title")?.textContent,l=r.querySelector("link")?.textContent,c=r.querySelector("pubDate")?.textContent,d=r.querySelector("description")?.textContent,u=r.querySelector("guid")?.textContent,m=r.querySelector("author")?.textContent||r.querySelector("dc\\:creator")?.textContent,g=r.querySelector("enclosure"),p=g?{url:g.getAttribute("url"),type:g.getAttribute("type")}:null,h=r.querySelector("media\\:content")||r.querySelector("content"),w=h?{url:h.getAttribute("url")}:null,v=r.querySelector("media\\:thumbnail")||r.querySelector("thumbnail"),S=v?v.getAttribute("url"):null;return{title:o,link:l,pubDate:c,description:d,guid:u,author:m,enclosure:p,"media:content":w,thumbnail:S}});return{title:a,items:i}}class Vi{constructor(){this.currentIndex=0,this.failureCounts=new Map,this.lastSuccess=new Map}async fetchViaProxy(n){const s=pt.length;let a=null;for(let i=0;i<s;i++){const r=(this.currentIndex+i)%s,o=pt[r];try{const l=o.format(n),c=new AbortController,d=setTimeout(()=>c.abort(),8e3);let u;try{u=await fetch(l,{signal:c.signal})}finally{clearTimeout(d)}if(!u.ok)throw new Error(`HTTP ${u.status}`);const m=await o.parse(u);if(!m||!m.items||m.items.length===0)throw new Error("No items returned");return this.failureCounts.set(o.name,0),this.lastSuccess.set(o.name,Date.now()),this.currentIndex=r,he.info("proxy",`${o.name} OK (${m.items.length} items)`),m}catch(l){console.warn(`[ProxyManager] ${o.name} failed for ${n}:`,l.message),a=l;const c=(this.failureCounts.get(o.name)||0)+1;this.failureCounts.set(o.name,c)}}throw he.error("proxy",`All proxies failed: ${a?.message}`),new Error(`All proxies failed. Last error: ${a?.message}`)}getProxyHealth(){return pt.map(n=>({name:n.name,failures:this.failureCounts.get(n.name)||0,lastSuccess:this.lastSuccess.get(n.name)||null}))}}const Gn=new Vi,vt="news_section_health",Kt=3;function Vt(e,n){if(e)try{const s=localStorage.getItem(vt),a=s?JSON.parse(s):{},i=a[e]||[];i.unshift(n),i.length>Kt&&(i.length=Kt),a[e]=i,localStorage.setItem(vt,JSON.stringify(a))}catch(s){console.warn("[SectionHealth] Failed to record fetch count:",s)}}function qi(e,n){try{const s=localStorage.getItem(vt),i=(s?JSON.parse(s):{})[e]||[];if(i.length===0)return{status:"ok",ratio:1,avg:n,history:[]};const o=i.reduce((d,u)=>d+u,0)/i.length;if(o===0)return{status:"ok",ratio:1,avg:0,history:i};const l=n/o;let c="ok";return l<.1?c="critical":l<.5&&(c="warning"),{status:c,ratio:l,avg:o,history:i}}catch(s){return console.warn("[SectionHealth] Failed to compute health:",s),{status:"ok",ratio:1,avg:0,history:[]}}}function Yi(e){if(!e||e.length<=3)return!1;const n=e[0].source;return e.every(s=>s.source===n)}const Ji={world:[Ie.WORLD_IN,"https://feeds.bbci.co.uk/news/rss.xml","https://feeds.bbci.co.uk/news/world/rss.xml","https://www.aljazeera.com/xml/rss/all.xml",Ie.WORLD_US],india:[Ie.TAMIL_NADU,"https://feeds.feedburner.com/ndtvnews-top-stories","https://www.thehindu.com/news/national/feeder/default.rss","https://timesofindia.indiatimes.com/rssfeedstopstories.cms"],chennai:[Ie.CHENNAI,"https://www.thehindu.com/news/cities/chennai/feeder/default.rss"],trichy:["https://www.thehindu.com/news/cities/Tiruchirapalli/feeder/default.rss"],local:["https://news.google.com/rss/search?q=Muscat+Oman&hl=en-OM&gl=OM&ceid=OM:en","https://www.muscatdaily.com/feed"],business:[Ie.BUSINESS_IN_SEARCH,"https://economictimes.indiatimes.com/rssfeedstopstories.cms","https://www.moneycontrol.com/rss/business.xml","https://www.livemint.com/rss/money","https://feeds.bbci.co.uk/news/business/rss.xml","https://www.cnbc.com/id/10001147/device/rss/rss.html"],technology:[Ie.TECH_IN_SEARCH,"https://gadgets360.com/rss/news","https://techcrunch.com/feed/","https://www.theverge.com/rss/index.xml"],sports:["https://www.espn.com/espn/rss/news"],entertainment:["https://www.bollywoodhungama.com/rss/news.xml","https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml","https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/telugu-cinema/rssfeed.xml","https://www.pinkvilla.com/rss/feed/entertainment"],social:["https://www.theverge.com/rss/index.xml"]},Xi={bbc:"BBC",ndtv:"NDTV",theHindu:"The Hindu",toi:"Times of India",financialExpress:"Financial Express",dtNext:"DT Next",omanObserver:"Oman Observer",moneyControl:"Moneycontrol",indiaToday:"India Today",variety:"Variety",hollywoodReporter:"Hollywood Reporter",bollywoodHungama:"Bollywood Hungama",alJazeera:"Al Jazeera"},Qi=["breaking","election","war","crisis","ai","market","inflation","conflict","gold","storm","rain"],Zi=new RegExp(Qi.join("|"),"i"),ea=300*1e3,nt=new Map;function Kn(e,n){if(!e&&!n)return!1;const s=(e||"")+" "+(n||"");return Zi.test(s)}function qt(e,n){if(!e||!n||n.length===0)return 0;const s=e.toLowerCase();let a=0;return n.forEach(i=>{i&&s.includes(i.toLowerCase())&&a++}),a}function gt(e){return e?e.replace(/<[^>]*>?/gm,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim():""}function ta(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function na(e){if(!e)return"Unknown";if(e.includes(" - Google News"))return"Google News";const n=Object.keys(Oe).find(s=>s!=="default"&&e.toLowerCase().includes(s.toLowerCase()));return n?Oe[n].name:e}function sa(e,n,s){if(!n)return null;const a=n.match(/(?:["â€œ])([^"â€]{30,150})(?:["â€])/);if(a&&a[1]){let i=a[1].trim();if(i.length>0)return`"${i}"`}return null}function _t(e,n,s=0,a=null){const i=a||V(),r=i.rankingWeights||{},o=(Date.now()-e.publishedAt)/(1e3*60*60),l=r.freshness?.maxBoost||3;let c;if(i.rankingMode==="smart")c=l/(1+Math.exp(.5*(o-12)));else{const H=r.freshness?.decayHours||26;c=Math.max(0,(H-o)/H)*l}const d=Ri(e.source),u=Di(e.source,n),m=r.source?.tier1Boost||.5,g=d*u,p=r.keyword?.matchBoost||2,h=Kn(e.title,e.description)?p:0,w=n==="world"?1.5:n==="business"?1.2:1;let v=0;e.sentiment&&(e.sentiment.label==="positive"?v=r.sentiment?.positiveBoost||.5:e.sentiment.label==="negative"&&(v=r.sentiment?.negativeBoost||.3));const f=/\b(live|updates|ongoing|developing)\b/i.test(e.title)?1.5:1,_=Mi.checkBreakingNews(e);e.isBreaking=_.isBreaking,e.breakingScore=_.breakingScore;const T=_.multiplier;if(i.enableNewScoring===!1)return(c+g+h+v)*w*T*f;const L=Li(e.title,e.description,i),k=Fi(e.title,e.description),O=Bi(e.title,e.description),M=Pi(e.title,null),F=Hi(e.title,e.description),D=Ui(e.imageUrl,i),W=c+h+v,j=1+d*u*m,C=W*j,B=L*k*O*M*F*D;let z=0,A=1;const y=i.buzz?.[n];if(y&&y.enabled){const H=e.title+" "+e.description,K=qt(H,y.positiveKeywords),q=qt(H,y.negativeKeywords),X=K*(y.positiveMultiplier||1),ie=q*(y.negativeMultiplier||1),ce=X-ie;ce<(y.filterThreshold||0)?A=.01:z=ce*2}let b=1;const P=new Date().getDay(),N=P===0||P===6||P===5;if(["entertainment","social","movies"].includes(n)||e.section==="entertainment"){const H=i.rankingWeights?.temporal?.entertainmentBoost||2.5;b*=H}if(N&&["entertainment","social","local","chennai","trichy","events"].includes(n)){const H=i.rankingWeights?.temporal?.weekendBoost||2;b*=H}const E=r.viewedPenalty||.4;let R=1;s>0&&(R=E,s>3&&(R=E/2));const $=(C+z)*B*b*w*T*f*R*A;return(i.debugLogs||a)&&(e._scoreBreakdown={freshness:c,sourceScore:d,categoryWeight:u,keywordBoost:h,sentimentBoost:v,impact:L,proximity:k,novelty:O,currency:M,visual:D,sectionPriority:w,breakingBoost:T,seenPenalty:R,total:$}),$}function ia(e,n){let s=null;for(const[a,i]of Object.entries(Xi))if(e.includes(i)||i.includes(e)){s=a;break}return s?n[s]!==!1:!0}async function bt(e,n=10,s=null){const a=Date.now();if(n===0)return[];const i=e;let r=[];const o=V();if(o.enableCache!==!1){const d=nt.get(i);if(d&&Date.now()-d.timestamp<ea){const u=Math.round((Date.now()-d.timestamp)/1e3);return console.log(`[RSS] âœ… Cache HIT for ${e} (age: ${u}s)`),Yt(d.data,e,n,s)}console.log(`[RSS] âš ï¸ Cache MISS for ${e} - Fetching fresh data`)}else console.log(`[RSS] â„¹ï¸ Cache DISABLED by user settings for ${e}`);if(e==="entertainment"){console.log("[RSS] Using entertainmentService for entertainment section");try{const u=V()?.entertainment||{},m=await Si(u);return console.log(`[RSS] Entertainment: Got ${m.length} articles with distribution`),m.slice(0,n)}catch(d){console.error("[RSS] Entertainment service failed:",d)}}const c=Ji[e]||[];if(c.length===0)return console.warn(`[RSS] No feeds defined for section: ${e}`),[];try{console.log(`[RSS] Feeds for ${e}:`,c);const d=await Promise.allSettled(c.map(p=>Se(p,e))),u=[],m=[];d.forEach((p,h)=>{p.status==="fulfilled"&&p.value?(u.push(p.value),console.log(`[RSS] âœ… Feed ${h+1}/${c.length} succeeded`)):(m.push(c[h]),console.warn(`[RSS] âš ï¸ Feed ${h+1}/${c.length} failed: ${p.reason?.message||"Unknown error"}`))}),m.length>0&&u.length>0&&(console.log(`[RSS] Retrying ${m.length} failed feed(s) for ${e}...`),await new Promise(h=>setTimeout(h,2e3)),(await Promise.allSettled(m.map(h=>Se(h,e)))).forEach((h,w)=>{h.status==="fulfilled"&&h.value?(u.push(h.value),console.log(`[RSS] âœ… Retry succeeded: ${m[w]}`)):console.error(`[RSS] âŒ Retry also failed: ${m[w]}`)})),r=u.flat();const g=Date.now()-a;console.log(`[RSS] Section '${e}' stats:`,{totalFeeds:c.length,successCount:u.length,failureCount:c.length-u.length,totalItems:r.length}),he.success("rss",`${e}: ${r.length} items from ${u.length}/${c.length} feeds`,{durationMs:g}),o.enableCache!==!1&&(nt.set(i,{timestamp:Date.now(),data:r}),console.log(`[RSS] ðŸ’¾ Cached ${r.length} items for ${e}`))}catch(d){return console.error(`[RSS] Unexpected error fetching section ${e}:`,{errorMessage:d.message,errorStack:d.stack,section:e}),he.error("rss",`${e}: ${d.message}`,{durationMs:Date.now()-a}),r.length>0?r:[]}try{let d=null;if(e==="social"){const g=V();g.buzzRankingWeights&&(d={...g,rankingWeights:{...g.rankingWeights,...g.buzzRankingWeights}})}const u=await Yt(r,e,n,s,d);u.forEach(g=>{g.sourceCount||(g.sourceCount=1)});const m=qi(e,u.length);return Vt(e,u.length),u.health=m,u.isSingleSource=Yi(u),u}catch(d){console.error(`[RSS] Ranking failed for ${e}:`,d);const u=r.slice(0,n);return Vt(e,u.length),u}}async function Se(e,n){const{title:s,items:a}=await Gn.fetchViaProxy(e);return a.map(i=>aa(i,s,n))}function aa(e,n,s="general"){const a=e.pubDate||e.created||new Date().toISOString(),i=Date.parse(a)||Date.now();let r=n;e.author&&(r=e.author),r=na(r);const o=ta(e.link||e.guid||e.title),l=e.description||"",d=Wi(e.title||"",l||"",r)||s;let u=null;if(e.enclosure&&e.enclosure.url)u=e.enclosure.url;else if(e.thumbnail)u=e.thumbnail;else if(e["media:content"]&&e["media:content"].url)u=e["media:content"].url;else if(l.includes("<img")){const p=l.match(/<img[^>]+src="([^">]+)"/);p&&(u=p[1])}u&&!u.startsWith("http")&&(u=null);const m=["business","market"].includes(s)||/\b(stock|market|shares|trading|sensex|nifty|bank|economy|crypto|ipo|revenue|profit)\b/i.test(e.title+l);let g=null;return m&&(g=Ni(e.title,gt(l))),{id:o,title:e.title,headline:e.title,description:l,summary:gt(l),link:e.link,url:e.link,source:r,publishedAt:i,fetchedAt:Date.now(),time:new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),impactScore:0,section:d,criticsView:sa(e.title,gt(l)),sentiment:g?{label:g.label,comparative:g.comparative,titleSentiment:g.titleSentiment,descriptionSentiment:g.descriptionSentiment}:null,imageUrl:u}}async function Yt(e,n,s,a,i=null){try{const r=new Set,o=Date.now(),l=i||V(),c=l.hideOlderThanHours||l.freshnessLimitHours||60,d=c*60*60*1e3,u=l.strictFreshness===!1,m=l.rankingMode!=="legacy";console.log(`[RSSDebug] filtering for ${n}: Limit=${c}h. Items=${e.length}`);const g=l.feedBlockedKeywords||[],p=e.filter(w=>{if(g.length>0){const f=(w.title+" "+w.description).toLowerCase();if(g.some(_=>f.includes(_.toLowerCase())))return!1}const S=/\b(live|updates)\b/i.test(w.title)?d*3:d;if(!u&&o-w.publishedAt>S)return!1;if(l.filteringMode==="keyword"){if(!Kn(w.title,w.description))return!1}else if(l.topWebsitesOnly){if(!["BBC","Reuters","NDTV","The Hindu","Times of India","Moneycontrol"].some(_=>w.source.includes(_)))return!1}else if(a&&!ia(w.source,a))return!1;return!0}).map(w=>{const v=w.section||n,S=$n(w.id),f=m?_t(w,v,S,l):0;return{...w,section:v,impactScore:f}}).filter(w=>r.has(w.id)?!1:(r.add(w.id),!0)),h=Ti(p,.75);return l.rankingMode==="legacy"?h.sort((w,v)=>v.publishedAt-w.publishedAt):h.sort((w,v)=>v.impactScore-w.impactScore),console.log(`[RSS] Final count for ${n}: ${h.length} (requested ${s})`),h.slice(0,s)}catch(r){throw console.error(`[RSS] Ranking error for ${n}:`,r),r}}function ra(){const e=nt.size;return nt.clear(),console.log(`[RSS] ðŸ—‘ï¸ Cleared ${e} cache entries`),e}function oa(e,n=20,s=40,a=30){const i=[],r=new Map,o=new Map,l=[...e].sort((c,d)=>(d.impactScore||0)-(c.impactScore||0));for(const c of l){if(i.length>=n)break;const d=c.section||"general",u=la(c.title,c.description),m=r.get(d)||0,g=o.get(u)||0,p=Math.floor(n*(s/100)),h=Math.floor(n*(a/100));m>=p||g>=h||(i.push(c),r.set(d,m+1),o.set(u,g+1))}return console.log("[Composer] Final composition:",{total:i.length,byTopic:Object.fromEntries(r),byGeo:Object.fromEntries(o)}),i}function la(e,n){const s=`${e||""} ${n||""}`.toLowerCase();return/chennai|madras/i.test(s)?"chennai":/trichy|tiruchirappalli/i.test(s)?"trichy":/tamil nadu|tn /i.test(s)?"tamil-nadu":/india|delhi|mumbai|bangalore/i.test(s)?"india":"global"}const Jt="news_audit_history";function ca(e){if(e.length===0)return 0;const n=[...e].sort((a,i)=>a-i),s=Math.floor(n.length/2);return n.length%2!==0?n[s]:(n[s-1]+n[s])/2}function Vn(e){return e.length===0?0:e.reduce((n,s)=>n+s,0)/e.length}function da(e,n){if(e.length===0)return 0;const s=e.map(i=>Math.pow(i-n,2)),a=Vn(s);return Math.sqrt(a)}function ua(e,n){const s={},a=n?.rankingWeights?.audit?.consensusThreshold||2;return e.forEach(i=>{const r=i.sourceCount||1;let o=null;r>=a+1?o="âš¡âš¡":r>=a&&(o="âš¡"),s[i.id]={count:r,sources:i.allSources||[i.source],badge:o}}),s}function ha(e,n){const s={};if(!n)return s;const a=new Set;n.followedTopics&&n.followedTopics.forEach(r=>a.add(r.query.toLowerCase())),n.upAhead&&n.upAhead.keywords&&Object.values(n.upAhead.keywords).flat().forEach(r=>{r&&a.add(r.toLowerCase())});const i=Object.entries(n.newsSources||{}).filter(([r,o])=>o).map(([r])=>r.toLowerCase());return e.forEach(r=>{const o=(r.title||"").toLowerCase(),l=(r.source||"").toLowerCase();let c=[],d=0;a.forEach(g=>{o.includes(g)&&(c.push(g),d+=1)});const u=i.some(g=>l.includes(g)||g.includes(l));let m=null;c.length>0&&(m=u?"ðŸŽ¯":"ðŸ“Œ"),s[r.id]={score:d,matches:c,badge:m}}),s}function ma(e,n){const s={};if(e.length<3)return s;const a=Date.now(),i=e.map(l=>(a-new Date(l.publishedAt).getTime())/(1e3*60*60)),r=ca(i),o=n?.rankingWeights?.freshness?.anomalyThreshold||2;return e.forEach((l,c)=>{const d=i[c];let u="none",m=null;d>6&&d>r*o&&(u="age",m="ðŸ•°ï¸"),s[l.id]={type:u,badge:m}}),s}function pa(e,n){const s={};if(e.length<5)return s;const a=e.map(l=>l.impactScore||0),i=Vn(a),r=da(a,i),o=n?.rankingWeights?.audit?.anomalySigma||2;return e.forEach(l=>{const c=l.impactScore||0;let d="none",u=null;c>i+o*r?(d="score_high",u="ðŸ“Šâ†‘"):c<i-1.5*r&&(d="score_low",u="ðŸ“Šâ†“"),s[l.id]={type:d,badge:u}}),s}async function ga(e,n){const s={};let a={};try{const r=localStorage.getItem(Jt);a=r?JSON.parse(r):{}}catch(r){console.warn("Failed to load audit history",r)}const i={};Object.entries(e).forEach(([r,o])=>{if(!Array.isArray(o)||o.length===0)return;const l=ua(o,n),c=ha(o,n),d=ma(o,n),u=pa(o,n),m=o.slice(0,10).map(p=>p.id),g=new Set(a[r]||[]);i[r]=m,o.forEach(p=>{const h=p.id,w=m.includes(h)&&g.has(h)?"ðŸŒ©ï¸":null;let v=null;p.isBreaking&&l[h]?.count>1?v="âœ…":p.isBreaking&&(v="â“"),s[h]={consensus:l[h],relevance:c[h],anomaly:u[h]?.badge?u[h]:d[h]?.badge?d[h]:{type:"none",badge:null},persistenceBadge:w,breakingVerified:v}})});try{localStorage.setItem(Jt,JSON.stringify(i))}catch(r){console.warn("Failed to save audit history",r)}return s}const qn=x.createContext(),Qe=["world","india","chennai","trichy"];function fa({children:e}){const{settingsVersion:n}=se(),s=x.useRef(n),[a,i]=x.useState({}),[r,o]=x.useState([]),[l,c]=x.useState(!0),[d,u]=x.useState([]),[m,g]=x.useState({}),[p,h]=x.useState(0),[w,v]=x.useState({}),S=x.useCallback(async _=>{if(!d.includes(_)){console.log(`[NewsContext] Lazy loading section: ${_}`);try{const T=V();if(T.sections[_]&&!T.sections[_].enabled){console.log(`[NewsContext] Skipping lazy load for disabled section: ${_}`);return}const L=T.sections[_]?.count||10,k=await bt(_,L+5,T.newsSources);i(O=>({...O,[_]:k||[]}))}catch(T){console.error(`[NewsContext] Failed to load section ${_}:`,T),g(L=>({...L,[_]:T.message}))}finally{u(T=>[...new Set([...T,_])])}}},[d]),f=x.useCallback(async(_=null)=>{c(!0);const T=Date.now();try{const L=V();if(!L){console.error("[NewsContext] Settings not available");return}const O=_||["world","india","chennai","trichy","local","social","entertainment","business","technology"],M=O.filter(C=>Qe.includes(C)),F=O.filter(C=>!Qe.includes(C)),D=[M,F].filter(C=>C.length>0);let W={};for(const C of D){const B={},z={};console.log(`[NewsContext] Fetching batch: ${C.join(", ")}`),await Promise.all(C.map(async N=>{if(L.sections[N]?.enabled!==!1)try{const E=L.sections[N]?.count||10,R=await bt(N,E+5,L.newsSources);R&&Array.isArray(R)?B[N]=R:B[N]=[]}catch(E){console.error(`[NewsContext] Error ${N}:`,E),z[N]=E.message,B[N]=[]}})),Object.assign(W,B);const A=Object.values(W).flat(),y={};Object.keys(W).forEach(N=>y[N]=[]),A.forEach(N=>{const E=N.section||"uncategorized";y[E]||(y[E]=[]),y[E].push(N)}),Object.keys(y).forEach(N=>{y[N].sort((E,R)=>(R.impactScore||0)-(E.impactScore||0))});const b=Object.values(y).flat(),I=oa(b,20,L.maxTopicPercent||40,L.maxGeoPercent||30);if(I&&I.length>0){const N=I.map(E=>E.id);Hs(N)}i(N=>({...N,...y,frontPage:I})),g(N=>({...N,...z})),u(N=>[...new Set([...N,...Object.keys(B)])]);const P=A.filter(N=>N.isBreaking||N.breakingScore&&N.breakingScore>1.5).sort((N,E)=>(E.breakingScore||0)-(N.breakingScore||0)).slice(0,3);o(P)}h(Date.now());const j=Date.now()-T;console.log(`[NewsContext] âœ… Refresh complete in ${j}ms`)}catch(L){console.error("[NewsContext] âŒ Fatal refresh error:",{errorMessage:L.message,errorStack:L.stack,timestamp:new Date().toISOString()})}finally{c(!1)}},[]);return x.useEffect(()=>{if(p===0)return;console.log("[NewsContext] Scheduling audit...");const _=setTimeout(async()=>{try{const T=V(),L=await ga(a,T);v(k=>({...k,...L}))}catch(T){console.error("[NewsContext] Audit failed:",T)}},3e3);return()=>clearTimeout(_)},[p]),x.useEffect(()=>{s.current!==n&&(console.log("[NewsContext] Settings changed (v"+n+") - refreshing"),ra(),s.current=n,f())},[n,f]),x.useEffect(()=>{console.log("[NewsContext] Mounting - Initial fetch (Priority Only)");const _=setTimeout(()=>{f(Qe)},500),T=setInterval(()=>{console.log("[NewsContext] Auto-refresh (5min cycle)"),f(Qe)},300*1e3);return()=>{clearTimeout(_),clearInterval(T),console.log("[NewsContext] Unmounting")}},[f]),t.jsx(qn.Provider,{value:{newsData:a,loading:l,errors:m,refreshNews:f,breakingNews:r,lastFetch:p,loadSection:S,loadedSections:d,auditResults:w},children:e})}function Ge(){return x.useContext(qn)}const xe=({active:e=!1,color:n="var(--accent-primary)",style:s={}})=>e?t.jsxs("div",{style:{position:"relative",height:"2px",width:"100%",overflow:"hidden",backgroundColor:"rgba(255,255,255,0.1)",...s},children:[t.jsx("div",{className:"progress-bar-shim",style:{position:"absolute",top:0,left:0,bottom:0,width:"100%",background:`linear-gradient(90deg, transparent, ${n}, transparent)`,transform:"translateX(-100%)",animation:"shim-infinite 1.5s infinite linear"}}),t.jsx("style",{children:`
                @keyframes shim-infinite {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            `})]}):null;function le({id:e,title:n,icon:s,colorClass:a,news:i=[],maxDisplay:r=3,showExpand:o=!0,error:l=null,extraContent:c=null,onArticleClick:d=null,showCritics:u=!0,loading:m=!1}){const[g,p]=x.useState(!1),[h,w]=x.useState(!1),{auditResults:v}=Ge(),f=V().rankingWeights?.trending?.threshold||12,_=g?i.length:Math.min(r,i.length),T=i.slice(0,_),L=i.length>r,k=i.health||{status:"ok"},O=D=>{if(!D)return"";const W=Math.floor((Date.now()-D)/1e3);let j=W/31536e3;return j>1?Math.floor(j)+"y":(j=W/2592e3,j>1?Math.floor(j)+"mo":(j=W/86400,j>1?Math.floor(j)+"d":(j=W/3600,j>1?Math.floor(j)+"h":(j=W/60,j>1?Math.floor(j)+"m":"Now"))))},M=D=>{Bn(D),d&&d(D),D.url&&window.open(D.url,"_blank","noopener,noreferrer")},F=()=>l?t.jsxs("div",{className:"empty-state",style:{borderColor:"rgba(255, 87, 87, 0.3)"},children:[t.jsx("div",{className:"empty-state__icon",children:"âŒ"}),t.jsx("p",{style:{color:"#ff5757"},children:l})]}):m?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-muted)"},children:"Loading stories..."}):i.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"ðŸ“­"}),t.jsx("p",{children:"No news available for this section"})]}):t.jsxs(t.Fragment,{children:[c,t.jsx("div",{className:"news-list-modern",children:T.map((D,W)=>t.jsxs("article",{className:"modern-news-card",onClick:()=>M(D),style:{cursor:D.url?"pointer":"default"},children:[t.jsxs("div",{className:"mnc-header",children:[t.jsx("span",{className:"mnc-source",children:D.source}),t.jsx("span",{className:"mnc-time",children:O(D.publishedAt)||D.time})]}),t.jsx("h3",{className:"mnc-headline",children:D.headline}),D.summary&&t.jsx("p",{className:"mnc-summary",children:D.summary}),t.jsxs("div",{className:"mnc-badges",children:[D.isBreaking&&t.jsx("span",{className:"mnc-badge mnc-badge--breaking",children:"âš¡ Breaking"}),!D.isBreaking&&D.impactScore>f&&t.jsx("span",{className:"mnc-badge mnc-badge--trending",children:"ðŸ”¥ Trending"}),D.sourceCount>1&&t.jsxs("span",{className:"mnc-badge mnc-badge--consensus",children:["ðŸ”” ",D.sourceCount," sources"]}),D.sentiment&&t.jsx("span",{className:`mnc-badge mnc-badge--sentiment-${D.sentiment.label}`,children:D.sentiment.label==="positive"?"Positive":D.sentiment.label==="negative"?"Negative":"Neutral"})]}),u&&D.criticsView&&t.jsxs("div",{className:"mnc-critics",children:[t.jsx("strong",{children:"Critics Take:"})," ",D.criticsView]}),v[D.id]&&t.jsxs("div",{className:"mnc-audit-row",children:[v[D.id].consensus?.badge&&t.jsx("span",{children:v[D.id].consensus.badge}),v[D.id].breakingVerified&&t.jsx("span",{children:v[D.id].breakingVerified})]})]},D.id||W))}),o&&L&&t.jsxs("div",{className:"news-more-modern",onClick:()=>p(!g),children:[t.jsx("span",{children:g?"Collapse":`Show ${i.length-r} more`}),t.jsx("span",{style:{fontSize:"1.2rem"},children:g?"â–²":"â–¼"})]})]});return t.jsxs("section",{className:"news-section",id:e,children:[t.jsxs("h2",{className:`news-section__title ${a}`,onClick:()=>w(!h),style:{cursor:"pointer"},title:`Tap to fold/unfold. Health: ${k.status.toUpperCase()}`,children:[t.jsxs("div",{className:"news-title-left",children:[t.jsx("span",{className:"news-icon",children:s}),t.jsx("span",{className:"news-text",children:n})]}),t.jsxs("div",{className:"news-title-right",children:[k.status==="critical"&&t.jsx("span",{title:"Critical Feed",className:"indicator-dot red"}),k.status==="warning"&&t.jsx("span",{title:"Warning Feed",className:"indicator-dot orange"}),i.length>0&&t.jsxs("span",{className:"news-count",children:["(",i.length,")"]}),t.jsx("span",{className:"collapse-arrow",children:h?"â–¼":"â–²"})]})]}),t.jsx(xe,{active:m}),!h&&F()]})}const kt=({sections:e})=>{const n=s=>{const a=document.getElementById(s);if(a){const o=a.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:o,behavior:"smooth"})}};return!e||e.length===0?null:t.jsx("div",{className:"section-navigator",children:e.map(({id:s,icon:a,label:i})=>t.jsx("button",{className:"section-navigator__btn",onClick:()=>n(s),title:i,children:t.jsx("span",{className:"section-navigator__icon",children:a})},s))})},ya=({items:e})=>{const[n,s]=x.useState(0);if(x.useEffect(()=>{if(!e||e.length<2)return;const i=setInterval(()=>{s(r=>(r+1)%e.length)},5e3);return()=>clearInterval(i)},[e]),!e||e.length===0)return null;const a=e[n];return t.jsxs("div",{className:"breaking-news-banner",children:[t.jsxs("div",{className:"breaking-label",children:[t.jsx("span",{className:"pulse-icon",children:"ðŸ”´"})," BREAKING"]}),t.jsxs("div",{className:"breaking-content",children:[t.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"breaking-link",children:a.title}),t.jsxs("span",{className:"breaking-time",children:[a.time," â€¢ ",a.source]})]}),e.length>1&&t.jsx("div",{className:"breaking-controls",children:e.map((i,r)=>t.jsx("span",{className:`control-dot ${r===n?"active":""}`,onClick:()=>s(r)},r))})]})},xa=({title:e,icon:n,actions:s,loadingPhase:a})=>{const i=e!=="Market Brief";return t.jsxs("header",{className:"header timeline-header",children:[i&&t.jsx("h1",{className:"header__title",style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:t.jsx("span",{children:e})}),t.jsx(Hn,{loadingPhase:a}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:s})]})};function wa(e){const n=e.filter(c=>c?.precipitation_probability!=null);if(n.length===0)return null;const s=n.map(c=>c.precipitation_probability),a=Math.round(s.reduce((c,d)=>c+d,0)/s.length),i=Math.min(...s),r=Math.max(...s),o=r-i,l=o>30;return{avg:a,min:i,max:r,range:o,isWideRange:l,displayString:`${l?"!":"~"}${a}% (${i}-${r}%)`,symbol:l?"!":"~",models:n.length}}function Xt(e){const n=e.filter(r=>r?.temperature_2m!=null);if(n.length===0)return null;let s=0,a=0;const i={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=i[r.modelName]||1;a+=r.temperature_2m*o,s+=o}),Math.round(s===0?n.reduce((r,o)=>r+o.temperature_2m,0)/n.length:a/s)}function Qt(e){const n=e.filter(a=>a?.apparent_temperature!=null);if(n.length===0)return null;const s=n.map(a=>a.apparent_temperature);return Math.round(s.reduce((a,i)=>a+i,0)/s.length)}function Zt(e){const n=e.filter(o=>o?.weather_code!=null);if(n.length===0)return null;const s=n.map(o=>o.weather_code),a={};s.forEach(o=>{a[o]=(a[o]||0)+1});let i=0,r=s[0];for(const[o,l]of Object.entries(a))l>i&&(i=l,r=parseInt(o));return r}function va(e){const n=e.filter(r=>r?.precipitation!=null);if(n.length===0)return 0;let s=0,a=0;const i={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=i[r.modelName]||1;a+=r.precipitation*o,s+=o}),s===0?0:parseFloat((a/s).toFixed(1))}function Yn(e){return Object.entries(e).filter(([n,s])=>s!==null).map(([n,s])=>n)}function Jn(e){const n={ecmwf:"ECMWF",gfs:"GFS",icon:"ICON"};return e.map(s=>n[s]||s).join(", ")}function ba(e,n,s,a){const i=Sa(n),r=ja(e),o=`${i}_${r}`,l={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};return l[o]?l[o]:o}function Sa(e){return e>=6&&e<8?"dawn":e>=8&&e<17?"day":e>=17&&e<19?"dusk":"night"}function ja(e){return e===0||e<=1?"clear":e===2?"partlyCloudy":e===3?"overcast":e>=45&&e<=48?"fog":e>=51&&e<=55||e>=56&&e<=57?"drizzle":e===61?"lightRain":e===63?"rain":e===65?"heavyRain":e>=66&&e<=67?"rain":e>=71&&e<=77?"snow":e>=80&&e<=82?"rain":e===85||e===86?"snow":e>=95&&e<=99?"storm":"cloudy"}const Xn={ecmwf:"https://api.open-meteo.com/v1/ecmwf",gfs:"https://api.open-meteo.com/v1/gfs",icon:"https://api.open-meteo.com/v1/dwd-icon"},en={chennai:{lat:13.0827,lon:80.2707},trichy:{lat:10.7905,lon:78.7047},muscat:{lat:23.5859,lon:58.4059}};async function Na(e){const n=e.toLowerCase();if(en[n])return en[n];try{const s=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");if(s[n])return s[n]}catch{console.warn("Geocode cache read failed")}try{console.log(`[WeatherService] Geocoding ${e}...`);const a=await(await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(e)}&count=1&language=en&format=json`)).json();if(a.results&&a.results.length>0){const i={lat:a.results[0].latitude,lon:a.results[0].longitude};try{const r=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");r[n]=i,localStorage.setItem("weather_geo_cache",JSON.stringify(r))}catch{}return i}}catch(s){console.error("Geocoding failed:",s)}throw new Error(`Location not found: ${e}`)}async function _a(e,n,s){const a=Xn[e];if(!a)throw new Error(`Unknown model: ${e}`);const i=new URLSearchParams({latitude:n,longitude:s,current:"temperature_2m,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m",hourly:"temperature_2m,precipitation_probability,precipitation,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m,uv_index,cloud_cover,visibility,dew_point_2m",daily:"precipitation_probability_max,precipitation_sum,uv_index_max",timezone:"auto"}),r=`${a}?${i}`;console.log(`[WeatherService] Fetching ${e.toUpperCase()}...`);const o=await fetch(r);if(!o.ok)throw new Error(`${e.toUpperCase()} API request failed: ${o.status}`);const l=await o.json();return console.log(`[WeatherService] âœ… ${e.toUpperCase()}: Success`),l}async function ka(e){const n=Date.now();let s,a;try{const l=await Na(e);s=l.lat,a=l.lon}catch{throw new Error(`Unknown location: ${e}`)}const r=V().weather?.models||{ecmwf:!0,gfs:!0,icon:!0},o=Object.keys(Xn).filter(l=>r[l]!==!1);o.length===0&&(console.warn("[WeatherService] No models enabled, using all models"),o.push("ecmwf","gfs","icon")),console.log(`[WeatherService] Fetching from models: ${o.join(", ")}`);try{const l=await Promise.allSettled(o.map(m=>_a(m,s,a))),c={};o.forEach((m,g)=>{c[m]=l[g].status==="fulfilled"?l[g].value:null,l[g].status==="rejected"&&console.warn(`[WeatherService] âš ï¸ ${m.toUpperCase()} failed:`,l[g].reason?.message)});const d=Yn(c);if(d.length===0)throw new Error("All weather models failed to fetch data");const u=Date.now()-n;return console.log(`[WeatherService] âœ… ${d.length}/${o.length} models succeeded: ${Jn(d)}`),he.success("weather",`${e}: ${d.length}/${o.length} models OK`,{durationMs:u}),Ca(c,e)}catch(l){throw console.error(`[WeatherService] âŒ Error fetching weather for ${e}:`,l),he.error("weather",`${e}: ${l.message}`,{durationMs:Date.now()-n}),l}}function Ca(e,n){const s=[e.ecmwf?.current,e.gfs?.current,e.icon?.current].filter(Boolean),a=(b,I)=>ba(b,I??new Date().getHours()),i=b=>b<=1?"â˜€ï¸":b<=3?"â›…":b<=67?"ðŸŒ§ï¸":b<=99?"â›ˆï¸":"â“",r={0:"Clear",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",48:"Fog",51:"Light Drizzle",61:"Light Rain",63:"Rain",65:"Heavy Rain",80:"Rain Showers",95:"Thunderstorm"},o=b=>r[b]||"Unknown",l=(b,I)=>{const P=[];for(let U=b;U<=I;U++)P.push(U);const N=[];e.ecmwf?.hourly&&N.push(e.ecmwf.hourly),e.gfs?.hourly&&N.push(e.gfs.hourly),e.icon?.hourly&&N.push(e.icon.hourly);const E={},R=[],$=[],H=[],K=[],q=[],X=[],ie=[],ce=[],je=[];P.forEach(U=>{e.ecmwf?.hourly?.precipitation_probability?.[U]!=null&&(E.ecmwf||(E.ecmwf=[]),E.ecmwf.push(e.ecmwf.hourly.precipitation_probability[U])),e.gfs?.hourly?.precipitation_probability?.[U]!=null&&(E.gfs||(E.gfs=[]),E.gfs.push(e.gfs.hourly.precipitation_probability[U])),e.icon?.hourly?.precipitation_probability?.[U]!=null&&(E.icon||(E.icon=[]),E.icon.push(e.icon.hourly.precipitation_probability[U]));const Q=N.map(Y=>({modelName:Y._modelName,temperature_2m:Y.temperature_2m?.[U],apparent_temperature:Y.apparent_temperature?.[U],precipitation:Y.precipitation?.[U],precipitation_probability:Y.precipitation_probability?.[U],weather_code:Y.weather_code?.[U],relative_humidity_2m:Y.relative_humidity_2m?.[U],wind_speed_10m:Y.wind_speed_10m?.[U],uv_index:Y.uv_index?.[U],cloud_cover:Y.cloud_cover?.[U]})),Ae=Xt(Q),de=Qt(Q),Ye=va(Q),Je=Zt(Q);Ae!==null&&R.push(Ae),de!==null&&$.push(de),Ye!==null&&H.push(Ye),Je!==null&&q.push(Je),Q.forEach(Y=>{Y.precipitation_probability!=null&&K.push({precipitation_probability:Y.precipitation_probability}),Y.relative_humidity_2m!=null&&X.push(Y.relative_humidity_2m),Y.wind_speed_10m!=null&&ie.push(Y.wind_speed_10m),Y.uv_index!=null&&ce.push(Y.uv_index),Y.cloud_cover!=null&&je.push(Y.cloud_cover)})});const G=R.length>0?Math.round(R.reduce((U,Q)=>U+Q,0)/R.length):null,ae=$.length>0?Math.round($.reduce((U,Q)=>U+Q,0)/$.length):G,ot=H.reduce((U,Q)=>U+Q,0),ps=wa(K),qe=[];Object.values(E).forEach(U=>{if(U.length>0){const Q=Math.round(U.reduce((Ae,de)=>Ae+de,0)/U.length);qe.push(Q)}});let Tt=0,lt=0,ct=0;qe.length>0&&(lt=Math.min(...qe),ct=Math.max(...qe),Tt=ct-lt);let At=ot.toFixed(1)+"mm";ot<1&&(At="-");const It=q.length>0?q[Math.floor(q.length/2)]:0,gs=i(It),fs=Math.floor((b+I)/2)%24,ys=a(It,fs),xs=X.length>0?Math.round(X.reduce((U,Q)=>U+Q,0)/X.length):null,ws=ie.length>0?Math.round(ie.reduce((U,Q)=>U+Q,0)/ie.length):null,vs=ce.length>0?Math.max(...ce):null,bs=je.length>0?Math.round(je.reduce((U,Q)=>U+Q,0)/je.length):null,Ss=P.map((U,Q)=>{const Ae=e.ecmwf?"ecmwf":e.gfs?"gfs":"icon",de=e[Ae]?.hourly;if(!de)return null;const Ye=de.temperature_2m?.[U],Je=de.precipitation?.[U],Y=de.precipitation_probability?.[U],Mt=de.weather_code?.[U],dt=U%24,js=dt>=12?"p":"a";return{time:`${dt%12===0?12:dt%12}${js}`,temp:Ye,precip:Je,prob:Y,icon:i(Mt),iconId:a(Mt,U%24)}}).filter(Boolean);return{temp:G,feelsLike:ae,icon:gs,iconId:ys,rainMm:At,rainProb:ps||{avg:0,min:0,max:0,displayString:"~0%",isWideRange:!1},probSpread:Tt,minModelAvg:lt,maxModelAvg:ct,humidity:xs,windSpeed:ws,uvIndex:vs,cloudCover:bs,hourly:Ss}},c=b=>{const I=b*24;return{morning:l(6+I,11+I),noon:l(12+I,16+I),evening:l(17+I,22+I)}},d=c(0),u=c(1),m=Xt(s),g=Qt(s),p=Zt(s),h=s.length>0&&s[0].relative_humidity_2m!=null?Math.round(s.reduce((b,I)=>b+(I.relative_humidity_2m||0),0)/s.length):null,w=s.length>0&&s[0].wind_speed_10m!=null?Math.round(s.reduce((b,I)=>b+(I.wind_speed_10m||0),0)/s.length):null,v=s.length>0&&s[0].wind_direction_10m!=null?Math.round(s.reduce((b,I)=>b+(I.wind_direction_10m||0),0)/s.length):null,S=[e.ecmwf?.daily?.precipitation_probability_max?.[0],e.gfs?.daily?.precipitation_probability_max?.[0],e.icon?.daily?.precipitation_probability_max?.[0]].filter(b=>b!=null),f=S.length>0?Math.round(S.reduce((b,I)=>b+I,0)/S.length):0,_=[e.ecmwf?.daily?.precipitation_sum?.[0],e.gfs?.daily?.precipitation_sum?.[0],e.icon?.daily?.precipitation_sum?.[0]].filter(b=>b!=null),T=_.length>0?(_.reduce((b,I)=>b+I,0)/_.length).toFixed(1):0,L=[e.ecmwf?.daily?.uv_index_max?.[0],e.gfs?.daily?.uv_index_max?.[0],e.icon?.daily?.uv_index_max?.[0]].filter(b=>b!=null),k=L.length>0?Math.round(L.reduce((b,I)=>b+I,0)/L.length):null,O=Yn(e),M=new Date().getHours(),F=[];e.ecmwf?.hourly&&F.push(e.ecmwf.hourly),e.gfs?.hourly&&F.push(e.gfs.hourly),e.icon?.hourly&&F.push(e.icon.hourly);const D=[],W=[],j=b=>{const I=M+b,P=(M+b)%24,N=F.map(G=>G.temperature_2m?.[I]).filter(G=>G!=null),E=F.map(G=>G.precipitation?.[I]).filter(G=>G!=null),R=F.map(G=>G.precipitation_probability?.[I]).filter(G=>G!=null),$=F.map(G=>G.weather_code?.[I]).filter(G=>G!=null),H=F.map(G=>G.cloud_cover?.[I]).filter(G=>G!=null),K=N.length>0?Math.round(N.reduce((G,ae)=>G+ae,0)/N.length):null,q=E.length>0?parseFloat((E.reduce((G,ae)=>G+ae,0)/E.length).toFixed(1)):0,X=R.length>0?Math.round(R.reduce((G,ae)=>G+ae,0)/R.length):0,ie=$.length>0?$[Math.floor($.length/2)]:0,ce=H.length>0?Math.round(H.reduce((G,ae)=>G+ae,0)/H.length):0;return{hour:P,label:b===0?"Now":(G=>{const ae=G>=12?"p":"a";return`${G%12===0?12:G%12}${ae}`})(P),temp:K,precip:q,prob:X,cloud:ce,icon:i(ie),iconId:a(ie,P),code:ie}};for(let b=0;b<24;b+=3)D.push(j(b));for(let b=0;b<8;b++)W.push(j(b));const C=[e.ecmwf?.daily?.temperature_2m_max?.[0],e.gfs?.daily?.temperature_2m_max?.[0],e.icon?.daily?.temperature_2m_max?.[0]].filter(b=>b!=null),B=[e.ecmwf?.daily?.temperature_2m_min?.[0],e.gfs?.daily?.temperature_2m_min?.[0],e.icon?.daily?.temperature_2m_min?.[0]].filter(b=>b!=null);let z=C.length>0?Math.round(C.reduce((b,I)=>b+I,0)/C.length):null,A=B.length>0?Math.round(B.reduce((b,I)=>b+I,0)/B.length):null;z===null&&D.length>0&&(z=Math.max(...D.map(b=>b.temp||-999)),z===-999&&(z=null)),A===null&&D.length>0&&(A=Math.min(...D.map(b=>b.temp||999)),A===999&&(A=null));let y="";return parseFloat(T)>0&&(y+=`Today's max rain probability: ${f}%. Total precip: ${T}mm. `),y+=`Condition: ${o(p)}. UV Index: ${k||"N/A"}.`,{name:n.charAt(0).toUpperCase()+n.slice(1),icon:n==="muscat"?"ðŸ“":"ðŸ›ï¸",fetchedAt:Date.now(),models:{successful:O,count:O.length,names:Jn(O)},current:{temp:m,feelsLike:g,high:z,low:A,condition:o(p),icon:i(p),iconId:a(p,new Date().getHours()),humidity:h,windSpeed:w,windDirection:v},morning:d.morning,noon:d.noon,evening:d.evening,tomorrow:u,hourly24:D,next8Hours:W,summary:y}}const Qn=x.createContext();function Ea({children:e}){const{settingsVersion:n}=se(),s=x.useRef(n),[a,i]=x.useState(null),[r,o]=x.useState(!0),[l,c]=x.useState(null),[d,u]=x.useState(0),m=x.useCallback(async(g=!1)=>{const p=V(),h=(p?.weatherFreshnessLimit||4)*60*60*1e3;if(!g&&a){const w=Date.now()-d;if(w<900*1e3)return;p?.strictFreshness&&w>h&&i(null)}if(o(!0),p?.sections?.weather===!1){o(!1);return}try{const w=p?.weather?.cities||["chennai","trichy","muscat"],v=await Promise.allSettled(w.map(f=>ka(f))),S={};w.forEach((f,_)=>{S[f]=v[_].status==="fulfilled"?v[_].value:null}),i(S),u(Date.now()),c(null)}catch(w){console.error("Weather Context Error:",w),c(w),i(null)}finally{o(!1)}},[a,d]);return x.useEffect(()=>{m()},[m]),x.useEffect(()=>{s.current!==n&&(s.current=n,m(!0))},[n,m]),t.jsx(Qn.Provider,{value:{weatherData:a,loading:r,error:l,refreshWeather:m},children:e})}function Ke(){return x.useContext(Qn)}const tn=32,ft={day_clear:t.jsxs("g",{children:[t.jsx("circle",{cx:"16",cy:"16",r:"6",fill:"#FFD93D"}),[0,45,90,135,180,225,270,315].map(e=>t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"7",stroke:"#FFD93D",strokeWidth:"2",strokeLinecap:"round",transform:`rotate(${e} 16 16)`},e))]}),night_clear:t.jsxs("g",{children:[t.jsx("path",{d:"M20 6 A10 10 0 1 0 26 20 A7 7 0 1 1 20 6Z",fill:"#B8C5E8"}),t.jsx("circle",{cx:"24",cy:"7",r:"1",fill:"#FFE"}),t.jsx("circle",{cx:"27",cy:"12",r:"0.7",fill:"#FFE"})]}),dawn_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#FF9F43",opacity:"0.3",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FFD93D"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),dusk_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#E74C3C",opacity:"0.25",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FF6B6B"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FF6B6B",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),day_partlyCloudy:t.jsxs("g",{children:[t.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD93D"}),[0,60,120,180,240,300].map(e=>t.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"3",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 12 12)`},e)),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#DFE6ED"})]}),night_partlyCloudy:t.jsxs("g",{children:[t.jsx("path",{d:"M10 6 A6 6 0 1 0 14 12 A4 4 0 1 1 10 6Z",fill:"#B8C5E8"}),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#636E83"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#778CA3"})]}),day_cloudy:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"11",ry:"6",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"6",ry:"5",fill:"#DFE6ED"}),t.jsx("ellipse",{cx:"20",cy:"16",rx:"5",ry:"4",fill:"#DFE6ED"})]}),day_overcast:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"12",ry:"6",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"7",ry:"5",fill:"#A4B0BE"}),t.jsx("ellipse",{cx:"21",cy:"16",rx:"5",ry:"4",fill:"#A4B0BE"})]}),day_fog:t.jsxs("g",{children:[[14,18,22].map((e,n)=>t.jsx("line",{x1:"4",y1:e,x2:"28",y2:e,stroke:"#B0BEC5",strokeWidth:"2.5",strokeLinecap:"round",opacity:.5+n*.15},n)),t.jsx("circle",{cx:"16",cy:"9",r:"4",fill:"#FFD93D",opacity:"0.4"})]}),day_drizzle:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"14",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"11",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("line",{x1:e,y1:"21",x2:e-1,y2:"25",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_lightRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#B0BEC5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#C8D6E5"}),[9,14,19,24].map((e,n)=>t.jsx("line",{x1:e,y1:"20",x2:e-1.5,y2:"26",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_rain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"12",rx:"11",ry:"5",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"9",rx:"6",ry:"4",fill:"#A4B0BE"}),[8,13,18,23].map((e,n)=>t.jsx("line",{x1:e,y1:"19",x2:e-2,y2:"27",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_heavyRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"11",rx:"12",ry:"5",fill:"#636E72"}),t.jsx("ellipse",{cx:"12",cy:"8",rx:"6",ry:"4",fill:"#778CA3"}),[7,12,17,22,27].map((e,n)=>t.jsx("line",{x1:e,y1:"18",x2:e-3,y2:"28",stroke:"#0984E3",strokeWidth:"2.5",strokeLinecap:"round"},n))]}),day_storm:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"10",rx:"12",ry:"5",fill:"#4A4A4A"}),t.jsx("ellipse",{cx:"12",cy:"7",rx:"6",ry:"4",fill:"#636E72"}),t.jsx("polygon",{points:"17,14 13,22 16,22 14,29 21,20 17,20 19,14",fill:"#FDCB6E"}),[8,24].map((e,n)=>t.jsx("line",{x1:e,y1:"17",x2:e-2,y2:"25",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_snow:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("text",{x:e,y:25,textAnchor:"middle",fontSize:"6",fill:"#74B9FF",children:"*"},n))]}),day_wind:t.jsxs("g",{children:[t.jsx("path",{d:"M4 14 Q12 10, 20 14 Q26 16, 28 12",fill:"none",stroke:"#78909C",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("path",{d:"M6 20 Q14 16, 22 20 Q27 22, 29 18",fill:"none",stroke:"#90A4AE",strokeWidth:"1.8",strokeLinecap:"round"}),t.jsx("path",{d:"M8 26 Q15 22, 24 26",fill:"none",stroke:"#B0BEC5",strokeWidth:"1.5",strokeLinecap:"round"})]})},Ta={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};function st({id:e,size:n=32,className:s=""}){const a=ft[e]||ft[Ta[e]]||ft.day_cloudy;return t.jsx("svg",{viewBox:`0 0 ${tn} ${tn}`,width:n,height:n,className:s,"aria-label":e?.replace(/_/g," "),children:a})}const at=24,Aa=({size:e=at,className:n=""})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"currentColor",className:n,style:{color:"#60a5fa",verticalAlign:"middle"},children:[t.jsx("path",{d:"M12,2 C12,2 7,7 7,10 C7,12.76 9.24,15 12,15 C14.76,15 17,12.76 17,10 C17,7 12,2 12,2 Z",opacity:"0.9"}),t.jsx("path",{d:"M6,12 C6,12 4,14 4,15.5 C4,16.6 4.9,17.5 6,17.5 C7.1,17.5 8,16.6 8,15.5 C8,14 6,12 6,12 Z",opacity:"0.7"}),t.jsx("path",{d:"M18,12 C18,12 16,14 16,15.5 C16,16.6 16.9,17.5 18,17.5 C19.1,17.5 20,16.6 20,15.5 C20,14 18,12 18,12 Z",opacity:"0.7"})]}),Ia=({size:e=at,className:n=""})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,style:{color:"#cbd5e1",verticalAlign:"middle"},children:t.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),Ma=({size:e=at,className:n="",color:s="currentColor"})=>t.jsxs("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:[t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12h20c0-5.52-4.48-10-10-10z",opacity:"1"}),t.jsx("path",{d:"M11 12h2v7c0 1.1.9 2 2 2s2-.9 2-2h-2c0 .55-.45 1-1 1s-1-.45-1-1v-7z",opacity:"0.8"})]}),nn=({size:e=at,className:n="",color:s="currentColor"})=>t.jsx("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})}),sn=()=>{const{weatherData:e,loading:n,error:s}=Ke(),{settings:a}=se(),[i,r]=x.useState(()=>{try{return localStorage.getItem("weather_active_city")||"chennai"}catch{return"chennai"}});if(x.useEffect(()=>{try{localStorage.setItem("weather_active_city",i)}catch{}},[i]),n)return t.jsx("div",{className:"quick-weather-card qw-bg-day",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Loading weather..."})});if(s||!e)return t.jsx("div",{className:"quick-weather-card qw-bg-night",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Weather unavailable"})});const o=(a.weather?.cities||["chennai","trichy","muscat"]).map(h=>h.toLowerCase()),l={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[o[2]]:o[2].charAt(0).toUpperCase()+o[2].slice(1)};o[2]+"";const c=new Date().getHours();let d="qw-bg-day";c>=6&&c<11?d="qw-bg-morning":c>=11&&c<17?d="qw-bg-day":c>=17&&c<20?d="qw-bg-evening":d="qw-bg-night";const u=e[i],m=Da(u),g=[];if(u?.hourly24)for(let h=0;h<12;h+=2)u.hourly24[h]&&g.push(u.hourly24[h]);const p=Ra(u,l[i]);return t.jsxs("section",{className:`quick-weather-card ${d}`,children:[t.jsx("div",{className:"qw-cities-grid",children:o.map(h=>{const w=e[h];if(!w?.current)return null;const v=w.current,S=h===i;return t.jsxs("div",{className:`qw-city-square ${S?"qw-city-square--active":""}`,onClick:()=>r(h),children:[t.jsx("div",{className:"qw-square-header",children:t.jsx("span",{className:"qw-square-name",children:l[h]})}),t.jsx("div",{className:"qw-square-icon",children:v.iconId?t.jsx(st,{id:v.iconId,size:40}):t.jsx("span",{style:{fontSize:"2rem"},children:v.icon})}),t.jsxs("div",{className:"qw-square-temp",children:[v.temp,"Â°"]})]},h)})}),t.jsxs("div",{className:"qw-highlight-text-container",children:[t.jsx("span",{className:"qw-highlight-icon",children:"ðŸ¤–"}),t.jsx("span",{className:"qw-highlight-text",children:p})]}),g.length>0&&t.jsx("div",{className:"qw-forecast-ribbon",children:g.map((h,w)=>t.jsxs("div",{className:"qw-ribbon-item",children:[t.jsx("div",{className:"qw-ribbon-time",children:h.label}),t.jsx("div",{className:"qw-ribbon-icon",children:h.iconId?t.jsx(st,{id:h.iconId,size:32}):h.icon}),t.jsxs("div",{className:"qw-ribbon-temp",children:[h.temp,"Â°"]}),t.jsx("div",{className:"qw-ribbon-pop",children:h.prob>20?t.jsxs("span",{className:"qw-pop-high",children:["ðŸ’§",h.prob,"%"]}):t.jsx("span",{className:"qw-pop-low",children:"--"})})]},w))}),m&&t.jsxs("div",{className:"qw-severe-banner",children:[t.jsx("span",{className:"qw-severe-icon",children:"âš ï¸"}),t.jsx("span",{className:"qw-severe-text",children:m})]})]})};function Ra(e,n){if(!e?.hourly24)return`Forecast for ${n} is unavailable right now.`;const s=e.hourly24.slice(0,8),a=s.filter(d=>d.precip>.5||d.prob>40),i=s.map(d=>d.temp).filter(d=>d!=null),r=i.length?Math.max(...i):null,o=i.length?Math.min(...i):null,l=e.current;return a.length>=3?"Expect rainy spells throughout the next 8 hours.":a.length>0?`Expecting showers around ${a[0].label}.`:s.filter(d=>d.condition&&d.condition.toLowerCase().includes("cloud")).length>=6?"Mostly cloudy skies for the next 8 hours.":l&&r&&r>l.temp+3?`Clear skies, warming up to ${r}Â° later.`:l&&o&&o<l.temp-3?`Clear skies, cooling down to ${o}Â° by evening.`:l?.condition?`${l.condition} currently. Expect stable conditions.`:"Clear skies expected for the next 8 hours."}function Da(e){if(!e?.hourly24)return null;const n=e.hourly24,s=n.filter(o=>o.precip>=10),a=n.filter(o=>o.prob>=80),i=n.map(o=>o.temp).filter(o=>o!=null),r=i.length>0?Math.max(...i):null;return s.length>0?"Heavy rain warning in effect.":a.length>=2?"Thunderstorms likely properly.":r!=null&&r>=42?`Heat warning: temperatures reaching ${r}Â°C.`:null}const an={MORNING_WEATHER:{id:"morning_weather",name:"Morning Weather",icon:"ðŸŒ…",startHour:6,startMinute:55,endHour:7,endMinute:0,sections:["weather"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MORNING_NEWS:{id:"morning_news",name:"Morning News",icon:"ðŸŒ„",startHour:7,startMinute:0,endHour:9,endMinute:0,sections:["weather","world","india","chennai","trichy","local","dtNext"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MARKET_BRIEF:{id:"market_brief",name:"Market Brief",icon:"ðŸ“Š",startHour:9,startMinute:0,endHour:11,endMinute:55,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},MIDDAY_BRIEF:{id:"midday_brief",name:"Midday Brief",icon:"â˜€ï¸",startHour:11,startMinute:55,endHour:14,endMinute:30,sections:["india","world","chennai","trichy"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!1,social:!1,weather:!0,market:!0}},MARKET_MOVERS:{id:"market_movers",name:"Market Movers",icon:"ðŸ“ˆ",startHour:14,startMinute:30,endHour:16,endMinute:20,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},EVENING_NEWS:{id:"evening_news",name:"Evening News",icon:"ðŸŒ†",startHour:16,startMinute:20,endHour:16,endMinute:45,sections:["world","india","chennai","trichy","local","social"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},LOCAL_EVENTS:{id:"local_events",name:"Local Events",icon:"ðŸ“",startHour:16,startMinute:45,endHour:19,endMinute:30,sections:["chennai","trichy","local","social"],recommended:{world:!1,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!1}},NIGHT_WRAP_UP:{id:"night_wrap_up",name:"Night Wrap-Up",icon:"ðŸŒ™",startHour:19,startMinute:30,endHour:20,endMinute:0,sections:["world","india","chennai","trichy","local","social","market"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},URGENT_ONLY:{id:"urgent_only",name:"Urgent Alerts Only",icon:"ðŸ””",startHour:20,startMinute:0,endHour:6,endMinute:55,sections:["urgent"],recommended:{world:!1,india:!1,chennai:!1,trichy:!1,local:!1,social:!1,weather:!0,market:!1}}};function yt(e=new Date){const n=e.getHours(),s=e.getMinutes(),a=n*60+s,i=Object.values(an);for(const r of i){const o=r.startHour*60+r.startMinute;let l=r.endHour*60+r.endMinute;if(r.id==="urgent_only"){if(a>=o||a<l)return r}else if(a>=o&&a<l)return r}return an.URGENT_ONLY}function rn(e){return e?.recommended||{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}}function La(e){if(!e)return"Welcome to Daily Event AI";switch(e.id){case"morning_weather":return"Good Morning! Here's your weather start.";case"morning_news":return"Your Morning Headlines are ready.";case"market_brief":return"Market Open: Sensex & Nifty Updates.";case"midday_brief":return"Midday Update: Top stories so far.";case"market_movers":return"Market Movers: Gainers & Losers.";case"evening_news":return"Evening Wrap: Catch up on the day.";case"local_events":return"How your evening looks around town.";case"night_wrap_up":return"The Day in Review.";case"urgent_only":return"Urgent Updates Only.";default:return"Daily Event AI: Live Updates."}}function Oa({article:e,size:n="medium",onClick:s,href:a,badge:i}){const{settings:r}=se(),[o,l]=x.useState(!1),[c,d]=x.useState(!1),[u,m]=x.useState(!1);`${encodeURIComponent(e.source)}`;const g=e.imageUrl&&!o,p=a?"a":"article",h=a?{href:a,target:"_blank",rel:"noopener noreferrer"}:{};return t.jsxs(p,{className:`image-card image-card--${n}`,onClick:s,...h,style:{position:"relative"},children:[r?.debugLogs&&e._scoreBreakdown&&t.jsxs("div",{className:"debug-badge",onClick:w=>{w.preventDefault(),w.stopPropagation(),m(!u)},style:{position:"absolute",top:"5px",right:"5px",zIndex:20,background:"rgba(0,0,0,0.7)",color:"#00ff41",fontSize:"0.6rem",padding:"2px 4px",borderRadius:"4px",cursor:"help",border:"1px solid #00ff41"},children:[e._scoreBreakdown.total.toFixed(1),u&&t.jsx("div",{style:{position:"absolute",top:"100%",right:0,width:"200px",background:"#111",border:"1px solid #333",padding:"8px",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",pointerEvents:"none"},children:Object.entries(e._scoreBreakdown).map(([w,v])=>w!=="total"&&typeof v=="number"&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[t.jsx("span",{style:{color:"#aaa",textTransform:"capitalize"},children:w}),t.jsx("span",{style:{color:"#fff"},children:v.toFixed(2)})]},w))})]}),g&&t.jsxs("div",{className:"image-card__media",children:[!c&&t.jsx("div",{className:"image-card__skeleton"}),t.jsx("img",{src:e.imageUrl,alt:e.title,className:`image-card__image ${c?"loaded":""}`,onLoad:()=>d(!0),onError:()=>l(!0),loading:"lazy"}),i&&t.jsx("div",{className:"image-card__badge",children:i}),t.jsx("div",{className:"image-card__overlay",children:t.jsx("span",{className:"image-card__source",children:e.source})})]}),t.jsxs("div",{className:"image-card__content",children:[t.jsx("h3",{className:"image-card__headline",children:e.title}),e.summary&&t.jsxs("p",{className:"image-card__summary",children:[e.summary.substring(0,150),"..."]}),t.jsxs("div",{className:"image-card__meta",children:[t.jsx("span",{className:"meta__time",children:e.time}),e.sentiment&&t.jsx("span",{className:`meta__sentiment meta__sentiment--${e.sentiment.label}`,children:e.sentiment.label==="positive"?"ðŸ“ˆ":e.sentiment.label==="negative"?"ðŸ“‰":"ï¿½"})]})]})]})}const Fa="https://en.wikipedia.org/api/rest_v1/feed/onthisday/selected",$a={fetchDailyFacts:async()=>{const e=new Date,n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),a=`${Fa}/${n}/${s}`;try{console.log(`[QuickFacts] Fetching from ${a}`);const i=await fetch(a);if(!i.ok)throw new Error("Wiki API Failed");const r=await i.json();return!r.selected||r.selected.length===0?[]:r.selected.sort(()=>.5-Math.random()).slice(0,5).map(c=>({text:c.text,year:c.year,pages:c.pages}))}catch(i){return console.warn("[QuickFacts] Fetch failed:",i),[{year:"1969",text:"The internet (ARPANET) sent its first message."},{year:"1990",text:"The first web page was published by Tim Berners-Lee."},{year:"2004",text:"Facebook was launched by Mark Zuckerberg."}]}}},on=["Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.","Octopuses have three hearts. Two pump blood to the gills, while one pumps it to the rest of the body.","Bananas are berries, but strawberries aren't.","The Eiffel Tower can be 15 cm taller during the summer due to thermal expansion.","A group of flamingos is called a 'flamboyance'.","Wombat poop is cube-shaped.","The shortest war in history lasted 38 minutes between Britain and Zanzibar in 1896.","Cleopatra lived closer in time to the Moon landing than to the construction of the Great Pyramid of Giza.","Sloths can hold their breath longer than dolphins (up to 40 minutes).","A cloud can weigh more than a million pounds.","The first computer bug was an actual moth trapped in a relay of the Harvard Mark II computer in 1947."];async function Ba(){try{const e=await $a.fetchDailyFacts();if(e&&e.length>0){const n=e[Math.floor(Math.random()*e.length)];return{text:`On this day in ${n.year}: ${n.text}`,year:n.year,isDynamic:!0}}return null}catch(e){return console.warn("OnThisDay fetch failed:",e),null}}function Pa(e){const n=[],s=new Set(["the","and","for","with","that","this","from","dead","kills","says","india","world","chennai","tamil","nadu"]),a=[...e.world||[],...e.india||[],...e.tech||[]];if(a.length===0)return null;a.forEach(l=>{if(!l.title)return;l.title.replace(/[^\w\s]/gi,"").toLowerCase().split(/\s+/).forEach(d=>{d.length>3&&!s.has(d)&&n.push(d)})});const i={};n.forEach(l=>i[l]=(i[l]||0)+1);const o=Object.entries(i).sort((l,c)=>c[1]-l[1]).slice(0,3).map(l=>l[0]);return o.length===0?null:{type:"TRENDING",icon:"ðŸ”¥",text:`Trending now: #${o.join(", #")}`}}function za(e){if(!e||Object.keys(e).length===0)return null;const n=Object.keys(e)[0],s=e[n];if(!s||!s.current)return null;const a=s.current.temp,i=s.current.condition.toLowerCase();let r="";return a>35?r=`It's a scorcher today at ${a}Â°C. Stay hydrated!`:a<20?r=`Cooler vibes today at ${a}Â°C.`:i.includes("rain")?r="Rainy skies today. Don't forget your umbrella.":r=`Currently ${a}Â°C and ${i}. A pleasant day ahead?`,{type:"WEATHER INSIGHT",icon:"ðŸŒ¤ï¸",text:r}}function Ha(e,n,s=null){const a=[];if(s&&s.isDynamic){const o={type:"ON THIS DAY",icon:"ðŸ“…",text:s.text};a.push(o),a.push(o),a.push(o)}else a.push({type:"DID YOU KNOW?",icon:"ðŸ’¡",text:on[Math.floor(Math.random()*on.length)]});const i=Pa(e);i&&a.push(i);const r=za(n);return r&&a.push(r),a[Math.floor(Math.random()*a.length)]}const Ne=[{start:"06:55",id:"morning_weather",label:"Morning Weather",name:"Morning Weather",icon:"ðŸŒ¤ï¸",focus:"weather"},{start:"07:00",id:"morning_news",label:"Morning News",name:"Morning News",icon:"â˜•",focus:"news_top"},{start:"09:00",id:"market_brief",label:"Market Brief",name:"Market Brief",icon:"ðŸ“ˆ",focus:"market"},{start:"11:55",id:"midday_brief",label:"Midday Brief",name:"Midday Brief",icon:"â˜€ï¸",focus:"news_all"},{start:"14:30",id:"market_movers",label:"Market Movers",name:"Market Movers",icon:"ðŸ“‰",focus:"market"},{start:"16:20",id:"evening_news",label:"Evening News",name:"Evening News",icon:"ðŸŒ†",focus:"news_all"},{start:"16:45",id:"local_events",label:"Local Events",name:"Local Events",icon:"ðŸ“",focus:"local"},{start:"19:30",id:"night_wrap",label:"Night Wrap-Up",name:"Night Wrap-Up",icon:"ðŸŒ™",focus:"summary"},{start:"20:00",id:"urgent_only",label:"Urgent Alerts Only",name:"Urgent Alerts Only",icon:"âš ï¸",focus:"breaking"}];function ln(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=Ne[Ne.length-1];for(let a=0;a<Ne.length;a++){const i=Ne[a],[r,o]=i.start.split(":").map(Number),l=r*60+o;if(n>=l)s=i;else break}return s}function Ua(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=null;for(const i of Ne){const[r,o]=i.start.split(":").map(Number);if(r*60+o>n){s=i;break}}let a=new Date(e);if(s){const[i,r]=s.start.split(":").map(Number);a.setHours(i,r,0,0)}else{const[i,r]=Ne[0].start.split(":").map(Number);a.setDate(a.getDate()+1),a.setHours(i,r,0,0)}return Math.max(0,a.getTime()-e.getTime())}function Zn(e,n={}){Notification.permission==="granted"&&(navigator.serviceWorker&&navigator.serviceWorker.ready?navigator.serviceWorker.ready.then(s=>{s.showNotification(e,{icon:"./vite.svg",badge:"./vite.svg",vibrate:[200,100,200],requireInteraction:!0,...n})}):new Notification(e,{icon:"./vite.svg",...n}))}const es=x.createContext();function Wa({children:e}){const[n,s]=x.useState(()=>ln());return x.useEffect(()=>{let a;const i=()=>{const r=Ua()+2e3;console.log(`[Segment] Next switch in ${(r/6e4).toFixed(1)} min`),a=setTimeout(()=>{const o=ln();console.log(`[Segment] Switching to ${o.label}`),s(o),Zn(`${o.icon} ${o.label}`,{body:"New content available. Tap to refresh.",tag:"segment-update",renotify:!0}),i()},r)};return i(),()=>clearTimeout(a)},[]),t.jsx(es.Provider,{value:{currentSegment:n,SEGMENTS:Ne},children:e})}function Ga(){return x.useContext(es)}function rt(){const[e,n]=x.useState(!1),[s,a]=x.useState(!1),[i,r]=x.useState(!1),[o,l]=x.useState(typeof window<"u"?window.innerWidth:0);return x.useEffect(()=>{const c=()=>{const d=window.innerWidth;l(d);const u=d>=1024,m=d>=768&&d<1024;n(u),a(m),r(u),console.log(`[Layout] Width: ${d}px, Mode: ${u?"desktop":m?"tablet":"mobile"}`)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),{isDesktop:e,isTablet:s,isWebView:i,screenWidth:o}}function Ka(e){return Te({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"},child:[]}]})(e)}function Va(e){return Te({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function qa(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(e)}function Ya(e){return Te({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"},child:[]}]})(e)}function Ja(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"},child:[]}]})(e)}function Xa(e){return Te({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H88c-13.255 0-24 10.745-24 24v8H24c-13.255 0-24 10.745-24 24v272c0 30.928 25.072 56 56 56h472c26.51 0 48-21.49 48-48V88c0-13.255-10.745-24-24-24zM56 400a8 8 0 0 1-8-8V144h16v248a8 8 0 0 1-8 8zm236-16H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm-208-96H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm0-96H140c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h360c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12z"},child:[]}]})(e)}function Qa(e){return Te({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(e)}const Za=()=>{const{settings:e}=se(),{currentSegment:n}=Ga(),[s,a]=x.useState(Notification.permission),[i,r]=x.useState(null),[o,l]=x.useState(null),{isWebView:c,isDesktop:d}=rt(),{weatherData:u,loading:m,refreshWeather:g}=Ke(),{newsData:p,loading:h,errors:w,breakingNews:v,refreshNews:S,loadSection:f,loadedSections:_}=Ge(),{sections:T,uiMode:L="timeline"}=e,[k,O]=x.useState([]);x.useEffect(()=>{if(!p.frontPage){O([]);return}if(e.customSortTopStories){let y=p.frontPage.filter(I=>!(Us(I.id)||$n(I.id)>3));y.sort((I,P)=>(P.impactScore||0)-(I.impactScore||0));const b=10;if(y.length<b){const I=new Set(y.map(E=>E.id)),P=p.frontPage.filter(E=>!I.has(E.id));P.sort((E,R)=>(R.impactScore||0)-(E.impactScore||0));const N=b-y.length;y=[...y,...P.slice(0,N)]}O(y)}else O(p.frontPage)},[p.frontPage,e.customSortTopStories]),x.useEffect(()=>{g(),S()},[n.id,S,g]),x.useEffect(()=>{Ba().then(y=>{y&&l(y)})},[]),x.useEffect(()=>{const y=p&&Object.keys(p).length>0,b=u&&Object.keys(u).length>0;(y||b||o)&&r(Ha(p,u,o))},[h,m,p,u,o]);const[M,F]=x.useState(!1);x.useEffect(()=>{const y=()=>{window.scrollY>400?F(!0):F(!1)};return window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)},[]);const D=()=>{window.scrollTo({top:0,behavior:"smooth"})};x.useEffect(()=>{let y=0,b=!1;const I=E=>{window.scrollY===0&&(y=E.touches[0].clientY,b=!0)},P=E=>{b&&E.touches[0].clientY},N=E=>{if(!b)return;E.changedTouches[0].clientY-y>150&&window.scrollY===0&&(S(),g()),b=!1};return d||(document.addEventListener("touchstart",I),document.addEventListener("touchmove",P),document.addEventListener("touchend",N)),()=>{document.removeEventListener("touchstart",I),document.removeEventListener("touchmove",P),document.removeEventListener("touchend",N)}},[S,g,d]);const W=m&&!u||h&&Object.keys(p).length===0,j=W?1:3,C=L==="timeline",B=n.id==="urgent_only",z=[{id:"top-stories",icon:"â­",label:"Top"},T.india?.enabled&&{id:"india-news",icon:"ðŸ‡®ðŸ‡³",label:"India"},T.chennai?.enabled&&{id:"chennai-news",icon:"ðŸ›ï¸",label:"Tamil Nadu"},T.local?.enabled&&{id:"local-news",icon:"ðŸ“",label:"Muscat"}].filter(Boolean),A=t.jsxs("div",{className:"header__actions",children:[t.jsx(ze,{to:"/refresh",className:"header__action-btn",children:"ðŸ”„"}),t.jsx(ze,{to:"/settings",className:"header__action-btn",children:"âš™ï¸"})]});return t.jsxs("div",{className:`page-container mode-${L} ${c?"page-container--desktop":""}`,children:[C?t.jsx(xa,{title:n.id==="market_brief"?"":n.label,icon:n.icon,actions:A,loadingPhase:j}):t.jsx(ke,{title:n.label,icon:n.icon,actions:A,loadingPhase:j}),t.jsxs("main",{className:`main-content ${c?"main-content--desktop":""}`,children:[W&&t.jsxs("div",{className:"loading",style:{padding:"40px"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Updates..."})]}),c?t.jsxs("div",{className:"main-page-grid",children:[t.jsxs("div",{className:"left-col",children:[t.jsx(sn,{}),t.jsxs("div",{className:"modern-card",style:{marginTop:"20px"},children:[t.jsx("div",{className:"modern-card__header",children:t.jsx("h2",{className:"modern-card__title",children:"ðŸŒ Global News"})}),t.jsx("div",{className:"newspaper-column",children:(p.world||[]).slice(0,8).map((y,b)=>t.jsxs("a",{href:y.link,target:"_blank",rel:"noopener noreferrer",className:"newspaper-item",children:[t.jsx("div",{className:"newspaper-item__title",children:y.title}),t.jsxs("div",{className:"newspaper-item__meta",children:[y.source," â€¢ ",y.time]})]},b))})]})]}),t.jsx("div",{className:"right-col",children:t.jsxs("div",{className:"news-sections",children:[k.length>0&&t.jsx(le,{id:"top-stories",title:"Top Stories",icon:"â­",colorClass:"news-section__title--world",news:k,maxDisplay:10}),T.india?.enabled&&t.jsx(le,{id:"india-news",title:"India News",icon:"ðŸ‡®ðŸ‡³",colorClass:"news-section__title--india",news:p.india,maxDisplay:T.india.count||5}),T.chennai?.enabled&&t.jsx(le,{id:"chennai-news",title:"Tamil Nadu",icon:"ðŸ›ï¸",colorClass:"news-section__title--chennai",news:p.chennai,maxDisplay:T.chennai.count||5}),T.local?.enabled&&t.jsx(le,{id:"local-news",title:"Muscat / Local",icon:"ðŸ“",colorClass:"news-section__title--local",news:p.local,maxDisplay:T.local.count||5})]})})]}):t.jsxs("div",{className:"content-wrapper",children:[!C&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"topline",children:[t.jsxs("div",{className:"topline__label",style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:i?.icon||"ðŸ“°"}),t.jsx("span",{children:i?.type||"TOPLINE"})]}),t.jsx("div",{className:"topline__text",children:i?.text||La(n)})]}),t.jsx(ya,{items:v})]}),t.jsx(sn,{}),t.jsx("div",{className:"news-sections",children:(!B||v.length===0)&&t.jsxs(t.Fragment,{children:[k.length>0&&t.jsx(le,{id:"top-stories",title:"Top Stories",icon:"â­",colorClass:"news-section__title--world",news:k,maxDisplay:10}),T.india?.enabled&&t.jsx(le,{id:"india-news",title:"India",icon:"ðŸ‡®ðŸ‡³",colorClass:"news-section__title--india",news:p.india,maxDisplay:T.india.count||5}),T.chennai?.enabled&&t.jsx(le,{id:"chennai-news",title:"Tamil Nadu",icon:"ðŸ›ï¸",colorClass:"news-section__title--chennai",news:p.chennai,maxDisplay:T.chennai.count||5}),T.local?.enabled&&t.jsx(le,{id:"local-news",title:"Muscat",icon:"ðŸ“",colorClass:"news-section__title--local",news:p.local,maxDisplay:T.local.count||5}),t.jsx(le,{id:"world-news",title:"World",icon:"ðŸŒ",colorClass:"news-section__title--world",news:p.world,maxDisplay:T.world?.count||5})]})})]}),e.debugLogs&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"var(--spacing-md)",padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:"var(--radius-sm)",fontSize:"0.7rem",color:"var(--text-muted)",flexWrap:"wrap"},children:[t.jsxs("span",{title:"Segment",children:[n.icon," ",n.label]}),t.jsx("span",{title:"Notifications",children:s==="granted"?"ðŸ””":"ðŸ”•"}),t.jsxs("span",{title:"UI Mode",children:["ðŸ“± ",L]})]})]}),t.jsx(kt,{sections:z}),t.jsx("button",{onClick:D,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:M?1:0,pointerEvents:M?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},className:"back-to-top",children:"â†‘"})]})};function er(e="ua_watchlist"){const[n,s]=x.useState(()=>{try{return JSON.parse(localStorage.getItem(e))||[]}catch{return[]}});return{watchlist:n,toggleWatchlist:r=>{let o;n.includes(r)?o=n.filter(l=>l!==r):o=[...n,r],s(o),localStorage.setItem(e,JSON.stringify(o))},isWatched:r=>n.includes(r)}}const tr=(e,n)=>{const s=new Date,a=s.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",i=new Date(s.getTime()+3600*1e3).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",r=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${e}
DESCRIPTION:${n}
DTSTART:${a}
DTEND:${i}
END:VEVENT
END:VCALENDAR`,o=new Blob([r],{type:"text/calendar"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`${e.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.ics`,c.click(),URL.revokeObjectURL(l)},ts={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},xt=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Ce=Object.keys(ts).filter(e=>e.length>2).join("|"),nr=/\b(\d{4})-(\d{1,2})-(\d{1,2})\b/,sr=/\b(\d{1,2})[/-](\d{1,2})[/-](\d{4})\b/,ir=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s-]+(\\d{4}))?\\b`,"i"),ar=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${Ce})(?:[-\\s,]+(\\d{4}))?\\b`,"i"),rr=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),or=new RegExp(`\\b(${Ce})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),lr=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-)\\s*(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${Ce})\\b`,"i"),cr=/\bnext\s+(\d+)\s+(day|week)s?\b/,dr=new RegExp(`\\b(?:ends?|last date|deadline|valid (?:till|until)|expires?|before)\\s+(?:on\\s+)?(${Ce})\\s+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s]+(\\d{4}))?\\b`,"i");function _e(e){return ts[e.toLowerCase().slice(0,3)]??null}function fe(e,n,s){const a=new Date(s.getFullYear(),e,n);return a<s&&s-a>30*864e5&&a.setFullYear(a.getFullYear()+1),a}function ur(e,n){const s=e.match(nr);if(s)return{start:new Date(+s[1],+s[2]-1,+s[3]),end:null,type:"iso"};const a=e.match(sr);return a?{start:new Date(+a[3],+a[2]-1,+a[1]),end:null,type:"numeric"}:null}function hr(e,n){const s=e.match(ir);if(s){const i=_e(s[1]),r=+s[2],o=s[3]?+s[3]:null;return{start:o?new Date(o,i,r):fe(i,r,n),end:null,type:"named"}}const a=e.match(ar);if(a){const i=_e(a[2]),r=+a[1],o=a[3]?+a[3]:null;return{start:o?new Date(o,i,r):fe(i,r,n),end:null,type:"named"}}return null}function mr(e,n){const s=e.match(rr);if(s)return{start:fe(_e(s[1]),+s[2],n),end:fe(_e(s[3]),+s[4],n),type:"range"};const a=e.match(or);if(a){const r=_e(a[1]);return{start:fe(r,+a[2],n),end:fe(r,+a[3],n),type:"range"}}const i=e.match(lr);if(i){const r=_e(i[3]);return{start:fe(r,+i[1],n),end:fe(r,+i[2],n),type:"range"}}return null}function pr(e,n){const s=e.toLowerCase();if(!/tomorrow|today|next|this|week|weekend/.test(s))return null;if(/\btomorrow\b/.test(s)){const i=new Date(n);return i.setDate(i.getDate()+1),{start:i,end:null,type:"relative"}}if(/\btoday\b/.test(s))return{start:new Date(n),end:null,type:"relative"};const a=s.match(cr);if(a){const i=+a[1],r=a[2]==="week"?7:1,o=new Date(n);return o.setDate(o.getDate()+i*r),{start:new Date(n),end:o,type:"relative"}}if(/\bnext week\b/.test(s)){const i=new Date(n);i.setDate(i.getDate()+(7-i.getDay()+1));const r=new Date(i);return r.setDate(r.getDate()+6),{start:i,end:r,type:"relative"}}for(let i=0;i<xt.length;i++){if(!s.includes(xt[i]))continue;if(new RegExp(`\\b(?:this|next|coming)\\s+${xt[i]}\\b`,"i").test(e)){const o=new Date(n);let l=(i-o.getDay()+7)%7;return l===0&&(l=7),o.setDate(o.getDate()+l),{start:o,end:null,type:"relative"}}}if(/\bthis weekend\b/.test(s)){const i=new Date(n);i.setDate(i.getDate()+(6-i.getDay()+7)%7);const r=new Date(i);return r.setDate(r.getDate()+1),{start:i,end:r,type:"relative"}}return null}function gr(e,n){const s=e.match(dr);if(s){const a=_e(s[1]),i=+s[2],r=s[3]?+s[3]:null,o=r?new Date(r,a,i):fe(a,i,n);return{start:new Date(n),end:o,type:"deadline"}}return null}function Ct(e,n){if(!e)return null;const s=n?new Date(n):new Date;return isNaN(s.getTime())?null:ur(e)||mr(e,s)||gr(e,s)||hr(e,s)||pr(e,s)}function fr(e,n=14){if(!e?.start)return[];const s=[],a=new Date(e.start);a.setHours(0,0,0,0);const i=e.end?new Date(e.end):new Date(a);i.setHours(0,0,0,0);let r=new Date(a);for(;r<=i&&s.length<n;)s.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return s}const me="upAhead_planner",Ze="upAhead_blacklist",et="/api",re={sync:async()=>{try{const e=await fetch(`${et}/blacklist`);if(e.ok){const s=await e.json(),a=re.getBlacklist(),i=new Set([...a,...s]);localStorage.setItem(Ze,JSON.stringify([...i]))}const n=await fetch(`${et}/user_plan`);if(n.ok){const s=await n.json(),a=localStorage.getItem(me),r={...a?JSON.parse(a):{},...s};localStorage.setItem(me,JSON.stringify(r))}console.log("[PlannerStorage] Synced with server")}catch(e){console.warn("[PlannerStorage] Sync failed",e)}},getUpcomingDays:(e=14)=>{try{const n=localStorage.getItem(me);if(!n)return[];const s=JSON.parse(n),a=new Date().toISOString().split("T")[0];return Object.entries(s).filter(([r])=>r>=a).sort((r,o)=>r[0].localeCompare(o[0])).slice(0,e).map(([r,o])=>({date:r,items:o}))}catch(n){return console.error("Failed to read planner storage",n),[]}},addItem:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};return a[e]||(a[e]=[]),a[e].some(i=>i.id===n.id)?!1:(a[e].push(n),localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a),!0)}catch(s){return console.error("Failed to add item to planner",s),!1}},removeItem:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};return a[e]?(a[e]=a[e].filter(i=>i.id!==n),a[e].length===0&&delete a[e],localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a),!0):!1}catch(s){return console.error("Failed to remove item",s),!1}},merge:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};let i=!1;e.forEach(r=>{a[r]||(a[r]=[]);const o=new Set(a[r].map(l=>l.id));n.forEach(l=>{o.has(l.id)||(a[r].push(l),i=!0)})}),i&&(localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a))}catch(s){console.error("Merge failed",s)}},savePlanToApi:async e=>{try{await fetch(`${et}/user_plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save plan error:",n)}},addToBlacklist:e=>{try{const n=JSON.parse(localStorage.getItem(Ze)||"[]");n.includes(e)||(n.push(e),localStorage.setItem(Ze,JSON.stringify(n)),re.saveBlacklistToApi(n))}catch(n){console.error("Failed to blacklist",n)}},getBlacklist:()=>{try{return new Set(JSON.parse(localStorage.getItem(Ze)||"[]"))}catch{return new Set}},saveBlacklistToApi:async e=>{try{await fetch(`${et}/blacklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save blacklist error:",n)}}},ns="upAhead_cache";function yr(){try{const e=localStorage.getItem(ns);if(e){const n=JSON.parse(e);return Date.now()-new Date(n.lastUpdated||0).getTime()>480*60*1e3&&console.log("[UpAheadService] Cache is older than 8 hours."),n}}catch(e){console.warn("Cache read error",e)}return null}function xr(e){try{localStorage.setItem(ns,JSON.stringify(e))}catch(n){console.warn("Cache write error",n)}}const cn=new Map;function wr(e,n){let s=cn.get(n);if(!s){const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=new RegExp(`\\b${a}\\b`,"i"),cn.set(n,s)}return s.test(e)}function vr(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function br(e,n){const s=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");return vr(`${s}-${n}`)}function Be(e,n){const s=e.toLowerCase(),a=n.toLowerCase();return n.includes(" ")?s.includes(a):wr(s,a)}const Sr={movies:["Tamil movie release this week","new movie release OTT","BookMyShow Chennai movies","upcoming movies Kollywood","movie tickets showtimes"],events:["Chennai events this week","LiveChennai events","concert tickets Chennai","standup comedy show Chennai","exhibition workshops Chennai","things to do Chennai weekend","Muscat events this week","Muscat concerts exhibitions","theatre shows Chennai this week","art exhibition Chennai","food festival Chennai","cultural event Chennai","music sabha Chennai","Muscat Royal Opera House events"],festivals:["Maha Shivaratri 2025 date","upcoming festivals Tamil Nadu 2025","bank holidays India upcoming","public holidays Tamil Nadu","religious festivals this month India","Oman festivals holidays"],alerts:["TANGEDCO power cut Chennai tomorrow","TNEB power shutdown schedule","Chennai traffic advisory today","Chennai metro maintenance","water supply disruption Chennai","road closure Chennai"],weather_alerts:["IMD Chennai weather warning","Tamil Nadu heavy rain alert","cyclone warning Chennai","heat wave advisory Tamil Nadu","Oman weather warning Muscat"],sports:["IPL 2026 schedule matches","cricket match Chennai CSK","ISL football match schedule","Pro Kabaddi schedule","sports events Chennai this week"],shopping:["Chennai sale offers discount today","exhibition sale Chennai","Pongal sale Tamil Nadu","Diwali offers Chennai","end of season sale Chennai mall","Muscat shopping festival offers"],airlines:["Oman Air flight offers","Indigo Airlines offers","Salam Air ticket offers","Air India sale","flight ticket offers India"],civic:["VIP visit Chennai road closure","minister visit Tamil Nadu traffic","protest bandh Chennai tomorrow","Chennai corporation announcement","Muscat road closure traffic"]},dn={movies:["https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/bollywood/rssfeed.xml"],sports:["https://www.espn.com/espn/rss/news"],festivals:["https://www.timeanddate.com/holidays/india/feed"],events:["https://www.thehindu.com/news/cities/chennai/feeder/default.rss"]};async function jr(){try{const s=`${"./".endsWith("/")?"./":".//"}data/up_ahead.json`,a=await fetch(s);if(!a.ok)return console.warn(`[UpAheadService] Static fetch failed: ${a.status}`),null;const i=await a.json();return i.error?(console.warn(`[UpAheadService] Static data has error: ${i.error}`),null):i}catch(e){return console.error("[UpAheadService] Static fetch exception:",e),null}}function un(e,n){if(!e)return n;if(!n)return e;const s={...e},a=new Map;return e.timeline&&e.timeline.forEach(i=>{a.set(i.date,{...i,items:[...i.items||[]]})}),n.timeline&&n.timeline.forEach(i=>{if(!a.has(i.date))a.set(i.date,i);else{const r=a.get(i.date),o=new Set(r.items.map(l=>l.id));i.items.forEach(l=>{o.has(l.id)||(r.items.push(l),o.add(l.id))})}}),s.timeline=Array.from(a.values()).sort((i,r)=>i.date.localeCompare(r.date)),n.sections&&(s.sections||(s.sections={}),Object.keys(n.sections).forEach(i=>{const r=s.sections[i]||[],o=n.sections[i]||[],l=new Set(r.map(d=>d.title)),c=[...r];o.forEach(d=>{l.has(d.title)||(c.push(d),l.add(d.title))}),s.sections[i]=c})),s.weekly_plan=is(s.timeline,new Set),s.lastUpdated=n.lastUpdated||e.lastUpdated,s}async function Nr(e){const n=Date.now();console.log("[UpAheadService] Fetching LIVE data with settings:",e);const s=e?.categories||{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0},a=e?.locations&&e.locations.length>0?e.locations:["Chennai","India"],i=e?.keywords||oe.upAhead.keywords;let r=[];const o=[],l=h=>{const w=encodeURIComponent(h);o.push({url:`https://news.google.com/rss/search?q=${w}+when:7d&hl=en-IN&gl=IN&ceid=IN:en`,type:"search",originalQuery:h})};for(const[h,w]of Object.entries(s)){if(!w)continue;dn[h]&&dn[h].forEach(S=>{o.push({url:S,type:"static",category:h})}),(Sr[h]||[]).forEach(S=>{h==="events"||h==="alerts"||h==="movies"?a.forEach(f=>{f.toLowerCase()==="india"&&(h==="alerts"||h==="events")||l(`${S} ${f}`)}):h==="shopping"||h==="airlines"?a.forEach(f=>{l(`${S} ${f}`)}):l(`${S}`)})}const c=[...new Map(o.map(h=>[h.url,h])).values()];console.log(`[UpAheadService] Prepared ${c.length} feeds to fetch.`);const d=c.map(async h=>{try{const{items:w}=await Gn.fetchViaProxy(h.url);return w.map(v=>_r(v,h,i))}catch(w){return console.warn(`[UpAheadService] Failed to fetch ${h.url}:`,w.message),[]}}),u=await Promise.allSettled(d);for(let h=0;h<u.length;h++)u[h].status==="fulfilled"?r.push(...u[h].value):console.warn("[UpAheadService] A feed failed to load:",u[h].reason);const m=Er(r,e);try{for(const h of r)if(h.extractedDate){const w=Ct(`${h.title} ${h.description||""}`,h.pubDate);if(w){const v=fr(w);v.length>0&&re.merge(v,[{id:h.id,title:h.title,category:h.category,link:h.link}])}}}catch(h){console.warn("[UpAhead] Planner storage write failed",h)}const g=Date.now()-n,p=m?.timeline?.reduce((h,w)=>h+(w.items?.length||0),0)||0;return he.success("upAhead",`LIVE: ${p} items from ${c.length} feeds`,{durationMs:g}),m}function St(e){if(!e)return"";let n=e.toString();const s={"&nbsp;":" ","&amp;":"&","&quot;":'"',"&#39;":"'","&lt;":"<","&gt;":">"};return n=n.replace(/&[a-z0-9#]+;/gi,a=>s[a]||a),n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,""),n=n.replace(/<style[^>]*>([\S\s]*?)<\/style>/gmi,""),n=n.replace(/<\/?[^>]+(>|$)/g,""),n.trim()}function _r(e,n,s=null){const a=St(e.title||""),i=e.description||"",r=St(i),o=`${a} ${r}`;let l=e.pubDate?new Date(e.pubDate):null;l&&isNaN(l.getTime())&&(l=null);let c=n.category;(!c||n.type==="search")&&(c=Cr(o,s));let d=null;const u=Ct(o,l);u?.start?c==="shopping"&&u.end?d=u.end:d=u.start:d=ss(o,l);let m=[],g=!1;/ott|releases|week/i.test(a)&&/\d+ new/i.test(a)&&(g=!0),g&&c==="movies"&&(m=kr(i,l));const p=d?d.toISOString().slice(0,10):l?l.toISOString().slice(0,10):"nodate",h=br(a,p);return{id:e.guid||e.link||a,canonicalId:h,title:a,link:e.link,description:r,pubDate:l,extractedDate:d,category:c,rawSource:n.originalQuery||"feed",isRoundup:g,subItems:m}}function kr(e,n){const s=[],a=e.split(/<br\s*\/?>|\n|<\/li>|<\/p>|â€¢/i),i=["netflix","prime","prime video","hotstar","sony liv","zee5","jiocinema","aha","sunnxt","hulu","disney"],r=new RegExp(`\\b(${i.sort((o,l)=>l.length-o.length).join("|")})\\b`,"i");return a.forEach(o=>{const l=St(o).trim();if(l.length<5)return;const c=r.test(l),d=ss(l,n);if(c||d){let u=l.replace(/^\d+\.\s*/,"").replace(/^[-\u2013\u2014]\s*/,"").replace(/\(.*\)/g,"").trim();if(u.length<3)return;const m=l.match(r),g=m?m[0]:"OTT";s.push({title:u,date:d,originalText:l,platform:g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()})}}),s}function Cr(e,n=null){const s=e.toLowerCase(),a=n||oe.upAhead.keywords,i=r=>r&&r.some(o=>Be(s,o));return s.includes("arrest")||s.includes("held for")||s.includes("police")||s.includes("seized")||s.includes("murder")||s.includes("crime")||s.includes("jail")||s.includes("court")||s.includes("bail")||s.includes("clinic")&&s.includes("unregistered")?"general":i(a.weather_alerts)?"weather_alerts":i(a.alerts)?"alerts":i(a.movies)?(a.movies_negative||[]).some(o=>Be(s,o))?"general":"movies":i(a.sports)?(a.sports_negative||[]).some(o=>Be(s,o))?"general":"sports":i(a.airlines)?"airlines":i(a.shopping)?"shopping":i(a.festivals)?"festivals":i(a.civic)?"civic":i(a.events)?"events":"general"}function ss(e,n){return Ct(e,n)?.start||null}function Er(e,n){const s=new Date;s.setHours(0,0,0,0);const a=new Map,i={movies:[],festivals:[],alerts:[],events:[],sports:[],shopping:[],civic:[],weather_alerts:[],airlines:[]},r=new Set,l=(n?.hideOlderThanHours||336)*60*60*1e3,c={weather_alerts:6,alerts:12,festivals:336},d=n?.keywords||n?.upAhead?.keywords||oe.upAhead.keywords,u=f=>{let _=d.negative&&d.negative.length>0?d.negative:oe.upAhead.keywords.negative;const T=`${f}_negative`,L=d[T]&&d[T].length>0?d[T]:oe.upAhead.keywords[T]||[];return[...new Set([..._,...L])]},m=n?.signals||oe.upAhead.signals,g={};["movies","events","festivals","alerts","sports","shopping","civic","weather_alerts","airlines"].forEach(f=>{g[f]=d[f]&&d[f].length>0?d[f]:oe.upAhead.keywords[f]||[]});const h=(n?.locations||n?.upAhead?.locations||["Chennai","Muscat","Trichy"]).map(f=>f.toLowerCase());e.forEach(f=>{if(r.has(f.id)||(r.add(f.id),!f.pubDate||isNaN(f.pubDate.getTime())))return;const _=Date.now()-f.pubDate.getTime();let T=l;if(c[f.category]){const R=c[f.category]*60*60*1e3;T=Math.min(l,R)}const L=["movies","events","sports","shopping","civic","festivals","airlines"].includes(f.category),k=f.extractedDate&&f.extractedDate>=s;if(!L&&!k&&_>T)return;const O=(f.title+" "+f.description).toLowerCase(),M=/(?:â€¢|-|published)\s*(\d+)\s*(mo|month|months|w|week|weeks|y|year|years)\s*(?:ago)?/i,F=O.match(M);if(F){const R=parseInt(F[1]),$=F[2].toLowerCase();if($.startsWith("mo")||$.startsWith("y")||$.startsWith("w")&&R>=1)return}const D=/ott|releases|week|weekend/i.test(O)&&/\d+ new/i.test(O);let W=0;const j=n?.ranking?.[f.category]||n?.upAhead?.ranking?.[f.category]||{},C=j.positiveMultiplier||1,B=j.negativeMultiplier||1,z=j.filterThreshold||0,A=g[f.category]||[],y=u(f.category),b=A.reduce((R,$)=>Be(O,$.toLowerCase())?R+1:R,0),I=y.reduce((R,$)=>Be(O,$.toLowerCase())?R+1:R,0);W=b*C-I*B;const P=m.reduce((R,$)=>O.includes($)?R+1:R,0);if(W+=P*.5,["movies","events","shopping","airlines","sports","festivals"].includes(f.category)&&W<z||!D&&I>0&&W<=0||L&&!f.extractedDate&&!f.isRoundup&&b===0&&P===0||(f.category==="alerts"||f.category==="civic")&&!h.some($=>O.includes($)))return;if(f._forwardScore=W,f.category&&i[f.category]){if((f.category==="movies"||f.category==="events"||f.category==="festivals")&&!f.extractedDate&&!f.isRoundup||L&&!f.extractedDate&&!f.isRoundup&&W<=0)return;if(f.category==="festivals"&&f.extractedDate){if((f.extractedDate.getTime()-s.getTime())/(1e3*3600*24)<-3)return}else if(L&&f.extractedDate&&f.extractedDate<s)return;let R=null;!f.extractedDate&&["shopping","alerts","weather_alerts","civic"].includes(f.category)&&(R=f.pubDate?f.pubDate.toDateString():null);const $={title:f.title,link:f.link,releaseDate:f.extractedDate?f.extractedDate.toDateString():R,date:f.extractedDate?f.extractedDate.toDateString():R,text:f.title,severity:"medium",language:"Unknown",isRoundup:f.isRoundup,subItemsCount:f.subItems?f.subItems.length:0};i[f.category].push($)}let E=f.extractedDate;if(!E&&(f.category==="alerts"||f.category==="weather_alerts")){const R=f.category==="weather_alerts"?12:24;if(f.pubDate&&Date.now()-f.pubDate.getTime()<R*60*60*1e3)E=s;else return}if(!E&&f.isRoundup&&(E=s),!E&&W>0&&L&&["shopping","airlines","alerts","weather_alerts","civic"].includes(f.category)&&f.pubDate&&Date.now()-f.pubDate.getTime()<2880*60*1e3&&(E=s),E&&E>=s){const R=E.toISOString().split("T")[0];a.has(R)||a.set(R,{date:R,dayLabel:Tr(E),items:[]});const $={id:f.id,type:Ar(f.category),title:f.title,subtitle:f.isRoundup?`${f.subItems?.length||"Multiple"} ITEMS`:f.category.toUpperCase(),description:f.description,tags:[f.category],link:f.link,isRoundup:f.isRoundup,subItems:f.subItems,_forwardScore:f._forwardScore||0};a.get(R).items.push($)}});const w=Array.from(a.values()).sort((f,_)=>f.date.localeCompare(_.date));w.forEach(f=>{f.items.sort((_,T)=>(T._forwardScore||0)-(_._forwardScore||0)),f.items.forEach(_=>delete _._forwardScore)}),Object.keys(i).forEach(f=>{i[f].sort((_,T)=>_.date&&T.date?new Date(_.date)-new Date(T.date):0),i[f]=i[f].slice(0,10)});const v=re.getBlacklist?re.getBlacklist():new Set,S=is(w,v);return{timeline:w,sections:i,weekly_plan:S,lastUpdated:new Date().toISOString()}}function Tr(e){const n=new Date;n.setHours(0,0,0,0);const s=new Date(n);s.setDate(s.getDate()+1);const a=new Date(e);return a.setHours(0,0,0,0),a.getTime()===n.getTime()?"Today":a.getTime()===s.getTime()?"Tomorrow":a.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}function Ar(e){return{movies:"movie",events:"event",festivals:"festival",alerts:"alert",sports:"sport",shopping:"shopping",civic:"civic",weather_alerts:"weather_alert",airlines:"airline"}[e]||"event"}function is(e,n=new Set){const s=[],a=new Date,i=r=>{const o=["th","st","nd","rd"],l=r%100;return r+(o[(l-20)%10]||o[l]||o[0])};for(let r=0;r<7;r++){const o=new Date(a);o.setDate(a.getDate()+r);const l=o.toISOString().split("T")[0],c=o.toLocaleDateString("en-US",{weekday:"long"}),d=o.toLocaleDateString("en-US",{month:"short"}),u=o.getDate(),m=`${i(u)} ${d}`,g=e.find(h=>h.date===l);let p=[];g&&g.items.length>0&&(p=g.items.filter(w=>!(w.type==="festival"||n.has(w.id))).slice(0,10).map(w=>({id:w.id,title:w.title,type:w.type,icon:Ir(w.type),link:w.link,description:w.description,isOffer:w.type==="shopping"||w.type==="airline"}))),s.push({day:c,date:m,items:p})}return s}function Ir(e){return{movie:"ðŸŽ¬",event:"ðŸŽ­",festival:"ðŸŽŠ",alert:"âš ï¸",sport:"âš½",shopping:"ðŸ›’",civic:"ðŸ›ï¸",entertainment:"ðŸŽ¶",weather_alert:"ðŸŒªï¸",airline:"âœˆï¸",general:"ðŸ“…"}[e]||"ðŸ“…"}function Mr(){const{settings:e}=se(),[n,s]=x.useState(null),[a,i]=x.useState(!0),[r,o]=x.useState(!1),[l,c]=x.useState(0),[d,u]=x.useState("plan"),[,m]=x.useState(re.getBlacklist?re.getBlacklist():new Set),{toggleWatchlist:g,isWatched:p}=er(),h=x.useCallback(async(j=!1)=>{if(j?(o(!0),c(1)):(i(!0),c(0)),!j){const C=yr();C&&(s(C),i(!1),c(1))}try{const C=await jr();C&&(s(B=>un(B,C)),j||c(2),i(!1))}catch(C){console.warn("Static fetch failed",C)}o(!0);try{const C=e.upAhead||{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},locations:["Chennai"]},B=await Nr(C);s(z=>{const A=un(z,B);return xr(A),A}),c(3)}catch(C){console.error("Failed to load Live Up Ahead data",C)}finally{o(!1),i(!1)}},[e.upAhead]);x.useEffect(()=>{h(!1)},[h]);const w=j=>{j&&re.addToBlacklist&&(re.addToBlacklist(j),m(re.getBlacklist()),h(!1))},v=(j,C)=>{re.addItem(C,{id:j.id,title:j.title,category:j.tags?.[0]||"event",link:j.link,description:j.description}),alert("Added to Plan!")},S=j=>{if(!j)return"Coming Soon";const C=new Date(j);if(isNaN(C.getTime()))return j;const B=C.toLocaleDateString("en-US",{weekday:"short"}),z=C.getDate().toString().padStart(2,"0"),A=C.toLocaleDateString("en-US",{month:"short"});return`${B}, ${z} ${A}`},f=({item:j,colorClass:C})=>t.jsxs("div",{className:"poster-card",style:{minWidth:"220px",scrollSnapAlign:"start"},children:[t.jsx("div",{style:{height:"100%",width:"100%",background:"linear-gradient(135deg, var(--bg-secondary), var(--bg-card))",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",opacity:.3},children:d==="movies"?"ðŸŽ¬":"ðŸ“…"}),t.jsxs("div",{className:"poster-card__content",children:[t.jsx("div",{className:`ua-badge ${C}`,style:{marginBottom:"8px",display:"inline-block"},children:S(j.date||j.releaseDate)}),t.jsx("div",{className:"poster-card__title",children:j.title}),t.jsx("div",{style:{fontSize:"0.8rem",opacity:.8,marginTop:"4px"},children:j.description?j.description.length>60?j.description.substring(0,60)+"...":j.description:""}),t.jsxs("div",{style:{marginTop:"12px",display:"flex",gap:"8px"},children:[t.jsx("a",{href:j.link,target:"_blank",rel:"noopener noreferrer",className:"btn btn--secondary",style:{padding:"4px 8px",fontSize:"0.7rem"},children:"Details"}),t.jsx("button",{className:"btn btn--primary",onClick:()=>v(j,j.date||j.releaseDate),style:{padding:"4px 8px",fontSize:"0.7rem"},children:"+ Plan"})]})]})]}),_=({items:j,colorClass:C,emptyMessage:B})=>!j||j.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:B})}):t.jsx("div",{className:"timeline-card-row",style:{padding:"10px 0"},children:j.map((z,A)=>t.jsx(f,{item:z,colorClass:C},A))}),T=({items:j,colorClass:C,emptyMessage:B,isOffer:z=!1})=>!j||j.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:B})}):t.jsx("div",{className:"dashboard-grid",style:{gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))"},children:j.map((A,y)=>t.jsxs("div",{className:"modern-card",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsx("div",{className:`ua-badge ${C}`,children:S(A.date||A.releaseDate)}),z&&t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ·ï¸"})]}),t.jsx("h3",{className:"modern-card__title",style:{marginTop:"8px"},children:A.title}),t.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",margin:"8px 0",flex:1},children:A.description||"No description available."}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[t.jsx("a",{href:A.link,target:"_blank",rel:"noopener noreferrer",className:"ua-source-link",children:"Details â†—"}),t.jsx("button",{className:"ua-cal-btn",onClick:()=>v(A,A.date||A.releaseDate),children:"+ Plan"})]})]},y))});if(a&&!n)return t.jsxs("div",{className:"page-container",children:[t.jsx(ke,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Scanning horizon..."})]})]});if(!n||!n.timeline||n.timeline.length===0)return t.jsxs("div",{className:"page-container",children:[t.jsx(ke,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"empty-state",children:[t.jsx("span",{style:{fontSize:"3rem"},children:"ðŸ”­"}),t.jsx("h3",{children:"Nothing on the radar"}),t.jsx("p",{children:"No upcoming events found."}),t.jsx("button",{onClick:()=>h(!0),className:"btn btn--primary",style:{marginTop:"1rem"},children:"Retry Scan"}),t.jsx("div",{style:{marginTop:"0.75rem"},children:t.jsxs("small",{children:["Try adding more locations or categories in ",t.jsx(ze,{to:"/settings",style:{color:"var(--accent-primary)"},children:"Settings"}),"."]})})]})]});const L=n.sections?.weather_alerts||[],k=n.sections?.alerts||[],O=n.sections?.civic||[],M=[...L,...k,...O],F=L[0]||k[0]||null,D=L.length>0?"ðŸŒªï¸":"âš ï¸",W=L.length>0?"Weather Warning":"Worth Knowing";return t.jsxs("div",{className:"page-container up-ahead-page",children:[t.jsx(ke,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l,rightElement:r?t.jsx("div",{className:"scanning-indicator",style:{fontSize:"0.7rem",color:"var(--accent-primary)"},children:"Scanning..."}):null}),t.jsx("div",{style:{textAlign:"center",fontSize:"0.7rem",color:"var(--text-muted)",padding:"6px",background:"var(--bg-secondary)",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:r?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading__spinner",style:{width:"12px",height:"12px",borderWidth:"2px"}}),t.jsx("span",{children:"Scanning horizon..."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:["Live Feed â€¢ ",e.upAhead?.locations?.join(", ")||"All Locations"]}),t.jsx("button",{onClick:()=>h(!0),style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.8rem"},children:"ðŸ”„"})]})}),F&&t.jsxs("div",{className:`ua-alert-banner ${L.length>0?"weather-alert":""}`,children:[t.jsx("span",{className:"ua-alert-icon",children:D}),t.jsxs("div",{className:"ua-alert-content",children:[t.jsx("h4",{children:W}),t.jsx("p",{children:F.text})]})]}),t.jsxs("main",{className:"main-content",children:[t.jsxs("div",{className:"ua-view-toggle scrollable-tabs",children:[t.jsx("button",{className:`ua-toggle-btn ${d==="plan"?"active":""}`,onClick:()=>u("plan"),children:"Plan My Week"}),t.jsx("button",{className:`ua-toggle-btn ${d==="offers"?"active":""}`,onClick:()=>u("offers"),children:"Offers"}),t.jsx("button",{className:`ua-toggle-btn ${d==="movies"?"active":""}`,onClick:()=>u("movies"),children:"Releasing Soon"}),t.jsx("button",{className:`ua-toggle-btn ${d==="events"?"active":""}`,onClick:()=>u("events"),children:"Upcoming Events"}),t.jsx("button",{className:`ua-toggle-btn ${d==="alerts"?"active":""}`,onClick:()=>u("alerts"),children:"Alerts"}),t.jsx("button",{className:`ua-toggle-btn ${d==="festivals"?"active":""}`,onClick:()=>u("festivals"),children:"Festivals"}),t.jsx("button",{className:`ua-toggle-btn ${d==="feed"?"active":""}`,onClick:()=>u("feed"),children:"Timeline"})]}),d==="plan"&&t.jsxs("div",{className:"ua-weekly-plan",children:[t.jsx(xe,{active:a||r,style:{marginBottom:"10px",borderRadius:"4px"}}),n.weekly_plan&&Array.isArray(n.weekly_plan)?n.weekly_plan.map((j,C)=>t.jsxs("div",{className:"modern-card",style:{marginBottom:"16px"},children:[t.jsx("div",{className:"modern-card__header",style:{paddingBottom:"0",borderBottom:"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("div",{className:"ua-plan-ribbon",style:{borderRadius:"8px"},children:t.jsx("div",{style:{fontSize:"0.95rem",fontWeight:800,whiteSpace:"nowrap"},children:j.day})}),t.jsx("span",{style:{opacity:.8,fontWeight:500,color:"var(--text-muted)"},children:j.date})]})}),t.jsx("div",{className:"ua-plan-day-content",style:{border:"none",padding:"8px 0 0 0",background:"transparent"},children:j.items&&j.items.length>0?j.items.map((B,z)=>t.jsxs("div",{className:"ua-plan-event-item",style:{borderColor:"rgba(255,255,255,0.05)"},children:[t.jsx("button",{className:"ua-plan-delete-btn",onClick:A=>{A.preventDefault(),w(B.id)},"aria-label":"Remove event",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:"0.9rem",padding:"0 8px 0 0"},children:"âœ•"}),t.jsxs("a",{href:B.link,target:"_blank",rel:"noopener noreferrer",style:{flex:1,display:"flex",alignItems:"center",gap:"10px",textDecoration:"none",color:"inherit"},children:[t.jsx("span",{className:"ua-event-icon",children:B.icon}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{className:"ua-event-title",children:B.title}),B.isOffer&&t.jsx("span",{className:"ua-offer-badge",children:"ðŸ›’ Ends Today"})]})]}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsx("button",{className:"ua-plan-action-btn",onClick:A=>{A.preventDefault(),tr(B.title,B.description||B.title)},title:"Add to Calendar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.1rem"},children:"ðŸ“…"})})]},z)):t.jsx("span",{className:"ua-plan-empty",style:{padding:"10px",color:"var(--text-muted)",fontSize:"0.9rem"},children:"-"})})]},C)):t.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"Data unavailable."})]}),d==="movies"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(xe,{active:a||r}),t.jsx(_,{items:n.sections?.movies,colorClass:"type-movie",emptyMessage:"No upcoming movie releases found."})]}),d==="offers"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(xe,{active:a||r}),t.jsx(T,{items:[...n.sections?.shopping||[],...n.sections?.airlines||[]],colorClass:"type-shopping",emptyMessage:"No offers found.",isOffer:!0}),t.jsx("div",{style:{textAlign:"center",marginTop:"10px",fontSize:"0.8rem",color:"var(--text-muted)"},children:"Including Airline Offers"})]}),d==="events"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(xe,{active:a||r}),t.jsx(T,{items:[...n.sections?.events||[],...n.sections?.sports||[]],colorClass:"type-event",emptyMessage:"No upcoming events found."})]}),d==="alerts"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(xe,{active:a||r}),t.jsx(T,{items:M,colorClass:"type-alert",emptyMessage:"No alerts found."})]}),d==="festivals"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(xe,{active:a||r}),t.jsx(_,{items:n.sections?.festivals,colorClass:"type-festival",emptyMessage:"No festivals found."})]}),d==="feed"&&t.jsx("div",{className:"ua-timeline",children:n.timeline.map(j=>t.jsxs("div",{className:"ua-day-section timeline-track",children:[t.jsxs("div",{className:"ua-day-header",children:[t.jsx("div",{className:"ua-day-label",children:j.dayLabel}),t.jsx("div",{className:"ua-date-sub",children:j.date})]}),j.items?.map(C=>t.jsx("div",{className:"timeline-card",style:{marginBottom:"16px"},children:t.jsxs("div",{className:"ua-media-content",style:{padding:0},children:[t.jsxs("div",{className:"ua-media-header",children:[t.jsx("span",{className:`ua-badge type-${C.type}`,children:C.type.toUpperCase()}),t.jsx("button",{className:`ua-watch-btn ${p(C.id)?"active":""}`,onClick:()=>g(C.id),children:p(C.id)?"â˜…":"â˜†"})]}),t.jsx("h3",{className:"ua-media-title",children:C.title}),t.jsx("p",{className:"ua-media-desc",children:C.description?C.description.length>100?C.description.substring(0,100)+"...":C.description:""}),t.jsxs("div",{className:"ua-media-footer",children:[C.link&&t.jsx("a",{href:C.link,target:"_blank",rel:"noopener noreferrer",className:"ua-source-link",children:"Read Source â†—"}),t.jsx("button",{className:"ua-cal-btn",onClick:()=>v(C,j.date),title:"Add to Plan My Week",children:"ðŸ“Œ Plan"})]})]})},C.id))]},j.date))})]})]})}const Rr=({weatherData:e,activeCity:n,onRefresh:s,loading:a,isDesktop:i})=>{const r=n||Object.keys(e)[0]||"chennai",o=e[r]||e[r.toLowerCase()],l=x.useMemo(()=>{if(!o)return"Loading weather data...";const c=o.current||{},d=o.next8Hours||[],u=o.hourly24||[];let m=c.high;if((m==null||m===void 0)&&u.length>0){const v=Math.max(...u.map(S=>S.temp||-999));v!==-999&&(m=v)}const g=m!=null?`${m}Â°`:"--";let p="";const h=d.slice(0,4).find(v=>v.precip>.5||v.prob>=40);h?p=`Rain likely at ${h.label}`:c.windSpeed>25?p=`Windy (${c.windSpeed} km/h)`:c.temp>38||m>38?p="Heatwave Alert":c.humidity>85&&c.temp>30?p="High Humidity":c.condition&&c.condition.toLowerCase().includes("rain")&&(p="Raining Now");let w=`${c.condition||"Clear"} â€¢ High ${g}`;return p?`${w} â€¢ ${p}`:w},[o]);return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"linear-gradient(to bottom, var(--bg-card), var(--bg-primary))",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 20px rgba(0,0,0,0.4)",padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("h2",{style:{fontSize:"1.4rem",margin:0,fontWeight:800,background:"linear-gradient(135deg, #fff 0%, #aaa 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textTransform:"capitalize",letterSpacing:"-0.02em",lineHeight:1.1},children:r}),a&&t.jsx("span",{className:"pulse-dot",style:{width:"8px",height:"8px",borderRadius:"50%",background:"var(--accent-primary)",display:"inline-block",boxShadow:"0 0 10px var(--accent-primary)"}})]}),t.jsx("div",{style:{fontSize:"0.95rem",color:"var(--accent-info)",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:i?"auto":"280px",opacity:.9},children:l})]}),t.jsx("button",{onClick:s,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"var(--text-primary)",opacity:a?.7:1,transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},title:"Refresh Weather",children:t.jsx("span",{style:{display:"block",transform:a?"rotate(360deg)":"none",transition:"transform 1s linear infinite",fontSize:"18px"},children:a?"âŸ³":"â†»"})})]})};function Dr({weatherData:e,activeCity:n,setActiveCity:s}){const{settings:a}=se(),i=(a.weather?.cities||["chennai","trichy","muscat"]).map(p=>p.toLowerCase()),r={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[i[2]]:i[2].charAt(0).toUpperCase()+i[2].slice(1)},o={chennai:"ðŸ›ï¸",trichy:"ðŸ¯",muscat:"ðŸ“",[i[2]]:"ðŸ“"},[l,c]=x.useState(null);if(!e)return null;const d=e[n]||e.chennai;if(!d)return t.jsx("div",{className:"dw-container",children:"Data unavailable"});const u=new Date().getHours();let m=[];const g=(p,h,w=null)=>{p==="today"||d.tomorrow;const v=p==="today"?d[h]:d.tomorrow?.[h];let S=w;return S||(h==="morning"?S="Morning":h==="noon"?S="Afternoon":S="Evening",p==="tomorrow"&&(S="Tomorrow "+S)),{id:`${p}-${h}`,label:S,data:v}};return u<11?m=[g("today","morning","This Morning"),g("today","noon"),g("today","evening")]:u<17?m=[g("today","noon","This Afternoon"),g("today","evening"),g("tomorrow","morning")]:u<21?m=[g("today","evening","Tonight"),g("tomorrow","morning"),g("tomorrow","noon")]:m=[g("tomorrow","morning","Tomorrow Morning"),g("tomorrow","noon"),g("tomorrow","evening")],t.jsxs("div",{className:"dw-container",children:[t.jsx("div",{className:"dw-sidebar",children:i.map(p=>t.jsxs("button",{className:`dw-city-tab ${p===n?"active":""}`,onClick:()=>s(p),"aria-label":`Select ${r[p]}`,children:[t.jsx("span",{className:"dw-city-icon",children:o[p]||"ðŸ“"}),t.jsx("span",{className:"dw-city-name",children:r[p]||p})]},p))}),t.jsxs("div",{className:"dw-content",children:[t.jsxs("div",{className:"dw-header",children:[t.jsxs("div",{className:"dw-header-main",children:[t.jsx("h2",{className:"dw-city-title",children:d.name}),t.jsxs("span",{className:"dw-current-temp",children:[d.current?.temp,"Â°"]})]}),t.jsx("div",{className:"dw-header-sub",children:d.summary})]}),t.jsx("div",{className:"dw-cards-list",children:m.map((p,h)=>p.data?t.jsx(Lr,{segment:p,isExpanded:l===h,onToggle:()=>c(l===h?null:h)},p.id):null)}),t.jsxs("div",{className:"dw-footer",children:["Forecast based on ",d.models?.count," models (",d.models?.names,")."]})]})]})}function Lr({segment:e,isExpanded:n,onToggle:s}){const{label:a,data:i}=e,r=parseFloat(i.rainMm==="-"?0:i.rainMm),o=i.rainProb?.avg||0,l=r>=1,c=r>0||o>0;let d=nn,u="var(--text-secondary)",m="No significant rain";c&&(l?(d=Ma,u="#3b82f6"):(d=nn,u="#94a3b8"),m=`${r>0?r.toFixed(1)+"mm":"Trace"} (${o}%)`);const g=Or(i);return t.jsxs("div",{className:`dw-card ${n?"expanded":""}`,onClick:s,children:[t.jsxs("div",{className:"dw-card-header",children:[t.jsx("span",{className:"dw-period-badge",children:a}),t.jsx("span",{className:"dw-expand-hint",children:n?"Collapse":"Touch for Hourly"})]}),t.jsxs("div",{className:"dw-card-main",children:[t.jsx("div",{className:"dw-main-icon",children:i.iconId?t.jsx(st,{id:i.iconId,size:56}):t.jsx("span",{style:{fontSize:"3rem"},children:i.icon})}),t.jsxs("div",{className:"dw-main-temp",children:[t.jsxs("div",{className:"dw-temp-val",children:[i.temp,"Â°"]}),t.jsxs("div",{className:"dw-temp-feels",children:["Feels like ",i.feelsLike,"Â°"]})]})]}),t.jsxs("div",{className:"dw-details-grid",children:[t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(d,{size:20,color:u})}),t.jsx("div",{className:"dw-detail-text",children:m})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(Aa,{size:20})}),t.jsxs("div",{className:"dw-detail-text",children:[i.humidity,"% ",t.jsx("span",{className:"dw-sep",children:"|"})," ",t.jsx(Ia,{size:16})," ",i.windSpeed," km/h"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â˜€ï¸"}),t.jsxs("div",{className:"dw-detail-text",children:["UV: ",i.uvIndex||"-"," ",t.jsx("span",{className:"dw-sep",children:"|"})," PM 2.5: -"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â„¹ï¸"}),t.jsx("div",{className:"dw-detail-text dw-desc",children:g})]})]}),n&&i.hourly&&t.jsx("div",{className:"dw-hourly-container hide-scrollbar",onClick:p=>p.stopPropagation(),children:i.hourly.map((p,h)=>t.jsxs("div",{className:"dw-hourly-slot",children:[t.jsx("span",{className:"dw-slot-time",children:p.time}),t.jsx("div",{className:"dw-slot-icon",children:p.iconId?t.jsx(st,{id:p.iconId,size:28}):p.icon}),t.jsxs("strong",{className:"dw-slot-temp",children:[p.temp,"Â°"]}),p.precip>0&&t.jsxs("span",{className:"dw-slot-precip",children:[p.precip>=1&&t.jsx("span",{style:{fontSize:"0.7rem"},children:"â˜‚ï¸"}),p.precip,"mm"]})]},h))})]})}function Or(e){const n=[];return e.rainProb?.avg>40?n.push("Rain expected."):e.cloudCover>70?n.push("Cloudy."):e.cloudCover<20&&n.push("Clear skies."),e.windSpeed>20&&n.push("Breezy."),e.uvIndex>8&&n.push("High UV."),n.length===0?"Pleasant conditions.":n.join(" ")}function Fr(){const{weatherData:e,loading:n,error:s,refreshWeather:a}=Ke(),{settings:i}=se(),{isDesktop:r}=rt(),o=e,l=(i.weather?.cities||["chennai","trichy","muscat"]).map(m=>m.toLowerCase()),[c,d]=x.useState(()=>localStorage.getItem("dw_active_city")||"chennai");x.useEffect(()=>{localStorage.setItem("dw_active_city",c)},[c]);const u=()=>{a(!0)};return n&&!e?t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Forecast..."})]})}):t.jsxs("div",{className:"page-container",style:{padding:0},children:[o&&t.jsx(Rr,{weatherData:o,activeCity:c,cities:l,onRefresh:u,loading:n,isDesktop:r}),t.jsxs("main",{className:"main-content",style:{padding:0,marginTop:0},children:[s&&t.jsxs("div",{className:"topline",style:{borderLeftColor:"var(--accent-danger)",margin:"16px"},children:[t.jsx("div",{className:"topline__label",style:{color:"var(--accent-danger)"},children:"Error"}),t.jsx("div",{className:"topline__text",children:"Failed to update weather. Showing cached data."})]}),o?t.jsx(Dr,{weatherData:o,activeCity:c,setActiveCity:d}):t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"â˜ï¸"}),t.jsx("p",{children:"Weather data unavailable."}),t.jsx("button",{onClick:u,className:"btn btn--secondary mt-md",children:"Retry"})]})]})]})}const $r=({indices:e,onRefresh:n,loading:s,lastUpdated:a})=>{const r=["NIFTY 50","SENSEX","NIFTY BANK"].map(c=>e?.find(d=>d.name.toUpperCase().includes(c))).filter(Boolean),o=r.length>0?r:e?.slice(0,3)||[],l=c=>c?new Date(c).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):"";return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-primary)",paddingBottom:"8px",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"var(--gradient-header)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ“ˆ"}),t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"1.1rem",margin:0,fontWeight:700,color:"var(--text-primary)",lineHeight:1.2},children:"Indian Markets"}),a&&t.jsxs("div",{style:{fontSize:"0.65rem",color:"rgba(255,255,255,0.7)",fontWeight:400},children:["Updated ",l(a)]})]})]}),t.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem",padding:"4px",color:"var(--text-primary)",opacity:s?.5:1,transition:"transform 0.3s"},title:"Refresh Markets",className:s?"spin":"",children:s?"âŸ³":"ðŸ”„"})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${o.length}, 1fr)`,gap:"1px",background:"var(--border-default)",marginTop:"0"},children:o.map((c,d)=>{const u=c.direction==="up"||c.change>0,m=u?"var(--accent-success)":"var(--accent-danger)",g=u?"â–²":"â–¼";return t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"10px 4px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",fontWeight:600,marginBottom:"2px",textTransform:"uppercase"},children:c.name.replace("NIFTY","").replace("SENSEX","SENSEX").trim()||c.name}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,color:"var(--text-primary)",marginBottom:"2px"},children:c.value}),t.jsxs("div",{style:{fontSize:"0.75rem",color:m,fontWeight:600,display:"flex",alignItems:"center",gap:"2px"},children:[t.jsx("span",{children:g}),t.jsx("span",{children:Math.abs(c.change).toFixed(2)}),t.jsxs("span",{style:{opacity:.8},children:["(",Math.abs(c.changePercent).toFixed(2),"%)"]})]})]},d)})}),t.jsx("style",{children:`
                .spin { animation: spin 1s linear infinite; }
                @keyframes spin { 100% { transform: rotate(360deg); } }
            `})]})};function Br({funds:e}){const[n,s]=x.useState(!1);if(!e||e.length===0)return t.jsxs("div",{className:"mf-card mf-card--empty",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Funds"]}),t.jsx("p",{className:"mf-card__empty-text",children:"NAV data unavailable"})]});const a=n?e:e.slice(0,4);return t.jsxs("div",{className:"mf-card",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]}),t.jsx("span",{className:"mf-card__date",children:e[0]?.navDate||"Latest"})]}),t.jsx("div",{className:"mf-card__list",children:a.map((i,r)=>t.jsxs("div",{className:"mf-fund",children:[t.jsxs("div",{className:"mf-fund__info",children:[t.jsx("div",{className:"mf-fund__name",children:i.name}),t.jsx("div",{className:"mf-fund__category",children:i.category})]}),t.jsxs("div",{className:"mf-fund__nav",children:[t.jsxs("div",{className:"mf-fund__value",children:["â‚¹",i.nav]}),t.jsxs("div",{className:`mf-fund__change mf-fund__change--${i.direction}`,children:[i.direction==="up"?"â–²":"â–¼"," ",i.changePercent,"%"]})]})]},i.code||r))}),e.length>4&&t.jsx("button",{className:"mf-card__toggle",onClick:()=>s(!n),children:n?"Show Less â–²":`Show All (${e.length}) â–¼`})]})}function Pr({ipoData:e}){const[n,s]=x.useState("upcoming");if(!e)return t.jsxs("div",{className:"ipo-card ipo-card--empty",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),t.jsx("p",{children:"IPO data unavailable"})]});const a=[{key:"upcoming",label:"Upcoming",icon:"ðŸ“…"},{key:"live",label:"Live",icon:"ðŸ”´"},{key:"recent",label:"Recent",icon:"âœ…"}],i=e[n]||[];return t.jsxs("div",{className:"ipo-card",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),e.isFallback&&t.jsx("span",{className:"ipo-card__fallback-badge",children:"Demo Data"})]}),t.jsx("div",{className:"ipo-card__tabs",children:a.map(r=>t.jsxs("button",{className:`ipo-tab ${n===r.key?"ipo-tab--active":""}`,onClick:()=>s(r.key),children:[r.icon," ",r.label,t.jsx("span",{className:"ipo-tab__count",children:e[r.key]?.length||0})]},r.key))}),t.jsx("div",{className:"ipo-card__list",children:i.length===0?t.jsxs("div",{className:"ipo-card__empty",children:["No ",n," IPOs at the moment"]}):i.map((r,o)=>t.jsxs("div",{className:"ipo-item",children:[t.jsxs("div",{className:"ipo-item__header",children:[t.jsxs("div",{className:"ipo-item__name",children:[r.name,r.isSME&&t.jsx("span",{style:{fontSize:"0.6rem",marginLeft:"6px",background:"#333",padding:"2px 4px",borderRadius:"4px"},children:"SME"})]}),t.jsx("div",{className:`ipo-item__status ipo-item__status--${r.status||n}`,children:r.status||n})]}),t.jsxs("div",{className:"ipo-item__details",children:[r.issuePrice&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Price Band:"}),t.jsx("span",{className:"ipo-item__value",children:r.issuePrice})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Open:"}),t.jsx("span",{className:"ipo-item__value",children:r.openDate})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Close:"}),t.jsx("span",{className:"ipo-item__value",children:r.closeDate})]}),r.issueSize&&r.issueSize!=="-"&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Size:"}),t.jsx("span",{className:"ipo-item__value",children:r.issueSize})]})]})]},o))})]})}function zr(){const{marketData:e,loading:n,error:s,refreshMarket:a,lastFetch:i}=zn(),{settings:r}=se(),o=r?.market||{},[l,c]=x.useState(()=>Date.now());x.useEffect(()=>{const M=setInterval(()=>c(Date.now()),6e4);return()=>clearInterval(M)},[]);const d=()=>{a()},u=M=>{const F=M?.timestamp||i;return F?l-F:1/0},m=M=>{const F=u(M),D=F>900*1e3;return F>14400*1e3?{opacity:.3,filter:"grayscale(1) brightness(0.7)",transition:"all 0.3s ease"}:D?{opacity:.6,filter:"grayscale(0.5)",transition:"all 0.3s ease"}:{opacity:1,filter:"none",transition:"all 0.3s ease"}},[g,p]=x.useState(!1);x.useEffect(()=>{const M=()=>{p(window.scrollY>400)};return window.addEventListener("scroll",M),()=>window.removeEventListener("scroll",M)},[]);const h=[(o.showGainers!==!1||o.showLosers!==!1)&&{id:"market-movers",icon:"ðŸ“ˆ",label:"Top Movers"},o.showSectorals!==!1&&{id:"sectoral-indices",icon:"ðŸ›ï¸",label:"Sectorals"},o.showCommodities!==!1&&{id:"commodities",icon:"ðŸª™",label:"Commodities"},o.showCurrency!==!1&&{id:"currency",icon:"ðŸ’±",label:"Currency"},o.showFIIDII!==!1&&{id:"fiidii",icon:"ðŸ¦",label:"FII/DII"},o.showMutualFunds!==!1&&{id:"mutual-funds",icon:"ðŸ’°",label:"Mutual Funds"},o.showIPO!==!1&&{id:"ipo-tracker",icon:"ðŸŽ¯",label:"IPO Watch"}].filter(Boolean);if(n&&!e)return t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Market Data..."})]})});const{indices:w,mutualFunds:v,ipo:S,movers:f,sectorals:_,commodities:T,currencies:L,fiidii:k}=e||{},O=()=>{window.scrollTo({top:0,behavior:"smooth"})};return t.jsxs("div",{className:"page-container",style:{padding:0},children:[t.jsx($r,{indices:w,onRefresh:d,loading:n,lastUpdated:i}),t.jsxs("main",{className:"main-content market-page",style:{padding:"16px",marginTop:0},children:[s&&t.jsx("div",{className:"error-state",style:{marginBottom:"16px",padding:"12px",background:"rgba(255, 71, 87, 0.1)",border:"1px solid var(--accent-danger)",borderRadius:"8px",color:"var(--accent-danger)"},children:t.jsx("p",{style:{margin:0},children:"Failed to load market data. Showing cached data."})}),t.jsxs("div",{className:"dashboard-grid",children:[(o.showGainers!==!1||o.showLosers!==!1)&&t.jsxs("div",{id:"market-movers",className:"modern-card dashboard-col-2",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ“ˆ"})," Top Movers"]})}),t.jsxs("div",{className:"movers-grid",children:[o.showGainers!==!1&&t.jsxs("div",{className:"movers-column movers-column--gainers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”¼ Top Gainers"}),f?.gainers?.slice(0,5).map((M,F)=>t.jsxs("div",{className:"mover-item",style:m(M),children:[t.jsx("div",{className:"mover-item__symbol",children:M.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",M.price]}),t.jsxs("div",{className:"mover-item__change text-success",children:["+",M.changePercent,"%"]})]},F)),(!f?.gainers||f.gainers.length===0)&&t.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"No gainers data"})]}),o.showLosers!==!1&&t.jsxs("div",{className:"movers-column movers-column--losers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”½ Top Losers"}),f?.losers?.slice(0,5).map((M,F)=>t.jsxs("div",{className:"mover-item",style:m(M),children:[t.jsx("div",{className:"mover-item__symbol",children:M.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",M.price]}),t.jsxs("div",{className:"mover-item__change text-danger",children:[M.changePercent,"%"]})]},F)),(!f?.losers||f.losers.length===0)&&t.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"No losers data"})]})]})]}),o.showSectorals!==!1&&t.jsxs("div",{id:"sectoral-indices",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ›ï¸"})," Sectoral Indices"]})}),t.jsxs("div",{className:"sectoral-grid",style:{gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))"},children:[_?.map((M,F)=>t.jsxs("div",{className:"sectoral-card",style:m(M),children:[t.jsx("div",{className:"sectoral-card__name",children:M.name}),t.jsx("div",{className:"sectoral-card__value",children:M.value}),t.jsxs("div",{className:`sectoral-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,children:[M.changePercent>=0?"â–²":"â–¼"," ",Math.abs(M.changePercent),"%"]})]},F)),(!_||_.length===0)&&t.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"No sectoral data"})]})]}),o.showCommodities!==!1&&t.jsxs("div",{id:"commodities",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸª™"})," Commodity Watch"]})}),t.jsxs("div",{className:"commodity-grid",style:{gridTemplateColumns:"1fr"},children:[T?.map((M,F)=>t.jsxs("div",{className:"commodity-card",style:{...m(M),display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",textAlign:"left",minHeight:"auto"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"commodity-card__name",style:{marginBottom:0},children:M.name}),t.jsx("div",{className:"commodity-card__unit",style:{fontSize:"0.65rem"},children:M.unit})]}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx("div",{className:"commodity-card__value",style:{fontSize:"1rem"},children:M.value}),t.jsxs("div",{className:`commodity-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,style:{fontSize:"0.75rem"},children:[M.changePercent>=0?"+":"",M.changePercent,"%"]})]})]},F)),(!T||T.length===0)&&t.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"No commodity data"})]})]}),o.showCurrency!==!1&&t.jsxs("div",{id:"currency",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ’±"})," Currency Rates"]})}),t.jsxs("div",{className:"currency-grid",style:{gridTemplateColumns:"1fr"},children:[L?.map((M,F)=>t.jsxs("div",{className:"currency-card",style:{...m(M),display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",textAlign:"left",minHeight:"auto"},children:[t.jsx("div",{className:"currency-card__name",style:{marginBottom:0},children:M.name}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsxs("div",{className:"currency-card__value",style:{fontSize:"1rem"},children:["â‚¹",M.value]}),t.jsxs("div",{className:`currency-card__change ${M.changePercent>=0?"text-success":"text-danger"}`,style:{fontSize:"0.75rem"},children:[M.changePercent>=0?"+":"",M.changePercent,"%"]})]})]},F)),(!L||L.length===0)&&t.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem",textAlign:"center",padding:"10px"},children:"No currency data"})]})]}),o.showFIIDII!==!1&&t.jsxs("div",{id:"fiidii",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ¦"})," FII/DII Activity"]})}),t.jsxs("div",{className:"fiidii-container",style:{gridTemplateColumns:"1fr"},children:[t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"FII (Foreign)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",k?.fii?.buy||"--"," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",k?.fii?.sell||"--"," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${k?.fii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",k?.fii?.net||"--"," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"DII (Domestic)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",k?.dii?.buy||"--"," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",k?.dii?.sell||"--"," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${k?.dii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",k?.dii?.net||"--"," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-date",style:{textAlign:"center"},children:["As of: ",k?.date||"N/A"]})]})]}),o.showMutualFunds!==!1&&t.jsxs("div",{id:"mutual-funds",className:"modern-card dashboard-col-2",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]})}),t.jsx(Br,{funds:v})]}),o.showIPO!==!1&&t.jsxs("div",{id:"ipo-tracker",className:"modern-card dashboard-col-2",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]})}),t.jsx(Pr,{ipoData:S})]})]}),t.jsxs("div",{className:"market-disclaimer",children:[t.jsx("div",{children:"* Data is for informational purposes only. Not investment advice."}),e?.fetchedAt&&t.jsxs("div",{style:{fontSize:"0.7rem",opacity:.7,marginTop:"4px"},children:["Last Updated: ",new Date(e.fetchedAt).toLocaleString()]})]})]}),t.jsx(kt,{sections:h}),t.jsx("button",{onClick:O,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:g?1:0,pointerEvents:g?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:"â†‘"})]})}const hn="buzz_page_cache";function Hr(){const{newsData:e,refreshNews:n,loading:s,loadSection:a}=Ge(),{settings:i}=se(),[r,o]=x.useState("tamil"),[l,c]=x.useState(null),[d,u]=x.useState(0);x.useEffect(()=>{try{const k=localStorage.getItem(hn);if(k){const O=JSON.parse(k);Date.now()-(O.timestamp||0)<480*60*1e3,c(O),u(1)}}catch(k){console.warn("Buzz Cache read error",k)}},[]),x.useEffect(()=>{["entertainment","social","technology","local","world","india","chennai"].forEach(O=>a(O))},[a]);const m=Dn.useCallback(k=>{if(!k)return[];const O=(i.freshnessLimitHours||72)*36e5,M=Date.now();return k.filter(F=>M-(F.publishedAt||0)<O)},[i.freshnessLimitHours]),g=e.entertainment&&e.entertainment.length>0;x.useEffect(()=>{g&&u(3)},[g]);const p=g?e:l?.data||{},h=x.useMemo(()=>{const k=p.entertainment||[],O={tamil:["vijay","ajith","rajini","kamal","dhanush","suriya","vikram","simbu","siva karthikeyan","trisha","nayanthara","anirudh","ar rahman","kollywood","thalapathy","thala","udhayanidhi","vetri maaran","lokesh","nelson","jailer","leo","kanguva","indian 2","vettaiyan","goat","viduthalai","karthi","sethupathi","tamil","chennai"],hindi:["shah rukh","srk","salman","aamir","ranbir","alia","deepika","ranveer","kareena","akshay","bachchan","bollywood","hrithik","katrina","vicky kaushal","karan johar","yrf","dharma","pathaan","jawan","tiger 3","animal","dunki","war 2","singham","hindi","mumbai"],hollywood:["oscar","grammy","emmy","golden globe","marvel","dc","disney","warner bros","universal","tom cruise","dicaprio","nolan","avengers","spider-man","batman","superman","taylor swift","beyonce","kim kardashian","kanye","justin bieber","selena gomez","zendaya","hollywood","bad bunny","rihanna","drake"],ott:["netflix","prime video","hotstar","sonyliv","zee5","aha","streaming","web series","season","episode","ott"]};return k.map(M=>{const F=(M.title+" "+(M.summary||"")).toLowerCase();return O.tamil.some(D=>F.includes(D))?{...M,region:"tamil"}:O.hindi.some(D=>F.includes(D))?{...M,region:"hindi"}:O.hollywood.some(D=>F.includes(D))?{...M,region:"hollywood"}:O.ott.some(D=>F.includes(D))?{...M,region:"ott"}:M})},[p.entertainment]),w=x.useMemo(()=>{const k={india:["india","indian","bollywood","cricket","modi","delhi","mumbai","bangalore","hyderabad","ipl","bcci"],tamilnadu:["chennai","tamil","tamilnadu","kollywood","rajini","kamal","vijay","trichy","coimbatore","madurai","tn"],muscat:["muscat","oman","gulf","gcc","uae","dubai","arab","middle east","expat","omani"]},O=A=>{const y=(A.title+" "+(A.summary||"")).toLowerCase();return k.tamilnadu.some(b=>y.includes(b))?"tamilnadu":k.muscat.some(b=>y.includes(b))?"muscat":k.india.some(b=>y.includes(b))?"india":"world"},M=m(p.social||[]),F=m(p.world||[]),D=m(p.india||[]),W=m(p.chennai||[]),j=m(p.local||[]),C={world:[],india:[],tamilnadu:[],muscat:[]};M.forEach(A=>{const y=O(A);C[y].push({...A,source:"social"})}),F.filter(A=>A.title?.toLowerCase().includes("trend")||A.title?.toLowerCase().includes("viral")||A.title?.toLowerCase().includes("social")).forEach(A=>C.world.push({...A,source:"world"})),D.filter(A=>A.title?.toLowerCase().includes("trend")||A.title?.toLowerCase().includes("viral")||A.title?.toLowerCase().includes("social")).forEach(A=>C.india.push({...A,source:"india"})),W.forEach(A=>{C.tamilnadu.push({...A,source:"chennai"})}),j.forEach(A=>{C.muscat.push({...A,source:"local"})});const B={world:i.socialTrends?.worldCount??8,india:i.socialTrends?.indiaCount??8,tamilnadu:i.socialTrends?.tamilnaduCount??5,muscat:i.socialTrends?.muscatCount??4},z=[];return Object.entries(B).forEach(([A,y])=>{const b=C[A];b.sort((P,N)=>(N.publishedAt||0)-(P.publishedAt||0)),b.slice(0,y).forEach(P=>{z.push({...P,region:A,regionLabel:A==="world"?"ðŸŒ World":A==="india"?"ðŸ‡®ðŸ‡³ India":A==="tamilnadu"?"ðŸ›ï¸ Tamil Nadu":"ðŸï¸ Muscat"})})}),z.sort((A,y)=>(y.publishedAt||0)-(A.publishedAt||0)),z},[p,i.freshnessLimitHours,i.socialTrends,m]);x.useEffect(()=>{if(g)try{const k={timestamp:Date.now(),data:{entertainment:e.entertainment,social:e.social,technology:e.technology,world:e.world,india:e.india,chennai:e.chennai,local:e.local}};localStorage.setItem(hn,JSON.stringify(k))}catch(k){console.warn("Buzz Cache write error",k)}},[g,e]);const v=()=>{u(3),n(["technology","social","world","india","chennai","local"])},S=[{id:"entertainment",icon:"ðŸŽ¬",label:"Entertainment"},{id:"social-trends",icon:"ðŸ‘¥",label:"Social Trends"},{id:"tech-news",icon:"ðŸš€",label:"Tech & Startups"},{id:"ai-innovation",icon:"ðŸ¤–",label:"AI & Innovation"}],[f,_]=x.useState(!1);x.useEffect(()=>{const k=()=>{window.scrollY>400?_(!0):_(!1)};return window.addEventListener("scroll",k),()=>window.removeEventListener("scroll",k)},[]);const T=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=({item:k})=>t.jsxs("a",{href:k.link||"#",target:"_blank",rel:"noopener noreferrer",className:"poster-card",style:{textDecoration:"none",display:"block"},children:[k.imageUrl?t.jsx("img",{src:k.imageUrl,alt:k.title,className:"poster-card__image",loading:"lazy"}):t.jsx("div",{style:{height:"100%",width:"100%",background:"linear-gradient(135deg, var(--bg-secondary), var(--bg-card))",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",opacity:.3},children:"ðŸŽ¬"}),t.jsxs("div",{className:"poster-card__content",children:[t.jsx("div",{className:"poster-card__title",style:{fontSize:"0.9rem",marginBottom:"4px"},children:k.title}),t.jsx("div",{style:{fontSize:"0.7rem",opacity:.8},children:k.source})]})]});return t.jsxs("div",{className:"page-container",children:[t.jsx(ke,{title:"Buzz Hub",icon:"ðŸŽ­",onRefresh:v,loadingPhase:d||(s?3:0)}),t.jsxs("main",{className:"main-content",children:[t.jsxs("div",{id:"entertainment",className:"modern-card",style:{marginBottom:"24px"},children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸŽ¬"})," Entertainment"]})}),t.jsx(xe,{active:s&&d>1,style:{marginBottom:"16px"}}),t.jsxs("div",{className:"entertainment-tabs modern-icons",children:[t.jsxs("button",{className:`ent-tab ${r==="tamil"?"ent-tab--active":""}`,onClick:()=>o("tamil"),children:[t.jsx("span",{className:"ent-icon",children:"ðŸŽ­"})," Tamil"]}),t.jsxs("button",{className:`ent-tab ${r==="hindi"?"ent-tab--active":""}`,onClick:()=>o("hindi"),children:[t.jsx("span",{className:"ent-icon",children:"ðŸŽª"})," Hindi"]}),t.jsxs("button",{className:`ent-tab ${r==="hollywood"?"ent-tab--active":""}`,onClick:()=>o("hollywood"),children:[t.jsx("span",{className:"ent-icon",children:"ðŸŽ¬"})," H'wood"]}),t.jsxs("button",{className:`ent-tab ${r==="ott"?"ent-tab--active":""}`,onClick:()=>o("ott"),children:[t.jsx("span",{className:"ent-icon",children:"ðŸ“º"})," OTT"]})]}),t.jsx("div",{className:"dashboard-grid",style:{gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:m(h.filter(k=>k.region===r)).slice(0,8).map((k,O)=>t.jsx(L,{item:k},O))}),m(h.filter(k=>k.region===r)).length===0&&t.jsx("div",{className:"empty-state",children:"No entertainment news found for this category."})]}),t.jsxs("div",{id:"social-trends",className:"modern-card",style:{marginBottom:"24px"},children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ‘¥"})," Social Trends"]})}),t.jsxs("div",{className:"masonry-grid",children:[w.map((k,O)=>t.jsx(Oa,{article:{...k,time:k.time||"Recently"},href:k.link,badge:k.regionLabel,size:"medium"},O)),w.length===0&&t.jsx("div",{className:"empty-state",style:{gridColumn:"1/-1"},children:t.jsx("p",{children:"No social trends available"})})]})]}),t.jsxs("div",{className:"dashboard-grid",children:[t.jsxs("div",{id:"tech-news",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸš€"})," Tech & Startups"]})}),t.jsx(le,{news:m(p.technology),maxDisplay:i.sections?.technology?.count||5,showCritics:!1,hideTitle:!0})]}),t.jsxs("div",{id:"ai-innovation",className:"modern-card",children:[t.jsx("div",{className:"modern-card__header",children:t.jsxs("h2",{className:"modern-card__title",children:[t.jsx("span",{children:"ðŸ¤–"})," AI & Innovation"]})}),t.jsx(le,{news:m(p.technology?.filter(k=>k.title?.toLowerCase().includes("ai")||k.title?.toLowerCase().includes("innovation")||k.title?.toLowerCase().includes("machine learning")||k.title?.toLowerCase().includes("chatgpt")||k.title?.toLowerCase().includes("gemini"))),maxDisplay:6,showCritics:!1,hideTitle:!0})]})]})]}),t.jsx(kt,{sections:S}),t.jsx("button",{onClick:T,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:f?1:0,pointerEvents:f?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:"â†‘"})]})}const Ur=({article:e,sourceName:n,isTranslated:s})=>{const a=s&&e.title_en?e.title_en:e.title;return t.jsxs("article",{className:"newspaper-card",children:[n&&t.jsx("div",{className:"newspaper-card__source",children:n}),t.jsx("h3",{className:"newspaper-card__title",children:t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:a})}),t.jsx("div",{className:"newspaper-card__footer",children:t.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"newspaper-card__link",children:["Read Full Story ",t.jsx(qa,{size:10})]})})]})};var mn;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(mn||(mn={}));var pn;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(pn||(pn={}));var gn;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(gn||(gn={}));const fn=["user","model","function","system"];var yn;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(yn||(yn={}));var xn;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(xn||(xn={}));var wn;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(wn||(wn={}));var vn;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(vn||(vn={}));var Pe;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(Pe||(Pe={}));var bn;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(bn||(bn={}));var Sn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Sn||(Sn={}));var jn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(jn||(jn={}));class ne extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class Me extends ne{constructor(n,s){super(n),this.response=s}}class as extends ne{constructor(n,s,a,i){super(n),this.status=s,this.statusText=a,this.errorDetails=i}}class ve extends ne{}class rs extends ne{}const Wr="https://generativelanguage.googleapis.com",Gr="v1beta",Kr="0.24.1",Vr="genai-js";var Ee;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ee||(Ee={}));class qr{constructor(n,s,a,i,r){this.model=n,this.task=s,this.apiKey=a,this.stream=i,this.requestOptions=r}toString(){var n,s;const a=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Gr;let r=`${((s=this.requestOptions)===null||s===void 0?void 0:s.baseUrl)||Wr}/${a}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}function Yr(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${Vr}/${Kr}`),n.join(" ")}async function Jr(e){var n;const s=new Headers;s.append("Content-Type","application/json"),s.append("x-goog-api-client",Yr(e.requestOptions)),s.append("x-goog-api-key",e.apiKey);let a=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(i){throw new ve(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${i.message}`)}for(const[i,r]of a.entries()){if(i==="x-goog-api-key")throw new ve(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new ve(`Header name ${i} can only be set using the apiClient field`);s.append(i,r)}}return s}async function Xr(e,n,s,a,i,r){const o=new qr(e,n,s,a,r);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},to(r)),{method:"POST",headers:await Jr(o),body:i})}}async function Ve(e,n,s,a,i,r={},o=fetch){const{url:l,fetchOptions:c}=await Xr(e,n,s,a,i,r);return Qr(l,c,o)}async function Qr(e,n,s=fetch){let a;try{a=await s(e,n)}catch(i){Zr(i,e)}return a.ok||await eo(a,e),a}function Zr(e,n){let s=e;throw s.name==="AbortError"?(s=new rs(`Request aborted when fetching ${n.toString()}: ${e.message}`),s.stack=e.stack):e instanceof as||e instanceof ve||(s=new ne(`Error fetching from ${n.toString()}: ${e.message}`),s.stack=e.stack),s}async function eo(e,n){let s="",a;try{const i=await e.json();s=i.error.message,i.error.details&&(s+=` ${JSON.stringify(i.error.details)}`,a=i.error.details)}catch{}throw new as(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,a)}function to(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const s=new AbortController;e?.timeout>=0&&setTimeout(()=>s.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{s.abort()}),n.signal=s.signal}return n}function Et(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),tt(e.candidates[0]))throw new Me(`${we(e)}`,e);return no(e)}else if(e.promptFeedback)throw new Me(`Text not available. ${we(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tt(e.candidates[0]))throw new Me(`${we(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Nn(e)[0]}else if(e.promptFeedback)throw new Me(`Function call not available. ${we(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tt(e.candidates[0]))throw new Me(`${we(e)}`,e);return Nn(e)}else if(e.promptFeedback)throw new Me(`Function call not available. ${we(e)}`,e)},e}function no(e){var n,s,a,i;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)o.text&&r.push(o.text),o.executableCode&&r.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&r.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}function Nn(e){var n,s,a,i;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)o.functionCall&&r.push(o.functionCall);if(r.length>0)return r}const so=[Pe.RECITATION,Pe.SAFETY,Pe.LANGUAGE];function tt(e){return!!e.finishReason&&so.includes(e.finishReason)}function we(e){var n,s,a;let i="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)i+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(i+=` due to ${e.promptFeedback.blockReason}`),!((s=e.promptFeedback)===null||s===void 0)&&s.blockReasonMessage&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((a=e.candidates)===null||a===void 0)&&a[0]){const r=e.candidates[0];tt(r)&&(i+=`Candidate was blocked due to ${r.finishReason}`,r.finishMessage&&(i+=`: ${r.finishMessage}`))}return i}function He(e){return this instanceof He?(this.v=e,this):new He(e)}function io(e,n,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s.apply(e,n||[]),i,r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(g){a[g]&&(i[g]=function(p){return new Promise(function(h,w){r.push([g,p,h,w])>1||l(g,p)})})}function l(g,p){try{c(a[g](p))}catch(h){m(r[0][3],h)}}function c(g){g.value instanceof He?Promise.resolve(g.value.v).then(d,u):m(r[0][2],g)}function d(g){l("next",g)}function u(g){l("throw",g)}function m(g,p){g(p),r.shift(),r.length&&l(r[0][0],r[0][1])}}const _n=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ao(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),s=lo(n),[a,i]=s.tee();return{stream:oo(a),response:ro(i)}}async function ro(e){const n=[],s=e.getReader();for(;;){const{done:a,value:i}=await s.read();if(a)return Et(co(n));n.push(i)}}function oo(e){return io(this,arguments,function*(){const s=e.getReader();for(;;){const{value:a,done:i}=yield He(s.read());if(i)break;yield yield He(Et(a))}})}function lo(e){const n=e.getReader();return new ReadableStream({start(a){let i="";return r();function r(){return n.read().then(({value:o,done:l})=>{if(l){if(i.trim()){a.error(new ne("Failed to parse stream"));return}a.close();return}i+=o;let c=i.match(_n),d;for(;c;){try{d=JSON.parse(c[1])}catch{a.error(new ne(`Error parsing JSON response: "${c[1]}"`));return}a.enqueue(d),i=i.substring(c[0].length),c=i.match(_n)}return r()}).catch(o=>{let l=o;throw l.stack=o.stack,l.name==="AbortError"?l=new rs("Request aborted when reading from the stream"):l=new ne("Error reading from the stream"),l})}}})}function co(e){const n=e[e.length-1],s={promptFeedback:n?.promptFeedback};for(const a of e){if(a.candidates){let i=0;for(const r of a.candidates)if(s.candidates||(s.candidates=[]),s.candidates[i]||(s.candidates[i]={index:i}),s.candidates[i].citationMetadata=r.citationMetadata,s.candidates[i].groundingMetadata=r.groundingMetadata,s.candidates[i].finishReason=r.finishReason,s.candidates[i].finishMessage=r.finishMessage,s.candidates[i].safetyRatings=r.safetyRatings,r.content&&r.content.parts){s.candidates[i].content||(s.candidates[i].content={role:r.content.role||"user",parts:[]});const o={};for(const l of r.content.parts)l.text&&(o.text=l.text),l.functionCall&&(o.functionCall=l.functionCall),l.executableCode&&(o.executableCode=l.executableCode),l.codeExecutionResult&&(o.codeExecutionResult=l.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),s.candidates[i].content.parts.push(o)}i++}a.usageMetadata&&(s.usageMetadata=a.usageMetadata)}return s}async function os(e,n,s,a){const i=await Ve(n,Ee.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(s),a);return ao(i)}async function ls(e,n,s,a){const r=await(await Ve(n,Ee.GENERATE_CONTENT,e,!1,JSON.stringify(s),a)).json();return{response:Et(r)}}function cs(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Ue(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const s of e)typeof s=="string"?n.push({text:s}):n.push(s);return uo(n)}function uo(e){const n={role:"user",parts:[]},s={role:"function",parts:[]};let a=!1,i=!1;for(const r of e)"functionResponse"in r?(s.parts.push(r),i=!0):(n.parts.push(r),a=!0);if(a&&i)throw new ne("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!i)throw new ne("No content is provided for sending chat message.");return a?n:s}function ho(e,n){var s;let a={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(s=n?.cachedContent)===null||s===void 0?void 0:s.name,contents:[]};const i=e.generateContentRequest!=null;if(e.contents){if(i)throw new ve("CountTokensRequest must have one of contents or generateContentRequest, not both.");a.contents=e.contents}else if(i)a=Object.assign(Object.assign({},a),e.generateContentRequest);else{const r=Ue(e);a.contents=[r]}return{generateContentRequest:a}}function kn(e){let n;return e.contents?n=e:n={contents:[Ue(e)]},e.systemInstruction&&(n.systemInstruction=cs(e.systemInstruction)),n}function mo(e){return typeof e=="string"||Array.isArray(e)?{content:Ue(e)}:e}const Cn=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],po={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function go(e){let n=!1;for(const s of e){const{role:a,parts:i}=s;if(!n&&a!=="user")throw new ne(`First content should be with role 'user', got ${a}`);if(!fn.includes(a))throw new ne(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(fn)}`);if(!Array.isArray(i))throw new ne("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new ne("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of i)for(const c of Cn)c in l&&(r[c]+=1);const o=po[a];for(const l of Cn)if(!o.includes(l)&&r[l]>0)throw new ne(`Content with role '${a}' can't contain '${l}' part`);n=!0}}function En(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const s=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(s===void 0||s.parts===void 0||s.parts.length===0)return!1;for(const a of s.parts)if(a===void 0||Object.keys(a).length===0||a.text!==void 0&&a.text==="")return!1;return!0}const Tn="SILENT_ERROR";class fo{constructor(n,s,a,i={}){this.model=s,this.params=a,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,a?.history&&(go(a.history),this._history=a.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,s={}){var a,i,r,o,l,c;await this._sendPromise;const d=Ue(n),u={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},m=Object.assign(Object.assign({},this._requestOptions),s);let g;return this._sendPromise=this._sendPromise.then(()=>ls(this._apiKey,this.model,u,m)).then(p=>{var h;if(En(p.response)){this._history.push(d);const w=Object.assign({parts:[],role:"model"},(h=p.response.candidates)===null||h===void 0?void 0:h[0].content);this._history.push(w)}else{const w=we(p.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}g=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,g}async sendMessageStream(n,s={}){var a,i,r,o,l,c;await this._sendPromise;const d=Ue(n),u={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},m=Object.assign(Object.assign({},this._requestOptions),s),g=os(this._apiKey,this.model,u,m);return this._sendPromise=this._sendPromise.then(()=>g).catch(p=>{throw new Error(Tn)}).then(p=>p.response).then(p=>{if(En(p)){this._history.push(d);const h=Object.assign({},p.candidates[0].content);h.role||(h.role="model"),this._history.push(h)}else{const h=we(p);h&&console.warn(`sendMessageStream() was unsuccessful. ${h}. Inspect response object for details.`)}}).catch(p=>{p.message!==Tn&&console.error(p)}),g}}async function yo(e,n,s,a){return(await Ve(n,Ee.COUNT_TOKENS,e,!1,JSON.stringify(s),a)).json()}async function xo(e,n,s,a){return(await Ve(n,Ee.EMBED_CONTENT,e,!1,JSON.stringify(s),a)).json()}async function wo(e,n,s,a){const i=s.requests.map(o=>Object.assign(Object.assign({},o),{model:n}));return(await Ve(n,Ee.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),a)).json()}class An{constructor(n,s,a={}){this.apiKey=n,this._requestOptions=a,s.model.includes("/")?this.model=s.model:this.model=`models/${s.model}`,this.generationConfig=s.generationConfig||{},this.safetySettings=s.safetySettings||[],this.tools=s.tools,this.toolConfig=s.toolConfig,this.systemInstruction=cs(s.systemInstruction),this.cachedContent=s.cachedContent}async generateContent(n,s={}){var a;const i=kn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return ls(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}async generateContentStream(n,s={}){var a;const i=kn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return os(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}startChat(n){var s;return new fo(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),this._requestOptions)}async countTokens(n,s={}){const a=ho(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),s);return yo(this.apiKey,this.model,a,i)}async embedContent(n,s={}){const a=mo(n),i=Object.assign(Object.assign({},this._requestOptions),s);return xo(this.apiKey,this.model,a,i)}async batchEmbedContents(n,s={}){const a=Object.assign(Object.assign({},this._requestOptions),s);return wo(this.apiKey,this.model,n,a)}}class vo{constructor(n){this.apiKey=n}getGenerativeModel(n,s){if(!n.model)throw new ne("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new An(this.apiKey,n,s)}getGenerativeModelFromCachedContent(n,s,a){if(!n.name)throw new ve("Cached content must contain a `name` field.");if(!n.model)throw new ve("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const o of i)if(s?.[o]&&n[o]&&s?.[o]!==n[o]){if(o==="model"){const l=s.model.startsWith("models/")?s.model.replace("models/",""):s.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(l===c)continue}throw new ve(`Different value for "${o}" specified in modelParams (${s[o]}) and cachedContent (${n[o]})`)}const r=Object.assign(Object.assign({},s),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new An(this.apiKey,r,a)}}let In=null,jt=null;const Mn=e=>{if(!e)return!1;try{return In=new vo(e),jt=In.getGenerativeModel({model:"gemini-1.5-flash"}),!0}catch(n){return console.error("Failed to initialize Gemini AI:",n),!1}},wt={generateSummary:async(e,n,s=!1)=>{if(!Mn(n))throw new Error("Invalid or missing API Key");let i=`You are a professional news editor. Summarize the following news headlines into a concise, insightful daily briefing (3-4 bullet points).

Headlines:
${e.slice(0,15).map(r=>`- ${r.title}`).join(`
`)}`;s?i+=`

REQUIREMENTS:
1. Provide the summary in TWO languages: English and Tamil.
2. SEPARATE the English summary and Tamil summary with the exact delimiter "|||".

OUTPUT FORMAT:
<English Summary>
|||
<Tamil Summary>`:i+=`

REQUIREMENTS:
1. Language: English ONLY.
2. No introductory text.`;try{const l=(await(await jt.generateContent(i)).response).text().trim();if(s&&l.includes("|||")){const c=l.split("|||");return{summary:c[0].trim(),summary_ta:c[1].trim()}}return{summary:l}}catch(r){throw console.error("Summary generation failed:",r),new Error("AI Generation Failed. Check your API Key or Quota.")}},translateTexts:async(e,n)=>{if(!Mn(n))throw new Error("Invalid or missing API Key");const a=`Translate the following news headlines to English. Maintain journalistic style. Return ONLY the translated list, numbered exactly as input.

${e.map((i,r)=>`${r+1}. ${i}`).join(`
`)}`;try{const l=(await(await jt.generateContent(a)).response).text().split(`
`),c=new Array(e.length).fill(null);return l.forEach(d=>{const u=d.match(/^(\d+)\.\s+(.*)/);if(u){const m=parseInt(u[1])-1;m>=0&&m<e.length&&(c[m]=u[2].trim())}}),c}catch(i){throw console.error("Translation failed:",i),i}}},bo="https://api.allorigins.win/raw?url=";async function So(e){if(!e)return"";try{const n=bo+encodeURIComponent(e),s=await fetch(n,{signal:AbortSignal.timeout(12e3)});if(!s.ok)return"";const a=await s.text();return jo(a)}catch{return""}}function jo(e){const s=new DOMParser().parseFromString(e,"text/html");s.querySelectorAll("script, style, nav, footer, header, aside, .ad, .advertisement, .social-share, .comments").forEach(o=>o.remove());const a=["article",'[itemprop="articleBody"]',".article-body",".story-content",".article-content",".post-content",".entry-content",".td-post-content","#article-body",".story-element","main"];for(const o of a){const l=s.querySelector(o);if(l){const c=l.textContent.trim();if(c.length>200)return c.slice(0,5e3)}}return Array.from(s.querySelectorAll("p")).map(o=>o.textContent.trim()).filter(o=>o.length>40).join(`

`).slice(0,5e3)}async function No(e,n=5){if(!e||e.length<100)return e||"";const s=await _o(e);return s||ko(e,n)}async function _o(e){try{if(!("ai"in self)||!("summarizer"in self.ai)||(await self.ai.summarizer.capabilities()).available==="no")return null;const s=await self.ai.summarizer.create({type:"key-points",format:"plain-text",length:"medium"}),a=await s.summarize(e);return s.destroy(),a}catch{return null}}function ko(e,n=5){const s=e.replace(/([.!?])\s+/g,`$1
`).split(`
`).map(l=>l.trim()).filter(l=>l.length>20&&l.length<500);if(s.length<=n)return s.join(" ");const a=e.toLowerCase().split(/\W+/).filter(l=>l.length>3),i={};for(const l of a)i[l]=(i[l]||0)+1;const r=s.map((l,c)=>{const d=l.toLowerCase().split(/\W+/).filter(m=>m.length>3);let u=0;for(const m of d)u+=i[m]||0;return u=u/Math.max(d.length,1),c<3&&(u*=1.3),c===s.length-1&&(u*=1.1),{sentence:l,score:u,index:c}});r.sort((l,c)=>c.score-l.score);const o=r.slice(0,n);return o.sort((l,c)=>l.index-c.index),o.map(l=>l.sentence).join(" ")}const Co={THE_HINDU:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"International",limit:6},{id:"business",title:"Business",limit:5},{id:"sports",title:"Sport",limit:5}]},INDIAN_EXPRESS:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"World",limit:5},{id:"technology",title:"Explained / Tech",limit:5}]},DINAMANI:{sections:[{id:"chennai",title:"Tamil Nadu",limit:10},{id:"entertainment",title:"Cinema",limit:5}]},DAILY_THANTHI:{sections:[{id:"chennai",title:"Headlines",limit:10},{id:"local",title:"District News",limit:5}]}},Eo={getVirtualPaper:async e=>{const n=Co[e];if(!n)return console.warn(`[VirtualPaper] No config for ${e}`),[];console.log(`[VirtualPaper] Generating for ${e}...`);const s=n.sections.map(async i=>{try{const r=await bt(i.id,i.limit);return{page:i.title,articles:r.map(o=>({title:o.title,link:o.link,description:o.description,source:o.source,publishedAt:o.publishedAt}))}}catch(r){return console.error(`[VirtualPaper] Failed to fetch section ${i.id}`,r),{page:i.title,articles:[],error:"Failed to load section"}}});return(await Promise.all(s)).filter(i=>i.articles.length>0)}},To="./data/epaper_data.json",pe={THE_HINDU:{id:"THE_HINDU",label:"The Hindu",lang:"en"},INDIAN_EXPRESS:{id:"INDIAN_EXPRESS",label:"Indian Express",lang:"en"},DINAMANI:{id:"DINAMANI",label:"Dinamani",lang:"ta"},DAILY_THANTHI:{id:"DAILY_THANTHI",label:"Daily Thanthi",lang:"ta"}},Ao=()=>{const{settings:e}=se(),{isWebView:n}=rt(),[s,a]=x.useState(pe.THE_HINDU.id),[i,r]=x.useState(null),[o,l]=x.useState(null),[c,d]=x.useState(!0),[u,m]=x.useState(null),[g,p]=x.useState(!1),[h,w]=x.useState({}),[v,S]=x.useState({}),[f,_]=x.useState(!1),[T,L]=x.useState(!1),[k,O]=x.useState(!1),[M,F]=x.useState({}),[D,W]=x.useState(!1),j=e.newspaper?.summaryLineLimit||50,C=x.useCallback(async()=>{d(!0),m(null);try{const N=await fetch(`${To}?t=${Date.now()}`);if(!N.ok)throw new Error("Failed to fetch data");const E=await N.json();if(!E||!E.sources)throw new Error("Invalid data format");r(E.sources),l(E.lastUpdated)}catch(N){console.warn("JSON fetch failed, trying RSS fallback...",N);try{const E=await B();r(E),l(new Date().toISOString())}catch(E){console.error("Fallback failed:",E),m("Failed to load today's paper. Please check your internet connection.")}}finally{d(!1)}},[]),B=async()=>{const N={},E=new Promise(($,H)=>setTimeout(()=>H(new Error("Timeout")),15e3)),R=Object.keys(pe).map(async $=>{try{const H=await Eo.getVirtualPaper($);H&&H.length>0&&(N[$]=H)}catch(H){console.warn(`Virtual Paper failed for ${$}:`,H.message)}});try{await Promise.race([Promise.all(R),E])}catch($){console.warn("Virtual Paper fetch timed out or failed:",$)}if(Object.keys(N).length===0)throw new Error("Failed to generate Virtual Paper. Please check connection.");return N};x.useEffect(()=>{C()},[C]),x.useEffect(()=>{(async()=>{if(!i||!i[s]||!e.geminiKey)return;const E=i[s],R=pe[s].lang==="ta";for(const $ of E){const H=!$.summary&&!$.summary_ta||$.error,K=h[$.page];if(H&&!K&&!f){_(!0);try{console.log(`Generating fallback summary for ${$.page}...`);const q=await wt.generateSummary($.articles,e.geminiKey,R);w(X=>({...X,[$.page]:q}))}catch(q){console.error(`Failed to generate summary for ${$.page}:`,q)}finally{_(!1)}}}})()},[i,s,e.geminiKey,h,f]);const z=x.useCallback(async(N,E)=>{const R=`${s}_${N}`;if(M[R])return;const $=E?.[0];if($?.link)try{const H=await So($.link);if(H&&H.length>200){const K=await No(H,6);K&&F(q=>({...q,[R]:K}))}}catch{}},[s,M]);x.useEffect(()=>{(async()=>{if(!g||!i||!i[s]||pe[s].lang==="en"||!e.geminiKey)return;const E=i[s];let R=[],$=[];if(E.forEach(H=>{H.articles.forEach(K=>{const q=K.title_en,X=v[K.link];!q&&!X&&(R.push(K.title),$.push(K.link))})}),R.length>0&&!T){L(!0);try{console.log(`Translating ${R.length} titles...`);const H=15;for(let K=0;K<R.length;K+=H){const q=R.slice(K,K+H),X=await wt.translateTexts(q,e.geminiKey);S(ie=>{const ce={...ie};return X.forEach((je,G)=>{const ae=K+G;$[ae]&&(ce[$[ae]]=je)}),ce})}}catch(H){console.error("Translation failed:",H)}finally{L(!1)}}})()},[g,i,s,e.geminiKey,v,T]);const A=N=>{const E=h[N.page];if(E){if(g&&E.summary)return{text:E.summary,method:"gemini"};if(!g&&E.summary_ta)return{text:E.summary_ta,method:"gemini"};if(E.summary)return{text:E.summary,method:"gemini"}}if(g){if(N.summary)return{text:N.summary,method:N.summary_method||"server"};if(N.summary_ta)return{text:N.summary_ta,method:N.summary_method||"server"}}else{if(N.summary_ta)return{text:N.summary_ta,method:N.summary_method||"server"};if(N.summary)return{text:N.summary,method:N.summary_method||"server"}}const R=`${s}_${N.page}`;return M[R]?{text:M[R],method:"extractive"}:null},y=async()=>{if(!i||!i[s])return;W(!0);const E=i[s].map(async R=>{const $=`${s}_${R.page}`,H=h[R.page],K=M[$],q=pe[s].lang==="ta"&&!g?R.summary_ta:R.summary;if(!(H||K||q))if(e.geminiKey)try{const X=await wt.generateSummary(R.articles,e.geminiKey,pe[s].lang==="ta");w(ie=>({...ie,[R.page]:X}))}catch(X){console.error(`Gemini Gen Failed for ${R.page}:`,X)}else try{await z(R.page,R.articles)}catch(X){console.error(`Client Summary Failed for ${R.page}:`,X)}});await Promise.allSettled(E),W(!1)};x.useEffect(()=>{if(!i||!i[s])return;const N=i[s][0];N&&!N.summary&&!N.summary_ta&&!e.geminiKey&&z(N.page,N.articles)},[i,s,e.geminiKey,z]);const b=i?i[s]:[],P=pe[s].lang==="ta";return t.jsxs("div",{className:`page-container mode-newspaper ${n?"page-container--desktop":""}`,children:[t.jsxs("div",{className:"header",children:[t.jsxs("div",{className:"header__title",children:[t.jsx(Xa,{className:"header__title-icon"}),t.jsx("span",{children:"Daily Brief"})]}),t.jsxs("div",{className:"header__actions",style:{gap:"8px"},children:[t.jsx("button",{onClick:y,className:`btn-icon ${D?"pulse":""}`,title:"Generate All Summaries",disabled:D,style:{color:D?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(Ka,{size:18})}),t.jsx("button",{onClick:()=>O(!k),className:`btn-icon ${k?"active":""}`,title:k?"Card View":"Digest View",style:{color:k?"var(--accent-primary)":"var(--text-secondary)",fontSize:"1.1rem"},children:k?"ðŸ“°":"ðŸ“–"}),P&&t.jsx("button",{onClick:()=>p(!g),className:`btn-icon ${g?"active":""}`,title:g?"Show Original (Tamil)":"Translate to English",style:{color:g?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(Ya,{size:24})}),t.jsx("button",{onClick:C,className:"btn-icon","aria-label":"Refresh",children:t.jsx(Qa,{className:c?"spin":""})})]})]}),t.jsxs("div",{className:"topline",style:{borderRadius:0,margin:0,borderLeft:"none",borderBottom:"1px solid var(--border-default)",overflowX:"auto"},children:[t.jsx("div",{style:{display:"flex",gap:"8px",minWidth:"max-content"},children:Object.values(pe).map(N=>t.jsx("button",{onClick:()=>{a(N.id),p(!1)},className:`btn ${s===N.id?"btn--primary":"btn--secondary"}`,style:{padding:"8px 12px",fontSize:"0.85rem",whiteSpace:"nowrap"},children:N.label},N.id))}),o&&t.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"8px",textAlign:"center"},children:["Updated: ",new Date(o).toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),t.jsx("div",{className:"main-content",style:{padding:"16px"},children:c&&!i?t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching Today's Brief..."})]}):u?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"âš ï¸"}),t.jsx("p",{children:u}),t.jsx("button",{onClick:C,className:"btn btn--primary mt-md",children:"Retry"})]}):t.jsxs("div",{className:"newspaper-content",children:[!b||b.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:"No content available for this source today."})}):b.map((N,E)=>{const R=A(N),$={gemini:"AI Summary",server:"Summary",extractive:"Auto-Summary",headlines:"Headlines"};return t.jsxs("div",{className:"newspaper-section",style:{marginBottom:"32px"},children:[t.jsxs("h2",{className:"zone-title",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{children:N.page}),T&&g&&t.jsx("span",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",fontWeight:"normal"},children:"Translating..."})]}),R?t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"16px",borderRadius:"8px",marginBottom:"20px",borderLeft:"4px solid var(--accent-primary)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--accent-primary)",fontWeight:"bold",marginBottom:"8px"},children:[t.jsx(Ja,{}),t.jsx("span",{children:$[R.method]||"Summary"}),R.method==="extractive"&&t.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"normal",color:"var(--text-muted)",marginLeft:"4px"},children:"(no API key needed)"})]}),t.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.95rem",lineHeight:"1.6",fontFamily:"serif",display:"-webkit-box",WebkitLineClamp:j,WebkitBoxOrient:"vertical",overflow:"hidden"},children:R.text})]}):t.jsxs("div",{style:{padding:"12px",marginBottom:"20px",background:"rgba(255, 0, 0, 0.05)",borderLeft:"4px solid var(--accent-danger)",borderRadius:"4px",fontSize:"0.85rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(Va,{color:"var(--accent-danger)"}),t.jsx("span",{children:N.error==="Quota Exceeded"?"Daily AI Limit Reached.":N.error==="API Key Missing"?"AI Summary Unavailable.":"Summary not generated."})]}),!e.geminiKey&&t.jsx(ze,{to:"/settings",style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"Add Key to Enable"}),e.geminiKey&&f&&t.jsx("span",{style:{color:"var(--accent-primary)"},children:"Generating..."})]}),k?t.jsx("div",{style:{fontSize:"0.9rem",lineHeight:"1.7"},children:N.articles.map((H,K)=>{const q=g&&(v[H.link]||H.title_en)||H.title;return t.jsx("div",{style:{padding:"8px 0",borderBottom:"1px solid var(--border-default)"},children:t.jsx("a",{href:H.link,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--text-primary)",textDecoration:"none",fontWeight:500},children:q})},K)})}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px"},children:N.articles.map((H,K)=>{const q={...H,title_en:v[H.link]||H.title_en};return t.jsx(Ur,{article:q,sourceName:pe[s].label,isTranslated:g},K)})})]},E)}),t.jsx("div",{className:"market-disclaimer",style:{marginTop:"32px"},children:"Content aggregated from official sources. Summaries generated by AI. Verify important details from original articles."})]})})]})};function ge({checked:e,onChange:n,recommended:s=!1,disabled:a=!1}){return t.jsxs("label",{className:`toggle ${s?"toggle--recommended":""}`,children:[t.jsx("input",{type:"checkbox",className:"toggle__input",checked:e,onChange:i=>n(i.target.checked),disabled:a}),t.jsx("span",{className:"toggle__slider"})]})}const Io="https://api.allorigins.win/get?url=",Mo=e=>/\.(xml|rss|atom)$/i.test(e)||/feed|rss|atom/i.test(e),Ro=async e=>{try{if(!e)return[];if(Mo(e))return[{title:"Custom Feed",url:e}];const n=encodeURIComponent(e),a=await(await fetch(`${Io}${n}`)).json();if(!a.contents)throw new Error("Failed to fetch page content");const r=new DOMParser().parseFromString(a.contents,"text/html"),o=[];if(r.querySelectorAll('link[rel="alternate"][type="application/rss+xml"], link[rel="alternate"][type="application/atom+xml"]').forEach(c=>{let d=c.getAttribute("href");const u=c.getAttribute("title")||"RSS Feed";if(d&&!d.startsWith("http")){const m=new URL(e);d=new URL(d,m.origin).href}d&&o.push({title:u,url:d})}),o.length===0){const c=["/feed","/rss","/rss.xml","/atom.xml"],d=new URL(e).origin;c.forEach(u=>{o.push({title:`Possible Feed (${u})`,url:`${d}${u}`})})}return o}catch(n){return console.error("Feed discovery failed:",n),[]}},Do="ver.12-02-26 time 17.41",Lo=()=>{const{settings:e}=se(),[n,s]=x.useState([]),[a,i]=x.useState(null);x.useEffect(()=>{try{he&&typeof he.getLogs=="function"?s(he.getLogs()):s([])}catch(o){console.error("Failed to load logs",o),i(o.message)}},[]);const r=o=>{if(typeof o=="object")try{return JSON.stringify(o)}catch{return"[Circular Object]"}return String(o)};return a?t.jsxs("div",{className:"error-state",children:["Debug Error: ",a]}):t.jsxs("div",{className:"settings-tab-content",children:[t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ›"})," Debug Info"]}),t.jsxs("div",{className:"settings-card",children:[t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"App Version:"})," ",e?.appVersion||"Unknown"]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"User Agent:"})," ",navigator.userAgent]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"Screen:"})," ",window.innerWidth,"x",window.innerHeight]})]}),t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ“œ"})," Recent Logs"]}),t.jsx("div",{className:"settings-card",style:{maxHeight:"300px",overflowY:"auto",background:"black",color:"#0f0",fontFamily:"monospace",fontSize:"0.7rem",padding:"10px"},children:n.length===0?t.jsx("div",{children:"No logs available."}):n.map((o,l)=>t.jsxs("div",{style:{marginBottom:"4px",borderBottom:"1px solid #333",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[t.jsxs("span",{style:{color:"#888"},children:["[",new Date(o.timestamp).toLocaleTimeString(),"]"]})," ",t.jsxs("span",{style:{color:o.level==="error"?"red":o.level==="warn"?"orange":"#0f0"},children:[o.level.toUpperCase(),":"]})," ",r(o.message),o.details&&t.jsx("div",{style:{marginLeft:"15px",color:"#aaa",fontSize:"0.65rem"},children:r(o.details)})]},l))}),t.jsx("div",{className:"settings-card",children:t.jsx("button",{className:"btn btn--danger",onClick:()=>{window.confirm("Clear all data?")&&(localStorage.clear(),window.location.reload())},style:{width:"100%"},children:"Clear All Local Storage & Reload"})})]})},Oo=e=>{const n=e||{},s=n.freshness?.maxBoost||3,a=n.source?.tier1Boost||5,i=n.visual?.videoBoost||1.3,r=n.geo?.cityMatch||1.5;let o=0;return s>=2.5&&s<=4?o+=1.5:s>1&&(o+=1),a>=4&&a<=7?o+=1.5:a>=2&&(o+=1),i>=1.2&&i<=1.5?o+=1:o+=.5,r>=1.3&&r<=2?o+=1:o+=.5,Math.min(5,Math.max(1,Math.round(o)))};function Fo(){const{settings:e,updateSettings:n,reloadSettings:s}=se(),[a,i]=x.useState("general"),[r,o]=x.useState(!1),[l,c]=x.useState(""),[d,u]=x.useState(!1),[m,g]=x.useState(null),[p,h]=x.useState({}),[w,v]=x.useState({tier1:"",tier2:"",tier3:""}),[S,f]=x.useState({title:"Breaking: Major Economic Reforms Announced",description:"Government unveils new policy to boost GDP growth by 2%. Markets rally on the news.",source:"BBC News",age:2,section:"business",result:null});if(x.useEffect(()=>{if(!e?.rankingWeights)return;const y={title:S.title,description:S.description,source:S.source,publishedAt:Date.now()-S.age*60*60*1e3,section:S.section,imageUrl:null},b={...e,debugLogs:!0},I=_t(y,S.section,0,b);f(P=>({...P,result:{score:I,breakdown:y._scoreBreakdown}}))},[S.title,S.description,S.source,S.age,S.section,e]),!e)return t.jsx("div",{className:"loading",children:"Loading..."});const _=(y,b)=>{const I=y.split("."),P={...e};let N=P;for(let E=0;E<I.length-1;E++)N[I[E]]={...N[I[E]]},N=N[I[E]];N[I[I.length-1]]=b,n(P)},T=()=>{o(!0),setTimeout(()=>o(!1),2e3),s()},L=()=>{window.confirm("Reset all settings to defaults?")&&(n({...oe}),s())},k=(y,b)=>{if(!b||!b.trim())return;const I=y.split(".");let P=e;for(const N of I)P=P?.[N]||[];Array.isArray(P)||(P=[]),P.includes(b.trim())||_(y,[...P,b.trim()])},O=(y,b)=>{const I=y.split(".");let P=e;for(const N of I)P=P?.[N]||[];Array.isArray(P)&&_(y,P.filter(N=>N!==b))},M=(y,b)=>{k(y,b),h({...p,[y]:""})},F=(y,b)=>{if(!b||!b.trim())return;const I=e.sourceTiers?.[y]||[];I.some(P=>P.toLowerCase()===b.trim().toLowerCase())||_(`sourceTiers.${y}`,[...I,b.trim()]),v({...w,[y]:""})},D=(y,b)=>{const I=e.sourceTiers?.[y]||[];_(`sourceTiers.${y}`,I.filter(P=>P!==b))},W=async()=>{if(l){u(!0),g(null);try{const y=await Ro(l);if(y.length>0){const b=y[0];n({...e,customFeeds:[...e.customFeeds||[],{title:b.title,url:b.url}]}),c("")}else g("No feeds found.")}catch{g("Error discovering feeds.")}finally{u(!1)}}},j=y=>{const b=[...e.customFeeds||[]];b.splice(y,1),n({...e,customFeeds:b})},C=()=>{const y={settings:e,hiddenEvents:JSON.parse(localStorage.getItem("upAhead_hiddenEvents")||"[]"),watchlist:JSON.parse(localStorage.getItem("upAhead_watchlist")||"[]"),readingHistory:e.readingHistory||[]},b="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(y,null,2)),I=document.createElement("a");I.setAttribute("href",b),I.setAttribute("download","news_app_full_backup.json"),document.body.appendChild(I),I.click(),I.remove()},B=y=>{const b=y.target.files[0];if(!b)return;const I=new FileReader;I.onload=P=>{try{const N=JSON.parse(P.target.result);window.confirm("Replace current settings, hidden events, and watchlist with imported data?")&&(N.settings?(n(N.settings),N.hiddenEvents&&localStorage.setItem("upAhead_hiddenEvents",JSON.stringify(N.hiddenEvents)),N.watchlist&&localStorage.setItem("upAhead_watchlist",JSON.stringify(N.watchlist))):n(N),s())}catch{alert("Invalid backup file")}},I.readAsText(b)},z=[{id:"general",label:"General",icon:"âš™ï¸"},{id:"ranking",label:"Ranking",icon:"ðŸ§ "},{id:"weather",label:"Weather",icon:"ðŸŒ¤ï¸"},{id:"sources",label:"Sources",icon:"ðŸ“¡"},{id:"market",label:"Market",icon:"ðŸ“ˆ"},{id:"sandbox",label:"Sandbox",icon:"ðŸ§ª"},{id:"advanced",label:"Advanced",icon:"ðŸ”§"},{id:"debug",label:"Debug",icon:"ðŸ›"}],A=()=>{switch(a){case"general":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“±",title:"Interface"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Home Layout",subLabel:"Timeline / Classic / Newspaper",children:t.jsxs("select",{value:e.uiMode||"timeline",onChange:y=>n({...e,uiMode:y.target.value}),className:"settings-select",children:[t.jsx("option",{value:"timeline",children:"ðŸ“± Timeline"}),t.jsx("option",{value:"classic",children:"ðŸ“Š Classic"}),t.jsx("option",{value:"newspaper",children:"ðŸ“° Newspaper"})]})}),t.jsx(J,{label:"Font Size",subLabel:`${e.fontSize||26}px`,children:t.jsx("input",{type:"range",min:"14",max:"34",step:"1",value:e.fontSize||26,onChange:y=>n({...e,fontSize:parseInt(y.target.value)}),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ¤–",title:"AI Configuration"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:"Gemini API Key"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)",fontSize:"0.65rem"},children:"Required for client-side fallback."})]}),t.jsx("input",{type:"password",value:e.geminiKey||"",onChange:y=>n({...e,geminiKey:y.target.value}),className:"settings-input",placeholder:"Enter API Key"})]})}),t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Data"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsx("div",{className:"settings-item__label",children:t.jsx("span",{children:"Alpha Vantage API Key"})}),t.jsx("input",{type:"password",value:e.alphaVantageKey||"",onChange:y=>n({...e,alphaVantageKey:y.target.value}),className:"settings-input",placeholder:"Enter AV Key"})]})})]});case"ranking":return t.jsx($o,{settings:e,updateNested:_,updateSettings:n,addToList:k,removeFromList:O});case"weather":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“",title:"Locations"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"10px"},children:"Active Cities"}),t.jsxs("div",{style:{display:"grid",gap:"10px",marginBottom:"10px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"1."}),t.jsx("input",{type:"text",value:"Chennai",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"2."}),t.jsx("input",{type:"text",value:"Trichy",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"3."}),t.jsx("input",{type:"text",value:e.weather?.cities?.[2]||"Muscat",onChange:y=>{const b=[...e.weather?.cities||["chennai","trichy","muscat"]];b[2]=y.target.value,_("weather.cities",b)},className:"settings-input",placeholder:"Enter city..."})]})]})]}),t.jsx(Z,{icon:"ðŸŒ¤ï¸",title:"Weather Models"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ECMWF (European)",children:t.jsx(ge,{checked:e.weather?.models?.ecmwf!==!1,onChange:y=>_("weather.models.ecmwf",y)})}),t.jsx(J,{label:"GFS (NOAA)",children:t.jsx(ge,{checked:e.weather?.models?.gfs!==!1,onChange:y=>_("weather.models.gfs",y)})}),t.jsx(J,{label:"ICON (DWD)",children:t.jsx(ge,{checked:e.weather?.models?.icon!==!1,onChange:y=>_("weather.models.icon",y)})})]})]});case"sources":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“¡",title:"News Sources"}),t.jsxs(ee,{children:[t.jsxs("div",{className:"settings-item",style:{borderBottom:"1px solid var(--accent-danger)",background:"rgba(220, 38, 38, 0.15)",padding:"10px"},children:[t.jsxs("div",{className:"settings-item__label",style:{color:"var(--accent-danger)"},children:[t.jsx("span",{children:"ðŸ† Top Websites Only"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)"},children:"BBC, Reuters, NDTV, Hindu, TOI..."})]}),t.jsx(ge,{checked:e.topWebsitesOnly===!0,onChange:y=>n({...e,topWebsitesOnly:y})})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",padding:"10px"},children:Object.keys(e.newsSources||{}).map(y=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.8rem"},children:[t.jsx("input",{type:"checkbox",checked:e.newsSources?.[y]!==!1,onChange:b=>_(`newsSources.${y}`,b.target.checked),disabled:e.topWebsitesOnly}),y]},y))})]}),t.jsx(Z,{icon:"ðŸ†",title:"Source Tiers"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Classify sources to boost their ranking score."}),t.jsx(Re,{label:`Tier 1 (High Boost: ${e.rankingWeights?.source?.tier1Boost||.5}x)`,placeholder:"e.g. BBC, Reuters",value:w.tier1,onChange:y=>v({...w,tier1:y}),onAdd:()=>F("tier1",w.tier1),items:e.sourceTiers?.tier1||[],onRemove:y=>D("tier1",y)}),t.jsx(Re,{label:`Tier 2 (Medium Boost: ${e.rankingWeights?.source?.tier2Boost||.2}x)`,placeholder:"e.g. NDTV, Hindu",value:w.tier2,onChange:y=>v({...w,tier2:y}),onAdd:()=>F("tier2",w.tier2),items:e.sourceTiers?.tier2||[],onRemove:y=>D("tier2",y)}),t.jsx(Re,{label:`Tier 3 (No Boost: ${e.rankingWeights?.source?.tier3Boost||0}x)`,placeholder:"e.g. Local Blogs",value:w.tier3,onChange:y=>v({...w,tier3:y}),onAdd:()=>F("tier3",w.tier3),items:e.sourceTiers?.tier3||[],onRemove:y=>D("tier3",y)})]}),t.jsx(Z,{icon:"ðŸ”—",title:"Custom Feeds"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"10px"},children:[t.jsx("input",{type:"text",value:l,onChange:y=>c(y.target.value),placeholder:"RSS URL...",className:"settings-input"}),t.jsx("button",{className:"btn btn--primary",onClick:W,disabled:d,children:d?"...":"Add"})]}),m&&t.jsx("div",{style:{color:"red",fontSize:"0.75rem"},children:m}),e.customFeeds?.map((y,b)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",padding:"5px 0"},children:[t.jsx("span",{children:y.title||y.url}),t.jsx("button",{onClick:()=>j(b),style:{color:"red"},children:"âœ•"})]},b))]})]});case"market":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Display"}),t.jsx(ee,{children:Object.keys(e.market||{}).filter(y=>y.startsWith("show")).map(y=>t.jsx(J,{label:y.replace("show",""),children:t.jsx(ge,{checked:e.market?.[y]!==!1,onChange:b=>_(`market.${y}`,b)})},y))})]});case"sandbox":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ§ª",title:"Ranking Sandbox"}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:`Simulate how the current settings affect an article's score. Change settings in the "Ranking" tab to see impact here.`}),t.jsx(ee,{children:t.jsxs("div",{style:{display:"grid",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Title"}),t.jsx("input",{className:"settings-input",value:S.title,onChange:y=>f({...S,title:y.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Description"}),t.jsx("textarea",{className:"settings-input",style:{resize:"vertical",minHeight:"60px"},value:S.description,onChange:y=>f({...S,description:y.target.value})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Source"}),t.jsxs("select",{className:"settings-select",value:S.source,onChange:y=>f({...S,source:y.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"BBC News",children:"BBC (Tier 1)"}),t.jsx("option",{value:"Unknown Blog",children:"Blog (Tier 3)"}),t.jsx("option",{value:"NDTV",children:"NDTV (Tier 2)"}),t.jsx("option",{value:"TechCrunch",children:"TechCrunch"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Section"}),t.jsxs("select",{className:"settings-select",value:S.section,onChange:y=>f({...S,section:y.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"world",children:"World (High Priority)"}),t.jsx("option",{value:"business",children:"Business"}),t.jsx("option",{value:"technology",children:"Technology"}),t.jsx("option",{value:"general",children:"General"})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:["Age: ",S.age," hours"]}),t.jsx("input",{type:"range",min:"0",max:"72",step:"1",value:S.age,onChange:y=>f({...S,age:parseInt(y.target.value)}),style:{width:"100%"}})]})]})}),S.result&&t.jsxs("div",{className:"settings-card",style:{border:"1px solid var(--accent-primary)",background:"rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{textAlign:"center",padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:"CALCULATED SCORE"}),t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"var(--accent-primary)"},children:S.result.score.toFixed(1)})]}),t.jsx("div",{style:{padding:"10px",fontSize:"0.75rem"},children:t.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:t.jsx("tbody",{children:Object.entries(S.result.breakdown||{}).map(([y,b])=>y==="total"||typeof b!="number"?null:t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[t.jsx("td",{style:{padding:"4px",textTransform:"capitalize",color:"var(--text-secondary)"},children:y.replace(/([A-Z])/g," $1").trim()}),t.jsxs("td",{style:{padding:"4px",textAlign:"right",fontWeight:"bold",color:b>1.5?"#4f4":b<.5?"#f44":"#fff"},children:[b.toFixed(2),y.toLowerCase().includes("boost")||y.toLowerCase().includes("multiplier")?"x":""]})]},y))})})})]})]});case"advanced":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ”§",title:"Advanced"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Enable News Cache",subLabel:"Faster loads, 5min TTL",children:t.jsx(ge,{checked:e.enableCache!==!1,onChange:y=>n({...e,enableCache:y})})}),t.jsx(J,{label:"Crawler Mode",children:t.jsxs("select",{value:e.crawlerMode||"auto",onChange:y=>n({...e,crawlerMode:y.target.value}),className:"settings-select",children:[t.jsx("option",{value:"auto",children:"Auto"}),t.jsx("option",{value:"manual",children:"Manual"})]})}),t.jsx(J,{label:"Debug Logs",children:t.jsx(ge,{checked:e.debugLogs===!0,onChange:y=>n({...e,debugLogs:y})})})]}),t.jsx(Z,{icon:"ðŸ•µï¸",title:"Impact & Priority"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ’¥ Base Impact Weight",subLabel:"Multiplier",children:t.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:e.rankingWeights?.impact?.boost||1,onChange:y=>_("rankingWeights.impact.boost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ High Impact Boost",subLabel:"Triggers on Major Event Keywords",children:t.jsx("input",{type:"range",min:"1.0",max:"5.0",step:"0.1",value:e.rankingWeights?.impact?.highImpactBoost||2.5,onChange:y=>_("rankingWeights.impact.highImpactBoost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(Re,{label:"Major Event Keywords",placeholder:"e.g. Budget, Treaty, War",value:p.highImpact,onChange:y=>h({...p,highImpact:y}),onAdd:()=>M("highImpactKeywords",p.highImpact),items:e.highImpactKeywords||[],onRemove:y=>O("highImpactKeywords",y)}),t.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"5px"},children:["â„¹ï¸ Articles containing these words receive the ",t.jsx("strong",{children:"High Impact Boost"})," (above)."]})]}),t.jsx(Z,{icon:"âš¡",title:"Buzz Ranking"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:'Configuration for "Buzz" and "Social" sections.'}),t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:y=>_("buzzRankingWeights.visual.videoBoost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:y=>_("buzzRankingWeights.trending.threshold",parseFloat(y.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ”„",title:"Backup & Sync"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{className:"btn btn--secondary",onClick:C,style:{flex:1},children:"Export Backup"}),t.jsxs("label",{className:"btn btn--secondary",style:{flex:1,cursor:"pointer",textAlign:"center"},children:["Import Backup",t.jsx("input",{type:"file",accept:".json",onChange:B,style:{display:"none"}})]})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"8px"},children:"Saves Settings, Hidden Events (Plan My Week), and Watchlist to a file."})]})]});case"debug":return t.jsx(Lo,{});default:return null}};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[t.jsx(ke,{title:"Settings",showBack:!0,backTo:"/",compact:!0,style:{flex:"0 0 auto"}}),t.jsxs("div",{className:"settings-layout",children:[t.jsx("div",{className:"settings-sidebar",children:z.map(y=>t.jsxs("button",{className:`settings-tab-btn ${a===y.id?"active":""}`,onClick:()=>i(y.id),children:[t.jsx("span",{className:"tab-icon",children:y.icon}),t.jsx("span",{className:"tab-label",children:y.label})]},y.id))}),t.jsxs("div",{className:"settings-content",children:[t.jsx("div",{className:"settings-scroll-area",style:{overflowY:a==="ranking"?"hidden":"auto",padding:a==="ranking"?0:"15px"},children:A()}),t.jsxs("div",{className:"settings-footer",children:[t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx("button",{className:"btn btn--danger",onClick:L,style:{flex:1},children:"Reset"}),t.jsx("button",{className:"btn btn--primary",onClick:T,style:{flex:1},children:r?"âœ“ Saved":"Save"})]}),t.jsx("div",{className:"version-tag",children:Do})]})]})]}),t.jsx("style",{children:`
                .settings-layout { display: flex; flex: 1; overflow: hidden; background: var(--bg-primary); }
                .settings-sidebar { width: 72px; background: var(--bg-secondary); border-right: 1px solid var(--border-default); display: flex; flex-direction: column; padding: 10px 5px; overflow-y: auto; flex-shrink: 0; }
                .settings-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 4px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 8px; margin-bottom: 8px; width: 100%; transition: background 0.2s; min-height: 50px; }
                .settings-tab-btn.active { background: var(--accent-primary); color: #fff; }
                .tab-icon { font-size: 1.5rem; margin-bottom: 4px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; flex-shrink: 0; }
                .tab-label { font-size: 0.6rem; text-align: center; line-height: 1.1; display: none; }
                @media (min-height: 600px) { .tab-label { display: block; } }
                .settings-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
                .settings-scroll-area { flex: 1; overflow-y: auto; padding: 15px; }
                .settings-footer { flex-shrink: 0; background: var(--bg-secondary); border-top: 1px solid var(--border-default); padding: 15px; }
                .settings-card { background: var(--bg-card); border-radius: var(--radius-md); padding: 15px; margin-bottom: 20px; border: 1px solid var(--border-default); }
                .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
                .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
                .settings-item:last-child { border-bottom: none; }
                .settings-select, .settings-input, .settings-input-number { background: var(--bg-secondary); border: 1px solid var(--border-default); color: var(--text-primary); padding: 8px; border-radius: 4px; font-size: 0.85rem; }
                .settings-input { width: 100%; }
                .chip-checkbox { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 16px; border: 1px solid var(--border-default); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.8rem; cursor: pointer; }
                .chip-checkbox.active { background: var(--accent-primary); color: #fff; border-color: var(--accent-primary); }
                .keyword-chip { display: inline-flex; align-items: center; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; margin: 2px; font-size: 0.75rem; }
                .keyword-chip button { background: none; border: none; color: var(--accent-danger); margin-left: 6px; cursor: pointer; padding: 0; }
                .version-tag { text-align: right; font-size: 0.7rem; color: var(--text-muted); margin-top: 8px; font-family: monospace; opacity: 0.7; }
            `})]})}const $o=({settings:e,updateNested:n,updateSettings:s,addToList:a,removeFromList:i})=>{const[r,o]=x.useState("main"),[l,c]=x.useState("entertainment"),[d,u]=x.useState("movies"),[m,g]=x.useState({}),p=(S,f)=>g(_=>({..._,[S]:f})),h=()=>{const S=Oo(e.rankingWeights||{});return t.jsxs("div",{children:[t.jsx("div",{className:"settings-card",style:{background:"linear-gradient(135deg, rgba(255,215,0,0.1), rgba(0,0,0,0))",border:"1px solid rgba(255,215,0,0.3)"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("div",{style:{fontWeight:600,color:"#FFD700"},children:"â˜… Quality Rating"})}),t.jsxs("div",{style:{fontSize:"1.8rem",color:"#FFD700"},children:["â˜…".repeat(S),"â˜†".repeat(5-S)]})]})}),t.jsx(Z,{icon:"ðŸ†",title:"Top Stories & Global"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ† Top Stories Boost",subLabel:"Min Score for Top Stories",children:t.jsx("input",{type:"range",min:"8",max:"30",step:"1",value:e.rankingWeights?.trending?.threshold||12,onChange:f=>n("rankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“Œ Keyword Match",subLabel:`+${(e.rankingWeights?.keyword?.matchBoost||2).toFixed(1)} Points`,children:t.jsx("input",{type:"range",min:"0",max:"5",step:"0.5",value:e.rankingWeights?.keyword?.matchBoost||2,onChange:f=>n("rankingWeights.keyword.matchBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“ Location Match",subLabel:`${(e.rankingWeights?.geo?.cityMatch||1.5).toFixed(1)}x Multiplier`,children:t.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:e.rankingWeights?.geo?.cityMatch||1.5,onChange:f=>n("rankingWeights.geo.cityMatch",parseFloat(f.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ“‰",title:"Freshness & Decay"}),t.jsxs(ee,{children:[t.jsxs(J,{label:"ðŸŽšï¸ Freshness Sensitivity",subLabel:"Left: Stricter (Newer) | Right: Relaxed",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",gap:"10px"},children:[t.jsx("span",{title:"Strict/Fresh",style:{fontSize:"1.2rem"},children:"âš¡"}),t.jsx("input",{type:"range",min:"6",max:"72",value:e.rankingWeights?.freshness?.decayHours||26,onChange:f=>n("rankingWeights.freshness.decayHours",parseInt(f.target.value)),style:{flex:1}}),t.jsx("span",{title:"Relaxed/Older",style:{fontSize:"1.2rem"},children:"ðŸ¢"})]}),t.jsxs("div",{style:{textAlign:"right",fontSize:"0.7rem",color:"var(--text-muted)"},children:["Decay over ",e.rankingWeights?.freshness?.decayHours||26,"h"]})]}),t.jsx(J,{label:"ðŸ“‰ Hide Stale News",subLabel:`> ${e.hideOlderThanHours||60}h`,children:t.jsx("input",{type:"number",min:1,max:168,value:e.hideOlderThanHours||60,onChange:f=>s({...e,hideOlderThanHours:parseInt(f.target.value)||60}),className:"settings-input-number",style:{width:"60px"}})})]}),t.jsx(Z,{icon:"ðŸ§ ",title:"Classification Logic"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Automatic categorization logic."}),t.jsx("div",{className:"settings-item__label",style:{color:"var(--accent-primary)",marginTop:"10px"},children:"Entity Overrides (Exact Matches)"}),t.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",margin:"5px 0 15px 0",fontSize:"0.75rem",fontFamily:"monospace"},children:Object.entries(Wn).map(([f,_])=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("span",{style:{color:"var(--text-primary)"},children:f}),t.jsxs("span",{style:{color:"var(--text-muted)"},children:["â†’ ",_]})]},f))})]})]})},w=()=>{const S=[{id:"entertainment",label:"Entertain",icon:"ðŸŽ¬"},{id:"technology",label:"Tech",icon:"ðŸ’»"},{id:"sports",label:"Sports",icon:"âš½"},{id:"social",label:"Social",icon:"ðŸ”¥"}];return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:S.map(f=>t.jsxs("button",{onClick:()=>c(f.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:l===f.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:l===f.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:f.icon}),f.label]},f.id))}),t.jsx("div",{style:{flex:1,overflowY:"auto"},children:l==="social"?t.jsxs("div",{children:[t.jsx(Z,{icon:"ðŸ”¥",title:"Social Trends"}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:["Uses ",t.jsx("strong",{children:"Legacy Scoring"})," (Freshness + Source)."]}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:f=>n("buzzRankingWeights.visual.videoBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:f=>n("buzzRankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})})]})]}):t.jsx(Rn,{title:l.charAt(0).toUpperCase()+l.slice(1),icon:S.find(f=>f.id===l).icon,configPath:`buzz.${l}`,configData:e.buzz?.[l]||{},updateNested:n,addToList:a,removeFromList:i,localInputs:m,handleLocalInput:p,subTab:l})})]})},v=()=>{const S=[{id:"movies",label:"Movies",icon:"ðŸŽ¬"},{id:"events",label:"Events",icon:"ðŸŽ¤"},{id:"festivals",label:"Festivals",icon:"ðŸª”"},{id:"sports",label:"Sports",icon:"âš½"},{id:"shopping",label:"Shopping",icon:"ðŸ›’"},{id:"airlines",label:"Airlines",icon:"âœˆï¸"},{id:"alerts",label:"Alerts",icon:"âš ï¸"},{id:"civic",label:"Civic",icon:"ðŸ›ï¸"}],f=e.upAhead?.ranking?.[d]||{},_=j=>{const C=j==="positive"?e.upAhead?.keywords?.[d]:e.upAhead?.keywords?.[`${d}_negative`];return C&&C.length>0?C:(j==="positive"?oe.upAhead.keywords[d]:oe.upAhead.keywords[`${d}_negative`])||[]},T=_("positive"),L=_("negative"),k=()=>{const j=e.upAhead?.keywords?.negative;return j&&j.length>0?j:oe.upAhead.keywords.negative||[]},O=k(),M={enabled:e.upAhead?.categories?.[d]!==!1,positiveMultiplier:f.positiveMultiplier||1,negativeMultiplier:f.negativeMultiplier||1,filterThreshold:f.filterThreshold||0,positiveKeywords:T,negativeKeywords:[...O,...L]},F=(j,C)=>{j==="enabled"?n(`upAhead.categories.${d}`,C):(j==="positiveMultiplier"||j==="negativeMultiplier"||j==="filterThreshold")&&n(`upAhead.ranking.${d}.${j}`,C)},D=(j,C)=>{if(!C||!C.trim())return;const B=C.trim();if(j==="positiveKeywords"){const z=_("positive");if(z.some(A=>A.toLowerCase()===B.toLowerCase()))return;n(`upAhead.keywords.${d}`,[...z,B])}else if(j==="negativeKeywords"){const z=_("negative");if(z.some(A=>A.toLowerCase()===B.toLowerCase()))return;n(`upAhead.keywords.${d}_negative`,[...z,B])}},W=(j,C)=>{if(j==="positiveKeywords"){const z=_("positive").filter(A=>A!==C);n(`upAhead.keywords.${d}`,z)}else if(j==="negativeKeywords"){const B=_("negative");if(B.includes(C)){const z=B.filter(A=>A!==C);n(`upAhead.keywords.${d}_negative`,z)}else{const z=k();if(z.includes(C)&&window.confirm(`"${C}" is a global negative keyword. Remove it from ALL categories?`)){const A=z.filter(y=>y!==C);n("upAhead.keywords.negative",A)}}}};return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:S.map(j=>t.jsxs("button",{onClick:()=>u(j.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:d===j.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:d===j.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:j.icon}),j.label]},j.id))}),t.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[t.jsx(Z,{icon:"ðŸŒ",title:"Global Config"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"5px"},children:"Locations"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px"},children:["Chennai","Muscat","Trichy"].map(j=>t.jsxs("label",{className:`chip-checkbox ${e.upAhead?.locations?.includes(j)?"active":""}`,children:[t.jsx("input",{type:"checkbox",style:{display:"none"},checked:e.upAhead?.locations?.includes(j)||!1,onChange:C=>{const B=e.upAhead?.locations||[],z=C.target.checked?[...B,j]:B.filter(A=>A!==j);n("upAhead.locations",z)}}),j]},j))})]}),t.jsx(Rn,{title:S.find(j=>j.id===d).label,icon:S.find(j=>j.id===d).icon,configData:M,customUpdate:F,customAdd:D,customRemove:W,localInputs:m,handleLocalInput:p,subTab:`ua_${d}`})]})]})};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",padding:"0 15px",flexShrink:0},children:[t.jsx("button",{className:`btn ${r==="main"?"btn--primary":"btn--secondary"}`,onClick:()=>o("main"),style:{flex:1},children:"âš™ï¸ Main"}),t.jsx("button",{className:`btn ${r==="buzz"?"btn--primary":"btn--secondary"}`,onClick:()=>o("buzz"),style:{flex:1},children:"âš¡ Buzz"}),t.jsx("button",{className:`btn ${r==="upahead"?"btn--primary":"btn--secondary"}`,onClick:()=>o("upahead"),style:{flex:1},children:"ðŸ—“ï¸ Up Ahead"})]}),t.jsxs("div",{className:"settings-tab-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"0 15px 15px 15px"},children:[r==="main"&&h(),r==="buzz"&&w(),r==="upahead"&&v()]})]})},Rn=({title:e,icon:n,configPath:s,configData:a,updateNested:i,addToList:r,removeFromList:o,localInputs:l,handleLocalInput:c,subTab:d,customUpdate:u,customAdd:m,customRemove:g})=>{const p=(v,S)=>{u?u(v,S):i(`${s}.${v}`,S)},h=(v,S)=>{m?m(v,S):r(`${s}.${v}`,S)},w=(v,S)=>{g?g(v,S):o(`${s}.${v}`,S)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[t.jsx(Z,{icon:n,title:e}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:a.enabled!==!1?"Active":"Disabled"}),t.jsx(ge,{checked:a.enabled!==!1,onChange:v=>p("enabled",v)})]})]}),t.jsxs(ee,{children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:[t.jsx("strong",{children:"Ranking Formula:"})," (Positive Matches Ã— Multiplier) â€” (Negative Matches Ã— Multiplier)"]}),t.jsxs("div",{style:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#81c784"},children:"âœ… Positive Boost"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[a.positiveMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:a.positiveMultiplier||1,onChange:v=>p("positiveMultiplier",parseFloat(v.target.value)),style:{width:"80px"}})]})]}),t.jsx(Re,{label:"",placeholder:"Add positive keyword...",value:l[`${d}_pos`]||"",onChange:v=>c(`${d}_pos`,v),onAdd:()=>{h("positiveKeywords",l[`${d}_pos`]),c(`${d}_pos`,"")},items:a.positiveKeywords||[],onRemove:v=>w("positiveKeywords",v)})]}),t.jsxs("div",{style:{background:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#e57373"},children:"ðŸš« Negative Penalty"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[a.negativeMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:a.negativeMultiplier||1,onChange:v=>p("negativeMultiplier",parseFloat(v.target.value)),style:{width:"80px"}})]})]}),t.jsx(Re,{label:"",placeholder:"Add negative keyword...",value:l[`${d}_neg`]||"",onChange:v=>c(`${d}_neg`,v),onAdd:()=>{h("negativeKeywords",l[`${d}_neg`]),c(`${d}_neg`,"")},items:a.negativeKeywords||[],onRemove:v=>w("negativeKeywords",v)})]}),t.jsx(J,{label:"ðŸ›¡ï¸ Filter Threshold",subLabel:`Hide if Score < ${a.filterThreshold||0}`,children:t.jsx("input",{type:"range",min:"-5",max:"5",step:"1",value:a.filterThreshold||0,onChange:v=>p("filterThreshold",parseInt(v.target.value)),style:{width:"100%"}})})]})]})},Z=({icon:e,title:n})=>t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:e})," ",n]}),ee=({children:e})=>t.jsx("div",{className:"settings-card",children:e}),J=({label:e,subLabel:n,children:s})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:e}),n&&t.jsx("small",{children:n})]}),t.jsx("div",{style:{flex:"0 0 auto",marginLeft:"10px"},children:s})]}),Re=({label:e,placeholder:n,value:s,onChange:a,onAdd:i,items:r,onRemove:o})=>t.jsxs("div",{style:{marginBottom:"15px"},children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"6px"},children:e}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[t.jsx("input",{type:"text",value:s,onChange:l=>a(l.target.value),placeholder:n,className:"settings-input",onKeyDown:l=>l.key==="Enter"&&i()}),t.jsx("button",{className:"btn btn--secondary",onClick:i,style:{padding:"0 15px"},children:"Add"})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[r.map((l,c)=>t.jsxs("span",{className:"keyword-chip",children:[l,t.jsx("button",{onClick:()=>o(l),children:"Ã—"})]},c)),r.length===0&&t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Default keywords only"})]})]});function Bo(){const e=Nt(),[n,s]=x.useState(()=>rn(yt())),[a,i]=x.useState(!1),[r,o]=x.useState(()=>$s()),[l]=x.useState(()=>rn(yt())),{refreshWeather:c}=Ke(),{refreshNews:d}=Ge(),u=async()=>{i(!0);const h=Object.keys(n).filter(S=>n[S]),w=[],v=[];h.forEach(S=>{S==="weather"?(w.push(c(!0)),ht("weather")):S==="market"?ht("market"):(v.push(S),ht(S))}),v.length>0&&w.push(d(v));try{await Promise.all(w)}catch(S){console.error("Refresh failed",S)}o("Just now"),i(!1),setTimeout(()=>e("/"),500)},m=h=>{s({world:h,india:h,chennai:h,trichy:h,local:h,social:h,weather:h,market:h})},g=[{key:"world",icon:"ðŸŒ",label:"World News",desc:"International headlines"},{key:"india",icon:"ðŸ‡®ðŸ‡³",label:"India News",desc:"National news"},{key:"chennai",icon:"ðŸ›ï¸",label:"Chennai News",desc:"Chennai city updates"},{key:"trichy",icon:"ðŸ›ï¸",label:"Trichy News",desc:"Trichy local news"},{key:"local",icon:"ðŸ“",label:"Local (Muscat)",desc:"Muscat & Oman news"},{key:"social",icon:"ðŸ‘¥",label:"Social Trends",desc:"Trending topics"},{key:"weather",icon:"â˜ï¸",label:"Weather",desc:"Chennai, Trichy, Muscat"},{key:"market",icon:"ðŸ“ˆ",label:"Market",desc:"BSE, NSE, Movers"}],p=Object.values(n).filter(Boolean).length;return t.jsxs(t.Fragment,{children:[t.jsx(ke,{title:"Refresh Content",showBack:!0,backTo:"/"}),t.jsxs("div",{className:"refresh-page",children:[t.jsxs("div",{className:"refresh-info",children:[t.jsx("span",{children:"â±ï¸"}),t.jsxs("span",{children:["Last refresh: ",t.jsx("strong",{children:r})]})]}),t.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"},children:[t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>m(!0),children:"Select All"}),t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>m(!1),children:"Clear All"})]}),t.jsxs("section",{className:"settings-section",children:[t.jsxs("h2",{className:"settings-section__title",children:[t.jsx("span",{children:"ðŸ“‹"}),"Select Sections to Refresh",t.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.8rem",fontWeight:"normal",color:"var(--accent-primary)"},children:[p,"/",g.length]})]}),t.jsx("div",{className:"settings-card",children:g.map(({key:h,icon:w,label:v,desc:S})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",style:{flexDirection:"column",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-sm)"},children:[t.jsx("span",{className:"settings-item__icon",children:w}),v,l[h]&&t.jsx("span",{style:{color:"var(--weather-sun)",fontSize:"0.7rem"},children:"â˜…"})]}),t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginLeft:"28px"},children:S})]}),t.jsx(ge,{checked:n[h],onChange:f=>s(_=>({..._,[h]:f})),recommended:l[h]})]},h))})]}),t.jsxs("button",{className:`refresh-btn ${a?"refresh-btn--loading":""}`,onClick:u,disabled:a||p===0,children:[t.jsx("span",{className:"refresh-btn__icon",children:a?"âŸ³":"ðŸ”„"}),t.jsx("span",{children:a?"Refreshing...":"Refresh Now"})]}),t.jsxs("div",{className:"schedule-card",children:[t.jsxs("div",{className:"schedule-card__title",children:[t.jsx("span",{children:"ðŸ“Š"}),"Auto-Refresh Schedule"]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Forecast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 3 hours"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Nowcast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 1 hour"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"News Updates"}),t.jsx("span",{className:"schedule-item__value",children:"Every 30 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Market Data"}),t.jsx("span",{className:"schedule-item__value",children:"Every 5 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Social Trends"}),t.jsx("span",{className:"schedule-item__value",children:"Every 15 minutes"})]})]}),t.jsxs("div",{className:"card",style:{marginTop:"var(--spacing-md)",textAlign:"center"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:["Current Segment: ",t.jsx("strong",{style:{color:"var(--accent-primary)"},children:yt()?.name})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"4px"},children:"â˜… = Recommended sections for this time"})]})]})]})}function ds(e,n={}){const{country:s="IN",lang:a="en",timeRange:i="7d",excludeTerms:r=[]}=n;let o=encodeURIComponent(e);i&&(o+=`+when:${i}`),Array.isArray(r)&&r.forEach(u=>{o+=`+-${encodeURIComponent(u)}`});const l=`${a}-${s}`,c=s,d=`${s}:${a}`;return`https://news.google.com/rss/search?q=${o}&hl=${l}&gl=${c}&ceid=${d}`}async function us(e){try{const n=ds(e.query||e.name,e.options||{});console.log(`[TopicService] Fetching news for "${e.name}"`);const s=await Se(n,"following");zs(e.id);const a=V(),i=a.hideOlderThanHours||60,r=Date.now(),o=i*60*60*1e3,l=a.strictFreshness!==!1;let c=s;return l&&(c=s.filter(u=>u.publishedAt?r-u.publishedAt<=o:!1),console.log(`[TopicService] Filtered ${s.length-c.length} old articles for "${e.name}" (Limit: ${i}h)`)),c.map(u=>({...u,topicId:e.id,topicName:e.name,context:"following"}))}catch(n){return console.error(`[TopicService] Failed to fetch topic "${e.name}":`,n),[]}}async function Po(e){if(!e||e.length===0)return{};const n=e.map(r=>us(r)),a=(await Promise.all(n)).flat(),i={};return a.forEach(r=>{r&&r.topicId&&(i[r.topicId]||(i[r.topicId]=[]),i[r.topicId].push(r))}),i}const hs=x.createContext();function zo({children:e}){const[n,s]=x.useState([]),[a,i]=x.useState({}),[r,o]=x.useState(!1),[l,c]=x.useState([]);x.useEffect(()=>{const v=V();s(v.followedTopics||[]),h()},[]),x.useEffect(()=>{if(n.length===0)return;d(!1);const v=setInterval(()=>{console.log("[TopicContext] Auto-refreshing topics..."),d(!0)},900*1e3);return()=>clearInterval(v)},[n.length]);const d=async(v=!1)=>{if(n.length!==0){v||o(!0);try{const S=await Po(n);v&&u(S),i(S)}catch(S){console.error("[TopicContext] Failed to refresh topics:",S)}finally{v||o(!1)}}},u=v=>{let S=0,f="";if(Object.entries(v).forEach(([_,T])=>{const L=a[_]||[];if(T.length>0&&L.length>0&&T[0].id!==L[0].id){S++;const k=n.find(O=>O.id===_);k&&(f=k.name)}}),S>0){const _=S===1?`New update for ${f}`:`Updates in ${S} followed topics`;Zn(_,{body:"Click to see the latest stories.",tag:"topic-update"})}},m=v=>{Bs(v);const S=V();s(S.followedTopics||[]),setTimeout(()=>d(!1),50)},g=v=>{Ps(v),s(f=>f.filter(_=>_.id!==v));const S={...a};delete S[v],i(S)},p=v=>{Bn(v),h()},h=()=>{const v=Ws();c(v)},w={followedTopics:n,topicNews:a,loading:r,suggestions:l,addTopic:m,removeTopic:g,refreshTopics:d,addToHistory:p};return t.jsx(hs.Provider,{value:w,children:e})}function ms(){return x.useContext(hs)}function Ho({topic:e,articleCount:n,onClick:s,onRemove:a}){const i=Nt(),r=e.lastFetched?Uo(new Date(e.lastFetched)):"Never updated",o=()=>{s?s(e):i(`/following/${e.id}`)};return t.jsxs("div",{className:"topic-card",onClick:o,children:[t.jsx("div",{className:"topic-card__icon",children:e.icon||"ðŸ“°"}),t.jsxs("div",{className:"topic-card__content",children:[t.jsx("h3",{className:"topic-card__name",children:e.name}),t.jsxs("p",{className:"topic-card__update",children:["Last update: ",r]})]}),t.jsx("div",{className:"topic-card__badge",children:n>0&&t.jsxs("span",{className:"topic-card__count",children:[n," new"]})}),t.jsx("button",{className:"topic-card__menu",onClick:l=>{l.stopPropagation(),window.confirm(`Stop following "${e.name}"?`)&&a(e.id)},"aria-label":"Remove topic",children:"â‹®"})]})}function Uo(e){if(!e)return"Never";const n=Math.floor((Date.now()-e)/6e4);if(n<1)return"Just now";if(n<60)return`${n} min${n>1?"s":""} ago`;const s=Math.floor(n/60);return s<24?`${s} hour${s>1?"s":""} ago`:`${Math.floor(s/24)} days ago`}function Wo({onAddTopic:e}){const[n,s]=x.useState(""),[a,i]=x.useState([]),[r,o]=x.useState(!1),l=async d=>{if(d.preventDefault(),!!n.trim()){o(!0);try{const u=ds(n),m=await Se(u,"preview");i(m.slice(0,5))}catch(u){console.error("Search failed:",u),alert("Failed to find news for this topic. Try different keywords.")}finally{o(!1)}}},c=()=>{const d={name:n,query:n,icon:Go(n),options:{country:"IN",lang:"en",timeRange:"30d"}};e(d),s(""),i([])};return t.jsxs("div",{className:"topic-search",children:[t.jsxs("form",{onSubmit:l,children:[t.jsx("input",{type:"text",placeholder:"Search topics... (e.g., Tamil Nadu Elections)",value:n,onChange:d=>s(d.target.value),className:"topic-search__input"}),t.jsx("button",{type:"submit",disabled:r,children:r?"...":"Search"})]}),a.length>0&&t.jsxs("div",{className:"topic-search__preview",children:[t.jsxs("h4",{children:['Preview: "',n,'"']}),t.jsx("ul",{children:a.map((d,u)=>t.jsx("li",{children:d.title},u))}),t.jsxs("button",{onClick:c,className:"topic-search__follow-btn",children:['âž• Follow "',n,'"']})]})]})}function Go(e){const n=e.toLowerCase();return n.includes("election")?"ðŸ—³ï¸":n.includes("market")||n.includes("stock")||n.includes("sensex")?"ðŸ“Š":n.includes("film")||n.includes("movie")||n.includes("cinema")?"ðŸŽ¬":n.includes("sport")||n.includes("cricket")||n.includes("ipl")?"ðŸ":n.includes("tech")||/\bai\b/.test(n)||n.includes("startup")?"ðŸ’»":n.includes("weather")||n.includes("rain")?"â˜ï¸":"ðŸ“°"}function Ko(){const{followedTopics:e,topicNews:n,loading:s,suggestions:a,addTopic:i,removeTopic:r,refreshTopics:o}=ms();x.useEffect(()=>{},[]);const l=e.length>0,c=d=>{i({name:d,query:d,icon:"ðŸ”",options:{country:"IN",lang:"en",timeRange:"30d"}})};return t.jsxs("div",{className:"following-page",children:[t.jsx("header",{className:"following-page__header",children:t.jsx("h1",{children:"ðŸ“Œ Following"})}),t.jsxs("div",{className:"following-page__content",children:[t.jsx(Wo,{onAddTopic:i}),a.length>0&&t.jsxs("div",{className:"following-page__suggestions-section",children:[t.jsx("h4",{children:"Suggested for you"}),t.jsx("div",{className:"following-page__suggestions",children:a.map((d,u)=>t.jsxs("button",{className:"suggestion-chip",onClick:()=>c(d.word),children:["+ ",d.word]},u))})]}),s&&t.jsx("p",{children:"Loading updates..."}),l?t.jsxs("div",{className:"following-page__topics",children:[t.jsx("h2",{className:"following-page__section-title",children:"Your Topics"}),e.map(d=>t.jsx(Ho,{topic:d,articleCount:n[d.id]?.length||0,onRemove:r},d.id))]}):t.jsxs("div",{className:"following-page__empty",children:[t.jsx("p",{children:"No topics followed yet."}),t.jsx("p",{children:"Search for topics above to get started!"})]})]})]})}function Vo(){const{topicId:e}=Cs(),n=Nt(),{followedTopics:s,addToHistory:a}=ms(),[i,r]=x.useState([]),[o,l]=x.useState(!0),c=s.find(d=>d.id===e);return x.useEffect(()=>{if(!c)return;(async()=>{l(!0);try{const u=await us(c);r(u)}catch(u){console.error(u)}finally{l(!1)}})()},[e,c]),c?t.jsxs("div",{className:"page-container",children:[t.jsxs("header",{className:"header",style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-secondary)",borderBottom:"1px solid var(--border-color)",padding:"10px 15px",display:"flex",alignItems:"center",gap:"15px"},children:[t.jsx("button",{onClick:()=>n("/following"),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"var(--text-primary)"},children:"â†"}),t.jsxs("h1",{style:{margin:0,fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:c?.icon}),c?.name]})]}),t.jsx("main",{className:"main-content",style:{paddingTop:"0"},children:o?t.jsxs("div",{className:"loading",style:{padding:"20px",textAlign:"center"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching latest news..."})]}):t.jsx("div",{style:{padding:"10px"},children:t.jsx(le,{id:`topic-${e}`,title:`Latest on ${c?.name}`,icon:c?.icon,news:i,maxDisplay:50,showExpand:!1,colorClass:"news-section__title--world",onArticleClick:d=>a(d)})})})]}):t.jsx("div",{className:"page-container",children:t.jsxs("div",{className:"loading",style:{padding:"20px"},children:[t.jsx("p",{children:"Loading topic..."}),t.jsx("button",{onClick:()=>n("/following"),children:"Back to List"})]})})}function qo(){const{isWebView:e}=rt(),n=Ln(),s=[{path:"/",label:"Main",icon:"ðŸ "},{path:"/up-ahead",label:"Up Ahead",icon:"ðŸ—“ï¸"},{path:"/following",label:"Follow",icon:"ðŸ“Œ"},{path:"/newspaper",label:"Paper",icon:"ðŸ“°"},{path:"/markets",label:"Market",icon:"ðŸ“ˆ"},{path:"/tech-social",label:"Buzz",icon:"ðŸŽ­"},{path:"/weather",label:"Weather",icon:"â˜ï¸"},{path:"/settings",label:"Settings",icon:"âš™ï¸"}];return t.jsx("nav",{className:`bottom-nav ${e?"bottom-nav--desktop":""}`,children:s.map(a=>t.jsxs(Es,{to:a.path,className:`bottom-nav__item ${n.pathname===a.path?"active":""}`,title:a.label,children:[t.jsx("span",{className:"bottom-nav__icon",children:a.icon}),t.jsx("span",{className:"bottom-nav__label",children:a.label})]},a.path))})}const Yo=300*1e3;function Jo(){const{pathname:e}=Ln();return x.useEffect(()=>{window.scrollTo(0,0)},[e]),x.useEffect(()=>{let n=null;const s=()=>{document.hidden?n=Date.now():n&&Date.now()-n>Yo&&window.scrollTo(0,0)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[]),null}const Xo=()=>{const{settings:e}=se(),[n,s]=x.useState(!1),[a,i]=x.useState([]),[r,o]=x.useState(0),l=x.useRef(null);return x.useEffect(()=>{const c=console.log,d=console.warn,u=console.error,m=(p,h)=>{const w=Array.from(h).map(v=>{try{return typeof v=="object"?JSON.stringify(v):String(v)}catch{return"[Circular/Object]"}}).join(" ");i(v=>[...v.slice(-99),{type:p,message:w,time:new Date().toLocaleTimeString()}]),n||o(v=>v+1)};console.log=(...p)=>{m("log",p),c.apply(console,p)},console.warn=(...p)=>{m("warn",p),d.apply(console,p)},console.error=(...p)=>{m("error",p),u.apply(console,p)};const g=p=>{m("error",[p.message||"Unknown Global Error"])};return window.addEventListener("error",g),window.addEventListener("unhandledrejection",p=>m("error",["Unhandled Promise:",p.reason])),()=>{console.log=c,console.warn=d,console.error=u,window.removeEventListener("error",g)}},[n]),x.useEffect(()=>{n&&l.current&&(l.current.scrollIntoView({behavior:"smooth"}),o(0))},[a,n]),e.showDebugConsole===!1?null:t.jsxs("div",{style:{position:"fixed",bottom:"80px",right:"20px",zIndex:9999},children:[t.jsxs("button",{onClick:()=>{s(!n),o(0)},style:{width:"48px",height:"48px",borderRadius:"50%",background:r>0?"#ff4757":"rgba(0,0,0,0.8)",color:"white",border:"2px solid rgba(255,255,255,0.2)",fontSize:"24px",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:["ðŸž",r>0&&t.jsx("span",{style:{position:"absolute",top:"-5px",right:"-5px",background:"red",color:"white",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",border:"1px solid white"},children:r})]}),n&&t.jsxs("div",{style:{position:"absolute",bottom:"60px",right:"0",width:"320px",height:"400px",maxHeight:"60vh",background:"rgba(10, 13, 17, 0.95)",backdropFilter:"blur(10px)",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 8px 32px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"10px",background:"rgba(255,255,255,0.05)",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#00D4AA"},children:"Debug Console"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>i([]),style:{background:"none",border:"none",color:"#aaa",cursor:"pointer",fontSize:"0.8rem"},children:"Clear"}),t.jsx("button",{onClick:()=>s(!1),style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},children:"âœ•"})]})]}),t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"10px",fontFamily:"monospace",fontSize:"0.75rem",display:"flex",flexDirection:"column",gap:"4px"},children:[a.map((c,d)=>t.jsxs("div",{style:{color:c.type==="error"?"#ff6b6b":c.type==="warn"?"#feca57":"#1dd1a1",borderBottom:"1px solid rgba(255,255,255,0.05)",paddingBottom:"2px",wordBreak:"break-word"},children:[t.jsxs("span",{style:{opacity:.5,marginRight:"6px"},children:["[",c.time,"]"]}),c.message]},d)),t.jsx("div",{ref:l})]})]})]})},Qo=()=>{const{loading:e}=Ge(),{loading:n}=Ke(),s=e||n,[a,i]=x.useState(0),[r,o]=x.useState(!1);return x.useEffect(()=>{let l;return s?(o(!0),i(10),l=setInterval(()=>{i(c=>{if(c>=90)return c;const d=Math.max(1,(90-c)/10);return c+d})},200)):(i(100),setTimeout(()=>{o(!1),i(0)},400)),()=>clearInterval(l)},[s]),r?t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,height:"3px",zIndex:1e5,pointerEvents:"none"},children:t.jsx("div",{style:{height:"100%",width:`${a}%`,background:"linear-gradient(90deg, #00D4AA, #58A6FF, #F0883E)",boxShadow:"0 0 10px rgba(0, 212, 170, 0.5)",transition:"width 0.2s ease-out",borderRadius:"0 2px 2px 0"}})}):null};function Zo(){return console.log("[App] Rendering root component..."),t.jsx(pi,{children:t.jsx(Wa,{children:t.jsx(Ea,{children:t.jsx(fa,{children:t.jsx(mi,{children:t.jsx(zo,{children:t.jsxs(Ts,{children:[t.jsx(Jo,{}),t.jsx(Qo,{}),t.jsx(Xo,{}),t.jsxs("div",{className:"app",children:[t.jsxs(As,{children:[t.jsx(ue,{path:"/",element:t.jsx(Za,{})}),t.jsx(ue,{path:"/up-ahead",element:t.jsx(Mr,{})}),t.jsx(ue,{path:"/weather",element:t.jsx(Fr,{})}),t.jsx(ue,{path:"/markets",element:t.jsx(zr,{})}),t.jsx(ue,{path:"/tech-social",element:t.jsx(Hr,{})}),t.jsx(ue,{path:"/newspaper",element:t.jsx(Ao,{})}),t.jsx(ue,{path:"/settings",element:t.jsx(Fo,{})}),t.jsx(ue,{path:"/refresh",element:t.jsx(Bo,{})}),t.jsx(ue,{path:"/following",element:t.jsx(Ko,{})}),t.jsx(ue,{path:"/following/:topicId",element:t.jsx(Vo,{})})]}),t.jsx(qo,{})]})]})})})})})})})}class el extends Dn.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){this.setState({error:n,errorInfo:s}),console.error("Uncaught error:",n,s)}render(){return this.state.hasError?t.jsxs("div",{style:{padding:"20px",color:"red",background:"#333",minHeight:"100vh"},children:[t.jsx("h1",{children:"Something went wrong."}),t.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),t.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}function tl(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})})}const nl=[{title:"Millions affected by Chennai floods",description:"Heavy rains in Tamil Nadu capital have caused massive flooding affecting 5 million people.",imageUrl:"https://example.com/floods.jpg",section:"chennai",publishedAt:Date.now()-3600*1e3,source:"The Hindu"},{title:"Hero rescues child from burning building",description:"A brave firefighter in Mumbai saved a child from a tragic fire, creating a moment of hope.",imageUrl:"https://youtube.com/watch?v=abc",section:"india",publishedAt:Date.now()-7200*1e3,source:"NDTV"},{title:"Tech company announces new CEO",description:"Silicon Valley startup announces John Doe as new CEO replacing the founder.",imageUrl:null,section:"technology",publishedAt:Date.now()-300*60*1e3,source:"TechCrunch"}];function sl(){const e=V();console.log(`
=== SCORING TEST (New Scoring: ${e.enableNewScoring}) ===`),nl.forEach(n=>{const s={...n,sentiment:{label:"neutral"},keywords:[]},a=_t(s,n.section);console.log(`
Title: ${n.title}`),console.log(`Section: ${n.section}`),console.log(`Score: ${a.toFixed(2)}`)}),console.log(`
=================================================
`)}console.log("[Main] Application starting...");typeof window<"u"&&(window.runScoringTests=sl);tl();try{const e=document.getElementById("root");if(!e)throw new Error("Root element not found");Ls.createRoot(e).render(t.jsx(x.StrictMode,{children:t.jsx(el,{children:t.jsx(Zo,{})})}))}catch(e){console.error("Critical Application Failure:",e);const n=document.getElementById("root");n&&(n.innerHTML=`
      <div style="color: red; padding: 20px; text-align: center;">
        <h1>Application Failed to Start</h1>
        <p>${e.message}</p>
        <pre>${e.stack}</pre>
      </div>
    `)}
//# sourceMappingURL=index-D58JkjDa.js.map
