{"version":3,"file":"RefreshPage-BRTa7x48.js","sources":["../../src/pages/RefreshPage.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Header from '../components/Header';\nimport Toggle from '../components/Toggle';\nimport { getTimeSinceRefresh, setLastRefresh } from '../utils/storage';\nimport { getCurrentSegment, getRecommendedToggles } from '../utils/timeSegment';\nimport { useWeather } from '../context/WeatherContext';\nimport { useNews } from '../context/NewsContext';\n\n/**\n * Refresh Page Component\n * Allows user to:\n * - Select sections to refresh\n * - See last refresh time\n * - Trigger refresh\n * - View refresh schedule\n */\nfunction RefreshPage() {\n    const navigate = useNavigate();\n    const [refreshToggles, setRefreshToggles] = useState(() => getRecommendedToggles(getCurrentSegment()));\n    const [loading, setLoading] = useState(false);\n    const [lastRefresh, setLastRefreshTime] = useState(() => getTimeSinceRefresh());\n    const [recommended] = useState(() => getRecommendedToggles(getCurrentSegment()));\n\n    const { refreshWeather } = useWeather();\n    const { refreshNews } = useNews();\n\n    const handleRefresh = async () => {\n        setLoading(true);\n\n        const sectionsToRefresh = Object.keys(refreshToggles).filter(k => refreshToggles[k]);\n\n        const promises = [];\n        const newsSections = [];\n\n        sectionsToRefresh.forEach(key => {\n            if (key === 'weather') {\n                promises.push(refreshWeather(true)); // force refresh\n                setLastRefresh('weather');\n            }\n            else if (key === 'market') {\n                // Market data not yet in context, assuming static or handled elsewhere\n                setLastRefresh('market');\n            }\n            else {\n                newsSections.push(key);\n                setLastRefresh(key);\n            }\n        });\n\n        if (newsSections.length > 0) {\n            promises.push(refreshNews(newsSections));\n        }\n\n        try {\n            await Promise.all(promises);\n        } catch (e) {\n            console.error(\"Refresh failed\", e);\n        }\n\n        setLastRefreshTime('Just now');\n        setLoading(false);\n\n        setTimeout(() => navigate('/'), 500);\n    };\n\n    const toggleAll = (value) => {\n        setRefreshToggles({\n            world: value,\n            india: value,\n            chennai: value,\n            trichy: value,\n            local: value,\n            social: value,\n            weather: value,\n            market: value\n        });\n    };\n\n    const sectionConfig = [\n        { key: 'world', icon: 'üåê', label: 'World News', desc: 'International headlines' },\n        { key: 'india', icon: 'üáÆüá≥', label: 'India News', desc: 'National news' },\n        { key: 'chennai', icon: 'üèõÔ∏è', label: 'Chennai News', desc: 'Chennai city updates' },\n        { key: 'trichy', icon: 'üèõÔ∏è', label: 'Trichy News', desc: 'Trichy local news' },\n        { key: 'local', icon: 'üìç', label: 'Local (Muscat)', desc: 'Muscat & Oman news' },\n        { key: 'social', icon: 'üë•', label: 'Social Trends', desc: 'Trending topics' },\n        { key: 'weather', icon: '‚òÅÔ∏è', label: 'Weather', desc: 'Chennai, Trichy, Muscat' },\n        { key: 'market', icon: 'üìà', label: 'Market', desc: 'BSE, NSE, Movers' }\n    ];\n\n    const selectedCount = Object.values(refreshToggles).filter(Boolean).length;\n\n    return (\n        <>\n            <Header title=\"Refresh Content\" showBack backTo=\"/\" />\n\n            <div className=\"refresh-page\">\n                {/* Last Refresh Info */}\n                <div className=\"refresh-info\">\n                    <span>‚è±Ô∏è</span>\n                    <span>Last refresh: <strong>{lastRefresh}</strong></span>\n                </div>\n\n                {/* Quick Actions */}\n                <div style={{\n                    display: 'flex',\n                    gap: 'var(--spacing-sm)',\n                    marginBottom: 'var(--spacing-md)'\n                }}>\n                    <button\n                        className=\"btn btn--secondary\"\n                        style={{ flex: 1 }}\n                        onClick={() => toggleAll(true)}\n                    >\n                        Select All\n                    </button>\n                    <button\n                        className=\"btn btn--secondary\"\n                        style={{ flex: 1 }}\n                        onClick={() => toggleAll(false)}\n                    >\n                        Clear All\n                    </button>\n                </div>\n\n                {/* Section Selection */}\n                <section className=\"settings-section\">\n                    <h2 className=\"settings-section__title\">\n                        <span>üìã</span>\n                        Select Sections to Refresh\n                        <span style={{\n                            marginLeft: 'auto',\n                            fontSize: '0.8rem',\n                            fontWeight: 'normal',\n                            color: 'var(--accent-primary)'\n                        }}>\n                            {selectedCount}/{sectionConfig.length}\n                        </span>\n                    </h2>\n\n                    <div className=\"settings-card\">\n                        {sectionConfig.map(({ key, icon, label, desc }) => (\n                            <div key={key} className=\"settings-item\">\n                                <div className=\"settings-item__label\" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-sm)' }}>\n                                        <span className=\"settings-item__icon\">{icon}</span>\n                                        {label}\n                                        {recommended[key] && (\n                                            <span style={{ color: 'var(--weather-sun)', fontSize: '0.7rem' }}>‚òÖ</span>\n                                        )}\n                                    </div>\n                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginLeft: '28px' }}>\n                                        {desc}\n                                    </div>\n                                </div>\n                                <Toggle\n                                    checked={refreshToggles[key]}\n                                    onChange={(val) => setRefreshToggles(prev => ({ ...prev, [key]: val }))}\n                                    recommended={recommended[key]}\n                                />\n                            </div>\n                        ))}\n                    </div>\n                </section>\n\n                {/* Refresh Button */}\n                <button\n                    className={`refresh-btn ${loading ? 'refresh-btn--loading' : ''}`}\n                    onClick={handleRefresh}\n                    disabled={loading || selectedCount === 0}\n                >\n                    <span className=\"refresh-btn__icon\">{loading ? '‚ü≥' : 'üîÑ'}</span>\n                    <span>{loading ? 'Refreshing...' : 'Refresh Now'}</span>\n                </button>\n\n                {/* Refresh Schedule */}\n                <div className=\"schedule-card\">\n                    <div className=\"schedule-card__title\">\n                        <span>üìä</span>\n                        Auto-Refresh Schedule\n                    </div>\n                    <div className=\"schedule-item\">\n                        <span className=\"schedule-item__label\">Weather Forecast</span>\n                        <span className=\"schedule-item__value\">Every 3 hours</span>\n                    </div>\n                    <div className=\"schedule-item\">\n                        <span className=\"schedule-item__label\">Weather Nowcast</span>\n                        <span className=\"schedule-item__value\">Every 1 hour</span>\n                    </div>\n                    <div className=\"schedule-item\">\n                        <span className=\"schedule-item__label\">News Updates</span>\n                        <span className=\"schedule-item__value\">Every 30 minutes</span>\n                    </div>\n                    <div className=\"schedule-item\">\n                        <span className=\"schedule-item__label\">Market Data</span>\n                        <span className=\"schedule-item__value\">Every 5 minutes</span>\n                    </div>\n                    <div className=\"schedule-item\">\n                        <span className=\"schedule-item__label\">Social Trends</span>\n                        <span className=\"schedule-item__value\">Every 15 minutes</span>\n                    </div>\n                </div>\n\n                {/* Segment Info */}\n                <div className=\"card\" style={{ marginTop: 'var(--spacing-md)', textAlign: 'center' }}>\n                    <div style={{ fontSize: '0.8rem', color: 'var(--text-muted)' }}>\n                        Current Segment: <strong style={{ color: 'var(--accent-primary)' }}>\n                            {getCurrentSegment()?.name}\n                        </strong>\n                    </div>\n                    <div style={{ fontSize: '0.7rem', color: 'var(--text-muted)', marginTop: '4px' }}>\n                        ‚òÖ = Recommended sections for this time\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n}\n\nexport default RefreshPage;\n"],"names":["RefreshPage","navigate","useNavigate","refreshToggles","setRefreshToggles","useState","getRecommendedToggles","getCurrentSegment","loading","setLoading","lastRefresh","setLastRefreshTime","getTimeSinceRefresh","recommended","refreshWeather","useWeather","refreshNews","useNews","handleRefresh","sectionsToRefresh","k","promises","newsSections","key","setLastRefresh","e","toggleAll","value","sectionConfig","selectedCount","jsxs","Fragment","jsx","Header","icon","label","desc","Toggle","val","prev"],"mappings":"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"}