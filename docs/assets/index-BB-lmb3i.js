import{r as ks,a as Cs,b as x,L as Re,g as Es,R as Dn,u as Nt,c as Ts,d as Ln,N as Is,H as As,e as Ms,f as de}from"./vendor-react-hF7JAobB.js";import{r as Rs}from"./utils-sentiment-EAYl0nxh.js";import{G as Ee}from"./vendor-ui-Dm16880k.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();var ht={exports:{}},Fe={};var Rt;function Ds(){if(Rt)return Fe;Rt=1;var e=ks(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var h,u={},g=null,m=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(h in c)a.call(c,h)&&!r.hasOwnProperty(h)&&(u[h]=c[h]);if(l&&l.defaultProps)for(h in c=l.defaultProps,c)u[h]===void 0&&(u[h]=c[h]);return{$$typeof:n,type:l,key:g,ref:m,props:u,_owner:i.current}}return Fe.Fragment=s,Fe.jsx=o,Fe.jsxs=o,Fe}var Dt;function Ls(){return Dt||(Dt=1,ht.exports=Ds()),ht.exports}var t=Ls(),qe={},Lt;function Os(){if(Lt)return qe;Lt=1;var e=Cs();return qe.createRoot=e.createRoot,qe.hydrateRoot=e.hydrateRoot,qe}var Fs=Os();const ve={SETTINGS:"dailyEventAI_settings",LAST_REFRESH:"dailyEventAI_lastRefresh",CACHED_DATA:"dailyEventAI_cachedData",ARTICLE_VIEWS:"dailyEventAI_articleViews"},On="/api",oe={uiMode:"timeline",customSortTopStories:!0,theme:"dark",fontSize:26,freshnessLimitHours:36,hideOlderThanHours:60,weatherFreshnessLimit:4,strictFreshness:!0,filteringMode:"source",rankingMode:"smart",rankingWeights:{temporal:{weekendBoost:2,entertainmentBoost:2.5},geo:{cityMatch:1.5,maxScore:5},freshness:{decayHours:26,maxBoost:3},impact:{boost:1,highImpactBoost:2.5},visual:{videoBoost:1.3,imageBoost:1.15},sentiment:{positiveBoost:.5,negativeBoost:.3},keyword:{matchBoost:2},source:{tier1Boost:.25,tier2Boost:.15,tier3Boost:0},viewedPenalty:.4,trending:{threshold:12},audit:{consensusThreshold:2,anomalySigma:2}},buzzRankingWeights:{visual:{videoBoost:2,imageBoost:1.5},freshness:{decayHours:12,maxBoost:2},trending:{threshold:10}},buzz:{entertainment:{enabled:!0,positiveKeywords:["tamil","kollywood","hindi","bollywood","hollywood","ott","netflix","prime video","disney","hotstar"],positiveMultiplier:2,negativeKeywords:["gossip","rumour","dating","spotted"],negativeMultiplier:2,filterThreshold:0},technology:{enabled:!0,positiveKeywords:["startup","ai","artificial intelligence","innovation","funding","launch","generative ai","llm"],positiveMultiplier:2,negativeKeywords:["rumour","leak","speculation"],negativeMultiplier:2,filterThreshold:0},sports:{enabled:!0,positiveKeywords:["cricket","football","ipl","world cup","india vs","final","highlights"],positiveMultiplier:2,negativeKeywords:["opinion","blog"],negativeMultiplier:2,filterThreshold:0}},weather:{models:{ecmwf:!0,gfs:!0,icon:!0},cities:["chennai","trichy","muscat"],showHumidity:!0,showWind:!1},sections:{world:{enabled:!0,count:5},india:{enabled:!0,count:5},chennai:{enabled:!0,count:5},trichy:{enabled:!0,count:5},local:{enabled:!0,count:5},social:{enabled:!0,count:25},entertainment:{enabled:!0,count:5},business:{enabled:!0,count:5},technology:{enabled:!0,count:5},sports:{enabled:!0,count:5}},newsSources:{bbc:!0,reuters:!0,ndtv:!0,theHindu:!0,toi:!0,financialExpress:!0,dtNext:!0,omanObserver:!0,moneyControl:!0,variety:!0,hollywoodReporter:!0,bollywoodHungama:!0,filmCompanion:!0,indiaToday:!0,timesOfOman:!0},sourceTiers:{tier1:["BBC","Reuters","TechCrunch","The Verge","ESPN"],tier2:["NDTV","The Hindu","Times of India","Moneycontrol","Indian Express"],tier3:["Oman Observer","DT Next","Bollywood Hungama"]},market:{showIndices:!0,showGainers:!0,showLosers:!0,showMutualFunds:!0,showIPO:!0,showSectorals:!0,showCommodities:!0,showCurrency:!0,showFIIDII:!0,cacheMinutes:15},entertainment:{tamilCount:5,hindiCount:5,hollywoodCount:3,ottCount:2},socialTrends:{worldCount:8,indiaCount:8,tamilnaduCount:5,muscatCount:4},customFeeds:[],feedBlockedKeywords:[],highImpactKeywords:["Budget","Election","Summit","Treaty","War","Crash","Landfall","Verdict","Resigns","Assassination"],upAhead:{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},ranking:{movies:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},events:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},festivals:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},sports:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},shopping:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},airlines:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},weather_alerts:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0},civic:{positiveMultiplier:2,negativeMultiplier:2,filterThreshold:0}},locations:["Chennai","Muscat"],customLocation:"",signals:["upcoming","scheduled","starting","launches","opens","begins","commences","from today","this weekend","next week","releasing","premieres","debuts","kicks off","set to","slated for","expected on","effective from","valid till","last date","deadline","registrations open","bookings open","doors open","book now","tickets available","grab your","register","rsvp","sign up","enroll","apply before","limited seats","early bird","pre-order","advance booking","buy tickets","entry free","venue","stadium","auditorium","convention centre","exhibition hall","multiplex","arena","grounds","schedule","timetable","lineup","itinerary","match day","race day","show timings","showtimes","time slot","batch"],keywords:{movies:["release date","releasing","release","in theatres","in theaters","first day","advance booking","fdfs","premiere","preview","sneak peek","special screening","ott release","streaming from","now streaming","available on","direct to ott","digital premiere","tickets","showtimes","book now","bookmyshow","ticketnew","paytm movies","trailer launch","teaser release","motion poster"],events:["concert","live music","standup","comedy show","theatre","theater","drama","stage play","dance recital","sabha","kutcheri","kutchery","exhibition","expo","book fair","trade fair","flea market","art gallery","trade show","workshop","masterclass","bootcamp","seminar","webinar","hackathon","meetup","food festival","pop-up","tasting","brunch","food walk","heritage walk","night market","entry fee","passes available","gate open","limited slots","registration"],sports:[" vs "," v/s ","match","fixture","squad announced","playing xi","toss","innings","schedule","points table","qualifier","semi final","final","playoffs","stadium","live on","broadcast","streaming","start time","kick off","first ball"],festivals:["holiday","bank holiday","gazetted","declared holiday","government holiday","pongal","diwali","deepavali","navratri","dussehra","eid","ramadan","christmas","onam","vishu","ugadi","holi","ganesh","jayanti","puja","pooja","thai pusam","observed on","falls on","celebrated on","auspicious","muhurtham","tithi"],shopping:["sale","mega sale","flash sale","clearance","end of season","flat discount","upto off","cashback","coupon","promo code","shopping festival","exhibition sale","trade fair","grand opening","limited period","ends today","last day","offer valid","while stocks last","hurry"],airlines:["oman air","goindigo","salam air","ticket offer","flight deal","air india","vistara","akasa air","fare sale","booking open"],alerts:["power cut","power shutdown","load shedding","tangedco","tneb","scheduled maintenance","water cut","water supply","disruption","traffic advisory","road closure","diversion","metro shutdown","bus route change","train cancelled","flight delayed","boil water advisory","mosquito fogging","tree trimming","construction zone"],weather_alerts:["warning","alert","advisory","watch","red alert","orange alert","yellow alert","heavy rain","very heavy rain","cyclone","thunderstorm","heat wave","cold wave","fog","flooding","high tide","storm surge","imd","met department","weather bulletin"],civic:["vip movement","vip visit","road block","security arrangement","route change","bandh","hartal","strike","protest march","rasta roko","rail roko","corporation notice","tender","public hearing","ward meeting","grievance day"],movies_negative:["review","reviewed","reviews","opinion","editorial","column","interview","gossip","rumour","rumor","spotted","dating","controversy","trolled","slammed","reacts","reaction","leaked","wardrobe malfunction","breakup","case explained","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","promo shoot","shooting begins","wrapped up","schedule wrap","title reveal","first look","motion poster","cast revealed","plot leaked","producer","director","music director","remuneration","salary","budget","rights sold","satellite rights","audio launch","pre-release event","success meet","press meet","renamed","casts","court","petition","arrested","stealing","sewage","overflow","warns against","talks","deal","financial results","board meeting","did for free","bank holiday alert","check full list","divorce","decommission","released crore","schedules board meeting","fog","mist"],events_negative:["cancelled","postponed","webinar","virtual only","legacy","tribute","obituary"],sports_negative:["rumour","speculation","opinion","prediction","predictions","bracketology","power rankings","fantasy value"],festivals_negative:[],shopping_negative:["expired","sold out"],airlines_negative:["accident","crash","emergency landing","technical snag"],alerts_negative:["rumour","hoax","fake news"],civic_negative:["clinic","surgery","transplant","arrested","held"],negative:["review","reviewed","reviews","opinion","editorial","column","op-ed","analysis","deep dive","explainer","explained","interview","memoir","podcast","recap","retrospective","lookback","throwback","gossip","rumour","rumor","spotted","dating","divorce","controversy","trolled","slammed","reacts","reaction","claps back","feud","leaked","wardrobe malfunction","breakup","arrested","murder","stabbed","robbery","scam","fraud","accused","chargesheet","sentenced","bail","fir filed","kidnap","suicide","death toll","fatal","quarterly results","earnings call","dividend","stock split","ipo allotment","listing gains","shareholding pattern","promoter stake","mutual fund nav","portfolio rebalancing","alleges","slams","hits out","war of words","defamation","no confidence","horse trading","exit poll","poll prediction","meme","was held","concluded","wrapped up","came to an end","successfully completed","inaugurated by","flagged off","took place","was celebrated","passes away","passed away","demise","rip","condolences","last rites","funeral","pays tribute","mourns","obituary","top 10","top 5","best of","worst of","reasons why","things you","ranked","all you need to know","everything we know","box office collection","day 1 collection","total collection","worldwide gross","opening weekend","first week collection","crosses crore","nett collection","shocking","you won't believe","jaw dropping","gone viral","breaks the internet","exclusive","board meeting","financial results","quarterly results","dividend","earnings call","stock split","bonus issue","record date","schedules board meeting","to consider","fund raising","petrol price","price hike","title reveal","first look","renamed","locks release date","casts","producer","court","petition","arrested","stealing","sewage","warns","talks","deal","did for free","bank holiday alert","check full list","decommission","fog","mist","opens office","launches","inaugurated","reveals"]}},sectionOverrides:{},newspaper:{enableImages:!0,headlinesCount:3,leadsCount:6,briefsCount:12},enableNewScoring:!0,enableProximityScoring:!1,maxTopicPercent:40,maxGeoPercent:30,followedTopics:[],readingHistory:[],topicSuggestions:{enabled:!0,basedOnReadingHistory:!0},enableCache:!0,crawlerMode:"auto",debugLogs:!1,lastUpdated:0};function V(){let e=oe.fontSize;typeof window<"u"&&(e=window.innerWidth>=1024?18:26);const n={...oe,fontSize:e};try{const s=localStorage.getItem(ve.SETTINGS);if(s){const a=JSON.parse(s);return Fn(n,a)}}catch(s){console.error("Error reading settings:",s)}return{...n}}function Ue(e){try{const n={...e,lastUpdated:Date.now()};return localStorage.setItem(ve.SETTINGS,JSON.stringify(n)),$s(n),!0}catch(n){return console.error("Error saving settings:",n),!1}}async function $s(e){try{(await fetch(`${On}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok||console.warn("Failed to save settings to API")}catch(n){console.warn("API save error:",n)}}async function Bs(){try{const e=await fetch(`${On}/settings`);return e.ok?await e.json():null}catch(e){return console.warn("API fetch error:",e),null}}function mt(e){try{const n=localStorage.getItem(ve.LAST_REFRESH),s=n?JSON.parse(n):{};s[e]=new Date().toISOString(),localStorage.setItem(ve.LAST_REFRESH,JSON.stringify(s))}catch(n){console.error("Error setting last refresh:",n)}}function Ps(e=null){try{const n=localStorage.getItem(ve.LAST_REFRESH);if(!n)return"Never";const s=JSON.parse(n);let a=null;if(e&&s[e])a=new Date(s[e]);else{const c=Object.values(s).map(d=>new Date(d).getTime());c.length>0&&(a=new Date(Math.max(...c)))}if(!a)return"Never";const r=new Date-a,o=Math.floor(r/6e4),l=Math.floor(r/36e5);return o<1?"Just now":o<60?`${o} min${o>1?"s":""} ago`:l<24?`${l} hour${l>1?"s":""} ago`:a.toLocaleDateString()}catch{return"Unknown"}}function Fn(e,n){const s={...e};for(const a in n){const i=n[a];i!=null&&(typeof i=="object"&&!Array.isArray(i)?s[a]=Fn(e[a]||{},i):s[a]=i)}return s}function zs(e){const n=V();n.followedTopics=n.followedTopics||[],n.followedTopics.push({...e,id:`topic_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,created:new Date().toISOString(),lastFetched:null}),Ue(n)}function Hs(e){const n=V();n.followedTopics=n.followedTopics.filter(s=>s.id!==e),Ue(n)}function Us(e){const n=V(),s=n.followedTopics.find(a=>a.id===e);s&&(s.lastFetched=new Date().toISOString(),Ue(n))}function Ws(e){if(!(!e||e.length===0))try{const n=localStorage.getItem(ve.ARTICLE_VIEWS),s=n?JSON.parse(n):{};e.forEach(a=>{s[a]=(s[a]||0)+1}),localStorage.setItem(ve.ARTICLE_VIEWS,JSON.stringify(s))}catch(n){console.error("[Storage] Error incrementing views",n)}}function $n(e){try{const n=localStorage.getItem(ve.ARTICLE_VIEWS);return(n?JSON.parse(n):{})[e]||0}catch{return 0}}function Gs(e){return V().readingHistory?.some(s=>s.id===e)||!1}function Bn(e){if(!e||!e.title)return;const n=V(),s=n.readingHistory||[];s.some(a=>a.id===e.id)||(s.unshift({id:e.id,title:e.title,description:e.description||"",timestamp:Date.now()}),s.length>50&&(s.length=50),n.readingHistory=s,Ue(n))}function Ks(){const n=V().readingHistory||[];if(n.length===0)return[];const s=n.map(l=>`${l.title} ${l.description}`).join(" ").toLowerCase(),a=["the","and","in","of","to","a","is","for","on","with","at","from","by","an","be","as","it","has","that","are","was","will","says","said","after","over","new","more","about","can","top","best","india","news","update","latest","today","live"],i=s.match(/\b[a-z]{4,}\b/g)||[],r={};return i.forEach(l=>{a.includes(l)||(r[l]=(r[l]||0)+1)}),Object.entries(r).sort((l,c)=>c[1]-l[1]).slice(0,5).map(([l,c])=>({word:l.charAt(0).toUpperCase()+l.slice(1),count:c}))}const $e={nifty50:"^NSEI",sensex:"^BSESN",niftyBank:"^NSEBANK",niftyIT:"^CNXIT",niftyMidcap:"NIFTYMIDCAP150.NS",niftyPharma:"^CNXPHARMA",niftyAuto:"^CNXAUTO"},Vs="https://query1.finance.yahoo.com/v8/finance/chart/",qs=[e=>`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`];async function De(e){const n=`${Vs}${encodeURIComponent(e)}?interval=1d&range=1d`,s=async(a,i={})=>{const r=new AbortController,o=setTimeout(()=>r.abort(),1e4);try{const l=await fetch(a,{...i,signal:r.signal});return clearTimeout(o),l}catch(l){throw clearTimeout(o),l}};for(const a of qs)try{const i=a(n),r=await s(i);if(r.ok)return await r.json()}catch(i){console.warn(`[MarketService] Proxy failed: ${i.message}`)}throw new Error(`Failed to fetch market data for ${e}`)}async function Ys(e,n,s){if(!s)return null;const a=`https://www.alphavantage.co/query?function=${e}&symbol=${n}&apikey=${s}`;try{const r=await(await fetch(a)).json();if(r["Global Quote"])return r["Global Quote"];if(r["Top Gainers, Losers, and Most Active"])return r}catch(i){console.warn("Alpha Vantage fetch failed",i)}return null}function Le(e){const n=e.chart?.result?.[0]||e.finance?.result?.[0];if(!n||!n.meta)return null;const s=n.meta,a=s.regularMarketPrice,i=s.chartPreviousClose||s.previousClose,r=a-i,o=i?r/i*100:0,l=s.regularMarketTime?s.regularMarketTime*1e3:Date.now();return{price:a,change:r,changePercent:o.toFixed(2),timestamp:l}}async function Js(){console.log("[MarketService] Fetching Indian indices...");const e=Object.entries($e).map(async([a,i])=>{try{const r=await De(i),o=Le(r);return o?(console.log(`[MarketService] âœ… ${a}: ${o.price}`),{name:a==="nifty50"?"NIFTY 50":a==="sensex"?"SENSEX":a==="niftyBank"?"BANK NIFTY":a==="niftyIT"?"NIFTY IT":a==="niftyPharma"?"NIFTY PHARMA":a==="niftyAuto"?"NIFTY AUTO":"MIDCAP 150",symbol:i,value:o.price.toLocaleString("en-IN"),change:o.change.toFixed(2),changePercent:o.changePercent,direction:o.change>=0?"up":"down",currency:"â‚¹",timestamp:o.timestamp}):null}catch(r){return console.warn(`[MarketService] âš ï¸ Failed to fetch ${a}:`,r.message),null}}),s=(await Promise.all(e)).filter(a=>a!==null);return s.length===0?(console.warn("[MarketService] Yahoo Indices failed, trying backup..."),await Xs()):s}async function Xs(){const e={"NIFTY 50":"INDEXNSE:NIFTY_50",SENSEX:"INDEXBOM:SENSEX"};try{const n=Object.entries(e).map(async([a,i])=>{const r=`https://www.google.com/finance/quote/${i}`,o=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r)}`,d=(await(await fetch(o)).text()).match(/<div[^>]*class="[^"]*YMlKec[^"]*"[^>]*>([^<]+)<\/div>/);if(d&&d[1]){const h=d[1].replace(/,/g,""),u=parseFloat(h);return{name:a,symbol:i,value:u.toLocaleString("en-IN"),change:"0.00",changePercent:"0.00",direction:"neutral",currency:"â‚¹",timestamp:Date.now(),source:"Google (Backup)"}}return null});return(await Promise.all(n)).filter(a=>a!==null)}catch(n){return console.error("Backup indices fetch failed",n),[]}}const Qs="https://api.mfapi.in/mf/",Zs=[{code:"119551",name:"SBI Bluechip Fund"},{code:"120503",name:"HDFC Mid-Cap Opportunities"},{code:"118834",name:"ICICI Prudential Value Discovery"},{code:"122639",name:"Axis Long Term Equity Fund"},{code:"125354",name:"Mirae Asset Large Cap Fund"},{code:"118989",name:"Kotak Emerging Equity Fund"}];async function ei(){return console.log("[MarketService] Fetching Mutual Fund NAVs..."),(await Promise.allSettled(Zs.map(async s=>{const i=await(await fetch(`${Qs}${s.code}`)).json();if(!i.data||i.data.length===0)throw new Error("No NAV data");const r=parseFloat(i.data[0].nav),o=i.data.length>1?parseFloat(i.data[1].nav):r,l=r-o,c=(l/o*100).toFixed(2);return{code:s.code,name:i.meta?.scheme_name||s.name,category:i.meta?.scheme_category||"Equity",fundHouse:i.meta?.fund_house||"Unknown",nav:r.toFixed(2),navDate:i.data[0].date,change:l.toFixed(2),changePercent:c,direction:l>=0?"up":"down"}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function ti(){console.log("[MarketService] Fetching IPO data from IPOWatch...");const n=`https://api.allorigins.win/get?url=${encodeURIComponent("https://ipowatch.in/upcoming-ipo-calendar-ipo-list/")}`;try{const s=await fetch(n);if(!s.ok)throw new Error("Proxy failed");const i=(await s.json()).contents,l=new DOMParser().parseFromString(i,"text/html").querySelectorAll("table");let c=null;for(const p of l){const w=p.textContent.toLowerCase();if(w.includes("ipo")&&w.includes("price")||w.includes("ipo name")){c=p;break}}if(!c)throw new Error("No IPO table found");const d=Array.from(c.querySelectorAll("tr")),h=[];for(let p=1;p<d.length;p++){const w=d[p].querySelectorAll("td");if(w.length<3)continue;const b=w[0]?.textContent?.trim()||"Unknown";let j="Upcoming",f="TBA";const N=w[1]?.textContent?.trim(),T=w[2]?.textContent?.trim();N&&(j=N),T&&(f=T);let _="upcoming";const D=j.toLowerCase();D.includes("live")||D.includes("open")?_="live":D.includes("close")?_="recent":D.includes("upcoming")&&(_="upcoming");const P=b.includes("SME")||c.textContent.includes("SME");h.push({name:b,openDate:f,closeDate:"",status:_,isSME:P,issueSize:"-"})}const u=h.filter(p=>p.status==="upcoming").slice(0,5),g=h.filter(p=>p.status==="live"),m=h.filter(p=>p.status==="recent").slice(0,5);return{upcoming:u.length?u:h.slice(0,3),live:g,recent:m.length?m:h.slice(3,6),fetchedAt:Date.now()}}catch(s){return console.error("[MarketService] IPO Fetch Failed:",s),{upcoming:[],live:[],recent:[],fetchedAt:Date.now(),error:s.message}}}const ni="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_gainers&count=5",si="https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved/screener/new?scrIds=day_losers&count=5";async function Ot(e){const n=`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`;try{const s=await fetch(n);return s.ok?((await s.json()).finance?.result?.[0]?.quotes||[]).map(r=>({symbol:r.symbol.replace(".NS","").replace(".BO",""),price:r.regularMarketPrice?.toFixed(2)||"0.00",change:r.regularMarketChange?.toFixed(2)||"0.00",changePercent:r.regularMarketChangePercent?.toFixed(2)||"0.00",direction:(r.regularMarketChange||0)>=0?"up":"down",volume:r.regularMarketVolume})).filter(r=>r.symbol):[]}catch(s){return console.warn("[MarketService] Screener fetch failed:",s),[]}}const ii=["RELIANCE.NS","TCS.NS","HDFCBANK.NS","INFY.NS","ICICIBANK.NS","HINDUNILVR.NS","SBIN.NS","BHARTIARTL.NS","ITC.NS","KOTAKBANK.NS","LT.NS","AXISBANK.NS","ASIANPAINT.NS","MARUTI.NS","BAJFINANCE.NS"];async function ai(){console.log("[MarketService] Using fallback for movers...");const e=ii.slice(0,10).map(async i=>{try{const r=await De(i),o=Le(r);return o?{symbol:i.replace(".NS",""),price:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:parseFloat(o.changePercent),direction:o.change>=0?"up":"down"}:null}catch{return null}}),a=(await Promise.all(e)).filter(i=>i!==null).sort((i,r)=>r.changePercent-i.changePercent);return{gainers:a.filter(i=>i.changePercent>0).slice(0,5),losers:a.filter(i=>i.changePercent<0).slice(-5).reverse()}}async function ri(){console.log("[MarketService] Fetching top movers...");const n=V().alphaVantageKey;if(n)try{console.log("[MarketService] Trying Alpha Vantage for Movers...");const s=await Ys("TOP_GAINERS_LOSERS","",n);if(s&&s.top_gainers&&s.top_losers){const a=i=>i.slice(0,5).map(r=>({symbol:r.ticker,price:parseFloat(r.price).toFixed(2),change:parseFloat(r.change_amount).toFixed(2),changePercent:parseFloat(r.change_percentage.replace("%","")).toFixed(2),direction:parseFloat(r.change_amount)>=0?"up":"down"}));return{gainers:a(s.top_gainers),losers:a(s.top_losers)}}}catch(s){console.warn("[MarketService] Alpha Vantage failed:",s)}try{const[s,a]=await Promise.all([Ot(ni),Ot(si)]);if(s.length>0||a.length>0)return console.log("[MarketService] âœ… Used Screener API"),{gainers:s.slice(0,5),losers:a.slice(0,5)}}catch{console.warn("[MarketService] Screener API failed, trying fallback...")}return await ai()}async function oi(){console.log("[MarketService] Fetching sectoral indices...");const e=[{key:"niftyBank",name:"Bank Nifty",symbol:$e.niftyBank},{key:"niftyIT",name:"Nifty IT",symbol:$e.niftyIT},{key:"niftyPharma",name:"Nifty Pharma",symbol:$e.niftyPharma},{key:"niftyAuto",name:"Nifty Auto",symbol:$e.niftyAuto}];return(await Promise.allSettled(e.map(async s=>{const a=await De(s.symbol),i=Le(a);if(!i)throw new Error("No data");return{name:s.name,value:i.price.toFixed(2),change:i.change.toFixed(2),changePercent:i.changePercent,timestamp:i.timestamp}}))).filter(s=>s.status==="fulfilled").map(s=>s.value)}async function li(){console.log("[MarketService] Fetching commodities...");try{const e=await De("INR=X"),n=Le(e),s=n?n.price:84,a=[{name:"Gold",symbol:"GC=F",type:"gold"},{name:"Silver",symbol:"SI=F",type:"silver"},{name:"Crude Oil",symbol:"CL=F",type:"crude"}];return(await Promise.allSettled(a.map(async r=>{let o=null;try{const h=await De(r.symbol);o=Le(h)}catch{console.warn(`[MarketService] Failed to fetch ${r.name} (${r.symbol})`)}if(!o)throw new Error("No data");let l,c,d;return r.type==="gold"?(l=o.price*s/31.1035*10,c=o.change*s/31.1035*10,d="â‚¹/10g"):r.type==="silver"?(l=o.price*s/31.1035*1e3,c=o.change*s/31.1035*1e3,d="â‚¹/kg"):(l=o.price*s,c=o.change*s,d="â‚¹/bbl"),{name:r.name,value:l.toFixed(2),change:c.toFixed(2),changePercent:o.changePercent,unit:d,direction:c>=0?"up":"down",timestamp:o.timestamp}}))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}}async function ci(){console.log("[MarketService] Fetching currency rates...");const e=[{name:"USD/INR",symbol:"INR=X"},{name:"OMR/INR",symbol:"OMRINR=X"}],n=e.map(async i=>{try{const r=await De(i.symbol),o=Le(r);if(!o)throw new Error("No data");return{name:i.name,value:o.price.toFixed(2),change:o.change.toFixed(2),changePercent:o.changePercent,timestamp:o.timestamp,source:"yahoo"}}catch{return null}}),a=(await Promise.all(n)).filter(i=>i!==null);if(a.length===e.length)return a;console.log("[MarketService] âš ï¸ Yahoo Currency failed, using fallback...");try{const r=await(await fetch("https://open.er-api.com/v6/latest/USD")).json();if(!r||!r.rates)throw new Error("Fallback API failed");const o=r.rates.INR,l=r.rates.OMR,c=[];if(c.push({name:"USD/INR",value:o.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"}),l){const d=o/l;c.push({name:"OMR/INR",value:d.toFixed(2),change:"0.00",changePercent:"0.00",timestamp:Date.now(),source:"fallback"})}return c}catch(i){return console.error("[MarketService] âŒ All currency sources failed:",i),a}}async function di(){return{fii:{buy:12500.5,sell:11800.3,net:700.2},dii:{buy:8900.7,sell:9200.4,net:-299.7},date:new Date().toISOString().split("T")[0]}}const Ft="indian_market_data",ui=14400*1e3;async function hi(){try{const e=await fetch("/data/market_snapshot.json");if(e.ok)return await e.json()}catch(e){console.warn("[MarketService] Failed to load static snapshot",e)}return null}async function mi(){console.log("[MarketService] ðŸš€ Fetching all market data...");const[e,n,s,a,i,r,o,l]=await Promise.allSettled([Js(),ei(),ti(),ri(),oi(),li(),ci(),di()]),c={indices:e.status==="fulfilled"?e.value:[],mutualFunds:n.status==="fulfilled"?n.value:[],ipo:s.status==="fulfilled"?s.value:{upcoming:[],live:[],recent:[]},movers:a.status==="fulfilled"?a.value:{gainers:[],losers:[]},sectorals:i.status==="fulfilled"?i.value:[],commodities:r.status==="fulfilled"?r.value:[],currencies:o.status==="fulfilled"?o.value:[],fiidii:l.status==="fulfilled"?l.value:{fii:{},dii:{},date:""},fetchedAt:Date.now(),errors:{indices:e.status==="rejected"?e.reason?.message:null}};if(c.indices.length>0){try{localStorage.setItem(Ft,JSON.stringify(c)),console.log("[MarketService] âœ… Fresh data cached")}catch(h){console.warn("[MarketService] Cache write failed",h)}return c}console.warn("[MarketService] Critical data (Indices) missing. Checking cache...");try{const h=localStorage.getItem(Ft);if(h){const u=JSON.parse(h),g=Date.now()-(u.fetchedAt||0);if(g<ui)return console.log(`[MarketService] âš ï¸ Returning cached data (${(g/6e4).toFixed(0)} mins old)`),{...u,isStale:!0,staleReason:"Network/Proxy Failure - Showing cached data"};console.warn("[MarketService] Cache expired")}}catch(h){console.error("[MarketService] Cache read failed",h)}console.warn("[MarketService] Cache unavailable/expired. Attempting static snapshot...");const d=await hi();return d?(console.log("[MarketService] âœ… Loaded snapshot data"),{...d,isSnapshot:!0,fetchedAt:d.generated_at?new Date(d.generated_at).getTime():Date.now()}):c}const Pn=x.createContext(null),pt="market_cache",pi=900*1e3;function gi({children:e}){const[n,s]=x.useState(null),[a,i]=x.useState(!0),[r,o]=x.useState(null),[l,c]=x.useState(null),d=x.useCallback(async(u=!1)=>{if(!u)try{const g=localStorage.getItem(pt);if(g){const m=JSON.parse(g);if(Date.now()-m.fetchedAt<pi){console.log("[MarketContext] Using cached data"),s(m),i(!1),c(m.fetchedAt);return}}}catch{console.warn("[MarketContext] Cache read failed")}i(!0),o(null);try{const g=await mi();s(g),c(Date.now()),localStorage.setItem(pt,JSON.stringify(g)),console.log("[MarketContext] âœ… Market data loaded")}catch(g){console.error("[MarketContext] âŒ Failed to load market data:",g);try{const m=localStorage.getItem(pt);if(m){const p=JSON.parse(m),w=Date.now()-p.fetchedAt;console.log(`[MarketContext] Using stale cache due to fetch error (Age: ${(w/6e4).toFixed(0)}m)`),s(p),c(p.fetchedAt),w>14400*1e3?o("Network error. Data is expired (>4h)."):o("Network error. Showing cached data.")}else{try{const p=await fetch("/data/market_snapshot.json");if(p.ok){const w=await p.json();if(w&&w.indices&&w.indices.length>0){console.log("[MarketContext] Using static snapshot fallback"),s(w),c(new Date(w.generated_at).getTime()),o("Using offline snapshot (Live data failed)");return}}}catch(p){console.warn("Static fallback failed",p)}o(g.message)}}catch{o(g.message)}}finally{i(!1)}},[]);x.useEffect(()=>{d()},[d]);const h=x.useCallback(()=>d(!0),[d]);return t.jsx(Pn.Provider,{value:{marketData:n,loading:a,error:r,lastFetch:l,refreshMarket:h},children:e})}function zn(){const e=x.useContext(Pn);if(!e)throw new Error("useMarket must be used within MarketProvider");return e}const Hn=({loadingPhase:e})=>{const{marketData:n,loading:s,lastFetch:a}=zn(),i=x.useRef(null),r=x.useRef(!1),o=x.useMemo(()=>{if(!n)return[];const{indices:u=[],commodities:g=[]}=n,m=[...u,...g];return["NIFTY 50","NSE 50","50","SENSEX","BSE SENSEX","Gold","Silver"].map(w=>m.find(b=>b.name===w)).filter(Boolean)},[n]);x.useEffect(()=>{let u,g=0;const m=40;let p=0;const w=j=>{g||(g=j);const f=j-g;if(g=j,i.current&&!r.current){const N=m*f/1e3;if(p+=N,p>=1){const T=Math.floor(p);p-=T;const{scrollLeft:_,scrollWidth:D}=i.current;_>=D/2?i.current.scrollLeft=0:i.current.scrollLeft+=T}}else g=j;u=requestAnimationFrame(w)},b=setTimeout(()=>{u=requestAnimationFrame(w)},1e3);return()=>{cancelAnimationFrame(u),clearTimeout(b)}},[o]);const l=u=>{if(!u.timestamp)return!0;const m=Date.now()-u.timestamp,w=["Gold","Silver","Crude Oil"].includes(u.name)?3600*1e3:900*1e3;return m>w},c=u=>u?new Date(u).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",d=u=>u==="NSE 50"||u==="50"?"NIFTY 50":u==="BSE SENSEX"?"SENSEX":u,h=()=>{if(!e)return{};let u="transparent";return e===1?u="rgba(144, 238, 144, 0.2)":e===2?u="rgba(60, 179, 113, 0.2)":e===3&&(u="rgba(34, 139, 34, 0.2)"),{background:`linear-gradient(to bottom, transparent, ${u})`,transition:"background 0.5s ease"}};return s&&o.length===0||o.length===0?null:t.jsxs("div",{className:"market-ticker-container",style:h(),children:[t.jsx("div",{className:"ticker-label",children:"ðŸ“ˆ"}),t.jsx("div",{className:"ticker-track-wrapper",ref:i,onMouseEnter:()=>r.current=!0,onMouseLeave:()=>r.current=!1,onTouchStart:()=>r.current=!0,onTouchEnd:()=>r.current=!1,children:t.jsx("div",{className:"ticker-track",children:[...o,...o].map((u,g)=>{const m=l(u);return t.jsxs("div",{className:`ticker-item ${m?"stale-data":""}`,children:[t.jsx("span",{className:"ticker-name",children:d(u.name)}),t.jsxs("span",{className:"ticker-price",children:[u.name==="Gold"||u.name==="Silver"?u.value:typeof u.value=="number"?u.value.toFixed(2):u.value,u.unit?t.jsx("span",{style:{fontSize:"0.7em",marginLeft:"2px"},children:u.unit}):""]}),t.jsxs("span",{className:`ticker-change ${parseFloat(u.change)>=0?"positive":"negative"}`,children:[parseFloat(u.change)>=0?"â–²":"â–¼"," ",Math.abs(parseFloat(u.changePercent)).toFixed(2),"%"]})]},`${u.name}-${g}`)})})}),a&&t.jsxs("div",{className:"ticker-updated",children:[t.jsx("span",{style:{marginRight:"4px"},children:"ðŸ•’"})," ",c(a)]})]})},Un=x.createContext();function fi({children:e}){const[n,s]=x.useState(()=>V()),[a,i]=x.useState(0),r=x.useCallback(l=>{Ue(l),s(l),i(c=>c+1)},[]),o=x.useCallback(()=>{const l=V();s(l),i(c=>c+1)},[]);return x.useEffect(()=>{(async()=>{try{const c=await Bs();if(c){const d=V(),h=c.lastUpdated||0,u=d.lastUpdated||0;if(h>u)console.log("[Settings] Syncing from server (Remote is newer)..."),localStorage.setItem("dailyEventAI_settings",JSON.stringify(c)),o();else if(!d.upAhead?.keywords?.shopping){console.log("[Settings] Patching missing keywords from remote...");const g={...c,...d,upAhead:{...c.upAhead,...d.upAhead}};g.upAhead.keywords||(g.upAhead.keywords=c.upAhead.keywords),localStorage.setItem("dailyEventAI_settings",JSON.stringify(g)),o()}}}catch(c){console.warn("[Settings] Failed to sync with server",c)}})()},[o]),x.useEffect(()=>{const l=c=>{c.key==="dailyEventAI_settings"&&(console.log("[SettingsContext] Storage changed in another tab, reloading"),o())};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[o]),x.useEffect(()=>{n.fontSize&&(document.documentElement.style.fontSize=n.fontSize+"px")},[n.fontSize]),x.useEffect(()=>{document.documentElement.setAttribute("data-theme",n.theme||"dark")},[n.theme]),t.jsx(Un.Provider,{value:{settings:n,updateSettings:r,reloadSettings:o,settingsVersion:a},children:e})}function se(){const e=x.useContext(Un);if(!e)throw new Error("useSettings must be used within SettingsProvider");return e}const yi=()=>{const{settings:e,updateSettings:n}=se(),s=e.theme==="light",a=()=>{n({...e,theme:s?"dark":"light"})};return t.jsx("button",{onClick:a,className:"header__action-btn",title:s?"Switch to Dark Mode":"Switch to Light Mode",style:{background:"transparent",border:"none",cursor:"pointer",padding:"0 8px",color:"var(--text-primary)"},children:s?"ðŸŒ™":"â˜€ï¸"})};function _e({title:e,icon:n,showBack:s=!1,backTo:a="/",actions:i,pills:r,activePill:o,onPillChange:l,compact:c=!1,loadingPhase:d}){const[h,u]=x.useState(window.innerWidth>=1024);x.useEffect(()=>{const m=()=>u(window.innerWidth>=1024);return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]);const g=m=>m.includes("Morning")?"ðŸŒ…":m.includes("Midday")?"â˜€ï¸":m.includes("Evening")?"ðŸŒ™":m;return t.jsxs("header",{className:`header ${c?"header--compact":""}`,children:[s?t.jsxs(Re,{to:a,className:"header__back",children:[t.jsx("span",{children:"â†"}),t.jsx("span",{children:e})]}):t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[h&&t.jsx(yi,{}),t.jsx("h1",{className:"header__title"})]}),!s&&t.jsx(Hn,{loadingPhase:d}),r&&t.jsx("div",{className:"header__pills",children:r.map(m=>t.jsx("button",{className:`time-pill time-pill--matte ${o===m?"time-pill--active":""}`,onClick:()=>l&&l(m),title:m,children:g(m)},m))}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:i})]})}const Oe={bbc:{name:"BBC",credibility:2,staffSize:5500,bureaus:50,avgArticleLength:800,updateFrequency:"continuous",weight:1.8,categories:["world","business","technology","entertainment"]},reuters:{name:"Reuters",credibility:1.95,staffSize:2500,bureaus:200,avgArticleLength:600,updateFrequency:"continuous",weight:1.8,categories:["world","business"]},apnews:{name:"AP News",credibility:1.9,staffSize:2500,bureaus:250,avgArticleLength:500,updateFrequency:"continuous",weight:1.75,categories:["world","business","sports"]},aljazeera:{name:"Al Jazeera",credibility:1.7,staffSize:2e3,bureaus:60,avgArticleLength:900,updateFrequency:"hourly",weight:1.6,categories:["world","business"]},cnn:{name:"CNN",credibility:1.6,staffSize:3e3,bureaus:40,avgArticleLength:400,updateFrequency:"continuous",weight:1.5,categories:["world","business","technology"]},ndtv:{name:"NDTV",credibility:1.75,staffSize:1200,bureaus:15,avgArticleLength:600,updateFrequency:"continuous",weight:1.6,categories:["india","business","technology"]},thehindu:{name:"The Hindu",credibility:1.8,staffSize:800,bureaus:12,avgArticleLength:800,updateFrequency:"hourly",weight:1.65,categories:["india","world","business","technology"]},toi:{name:"Times of India",credibility:1.6,staffSize:1500,bureaus:25,avgArticleLength:500,updateFrequency:"continuous",weight:1.5,categories:["india","entertainment","sports"]},financialexpress:{name:"Financial Express",credibility:1.65,staffSize:300,bureaus:5,avgArticleLength:700,updateFrequency:"hourly",weight:1.55,categories:["business","technology"]},indianexpress:{name:"Indian Express",credibility:1.7,staffSize:400,bureaus:8,avgArticleLength:750,updateFrequency:"hourly",weight:1.6,categories:["india","world","business"]},techcrunch:{name:"TechCrunch",credibility:1.7,staffSize:200,bureaus:3,avgArticleLength:600,updateFrequency:"hourly",weight:1.6,categories:["technology"],specialization:"startups, VC"},theverge:{name:"The Verge",credibility:1.65,staffSize:100,bureaus:1,avgArticleLength:900,updateFrequency:"hourly",weight:1.55,categories:["technology"],specialization:"gadgets, consumer tech"},espn:{name:"ESPN",credibility:1.7,staffSize:500,bureaus:10,avgArticleLength:500,updateFrequency:"continuous",weight:1.6,categories:["sports"]},bollywoodhungama:{name:"Bollywood Hungama",credibility:1.4,staffSize:100,bureaus:2,avgArticleLength:400,updateFrequency:"hourly",weight:1.3,categories:["entertainment"],specialization:"Indian cinema"},googlenews:{name:"Google News",credibility:1.5,staffSize:0,bureaus:0,avgArticleLength:0,updateFrequency:"continuous",weight:1,categories:["world","india","business","technology","entertainment","sports"]},default:{name:"Default Source",credibility:1,staffSize:50,bureaus:1,avgArticleLength:400,updateFrequency:"daily",weight:.9,categories:[]}},xi=e=>{const n=Object.keys(Oe).find(c=>e.toLowerCase().replace(/\s+/g,"").includes(c))||"default",s=Oe[n],a=s.credibility/2*.4,r=Math.min(s.staffSize/5500,1)*.3,l=Math.min(s.bureaus/250,1)*.3;return a+r+l},wi=(e,n)=>{const s=Object.keys(Oe).find(i=>e.toLowerCase().replace(/\s+/g,"").includes(i))||"default",a=Oe[s];return!a.categories||a.categories.includes(n)?a.weight:a.weight*.7},$t="https://news.google.com/rss",vi="https://news.google.com/rss/search",Bt={WORLD:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx1YlY4U0JXVnVMVlZUR2dKVlV5Z0FQAQ",BUSINESS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGx6TVdZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",TECHNOLOGY:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRGRqTVhZU0JXVnVMVlZUR2dKVlV5Z0FQAQ",ENTERTAINMENT:"CAAqJggKIiBDQkFTRWvfSkwyMHZNREpxYW5RU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SPORTS:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp1ZEdvU0JXVnVMVlZUR2dKVlV5Z0FQAQ",SCIENCE:"CAAqJggKIiBDQkFTRWvfSkwyMHZNRFp0Y1RjU0JXVnVMVlZUR2dKVlV5Z0FQAQ",HEALTH:"CAAqJggKIiBDQkFTRWvfSkwyMHZNR3QwTlRFU0JXVnVMVlZUR2dKVlV5Z0FQAQ"};function ye({category:e,query:n,country:s="IN",lang:a="en"}){const i=`${a}-${s}`,r=s,o=`${s}:${a}`,l=`hl=${i}&gl=${r}&ceid=${o}`;if(n)return`${vi}?q=${encodeURIComponent(n)}&${l}`;if(e){const c=e.toUpperCase();if(Bt[c])return`${$t}/topics/${Bt[c]}?${l}`}return`${$t}?${l}`}const Ie={WORLD_IN:ye({category:"world",country:"IN",lang:"en"}),BUSINESS_IN:ye({category:"business",country:"IN",lang:"en"}),BUSINESS_IN_SEARCH:ye({query:"Business Economy India",country:"IN",lang:"en"}),TECH_IN:ye({category:"technology",country:"IN",lang:"en"}),TECH_IN_SEARCH:ye({query:"Technology Startups India",country:"IN",lang:"en"}),TAMIL_NADU:ye({query:"Tamil Nadu",country:"IN",lang:"ta"}),CHENNAI:ye({query:"Chennai",country:"IN",lang:"en"}),WORLD_US:ye({category:"world",country:"US",lang:"en"})},st={tamil:["https://www.thenewsminute.com/tamil-nadu/entertainment/feed","https://www.behindwoods.com/tamil-movies/rss-feeds/news.xml","https://timesofindia.indiatimes.com/rssfeeds/1081479906.cms","https://www.filmibeat.com/rss/filmibeat-tamil-fb.xml"],hindi:["https://www.bollywoodhungama.com/rss/news.xml","https://www.filmfare.com/feeds/bollywood.xml","https://timesofindia.indiatimes.com/rssfeeds/-2128936835.cms"],hollywood:["https://www.hollywoodreporter.com/feed/","https://variety.com/feed/","https://deadline.com/feed/"],ott:["https://www.whats-on-netflix.com/feed/","https://www.cordcuttersnews.com/feed/","https://www.streamingmedia.com/RSS/Articles.aspx"]};function bi(e){const n=["horoscope","rasipalan","zodiac","astrology","prediction","numerology"];return e.filter(s=>{const a=(s.title+" "+s.description).toLowerCase();return!n.some(i=>a.includes(i))})}async function Si(){console.log("[EntertainmentService] Fetching Tamil/Kollywood news...");const e=[];for(const s of st.tamil)try{const a=await be(s,"entertainment");e.push(...a.map(i=>({...i,category:"Tamil Cinema",region:"tamil"})))}catch(a){console.warn(`[EntertainmentService] Failed to fetch ${s}:`,a.message)}return bi(e).sort((s,a)=>(a.publishedAt||0)-(s.publishedAt||0)).slice(0,20)}async function ji(){console.log("[EntertainmentService] Fetching Hindi/Bollywood news...");const e=[];for(const n of st.hindi)try{const s=await be(n,"entertainment");e.push(...s.map(a=>({...a,category:"Hindi Cinema",region:"hindi"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function Ni(){console.log("[EntertainmentService] Fetching Hollywood news...");const e=[];for(const n of st.hollywood)try{const s=await be(n,"entertainment");e.push(...s.map(a=>({...a,category:"Hollywood",region:"hollywood"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function _i(){console.log("[EntertainmentService] Fetching OTT/Streaming news...");const e=[];for(const n of st.ott)try{const s=await be(n,"entertainment");e.push(...s.map(a=>({...a,category:"OTT & Streaming",region:"ott"})))}catch(s){console.warn(`[EntertainmentService] Failed to fetch ${n}:`,s.message)}return e.sort((n,s)=>(s.publishedAt||0)-(n.publishedAt||0)).slice(0,20)}async function ki(e={}){console.log("[EntertainmentService] ðŸŽ¬ Fetching all entertainment news...");const{tamilPercent:n=40,hindiPercent:s=35,hollywoodPercent:a=15,ottPercent:i=10}=e,[r,o,l,c]=await Promise.allSettled([Si(),ji(),Ni(),_i()]),d=r.status==="fulfilled"?r.value:[],h=o.status==="fulfilled"?o.value:[],u=l.status==="fulfilled"?l.value:[],g=c.status==="fulfilled"?c.value:[],m=40,p={tamil:Math.round(m*(n/100)),hindi:Math.round(m*(s/100)),hollywood:Math.round(m*(a/100)),ott:Math.round(m*(i/100))},b=[...d.slice(0,p.tamil),...h.slice(0,p.hindi),...u.slice(0,p.hollywood),...g.slice(0,p.ott)].sort(()=>Math.random()-.5);return console.log("[EntertainmentService] âœ… Entertainment news fetched:",{tamil:p.tamil,hindi:p.hindi,hollywood:p.hollywood,ott:p.ott,total:b.length}),b}const Pt={abandon:-2,accident:-2,alert:-1,ambitious:2,asset:2,active:1,advance:2,agree:1,amazing:4,approve:2,award:3,awesome:4,bad:-3,bailout:-2,beautiful:3,benefit:2,best:3,boost:1,breakthrough:3,bright:1,bull:2,bullish:2,buy:1,calm:2,cancel:-1,care:2,celebrate:3,challenge:-1,champion:2,cheap:-1,clean:2,collapse:-2,climb:1,comfort:2,commit:1,confidence:2,conflict:-2,congrats:2,congratulate:2,cool:1,correct:1,crash:-2,crisis:-3,criticize:-2,danger:-2,dead:-3,debt:-2,decline:-1,defeat:-2,deficit:-2,denied:-2,depression:-2,destroy:-3,devastate:-3,difficult:-1,disaster:-2,disease:-1,dispute:-2,doubt:-1,down:-1,drop:-1,dump:-1,earn:1,earnings:1,ease:2,easy:1,effective:2,efficient:2,emergency:-2,encourage:2,enjoy:2,error:-2,excellent:3,cite:2,expand:1,fail:-2,failure:-2,fake:-3,fall:-1,fantastic:4,fear:-2,fight:-1,fine:2,fraud:-4,free:1,fresh:1,fun:4,gain:2,good:3,great:3,growth:2,happy:3,hard:-1,harm:-2,hate:-3,healthy:2,help:2,hero:2,high:1,hope:2,hurt:-2,ignore:-1,ill:-2,improve:2,increase:1,infect:-2,inflation:-2,injury:-2,innovate:1,innovative:2,inspire:2,intelligent:2,invest:1,joke:2,joy:3,jump:1,kill:-3,lack:-2,lag:-1,lead:1,leader:1,legal:1,lie:-2,like:2,loss:-3,love:3,low:-1,luck:3,lucky:3,market:1,merger:2,miss:-1,mistake:-2,murder:-3,negative:-2,nice:3,outperform:2,outstanding:5,panic:-3,perfect:3,plunge:-2,poor:-2,positive:2,praise:3,problem:-2,profit:2,progress:2,promise:1,proud:2,protect:1,rally:2,recession:-2,record:2,recover:1,reject:-1,reliable:2,relief:1,rescue:2,resolve:2,restore:1,reward:2,rich:2,risk:-2,safe:1,save:2,scandal:-3,scare:-2,secure:2,sell:-1,shares:1,shortage:-2,sick:-2,significant:1,smart:1,smile:2,solid:2,solve:1,spark:1,stable:2,stock:1,stop:-1,strength:2,strong:2,success:2,suffer:-2,surge:1,surprise:2,sweet:2,tech:1,terrible:-3,terrified:-3,threat:-2,top:2,tough:-1,tragedy:-2,trouble:-2,trust:1,ugly:-3,uncertain:-1,unemployment:-2,unfair:-2,up:1,upset:-2,urgent:-1,useful:2,value:1,victory:3,violation:-2,violence:-3,volatile:-1,vulnerable:-2,weak:-2,wealth:3,win:4,winner:4,wonderful:4,worry:-3,worst:-3,wow:4,wrong:-2,yes:1},Ci=e=>e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>0),zt=e=>{if(!e||e.trim().length===0)return{score:0,comparative:0,label:"neutral"};const n=Ci(e);let s=0;n.forEach(r=>{Pt[r]&&(s+=Pt[r])});const a=n.length>0?s/n.length:0;let i="neutral";return a>.05?i="positive":a<-.05&&(i="negative"),{score:s,comparative:a,label:i}},Ei=(e,n)=>{const s=zt(e),a=zt(n),i=s.comparative*.6+a.comparative*.4;let r="neutral";return i>.05?r="positive":i<-.05&&(r="negative"),{label:r,comparative:i,titleSentiment:s,descriptionSentiment:a}};var Ti=Rs();const Ii=Es(Ti),Ai=(e,n=.75)=>{if(!e||e.length===0)return[];const s=[],a=new Set;for(let i=0;i<e.length;i++){if(a.has(i))continue;const r=[e[i]];a.add(i);for(let o=i+1;o<e.length;o++){if(a.has(o))continue;Ii.compareTwoStrings(e[i].title.toLowerCase(),e[o].title.toLowerCase())>n&&(r.push(e[o]),a.add(o))}s.push(r)}return s},Mi=e=>{if(!e||e.length===0)return null;const s=[...e].sort((o,l)=>l.impactScore-o.impactScore)[0],a=[...new Set(e.map(o=>o.source))],i=a.length,r=1+(i-1)*.1;return{...s,sourceCount:i,allSources:a,clusteredItems:e.length,impactScore:s.impactScore*r,clusterRepresentative:!0}},Ri=(e,n=.75)=>{const s=new Set,a=[];for(const o of e)!o.id||s.has(o.id)||(s.add(o.id),a.push(o));return Ai(a,n).map(Mi).filter(o=>o!==null)};function Di(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}class Li{constructor(){this.newsMap=new Map,this.breaking=new Set}checkBreakingNews(n,s=Date.now()){if(!n||!n.title||!n.publishedAt)return{isBreaking:!1,breakingScore:0,multiplier:1};const a=Di(n.title),i=(s-n.publishedAt)/1e3/60;let r=!1,o=0;for(const[l,c]of this.newsMap.entries())if(this.calculateSimilarity(a,l)>.7){(s-c.firstSeen)/1e3/60<60&&!c.sources.has(n.source)&&(c.sources.add(n.source),c.count++),c.count>=2&&i<60&&(r=!0,o=Math.log(60/Math.max(1,i))||1,o=Math.min(o,3),this.breaking.add(a));break}return this.newsMap.has(a)||this.newsMap.set(a,{firstSeen:n.publishedAt,sources:new Set([n.source]),count:1,title:n.title}),{isBreaking:r,breakingScore:o,multiplier:r?o:1}}calculateSimilarity(n,s){const a=new Set(n.split(/\s+/)),i=new Set(s.split(/\s+/)),r=[...a].filter(l=>i.has(l)).length,o=new Set([...a,...i]).size;return r/Math.max(o,1)}cleanup(n=120){const s=Date.now(),a=[];for(const[i,r]of this.newsMap.entries())(s-r.firstSeen)/1e3/60>n&&a.push(i);return a.forEach(i=>{this.newsMap.delete(i),this.breaking.delete(i)}),a.length}getBreakingStories(){const n=[];for(const[s,a]of this.newsMap.entries())a.count>=2&&n.push({title:a.title,sourceCount:a.count,sources:[...a.sources],firstSeen:a.firstSeen});return n}}const Oi=new Li;function Fi(e,n,s){const a=`${e} ${n}`.toLowerCase();let i=1;/\b(world|international|global|planet|earth|un|united nations)\b/.test(a)?i=1.5:/\b(india|country|nation|nationwide|federal|central govt|modi|parliament)\b/.test(a)?i=1.3:/\b(state|tamil nadu|kerala|karnataka|region|district)\b/.test(a)&&(i=1.1);let r=1;/\b(billions?|trillions?)\b/.test(a)?r=1.5:/\b(millions?|lakhs?|crores?)\b/.test(a)?r=1.3:/\b(thousands?|hundreds of thousands?)\b/.test(a)&&(r=1.1);let o=1;return s&&s.highImpactKeywords&&Array.isArray(s.highImpactKeywords)&&s.highImpactKeywords.some(c=>c?new RegExp(`\\b${c.toLowerCase()}\\b`,"i").test(a):!1)&&(o=s.rankingWeights?.impact?.highImpactBoost||2.5),i*r*o}const $i={chennai:{lat:13.0827,lon:80.2707,boost:2},trichy:{lat:10.7905,lon:78.7047,boost:1.8},"tamil nadu":{lat:11.1271,lon:78.6569,boost:1.6},muscat:{lat:23.588,lon:58.3829,boost:1.5},india:{lat:20.5937,lon:78.9629,boost:1.3}};function Bi(e,n){const s=V();if(s.enableProximityScoring===!1)return 1;const a=`${e} ${n}`.toLowerCase();let i=1;const r=s.rankingWeights?.geo?.cityMatch||1.5,o=s.rankingWeights?.geo?.maxScore||5;for(const[l,c]of Object.entries($i))a.includes(l.toLowerCase())&&c.boost>i&&(i=c.boost);if(s.weather?.cities)for(const l of s.weather.cities)a.includes(l.toLowerCase())&&r>i&&(i=r);return Math.min(i,o)}const Ht=new Map;function Pi(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>3)}function zi(e,n,s){const a=`${e} ${n}`,i=Pi(a);if(i.length===0)return 1;let r=0;i.forEach(c=>{const d=Ht.get(c)||{count:0};d.count<2&&r++,Ht.set(c,{count:d.count+1,lastSeen:Date.now()})});const o=r/i.length;return 1+Math.min(o*.5,.5)}function Hi(e,n=[]){const a=V().followedTopics||[];if(a.length===0)return 1;const i=e.toLowerCase();return a.some(o=>{const l=typeof o=="string"?o:o.name;if(!l)return!1;const c=l.toLowerCase();return i.includes(c)||n&&n.some(d=>d.toLowerCase().includes(c))})?1.5:1}const Ui=["hero","rescue","miracle","triumph","tragedy","survival","family","child","mother","father","couple","wedding","journey","struggle","overcome","inspire","brave","courage","heartbreak","reunion","loss","hope","dream","volunteer","charity","donation","help","saved","lifeline","community","spirit","kindness"];function Wi(e,n){const s=`${e} ${n}`.toLowerCase();let a=0;Ui.forEach(r=>{s.includes(r.toLowerCase())&&a++});const i=1+a*.2;return Math.min(i,2)}function Gi(e,n=null){if(!e)return 1;const s=n?.rankingWeights?.visual?.videoBoost||1.3,a=n?.rankingWeights?.visual?.imageBoost||1.15;return/youtube|vimeo|video|youtu\.be/i.test(e)?s:/\.(jpg|jpeg|png|gif|webp|svg)/i.test(e)||/images|img|photo|static/i.test(e)?a:Math.min(a,1.1)}const Ut={world:["UN","NATO","United Nations","international","embassy","foreign","global","war","peace talks","summit","G7","G20","EU","European Union","Middle East","Ukraine","Russia","Gaza","Israel","Palestine","Hamas","Hezbollah","Iran","China","USA","UK","Biden","Trump","Putin","Zelenskyy","Netanyahu","diplomacy","geopolitical","sanctions","treaty","United States","Britain","France","Germany","Australia","Canada","Japan","South Korea","North Korea"],india:["Delhi","New Delhi","Modi","BJP","Congress","Parliament","Supreme Court","India","Indian","Lok Sabha","Rajya Sabha","PM","President","RBI","central government","nationwide","union minister","Amit Shah","Rahul Gandhi","AAP","Kejriwal","Mamata Banerjee","Trinamool","CPM","Elections","ECI","Election Commission","CBI","ED","Enforcement Directorate","UPSC","NEET","census","aadhaar","pan card","railways","vande bharat","isro","chandrayaan","aditya-l1","gaganyaan","defence","army","navy","air force"],chennai:["Chennai","Madras","Marina Beach","TN Assembly","MTC","CMDA","Anna University","Kauvery Hospital","Apollo Chennai","Tambaram","Egmore","T Nagar","Adyar","Velachery","Guindy","Mylapore","Triplicane","Chromepet","Pallavaram","OMR","ECR","Old Mahabalipuram Road","East Coast Road","Koyambedu","Anna Nagar","Besant Nagar","Thiruvanmiyur","IIT Madras","Loyola College","Presidency College","Ripon Building","Greater Chennai Corporation","GCC","Chennai Metro","CMRL","Central Station","Egmore Station","Meenambakkam","Chennai Airport","Nungambakkam","Kodambakkam"],trichy:["Trichy","Tiruchirappalli","Srirangam","BHEL Trichy","NIT Trichy","Rock Fort","Kaveri","Cauvery","Thanjavur","Delta districts","Samayapuram","Manapparai","Thiruverumbur","Lalgudi","Musiri","Thuraiyur","Pudukkottai","Karur","Perambalur","Ariyalur","Kallanai","Mukkombu","Butterfly Park","Tiruchirapalli"],business:["stock","market","economy","GDP","inflation","RBI","Sensex","Nifty","shares","BSE","NSE","earnings","revenue","profit","loss","IPO","merger","acquisition","startup","funding","investment","corporate","CEO","CFO","bank","finance","fiscal","monetary","repo rate","tax","GST","income tax","customs","export","import","trade","rupee","dollar","gold","silver","oil","crude","brent","crypto","bitcoin","ethereum","blockchain","mutual fund","SIP","dividend","quarterly results","Adani","Ambani","Tata","Reliance","Infosys","TCS","Wipro","HDFC","ICICI","SBI"],technology:["AI","tech","technology","Google","Apple","Microsoft","software","hardware","cyber","crypto","blockchain","iPhone","Android","app","cloud","data","algorithm","machine learning","artificial intelligence","ChatGPT","OpenAI","Gemini","LLM","neural network","robotics","automation","5G","6G","telecom","semiconductor","chip","processor","Intel","AMD","Nvidia","Samsung","OnePlus","Xiaomi","cybersecurity","hacker","malware","ransomware","virus","SpaceX","NASA","satellite","rocket","drone","electric vehicle","EV","Tesla","Elon Musk","Mark Zuckerberg","Sundar Pichai","Satya Nadella","Tim Cook"],entertainment:["film","movie","actor","actress","director","box office","OTT","Netflix","Amazon Prime","Disney+","cinema","theatre","Kollywood","Bollywood","Hollywood","music","album","concert","award","Oscar","Emmy","Grammy","celebrity","release","trailer","teaser","review","blockbuster","star","superstar","hero","heroine","villain","script","screenplay","cinematography","Rajinikanth","Kamal Haasan","Vijay","Ajith","Suriya","Dhanush","Vikram","Nayanthara","Trisha","Anirudh","AR Rahman","Shah Rukh Khan","Salman Khan","Aamir Khan","Deepika Padukone","Alia Bhatt","Ranbir Kapoor","Karan Johar","Tollywood","Mollywood"],sports:["cricket","football","IPL","Olympics","match","championship","FIFA","World Cup","player","coach","team","goal","wicket","run","tennis","badminton","hockey","trophy","medal","CSK","MI","RCB","stadium","tournament","league","series","test match","ODI","T20","century","half-century","hat-trick","penalty","corner","free kick","grand slam","Wimbledon","US Open","French Open","Australian Open","F1","Formula 1","racing","driver","athlete","gold medal","silver medal","bronze medal","BCCI","ICC","Virat Kohli","Rohit Sharma","Dhoni","MS Dhoni","Messi","Ronaldo","Neymar","Mbappe"]},Wn={"Narendra Modi":"india","Rahul Gandhi":"india","Amit Shah":"india","Arvind Kejriwal":"india","Mamata Banerjee":"india","Droupadi Murmu":"india","Jagdeep Dhankhar":"india","Nirmala Sitharaman":"india","S. Jaishankar":"india","Rajnath Singh":"india","Nitin Gadkari":"india","Mallikarjun Kharge":"india","MK Stalin":"chennai","Edappadi Palaniswami":"chennai","K. Annamalai":"chennai",Annamalai:"chennai","Udhayanidhi Stalin":"chennai","Thol. Thirumavalavan":"chennai",Seeman:"chennai","Kamal Haasan":"entertainment",Rajinikanth:"entertainment",Vijay:"entertainment","Thalapathy Vijay":"entertainment","Ajith Kumar":"entertainment",Suriya:"entertainment","Shah Rukh Khan":"entertainment","Salman Khan":"entertainment","Alia Bhatt":"entertainment","Deepika Padukone":"entertainment","Taylor Swift":"entertainment",Beyonce:"entertainment","Chennai Super Kings":"sports",CSK:"sports","Mumbai Indians":"sports","Royal Challengers Bangalore":"sports",RCB:"sports","Indian Cricket Team":"sports","Virat Kohli":"sports","MS Dhoni":"sports","Rohit Sharma":"sports","Ravindra Jadeja":"sports","R Ashwin":"sports","Jasprit Bumrah":"sports","Lionel Messi":"sports","Cristiano Ronaldo":"sports","Novak Djokovic":"sports","Rafael Nadal":"sports","Carlos Alcaraz":"sports","PV Sindhu":"sports","Neeraj Chopra":"sports","R Praggnanandhaa":"sports","D Gukesh":"sports",OpenAI:"technology",Tesla:"technology",SpaceX:"technology",Nvidia:"technology","Sam Altman":"technology","Mark Zuckerberg":"technology","Sundar Pichai":"technology","Satya Nadella":"technology","Tim Cook":"technology","Gautam Adani":"business","Mukesh Ambani":"business","Ratan Tata":"business","N Chandrasekaran":"business","Uday Kotak":"business","Nifty 50":"business",Sensex:"business"};function Ki(e,n,s=""){const a=`${e} ${n}`.toLowerCase();for(const[c,d]of Object.entries(Wn)){const h=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${h}\\b`,"i").test(a))return d}const i={};Object.keys(Ut).forEach(c=>i[c]=0);for(const[c,d]of Object.entries(Ut))d.forEach(h=>{const u=h.toLowerCase(),g=["star","hero","mass","play","act","cast","plot","vijay","ajith","suriya","vikram","release"];u.length<=3||g.includes(u)?new RegExp(`\\b${u}\\b`,"i").test(a)&&i[c]++:a.includes(u)&&i[c]++});const o=Object.keys(i).sort((c,d)=>i[d]-i[c])[0];return i[o]>=2?o:null}const Vi=300,te={entries:[],subscribers:new Set,stats:{totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}}};function Wt(){te.subscribers.forEach(e=>e())}function qi(e){te.stats.byService[e]||(te.stats.byService[e]={ok:0,fail:0,totalMs:0,lastStatus:null,lastTime:null})}const he={add(e,n,s,a={}){const i={ts:Date.now(),level:e,service:n,message:s,...a};te.entries.push(i),te.entries.length>Vi&&te.entries.shift(),te.stats.totalFetches++,qi(n);const r=te.stats.byService[n];e==="error"?(te.stats.failures++,r.fail++,r.lastStatus="fail"):(te.stats.successes++,r.ok++,r.lastStatus="ok"),a.durationMs&&(te.stats.totalMs+=a.durationMs,r.totalMs+=a.durationMs),r.lastTime=Date.now(),Wt()},info(e,n,s){this.add("info",e,n,s)},warn(e,n,s){this.add("warn",e,n,s)},error(e,n,s){this.add("error",e,n,s)},success(e,n,s){this.add("success",e,n,s)},getEntries(){return te.entries},getStats(){return te.stats},subscribe(e){return te.subscribers.add(e),()=>te.subscribers.delete(e)},clear(){te.entries.length=0,te.stats={totalFetches:0,successes:0,failures:0,totalMs:0,byService:{}},Wt()}},gt=[{name:"rss2json",url:"https://api.rss2json.com/v1/api.json",format:e=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(n.status==="ok")return{title:n.feed?.title,items:n.items||[]};throw new Error("rss2json status not ok")}},{name:"codetabs",url:"https://api.codetabs.com/v1/proxy",format:e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.text();if(!n)throw new Error("Empty response from codetabs");return Gt(n)}},{name:"allorigins",url:"https://api.allorigins.win/get",format:e=>`https://api.allorigins.win/get?url=${encodeURIComponent(e)}`,parse:async e=>{const n=await e.json();if(!n.contents)throw new Error("No content from allorigins");return Gt(n.contents)}}];function Gt(e){const s=new DOMParser().parseFromString(e,"text/xml");if(s.getElementsByTagName("parsererror").length>0)throw new Error("XML Parsing Error");const a=s.querySelector("channel > title")?.textContent||"Unknown Source",i=Array.from(s.querySelectorAll("item")).map(r=>{const o=r.querySelector("title")?.textContent,l=r.querySelector("link")?.textContent,c=r.querySelector("pubDate")?.textContent,d=r.querySelector("description")?.textContent,h=r.querySelector("guid")?.textContent,u=r.querySelector("author")?.textContent||r.querySelector("dc\\:creator")?.textContent,g=r.querySelector("enclosure"),m=g?{url:g.getAttribute("url"),type:g.getAttribute("type")}:null,p=r.querySelector("media\\:content")||r.querySelector("content"),w=p?{url:p.getAttribute("url")}:null,b=r.querySelector("media\\:thumbnail")||r.querySelector("thumbnail"),j=b?b.getAttribute("url"):null;return{title:o,link:l,pubDate:c,description:d,guid:h,author:u,enclosure:m,"media:content":w,thumbnail:j}});return{title:a,items:i}}class Yi{constructor(){this.currentIndex=0,this.failureCounts=new Map,this.lastSuccess=new Map}async fetchViaProxy(n){const s=gt.length;let a=null;for(let i=0;i<s;i++){const r=(this.currentIndex+i)%s,o=gt[r];try{const l=o.format(n),c=new AbortController,d=setTimeout(()=>c.abort(),8e3);let h;try{h=await fetch(l,{signal:c.signal})}finally{clearTimeout(d)}if(!h.ok)throw new Error(`HTTP ${h.status}`);const u=await o.parse(h);if(!u||!u.items||u.items.length===0)throw new Error("No items returned");return this.failureCounts.set(o.name,0),this.lastSuccess.set(o.name,Date.now()),this.currentIndex=r,he.info("proxy",`${o.name} OK (${u.items.length} items)`),u}catch(l){console.warn(`[ProxyManager] ${o.name} failed for ${n}:`,l.message),a=l;const c=(this.failureCounts.get(o.name)||0)+1;this.failureCounts.set(o.name,c)}}throw he.error("proxy",`All proxies failed: ${a?.message}`),new Error(`All proxies failed. Last error: ${a?.message}`)}getProxyHealth(){return gt.map(n=>({name:n.name,failures:this.failureCounts.get(n.name)||0,lastSuccess:this.lastSuccess.get(n.name)||null}))}}const Gn=new Yi,vt="news_section_health",Kt=3;function Vt(e,n){if(e)try{const s=localStorage.getItem(vt),a=s?JSON.parse(s):{},i=a[e]||[];i.unshift(n),i.length>Kt&&(i.length=Kt),a[e]=i,localStorage.setItem(vt,JSON.stringify(a))}catch(s){console.warn("[SectionHealth] Failed to record fetch count:",s)}}function Ji(e,n){try{const s=localStorage.getItem(vt),i=(s?JSON.parse(s):{})[e]||[];if(i.length===0)return{status:"ok",ratio:1,avg:n,history:[]};const o=i.reduce((d,h)=>d+h,0)/i.length;if(o===0)return{status:"ok",ratio:1,avg:0,history:i};const l=n/o;let c="ok";return l<.1?c="critical":l<.5&&(c="warning"),{status:c,ratio:l,avg:o,history:i}}catch(s){return console.warn("[SectionHealth] Failed to compute health:",s),{status:"ok",ratio:1,avg:0,history:[]}}}function Xi(e){if(!e||e.length<=3)return!1;const n=e[0].source;return e.every(s=>s.source===n)}const Qi={world:[Ie.WORLD_IN,"https://feeds.bbci.co.uk/news/rss.xml","https://feeds.bbci.co.uk/news/world/rss.xml","https://www.aljazeera.com/xml/rss/all.xml",Ie.WORLD_US],india:[Ie.TAMIL_NADU,"https://feeds.feedburner.com/ndtvnews-top-stories","https://www.thehindu.com/news/national/feeder/default.rss","https://timesofindia.indiatimes.com/rssfeedstopstories.cms"],chennai:[Ie.CHENNAI,"https://www.thehindu.com/news/cities/chennai/feeder/default.rss"],trichy:["https://www.thehindu.com/news/cities/Tiruchirapalli/feeder/default.rss"],local:["https://news.google.com/rss/search?q=Muscat+Oman&hl=en-OM&gl=OM&ceid=OM:en","https://www.muscatdaily.com/feed"],business:[Ie.BUSINESS_IN_SEARCH,"https://economictimes.indiatimes.com/rssfeedstopstories.cms","https://www.moneycontrol.com/rss/business.xml","https://www.livemint.com/rss/money","https://feeds.bbci.co.uk/news/business/rss.xml","https://www.cnbc.com/id/10001147/device/rss/rss.html"],technology:[Ie.TECH_IN_SEARCH,"https://gadgets360.com/rss/news","https://techcrunch.com/feed/","https://www.theverge.com/rss/index.xml"],sports:["https://www.espn.com/espn/rss/news"],entertainment:["https://www.bollywoodhungama.com/rss/news.xml","https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml","https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/telugu-cinema/rssfeed.xml","https://www.pinkvilla.com/rss/feed/entertainment"],social:["https://www.theverge.com/rss/index.xml"]},Zi={bbc:"BBC",ndtv:"NDTV",theHindu:"The Hindu",toi:"Times of India",financialExpress:"Financial Express",dtNext:"DT Next",omanObserver:"Oman Observer",moneyControl:"Moneycontrol",indiaToday:"India Today",variety:"Variety",hollywoodReporter:"Hollywood Reporter",bollywoodHungama:"Bollywood Hungama",alJazeera:"Al Jazeera"},ea=["breaking","election","war","crisis","ai","market","inflation","conflict","gold","storm","rain"],ta=new RegExp(ea.join("|"),"i"),na=300*1e3,tt=new Map;function Kn(e,n){if(!e&&!n)return!1;const s=(e||"")+" "+(n||"");return ta.test(s)}function qt(e,n){if(!e||!n||n.length===0)return 0;const s=e.toLowerCase();let a=0;return n.forEach(i=>{i&&s.includes(i.toLowerCase())&&a++}),a}function ft(e){return e?e.replace(/<[^>]*>?/gm,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim():""}function sa(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function ia(e){if(!e)return"Unknown";if(e.includes(" - Google News"))return"Google News";const n=Object.keys(Oe).find(s=>s!=="default"&&e.toLowerCase().includes(s.toLowerCase()));return n?Oe[n].name:e}function aa(e,n,s){if(!n)return null;const a=n.match(/(?:["â€œ])([^"â€]{30,150})(?:["â€])/);if(a&&a[1]){let i=a[1].trim();if(i.length>0)return`"${i}"`}return null}function _t(e,n,s=0,a=null){const i=a||V(),r=i.rankingWeights||{},o=(Date.now()-e.publishedAt)/(1e3*60*60),l=r.freshness?.maxBoost||3;let c;if(i.rankingMode==="smart")c=l/(1+Math.exp(.5*(o-12)));else{const z=r.freshness?.decayHours||26;c=Math.max(0,(z-o)/z)*l}const d=xi(e.source),h=wi(e.source,n),u=r.source?.tier1Boost||.5,g=d*h,m=r.keyword?.matchBoost||2,p=Kn(e.title,e.description)?m:0,w=n==="world"?1.5:n==="business"?1.2:1;let b=0;e.sentiment&&(e.sentiment.label==="positive"?b=r.sentiment?.positiveBoost||.5:e.sentiment.label==="negative"&&(b=r.sentiment?.negativeBoost||.3));const f=/\b(live|updates|ongoing|developing)\b/i.test(e.title)?1.5:1,N=Oi.checkBreakingNews(e);e.isBreaking=N.isBreaking,e.breakingScore=N.breakingScore;const T=N.multiplier;if(i.enableNewScoring===!1)return(c+g+p+b)*w*T*f;const _=Fi(e.title,e.description,i),D=Bi(e.title,e.description),P=zi(e.title,e.description),I=Hi(e.title,null),B=Wi(e.title,e.description),$=Gi(e.imageUrl,i),M=c+p+b,v=1+d*h*u,L=M*v,O=_*D*P*I*B*$;let R=0,H=1;const W=i.buzz?.[n];if(W&&W.enabled){const z=e.title+" "+e.description,K=qt(z,W.positiveKeywords),q=qt(z,W.negativeKeywords),X=K*(W.positiveMultiplier||1),ie=q*(W.negativeMultiplier||1),le=X-ie;le<(W.filterThreshold||0)?H=.01:R=le*2}let E=1;const A=new Date().getDay(),S=A===0||A===6||A===5;if(["entertainment","social","movies"].includes(n)||e.section==="entertainment"){const z=i.rankingWeights?.temporal?.entertainmentBoost||2.5;E*=z}if(S&&["entertainment","social","local","chennai","trichy","events"].includes(n)){const z=i.rankingWeights?.temporal?.weekendBoost||2;E*=z}const C=r.viewedPenalty||.4;let k=1;s>0&&(k=C,s>3&&(k=C/2));const F=(L+R)*O*E*w*T*f*k*H;return(i.debugLogs||a)&&(e._scoreBreakdown={freshness:c,sourceScore:d,categoryWeight:h,keywordBoost:p,sentimentBoost:b,impact:_,proximity:D,novelty:P,currency:I,visual:$,sectionPriority:w,breakingBoost:T,seenPenalty:k,total:F}),F}function ra(e,n){let s=null;for(const[a,i]of Object.entries(Zi))if(e.includes(i)||i.includes(e)){s=a;break}return s?n[s]!==!1:!0}async function bt(e,n=10,s=null){const a=Date.now();if(n===0)return[];const i=e;let r=[];const o=V();if(o.enableCache!==!1){const d=tt.get(i);if(d&&Date.now()-d.timestamp<na){const h=Math.round((Date.now()-d.timestamp)/1e3);return console.log(`[RSS] âœ… Cache HIT for ${e} (age: ${h}s)`),Yt(d.data,e,n,s)}console.log(`[RSS] âš ï¸ Cache MISS for ${e} - Fetching fresh data`)}else console.log(`[RSS] â„¹ï¸ Cache DISABLED by user settings for ${e}`);if(e==="entertainment"){console.log("[RSS] Using entertainmentService for entertainment section");try{const h=V()?.entertainment||{},u=await ki(h);return console.log(`[RSS] Entertainment: Got ${u.length} articles with distribution`),u.slice(0,n)}catch(d){console.error("[RSS] Entertainment service failed:",d)}}const c=Qi[e]||[];if(c.length===0)return console.warn(`[RSS] No feeds defined for section: ${e}`),[];try{console.log(`[RSS] Feeds for ${e}:`,c);const d=await Promise.allSettled(c.map(m=>be(m,e))),h=[],u=[];d.forEach((m,p)=>{m.status==="fulfilled"&&m.value?(h.push(m.value),console.log(`[RSS] âœ… Feed ${p+1}/${c.length} succeeded`)):(u.push(c[p]),console.warn(`[RSS] âš ï¸ Feed ${p+1}/${c.length} failed: ${m.reason?.message||"Unknown error"}`))}),u.length>0&&h.length>0&&(console.log(`[RSS] Retrying ${u.length} failed feed(s) for ${e}...`),await new Promise(p=>setTimeout(p,2e3)),(await Promise.allSettled(u.map(p=>be(p,e)))).forEach((p,w)=>{p.status==="fulfilled"&&p.value?(h.push(p.value),console.log(`[RSS] âœ… Retry succeeded: ${u[w]}`)):console.error(`[RSS] âŒ Retry also failed: ${u[w]}`)})),r=h.flat();const g=Date.now()-a;console.log(`[RSS] Section '${e}' stats:`,{totalFeeds:c.length,successCount:h.length,failureCount:c.length-h.length,totalItems:r.length}),he.success("rss",`${e}: ${r.length} items from ${h.length}/${c.length} feeds`,{durationMs:g}),o.enableCache!==!1&&(tt.set(i,{timestamp:Date.now(),data:r}),console.log(`[RSS] ðŸ’¾ Cached ${r.length} items for ${e}`))}catch(d){return console.error(`[RSS] Unexpected error fetching section ${e}:`,{errorMessage:d.message,errorStack:d.stack,section:e}),he.error("rss",`${e}: ${d.message}`,{durationMs:Date.now()-a}),r.length>0?r:[]}try{let d=null;if(e==="social"){const g=V();g.buzzRankingWeights&&(d={...g,rankingWeights:{...g.rankingWeights,...g.buzzRankingWeights}})}const h=await Yt(r,e,n,s,d);h.forEach(g=>{g.sourceCount||(g.sourceCount=1)});const u=Ji(e,h.length);return Vt(e,h.length),h.health=u,h.isSingleSource=Xi(h),h}catch(d){console.error(`[RSS] Ranking failed for ${e}:`,d);const h=r.slice(0,n);return Vt(e,h.length),h}}async function be(e,n){const{title:s,items:a}=await Gn.fetchViaProxy(e);return a.map(i=>oa(i,s,n))}function oa(e,n,s="general"){const a=e.pubDate||e.created||new Date().toISOString(),i=Date.parse(a)||Date.now();let r=n;e.author&&(r=e.author),r=ia(r);const o=sa(e.link||e.guid||e.title),l=e.description||"",d=Ki(e.title||"",l||"",r)||s;let h=null;if(e.enclosure&&e.enclosure.url)h=e.enclosure.url;else if(e.thumbnail)h=e.thumbnail;else if(e["media:content"]&&e["media:content"].url)h=e["media:content"].url;else if(l.includes("<img")){const m=l.match(/<img[^>]+src="([^">]+)"/);m&&(h=m[1])}h&&!h.startsWith("http")&&(h=null);const u=["business","market"].includes(s)||/\b(stock|market|shares|trading|sensex|nifty|bank|economy|crypto|ipo|revenue|profit)\b/i.test(e.title+l);let g=null;return u&&(g=Ei(e.title,ft(l))),{id:o,title:e.title,headline:e.title,description:l,summary:ft(l),link:e.link,url:e.link,source:r,publishedAt:i,fetchedAt:Date.now(),time:new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),impactScore:0,section:d,criticsView:aa(e.title,ft(l)),sentiment:g?{label:g.label,comparative:g.comparative,titleSentiment:g.titleSentiment,descriptionSentiment:g.descriptionSentiment}:null,imageUrl:h}}async function Yt(e,n,s,a,i=null){try{const r=new Set,o=Date.now(),l=i||V(),c=l.hideOlderThanHours||l.freshnessLimitHours||60,d=c*60*60*1e3,h=l.strictFreshness===!1,u=l.rankingMode!=="legacy";console.log(`[RSSDebug] filtering for ${n}: Limit=${c}h. Items=${e.length}`);const g=l.feedBlockedKeywords||[],m=e.filter(w=>{if(g.length>0){const f=(w.title+" "+w.description).toLowerCase();if(g.some(N=>f.includes(N.toLowerCase())))return!1}const j=/\b(live|updates)\b/i.test(w.title)?d*3:d;if(!h&&o-w.publishedAt>j)return!1;if(l.filteringMode==="keyword"){if(!Kn(w.title,w.description))return!1}else if(l.topWebsitesOnly){if(!["BBC","Reuters","NDTV","The Hindu","Times of India","Moneycontrol"].some(N=>w.source.includes(N)))return!1}else if(a&&!ra(w.source,a))return!1;return!0}).map(w=>{const b=w.section||n,j=$n(w.id),f=u?_t(w,b,j,l):0;return{...w,section:b,impactScore:f}}).filter(w=>r.has(w.id)?!1:(r.add(w.id),!0)),p=Ri(m,.75);return l.rankingMode==="legacy"?p.sort((w,b)=>b.publishedAt-w.publishedAt):p.sort((w,b)=>b.impactScore-w.impactScore),console.log(`[RSS] Final count for ${n}: ${p.length} (requested ${s})`),p.slice(0,s)}catch(r){throw console.error(`[RSS] Ranking error for ${n}:`,r),r}}function la(){const e=tt.size;return tt.clear(),console.log(`[RSS] ðŸ—‘ï¸ Cleared ${e} cache entries`),e}function ca(e,n=20,s=40,a=30){const i=[],r=new Map,o=new Map,l=[...e].sort((c,d)=>(d.impactScore||0)-(c.impactScore||0));for(const c of l){if(i.length>=n)break;const d=c.section||"general",h=da(c.title,c.description),u=r.get(d)||0,g=o.get(h)||0,m=Math.floor(n*(s/100)),p=Math.floor(n*(a/100));u>=m||g>=p||(i.push(c),r.set(d,u+1),o.set(h,g+1))}return console.log("[Composer] Final composition:",{total:i.length,byTopic:Object.fromEntries(r),byGeo:Object.fromEntries(o)}),i}function da(e,n){const s=`${e||""} ${n||""}`.toLowerCase();return/chennai|madras/i.test(s)?"chennai":/trichy|tiruchirappalli/i.test(s)?"trichy":/tamil nadu|tn /i.test(s)?"tamil-nadu":/india|delhi|mumbai|bangalore/i.test(s)?"india":"global"}const Jt="news_audit_history";function ua(e){if(e.length===0)return 0;const n=[...e].sort((a,i)=>a-i),s=Math.floor(n.length/2);return n.length%2!==0?n[s]:(n[s-1]+n[s])/2}function Vn(e){return e.length===0?0:e.reduce((n,s)=>n+s,0)/e.length}function ha(e,n){if(e.length===0)return 0;const s=e.map(i=>Math.pow(i-n,2)),a=Vn(s);return Math.sqrt(a)}function ma(e,n){const s={},a=n?.rankingWeights?.audit?.consensusThreshold||2;return e.forEach(i=>{const r=i.sourceCount||1;let o=null;r>=a+1?o="âš¡âš¡":r>=a&&(o="âš¡"),s[i.id]={count:r,sources:i.allSources||[i.source],badge:o}}),s}function pa(e,n){const s={};if(!n)return s;const a=new Set;n.followedTopics&&n.followedTopics.forEach(r=>a.add(r.query.toLowerCase())),n.upAhead&&n.upAhead.keywords&&Object.values(n.upAhead.keywords).flat().forEach(r=>{r&&a.add(r.toLowerCase())});const i=Object.entries(n.newsSources||{}).filter(([r,o])=>o).map(([r])=>r.toLowerCase());return e.forEach(r=>{const o=(r.title||"").toLowerCase(),l=(r.source||"").toLowerCase();let c=[],d=0;a.forEach(g=>{o.includes(g)&&(c.push(g),d+=1)});const h=i.some(g=>l.includes(g)||g.includes(l));let u=null;c.length>0&&(u=h?"ðŸŽ¯":"ðŸ“Œ"),s[r.id]={score:d,matches:c,badge:u}}),s}function ga(e,n){const s={};if(e.length<3)return s;const a=Date.now(),i=e.map(l=>(a-new Date(l.publishedAt).getTime())/(1e3*60*60)),r=ua(i),o=n?.rankingWeights?.freshness?.anomalyThreshold||2;return e.forEach((l,c)=>{const d=i[c];let h="none",u=null;d>6&&d>r*o&&(h="age",u="ðŸ•°ï¸"),s[l.id]={type:h,badge:u}}),s}function fa(e,n){const s={};if(e.length<5)return s;const a=e.map(l=>l.impactScore||0),i=Vn(a),r=ha(a,i),o=n?.rankingWeights?.audit?.anomalySigma||2;return e.forEach(l=>{const c=l.impactScore||0;let d="none",h=null;c>i+o*r?(d="score_high",h="ðŸ“Šâ†‘"):c<i-1.5*r&&(d="score_low",h="ðŸ“Šâ†“"),s[l.id]={type:d,badge:h}}),s}async function ya(e,n){const s={};let a={};try{const r=localStorage.getItem(Jt);a=r?JSON.parse(r):{}}catch(r){console.warn("Failed to load audit history",r)}const i={};Object.entries(e).forEach(([r,o])=>{if(!Array.isArray(o)||o.length===0)return;const l=ma(o,n),c=pa(o,n),d=ga(o,n),h=fa(o,n),u=o.slice(0,10).map(m=>m.id),g=new Set(a[r]||[]);i[r]=u,o.forEach(m=>{const p=m.id,w=u.includes(p)&&g.has(p)?"ðŸŒ©ï¸":null;let b=null;m.isBreaking&&l[p]?.count>1?b="âœ…":m.isBreaking&&(b="â“"),s[p]={consensus:l[p],relevance:c[p],anomaly:h[p]?.badge?h[p]:d[p]?.badge?d[p]:{type:"none",badge:null},persistenceBadge:w,breakingVerified:b}})});try{localStorage.setItem(Jt,JSON.stringify(i))}catch(r){console.warn("Failed to save audit history",r)}return s}const qn=x.createContext(),Ye=["world","india","chennai","trichy"];function xa({children:e}){const{settingsVersion:n}=se(),s=x.useRef(n),[a,i]=x.useState({}),[r,o]=x.useState([]),[l,c]=x.useState(!0),[d,h]=x.useState([]),[u,g]=x.useState({}),[m,p]=x.useState(0),[w,b]=x.useState({}),j=x.useCallback(async N=>{if(!d.includes(N)){console.log(`[NewsContext] Lazy loading section: ${N}`);try{const T=V();if(T.sections[N]&&!T.sections[N].enabled){console.log(`[NewsContext] Skipping lazy load for disabled section: ${N}`);return}const _=T.sections[N]?.count||10,D=await bt(N,_+5,T.newsSources);i(P=>({...P,[N]:D||[]}))}catch(T){console.error(`[NewsContext] Failed to load section ${N}:`,T),g(_=>({..._,[N]:T.message}))}finally{h(T=>[...new Set([...T,N])])}}},[d]),f=x.useCallback(async(N=null)=>{c(!0);const T=Date.now();try{const _=V();if(!_){console.error("[NewsContext] Settings not available");return}const P=N||["world","india","chennai","trichy","local","social","entertainment","business","technology"],I=P.filter(L=>Ye.includes(L)),B=P.filter(L=>!Ye.includes(L)),$=[I,B].filter(L=>L.length>0);let M={};for(const L of $){const O={},R={};console.log(`[NewsContext] Fetching batch: ${L.join(", ")}`),await Promise.all(L.map(async S=>{if(_.sections[S]?.enabled!==!1)try{const C=_.sections[S]?.count||10,k=await bt(S,C+5,_.newsSources);k&&Array.isArray(k)?O[S]=k:O[S]=[]}catch(C){console.error(`[NewsContext] Error ${S}:`,C),R[S]=C.message,O[S]=[]}})),Object.assign(M,O);const H=Object.values(M).flat(),W={};Object.keys(M).forEach(S=>W[S]=[]),H.forEach(S=>{const C=S.section||"uncategorized";W[C]||(W[C]=[]),W[C].push(S)}),Object.keys(W).forEach(S=>{W[S].sort((C,k)=>(k.impactScore||0)-(C.impactScore||0))});const E=Object.values(W).flat(),y=ca(E,20,_.maxTopicPercent||40,_.maxGeoPercent||30);if(y&&y.length>0){const S=y.map(C=>C.id);Ws(S)}i(S=>({...S,...W,frontPage:y})),g(S=>({...S,...R})),h(S=>[...new Set([...S,...Object.keys(O)])]);const A=H.filter(S=>S.isBreaking||S.breakingScore&&S.breakingScore>1.5).sort((S,C)=>(C.breakingScore||0)-(S.breakingScore||0)).slice(0,3);o(A)}p(Date.now());const v=Date.now()-T;console.log(`[NewsContext] âœ… Refresh complete in ${v}ms`)}catch(_){console.error("[NewsContext] âŒ Fatal refresh error:",{errorMessage:_.message,errorStack:_.stack,timestamp:new Date().toISOString()})}finally{c(!1)}},[]);return x.useEffect(()=>{if(m===0)return;console.log("[NewsContext] Scheduling audit...");const N=setTimeout(async()=>{try{const T=V(),_=await ya(a,T);b(D=>({...D,..._}))}catch(T){console.error("[NewsContext] Audit failed:",T)}},3e3);return()=>clearTimeout(N)},[m]),x.useEffect(()=>{s.current!==n&&(console.log("[NewsContext] Settings changed (v"+n+") - refreshing"),la(),s.current=n,f())},[n,f]),x.useEffect(()=>{console.log("[NewsContext] Mounting - Initial fetch (Priority Only)");const N=setTimeout(()=>{f(Ye)},500),T=setInterval(()=>{console.log("[NewsContext] Auto-refresh (5min cycle)"),f(Ye)},300*1e3);return()=>{clearTimeout(N),clearInterval(T),console.log("[NewsContext] Unmounting")}},[f]),t.jsx(qn.Provider,{value:{newsData:a,loading:l,errors:u,refreshNews:f,breakingNews:r,lastFetch:m,loadSection:j,loadedSections:d,auditResults:w},children:e})}function it(){return x.useContext(qn)}function ue({id:e,title:n,icon:s,colorClass:a,news:i=[],maxDisplay:r=3,showExpand:o=!0,error:l=null,extraContent:c=null,onArticleClick:d=null,showCritics:h=!0}){const[u,g]=x.useState(!1),[m,p]=x.useState(!1),{auditResults:w}=it(),j=V().rankingWeights?.trending?.threshold||12,f=u?i.length:Math.min(r,i.length),N=i.slice(0,f),T=i.length>r,_=i.health||{status:"ok"},D=i.isSingleSource,P=v=>!v&&v!==0?"":v>15?"â­â­â­â­â­":v>10?"â­â­â­â­":v>6?"â­â­â­":v>3?"â­â­":"â­",I=v=>{switch(v?.toUpperCase()){case"HIGH":return"news-item__confidence--high";case"MEDIUM":return"news-item__confidence--medium";case"LOW":return"news-item__confidence--low";default:return""}},B=v=>{if(!v)return"";const L=Math.floor((Date.now()-v)/1e3);let O=L/31536e3;return O>1?Math.floor(O)+"y ago":(O=L/2592e3,O>1?Math.floor(O)+"mo ago":(O=L/86400,O>1?Math.floor(O)+"d ago":(O=L/3600,O>1?Math.floor(O)+"h ago":(O=L/60,O>1?Math.floor(O)+"m ago":"Just now"))))},$=v=>{Bn(v),d&&d(v),v.url&&window.open(v.url,"_blank","noopener,noreferrer")},M=()=>l?t.jsxs("div",{className:"empty-state",style:{borderColor:"rgba(255, 87, 87, 0.3)"},children:[t.jsx("div",{className:"empty-state__icon",children:"âŒ"}),t.jsx("p",{style:{color:"#ff5757"},children:l})]}):i.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"ðŸ“­"}),t.jsx("p",{children:"No news available for this section"})]}):t.jsxs(t.Fragment,{children:[c,t.jsx("div",{className:"news-list",children:N.map((v,L)=>t.jsxs("article",{className:"news-item",onClick:()=>$(v),style:{cursor:v.url?"pointer":"default"},children:[t.jsxs("div",{className:"news-item__badges",style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",fontSize:"0.85rem"},children:[P(v.impactScore)&&t.jsx("span",{title:`Impact Score: ${v.impactScore?.toFixed(1)}`,children:P(v.impactScore)}),v.isBreaking&&t.jsx("span",{title:"Breaking News",children:"âš¡"}),!v.isBreaking&&v.impactScore>j&&t.jsx("span",{title:"Trending",children:"ðŸ”¥"}),w[v.id]&&t.jsxs("span",{className:"audit-badges",style:{display:"flex",gap:"4px"},children:[w[v.id].consensus?.badge&&t.jsx("span",{title:`Corroborated by ${w[v.id].consensus.count} sources`,children:w[v.id].consensus.badge}),w[v.id].persistenceBadge&&t.jsx("span",{title:"Persistence",children:w[v.id].persistenceBadge}),w[v.id].relevance?.badge&&t.jsx("span",{title:"Relevance",children:w[v.id].relevance.badge}),w[v.id].anomaly?.badge&&t.jsx("span",{title:`Anomaly: ${w[v.id].anomaly.type}`,children:w[v.id].anomaly.badge}),w[v.id].breakingVerified&&t.jsx("span",{title:"Verified",children:w[v.id].breakingVerified})]})]}),t.jsxs("h3",{className:"news-item__headline",children:["â€¢ ",v.headline,v.url&&t.jsx("span",{style:{fontSize:"0.7rem",marginLeft:"8px",color:"var(--accent-secondary)"},children:"â†—"})]}),v.summary&&t.jsx("p",{className:"news-item__summary",children:v.summary}),h&&v.criticsView&&t.jsxs("div",{className:"news-item__critics",children:[t.jsx("span",{children:"ðŸ’¬"}),t.jsxs("div",{children:[t.jsx("strong",{style:{color:"var(--accent-secondary)",display:"block",marginBottom:"2px"},children:"Critics Take:"}),v.criticsView]})]}),t.jsxs("div",{className:"news-item__meta",children:[v.sentiment&&t.jsx("span",{className:`sentiment-badge sentiment--${v.sentiment.label}`,title:`Sentiment: ${v.sentiment.label}`,children:v.sentiment.label==="positive"?"ðŸŸ¢":v.sentiment.label==="negative"?"ðŸ”´":"âšª"}),t.jsx("span",{className:"news-item__source",children:v.source}),v.sourceCount>1&&t.jsxs("span",{className:"news-item__consensus",title:`Reported by ${v.sourceCount} sources`,children:["ðŸ”” ",v.sourceCount," sources"]}),t.jsx("span",{children:"|"}),t.jsx("span",{children:B(v.publishedAt)||v.time}),v.sourceCount&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"|"}),t.jsxs("span",{children:["#",v.sourceCount," Sources"]})]}),t.jsx("span",{children:"|"}),t.jsx("span",{className:`news-item__confidence ${I(v.confidence)}`,children:v.confidence})]})]},v.id||L))}),o&&T&&t.jsxs("div",{className:"news-more",onClick:()=>g(!u),children:[t.jsx("span",{style:{fontSize:"1.2rem"},children:u?"â–²":"â–¼"}),t.jsx("span",{children:u?"Collapse":`See ${i.length-r} more stories`})]})]});return t.jsxs("section",{className:"news-section",id:e,children:[t.jsxs("h2",{className:`news-section__title ${a}`,onClick:()=>p(!m),style:{cursor:"pointer"},title:`Tap to fold/unfold. Health: ${_.status.toUpperCase()}`,children:[t.jsx("span",{children:s}),n,_.status==="critical"&&t.jsx("span",{title:"Critical: Feed yield < 10% of average",style:{marginLeft:"8px"},children:"ðŸ”´"}),_.status==="warning"&&t.jsx("span",{title:"Warning: Feed yield < 50% of average",style:{marginLeft:"8px"},children:"âš ï¸"}),D&&i.length>3&&t.jsx("span",{title:"Single Source: Potential echo chamber",style:{marginLeft:"8px"},children:"ðŸ“¡"}),i.length>0&&t.jsxs("span",{style:{opacity:.6,fontSize:"0.9em",marginLeft:"6px"},children:["(",i.length,")"]}),t.jsx("span",{style:{marginLeft:"8px",fontSize:"0.8em",opacity:.5},children:m?"â–¼":"â–²"}),i.length>0&&i[0].fetchedAt&&t.jsx("span",{style:{fontSize:"0.65rem",marginLeft:"auto",padding:"2px 6px",borderRadius:"4px",background:Date.now()-i[0].fetchedAt<36e5?"rgba(0, 255, 0, 0.2)":"rgba(255, 165, 0, 0.2)",color:Date.now()-i[0].fetchedAt<36e5?"#4caf50":"#ffa726",border:"1px solid currentColor",fontWeight:"normal"},children:Date.now()-i[0].fetchedAt<3e5?"LIVE":B(i[0].fetchedAt)})]}),!m&&M()]})}const kt=({sections:e})=>{const n=s=>{const a=document.getElementById(s);if(a){const o=a.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:o,behavior:"smooth"})}};return!e||e.length===0?null:t.jsx("div",{className:"section-navigator",children:e.map(({id:s,icon:a,label:i})=>t.jsx("button",{className:"section-navigator__btn",onClick:()=>n(s),title:i,children:t.jsx("span",{className:"section-navigator__icon",children:a})},s))})},wa=({items:e})=>{const[n,s]=x.useState(0);if(x.useEffect(()=>{if(!e||e.length<2)return;const i=setInterval(()=>{s(r=>(r+1)%e.length)},5e3);return()=>clearInterval(i)},[e]),!e||e.length===0)return null;const a=e[n];return t.jsxs("div",{className:"breaking-news-banner",children:[t.jsxs("div",{className:"breaking-label",children:[t.jsx("span",{className:"pulse-icon",children:"ðŸ”´"})," BREAKING"]}),t.jsxs("div",{className:"breaking-content",children:[t.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"breaking-link",children:a.title}),t.jsxs("span",{className:"breaking-time",children:[a.time," â€¢ ",a.source]})]}),e.length>1&&t.jsx("div",{className:"breaking-controls",children:e.map((i,r)=>t.jsx("span",{className:`control-dot ${r===n?"active":""}`,onClick:()=>s(r)},r))})]})},va=({title:e,icon:n,actions:s,loadingPhase:a})=>{const i=e!=="Market Brief";return t.jsxs("header",{className:"header timeline-header",children:[i&&t.jsx("h1",{className:"header__title",style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"1.1rem"},children:t.jsx("span",{children:e})}),t.jsx(Hn,{loadingPhase:a}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:s})]})};function ba(e){const n=e.filter(c=>c?.precipitation_probability!=null);if(n.length===0)return null;const s=n.map(c=>c.precipitation_probability),a=Math.round(s.reduce((c,d)=>c+d,0)/s.length),i=Math.min(...s),r=Math.max(...s),o=r-i,l=o>30;return{avg:a,min:i,max:r,range:o,isWideRange:l,displayString:`${l?"!":"~"}${a}% (${i}-${r}%)`,symbol:l?"!":"~",models:n.length}}function Xt(e){const n=e.filter(r=>r?.temperature_2m!=null);if(n.length===0)return null;let s=0,a=0;const i={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=i[r.modelName]||1;a+=r.temperature_2m*o,s+=o}),Math.round(s===0?n.reduce((r,o)=>r+o.temperature_2m,0)/n.length:a/s)}function Qt(e){const n=e.filter(a=>a?.apparent_temperature!=null);if(n.length===0)return null;const s=n.map(a=>a.apparent_temperature);return Math.round(s.reduce((a,i)=>a+i,0)/s.length)}function Zt(e){const n=e.filter(o=>o?.weather_code!=null);if(n.length===0)return null;const s=n.map(o=>o.weather_code),a={};s.forEach(o=>{a[o]=(a[o]||0)+1});let i=0,r=s[0];for(const[o,l]of Object.entries(a))l>i&&(i=l,r=parseInt(o));return r}function Sa(e){const n=e.filter(r=>r?.precipitation!=null);if(n.length===0)return 0;let s=0,a=0;const i={ecmwf:1.2,icon:1,gfs:.8};return n.forEach(r=>{const o=i[r.modelName]||1;a+=r.precipitation*o,s+=o}),s===0?0:parseFloat((a/s).toFixed(1))}function Yn(e){return Object.entries(e).filter(([n,s])=>s!==null).map(([n,s])=>n)}function Jn(e){const n={ecmwf:"ECMWF",gfs:"GFS",icon:"ICON"};return e.map(s=>n[s]||s).join(", ")}function ja(e,n,s,a){const i=Na(n),r=_a(e),o=`${i}_${r}`,l={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};return l[o]?l[o]:o}function Na(e){return e>=6&&e<8?"dawn":e>=8&&e<17?"day":e>=17&&e<19?"dusk":"night"}function _a(e){return e===0||e<=1?"clear":e===2?"partlyCloudy":e===3?"overcast":e>=45&&e<=48?"fog":e>=51&&e<=55||e>=56&&e<=57?"drizzle":e===61?"lightRain":e===63?"rain":e===65?"heavyRain":e>=66&&e<=67?"rain":e>=71&&e<=77?"snow":e>=80&&e<=82?"rain":e===85||e===86?"snow":e>=95&&e<=99?"storm":"cloudy"}const Xn={ecmwf:"https://api.open-meteo.com/v1/ecmwf",gfs:"https://api.open-meteo.com/v1/gfs",icon:"https://api.open-meteo.com/v1/dwd-icon"},en={chennai:{lat:13.0827,lon:80.2707},trichy:{lat:10.7905,lon:78.7047},muscat:{lat:23.5859,lon:58.4059}};async function ka(e){const n=e.toLowerCase();if(en[n])return en[n];try{const s=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");if(s[n])return s[n]}catch{console.warn("Geocode cache read failed")}try{console.log(`[WeatherService] Geocoding ${e}...`);const a=await(await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(e)}&count=1&language=en&format=json`)).json();if(a.results&&a.results.length>0){const i={lat:a.results[0].latitude,lon:a.results[0].longitude};try{const r=JSON.parse(localStorage.getItem("weather_geo_cache")||"{}");r[n]=i,localStorage.setItem("weather_geo_cache",JSON.stringify(r))}catch{}return i}}catch(s){console.error("Geocoding failed:",s)}throw new Error(`Location not found: ${e}`)}async function Ca(e,n,s){const a=Xn[e];if(!a)throw new Error(`Unknown model: ${e}`);const i=new URLSearchParams({latitude:n,longitude:s,current:"temperature_2m,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m",hourly:"temperature_2m,precipitation_probability,precipitation,weather_code,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_direction_10m,uv_index,cloud_cover,visibility,dew_point_2m",daily:"precipitation_probability_max,precipitation_sum,uv_index_max",timezone:"auto"}),r=`${a}?${i}`;console.log(`[WeatherService] Fetching ${e.toUpperCase()}...`);const o=await fetch(r);if(!o.ok)throw new Error(`${e.toUpperCase()} API request failed: ${o.status}`);const l=await o.json();return console.log(`[WeatherService] âœ… ${e.toUpperCase()}: Success`),l}async function Ea(e){const n=Date.now();let s,a;try{const l=await ka(e);s=l.lat,a=l.lon}catch{throw new Error(`Unknown location: ${e}`)}const r=V().weather?.models||{ecmwf:!0,gfs:!0,icon:!0},o=Object.keys(Xn).filter(l=>r[l]!==!1);o.length===0&&(console.warn("[WeatherService] No models enabled, using all models"),o.push("ecmwf","gfs","icon")),console.log(`[WeatherService] Fetching from models: ${o.join(", ")}`);try{const l=await Promise.allSettled(o.map(u=>Ca(u,s,a))),c={};o.forEach((u,g)=>{c[u]=l[g].status==="fulfilled"?l[g].value:null,l[g].status==="rejected"&&console.warn(`[WeatherService] âš ï¸ ${u.toUpperCase()} failed:`,l[g].reason?.message)});const d=Yn(c);if(d.length===0)throw new Error("All weather models failed to fetch data");const h=Date.now()-n;return console.log(`[WeatherService] âœ… ${d.length}/${o.length} models succeeded: ${Jn(d)}`),he.success("weather",`${e}: ${d.length}/${o.length} models OK`,{durationMs:h}),Ta(c,e)}catch(l){throw console.error(`[WeatherService] âŒ Error fetching weather for ${e}:`,l),he.error("weather",`${e}: ${l.message}`,{durationMs:Date.now()-n}),l}}function Ta(e,n){const s=[e.ecmwf?.current,e.gfs?.current,e.icon?.current].filter(Boolean),a=(E,y)=>ja(E,y??new Date().getHours()),i=E=>E<=1?"â˜€ï¸":E<=3?"â›…":E<=67?"ðŸŒ§ï¸":E<=99?"â›ˆï¸":"â“",r={0:"Clear",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",48:"Fog",51:"Light Drizzle",61:"Light Rain",63:"Rain",65:"Heavy Rain",80:"Rain Showers",95:"Thunderstorm"},o=E=>r[E]||"Unknown",l=(E,y)=>{const A=[];for(let U=E;U<=y;U++)A.push(U);const S=[];e.ecmwf?.hourly&&S.push(e.ecmwf.hourly),e.gfs?.hourly&&S.push(e.gfs.hourly),e.icon?.hourly&&S.push(e.icon.hourly);const C={},k=[],F=[],z=[],K=[],q=[],X=[],ie=[],le=[],Se=[];A.forEach(U=>{e.ecmwf?.hourly?.precipitation_probability?.[U]!=null&&(C.ecmwf||(C.ecmwf=[]),C.ecmwf.push(e.ecmwf.hourly.precipitation_probability[U])),e.gfs?.hourly?.precipitation_probability?.[U]!=null&&(C.gfs||(C.gfs=[]),C.gfs.push(e.gfs.hourly.precipitation_probability[U])),e.icon?.hourly?.precipitation_probability?.[U]!=null&&(C.icon||(C.icon=[]),C.icon.push(e.icon.hourly.precipitation_probability[U]));const Q=S.map(Y=>({modelName:Y._modelName,temperature_2m:Y.temperature_2m?.[U],apparent_temperature:Y.apparent_temperature?.[U],precipitation:Y.precipitation?.[U],precipitation_probability:Y.precipitation_probability?.[U],weather_code:Y.weather_code?.[U],relative_humidity_2m:Y.relative_humidity_2m?.[U],wind_speed_10m:Y.wind_speed_10m?.[U],uv_index:Y.uv_index?.[U],cloud_cover:Y.cloud_cover?.[U]})),Te=Xt(Q),ce=Qt(Q),Ke=Sa(Q),Ve=Zt(Q);Te!==null&&k.push(Te),ce!==null&&F.push(ce),Ke!==null&&z.push(Ke),Ve!==null&&q.push(Ve),Q.forEach(Y=>{Y.precipitation_probability!=null&&K.push({precipitation_probability:Y.precipitation_probability}),Y.relative_humidity_2m!=null&&X.push(Y.relative_humidity_2m),Y.wind_speed_10m!=null&&ie.push(Y.wind_speed_10m),Y.uv_index!=null&&le.push(Y.uv_index),Y.cloud_cover!=null&&Se.push(Y.cloud_cover)})});const G=k.length>0?Math.round(k.reduce((U,Q)=>U+Q,0)/k.length):null,ae=F.length>0?Math.round(F.reduce((U,Q)=>U+Q,0)/F.length):G,lt=z.reduce((U,Q)=>U+Q,0),fs=ba(K),Ge=[];Object.values(C).forEach(U=>{if(U.length>0){const Q=Math.round(U.reduce((Te,ce)=>Te+ce,0)/U.length);Ge.push(Q)}});let Tt=0,ct=0,dt=0;Ge.length>0&&(ct=Math.min(...Ge),dt=Math.max(...Ge),Tt=dt-ct);let It=lt.toFixed(1)+"mm";lt<1&&(It="-");const At=q.length>0?q[Math.floor(q.length/2)]:0,ys=i(At),xs=Math.floor((E+y)/2)%24,ws=a(At,xs),vs=X.length>0?Math.round(X.reduce((U,Q)=>U+Q,0)/X.length):null,bs=ie.length>0?Math.round(ie.reduce((U,Q)=>U+Q,0)/ie.length):null,Ss=le.length>0?Math.max(...le):null,js=Se.length>0?Math.round(Se.reduce((U,Q)=>U+Q,0)/Se.length):null,Ns=A.map((U,Q)=>{const Te=e.ecmwf?"ecmwf":e.gfs?"gfs":"icon",ce=e[Te]?.hourly;if(!ce)return null;const Ke=ce.temperature_2m?.[U],Ve=ce.precipitation?.[U],Y=ce.precipitation_probability?.[U],Mt=ce.weather_code?.[U],ut=U%24,_s=ut>=12?"p":"a";return{time:`${ut%12===0?12:ut%12}${_s}`,temp:Ke,precip:Ve,prob:Y,icon:i(Mt),iconId:a(Mt,U%24)}}).filter(Boolean);return{temp:G,feelsLike:ae,icon:ys,iconId:ws,rainMm:It,rainProb:fs||{avg:0,min:0,max:0,displayString:"~0%",isWideRange:!1},probSpread:Tt,minModelAvg:ct,maxModelAvg:dt,humidity:vs,windSpeed:bs,uvIndex:Ss,cloudCover:js,hourly:Ns}},c=E=>{const y=E*24;return{morning:l(6+y,11+y),noon:l(12+y,16+y),evening:l(17+y,22+y)}},d=c(0),h=c(1),u=Xt(s),g=Qt(s),m=Zt(s),p=s.length>0&&s[0].relative_humidity_2m!=null?Math.round(s.reduce((E,y)=>E+(y.relative_humidity_2m||0),0)/s.length):null,w=s.length>0&&s[0].wind_speed_10m!=null?Math.round(s.reduce((E,y)=>E+(y.wind_speed_10m||0),0)/s.length):null,b=s.length>0&&s[0].wind_direction_10m!=null?Math.round(s.reduce((E,y)=>E+(y.wind_direction_10m||0),0)/s.length):null,j=[e.ecmwf?.daily?.precipitation_probability_max?.[0],e.gfs?.daily?.precipitation_probability_max?.[0],e.icon?.daily?.precipitation_probability_max?.[0]].filter(E=>E!=null),f=j.length>0?Math.round(j.reduce((E,y)=>E+y,0)/j.length):0,N=[e.ecmwf?.daily?.precipitation_sum?.[0],e.gfs?.daily?.precipitation_sum?.[0],e.icon?.daily?.precipitation_sum?.[0]].filter(E=>E!=null),T=N.length>0?(N.reduce((E,y)=>E+y,0)/N.length).toFixed(1):0,_=[e.ecmwf?.daily?.uv_index_max?.[0],e.gfs?.daily?.uv_index_max?.[0],e.icon?.daily?.uv_index_max?.[0]].filter(E=>E!=null),D=_.length>0?Math.round(_.reduce((E,y)=>E+y,0)/_.length):null,P=Yn(e),I=new Date().getHours(),B=[];e.ecmwf?.hourly&&B.push(e.ecmwf.hourly),e.gfs?.hourly&&B.push(e.gfs.hourly),e.icon?.hourly&&B.push(e.icon.hourly);const $=[],M=[],v=E=>{const y=I+E,A=(I+E)%24,S=B.map(G=>G.temperature_2m?.[y]).filter(G=>G!=null),C=B.map(G=>G.precipitation?.[y]).filter(G=>G!=null),k=B.map(G=>G.precipitation_probability?.[y]).filter(G=>G!=null),F=B.map(G=>G.weather_code?.[y]).filter(G=>G!=null),z=B.map(G=>G.cloud_cover?.[y]).filter(G=>G!=null),K=S.length>0?Math.round(S.reduce((G,ae)=>G+ae,0)/S.length):null,q=C.length>0?parseFloat((C.reduce((G,ae)=>G+ae,0)/C.length).toFixed(1)):0,X=k.length>0?Math.round(k.reduce((G,ae)=>G+ae,0)/k.length):0,ie=F.length>0?F[Math.floor(F.length/2)]:0,le=z.length>0?Math.round(z.reduce((G,ae)=>G+ae,0)/z.length):0;return{hour:A,label:E===0?"Now":(G=>{const ae=G>=12?"p":"a";return`${G%12===0?12:G%12}${ae}`})(A),temp:K,precip:q,prob:X,cloud:le,icon:i(ie),iconId:a(ie,A),code:ie}};for(let E=0;E<24;E+=3)$.push(v(E));for(let E=0;E<8;E++)M.push(v(E));const L=[e.ecmwf?.daily?.temperature_2m_max?.[0],e.gfs?.daily?.temperature_2m_max?.[0],e.icon?.daily?.temperature_2m_max?.[0]].filter(E=>E!=null),O=[e.ecmwf?.daily?.temperature_2m_min?.[0],e.gfs?.daily?.temperature_2m_min?.[0],e.icon?.daily?.temperature_2m_min?.[0]].filter(E=>E!=null);let R=L.length>0?Math.round(L.reduce((E,y)=>E+y,0)/L.length):null,H=O.length>0?Math.round(O.reduce((E,y)=>E+y,0)/O.length):null;R===null&&$.length>0&&(R=Math.max(...$.map(E=>E.temp||-999)),R===-999&&(R=null)),H===null&&$.length>0&&(H=Math.min(...$.map(E=>E.temp||999)),H===999&&(H=null));let W="";return parseFloat(T)>0&&(W+=`Today's max rain probability: ${f}%. Total precip: ${T}mm. `),W+=`Condition: ${o(m)}. UV Index: ${D||"N/A"}.`,{name:n.charAt(0).toUpperCase()+n.slice(1),icon:n==="muscat"?"ðŸ“":"ðŸ›ï¸",fetchedAt:Date.now(),models:{successful:P,count:P.length,names:Jn(P)},current:{temp:u,feelsLike:g,high:R,low:H,condition:o(m),icon:i(m),iconId:a(m,new Date().getHours()),humidity:p,windSpeed:w,windDirection:b},morning:d.morning,noon:d.noon,evening:d.evening,tomorrow:h,hourly24:$,next8Hours:M,summary:W}}const Qn=x.createContext();function Ia({children:e}){const{settingsVersion:n}=se(),s=x.useRef(n),[a,i]=x.useState(null),[r,o]=x.useState(!0),[l,c]=x.useState(null),[d,h]=x.useState(0),u=x.useCallback(async(g=!1)=>{const m=V(),p=(m?.weatherFreshnessLimit||4)*60*60*1e3;if(!g&&a){const w=Date.now()-d;if(w<900*1e3)return;m?.strictFreshness&&w>p&&i(null)}if(o(!0),m?.sections?.weather===!1){o(!1);return}try{const w=m?.weather?.cities||["chennai","trichy","muscat"],b=await Promise.allSettled(w.map(f=>Ea(f))),j={};w.forEach((f,N)=>{j[f]=b[N].status==="fulfilled"?b[N].value:null}),i(j),h(Date.now()),c(null)}catch(w){console.error("Weather Context Error:",w),c(w),i(null)}finally{o(!1)}},[a,d]);return x.useEffect(()=>{u()},[u]),x.useEffect(()=>{s.current!==n&&(s.current=n,u(!0))},[n,u]),t.jsx(Qn.Provider,{value:{weatherData:a,loading:r,error:l,refreshWeather:u},children:e})}function at(){return x.useContext(Qn)}const tn=32,yt={day_clear:t.jsxs("g",{children:[t.jsx("circle",{cx:"16",cy:"16",r:"6",fill:"#FFD93D"}),[0,45,90,135,180,225,270,315].map(e=>t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"7",stroke:"#FFD93D",strokeWidth:"2",strokeLinecap:"round",transform:`rotate(${e} 16 16)`},e))]}),night_clear:t.jsxs("g",{children:[t.jsx("path",{d:"M20 6 A10 10 0 1 0 26 20 A7 7 0 1 1 20 6Z",fill:"#B8C5E8"}),t.jsx("circle",{cx:"24",cy:"7",r:"1",fill:"#FFE"}),t.jsx("circle",{cx:"27",cy:"12",r:"0.7",fill:"#FFE"})]}),dawn_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#FF9F43",opacity:"0.3",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FFD93D"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),dusk_clear:t.jsxs("g",{children:[t.jsx("rect",{x:"0",y:"22",width:"32",height:"10",fill:"#E74C3C",opacity:"0.25",rx:"2"}),t.jsx("circle",{cx:"16",cy:"22",r:"6",fill:"#FF6B6B"}),[0,30,60,90,120,150,180].map(e=>t.jsx("line",{x1:"16",y1:"14",x2:"16",y2:"12",stroke:"#FF6B6B",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 16 22)`},e))]}),day_partlyCloudy:t.jsxs("g",{children:[t.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD93D"}),[0,60,120,180,240,300].map(e=>t.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"3",stroke:"#FFD93D",strokeWidth:"1.5",strokeLinecap:"round",transform:`rotate(${e} 12 12)`},e)),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#DFE6ED"})]}),night_partlyCloudy:t.jsxs("g",{children:[t.jsx("path",{d:"M10 6 A6 6 0 1 0 14 12 A4 4 0 1 1 10 6Z",fill:"#B8C5E8"}),t.jsx("ellipse",{cx:"20",cy:"22",rx:"9",ry:"5",fill:"#636E83"}),t.jsx("ellipse",{cx:"17",cy:"19",rx:"5",ry:"4",fill:"#778CA3"})]}),day_cloudy:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"11",ry:"6",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"6",ry:"5",fill:"#DFE6ED"}),t.jsx("ellipse",{cx:"20",cy:"16",rx:"5",ry:"4",fill:"#DFE6ED"})]}),day_overcast:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"20",rx:"12",ry:"6",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"15",rx:"7",ry:"5",fill:"#A4B0BE"}),t.jsx("ellipse",{cx:"21",cy:"16",rx:"5",ry:"4",fill:"#A4B0BE"})]}),day_fog:t.jsxs("g",{children:[[14,18,22].map((e,n)=>t.jsx("line",{x1:"4",y1:e,x2:"28",y2:e,stroke:"#B0BEC5",strokeWidth:"2.5",strokeLinecap:"round",opacity:.5+n*.15},n)),t.jsx("circle",{cx:"16",cy:"9",r:"4",fill:"#FFD93D",opacity:"0.4"})]}),day_drizzle:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"14",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"11",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("line",{x1:e,y1:"21",x2:e-1,y2:"25",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_lightRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#B0BEC5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#C8D6E5"}),[9,14,19,24].map((e,n)=>t.jsx("line",{x1:e,y1:"20",x2:e-1.5,y2:"26",stroke:"#74B9FF",strokeWidth:"1.5",strokeLinecap:"round"},n))]}),day_rain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"12",rx:"11",ry:"5",fill:"#99A4B2"}),t.jsx("ellipse",{cx:"12",cy:"9",rx:"6",ry:"4",fill:"#A4B0BE"}),[8,13,18,23].map((e,n)=>t.jsx("line",{x1:e,y1:"19",x2:e-2,y2:"27",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_heavyRain:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"11",rx:"12",ry:"5",fill:"#636E72"}),t.jsx("ellipse",{cx:"12",cy:"8",rx:"6",ry:"4",fill:"#778CA3"}),[7,12,17,22,27].map((e,n)=>t.jsx("line",{x1:e,y1:"18",x2:e-3,y2:"28",stroke:"#0984E3",strokeWidth:"2.5",strokeLinecap:"round"},n))]}),day_storm:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"10",rx:"12",ry:"5",fill:"#4A4A4A"}),t.jsx("ellipse",{cx:"12",cy:"7",rx:"6",ry:"4",fill:"#636E72"}),t.jsx("polygon",{points:"17,14 13,22 16,22 14,29 21,20 17,20 19,14",fill:"#FDCB6E"}),[8,24].map((e,n)=>t.jsx("line",{x1:e,y1:"17",x2:e-2,y2:"25",stroke:"#0984E3",strokeWidth:"2",strokeLinecap:"round"},n))]}),day_snow:t.jsxs("g",{children:[t.jsx("ellipse",{cx:"16",cy:"13",rx:"10",ry:"5",fill:"#C8D6E5"}),t.jsx("ellipse",{cx:"12",cy:"10",rx:"5",ry:"4",fill:"#DFE6ED"}),[10,16,22].map((e,n)=>t.jsx("text",{x:e,y:25,textAnchor:"middle",fontSize:"6",fill:"#74B9FF",children:"*"},n))]}),day_wind:t.jsxs("g",{children:[t.jsx("path",{d:"M4 14 Q12 10, 20 14 Q26 16, 28 12",fill:"none",stroke:"#78909C",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("path",{d:"M6 20 Q14 16, 22 20 Q27 22, 29 18",fill:"none",stroke:"#90A4AE",strokeWidth:"1.8",strokeLinecap:"round"}),t.jsx("path",{d:"M8 26 Q15 22, 24 26",fill:"none",stroke:"#B0BEC5",strokeWidth:"1.5",strokeLinecap:"round"})]})},Aa={night_cloudy:"day_overcast",night_overcast:"day_overcast",night_fog:"day_fog",night_drizzle:"day_drizzle",night_lightRain:"day_lightRain",night_rain:"day_rain",night_heavyRain:"day_heavyRain",night_storm:"day_storm",night_snow:"day_snow",night_wind:"day_wind",dawn_partlyCloudy:"day_partlyCloudy",dawn_cloudy:"day_cloudy",dawn_rain:"day_rain",dusk_partlyCloudy:"day_partlyCloudy",dusk_cloudy:"day_cloudy",dusk_rain:"day_rain"};function nt({id:e,size:n=32,className:s=""}){const a=yt[e]||yt[Aa[e]]||yt.day_cloudy;return t.jsx("svg",{viewBox:`0 0 ${tn} ${tn}`,width:n,height:n,className:s,"aria-label":e?.replace(/_/g," "),children:a})}const rt=24,Zn=({size:e=rt,className:n=""})=>t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"currentColor",className:n,style:{color:"#60a5fa",verticalAlign:"middle"},children:[t.jsx("path",{d:"M12,2 C12,2 7,7 7,10 C7,12.76 9.24,15 12,15 C14.76,15 17,12.76 17,10 C17,7 12,2 12,2 Z",opacity:"0.9"}),t.jsx("path",{d:"M6,12 C6,12 4,14 4,15.5 C4,16.6 4.9,17.5 6,17.5 C7.1,17.5 8,16.6 8,15.5 C8,14 6,12 6,12 Z",opacity:"0.7"}),t.jsx("path",{d:"M18,12 C18,12 16,14 16,15.5 C16,16.6 16.9,17.5 18,17.5 C19.1,17.5 20,16.6 20,15.5 C20,14 18,12 18,12 Z",opacity:"0.7"})]}),es=({size:e=rt,className:n=""})=>t.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,style:{color:"#cbd5e1",verticalAlign:"middle"},children:t.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),Ma=({size:e=rt,className:n="",color:s="currentColor"})=>t.jsxs("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:[t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12h20c0-5.52-4.48-10-10-10z",opacity:"1"}),t.jsx("path",{d:"M11 12h2v7c0 1.1.9 2 2 2s2-.9 2-2h-2c0 .55-.45 1-1 1s-1-.45-1-1v-7z",opacity:"0.8"})]}),nn=({size:e=rt,className:n="",color:s="currentColor"})=>t.jsx("svg",{viewBox:"0 0 24 24",width:e,height:e,fill:s,className:n,children:t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})}),sn=()=>{const{weatherData:e,loading:n,error:s}=at(),[a,i]=x.useState(()=>{try{return localStorage.getItem("weather_active_city")||"chennai"}catch{return"chennai"}});if(x.useEffect(()=>{try{localStorage.setItem("weather_active_city",a)}catch{}},[a]),n)return t.jsx("div",{className:"quick-weather-card qw-bg-day",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Loading weather..."})});if(s||!e)return t.jsx("div",{className:"quick-weather-card qw-bg-night",children:t.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:"Weather unavailable"})});const{settings:r}=se(),o=(r.weather?.cities||["chennai","trichy","muscat"]).map(p=>p.toLowerCase()),l={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[o[2]]:o[2].charAt(0).toUpperCase()+o[2].slice(1)},c={chennai:"ðŸ›ï¸",trichy:"ðŸ¯",muscat:"ðŸ“",[o[2]]:"ðŸ“"},d=new Date().getHours();let h="qw-bg-day";d>=6&&d<11?h="qw-bg-morning":d>=11&&d<17?h="qw-bg-day":d>=17&&d<20?h="qw-bg-evening":h="qw-bg-night";const u=e[a],g=Da(u),m=La(u);return t.jsxs("section",{className:`quick-weather-card ${h}`,children:[t.jsx("div",{className:"qw-cities-grid",children:o.map(p=>{const w=e[p];if(!w?.current)return null;const b=w.current,j=p===a;return t.jsxs("div",{className:`qw-city-card ${j?"qw-city-card--active":""}`,onClick:()=>i(p),children:[t.jsxs("div",{className:"qw-city-header",children:[t.jsx("span",{className:"qw-city-icon",children:c[p]}),t.jsx("span",{className:"qw-city-name",children:l[p]})]}),t.jsxs("div",{className:"qw-city-temp-row",children:[t.jsxs("span",{className:"qw-city-temp",style:{fontSize:"0.9rem"},children:[b.temp,"Â°"]}),t.jsx("span",{className:"qw-city-weather-icon",children:b.iconId?t.jsx(nt,{id:b.iconId,size:48}):t.jsx("span",{style:{fontSize:"2.5rem"},children:b.icon})})]}),t.jsx("div",{className:"qw-city-condition",children:b.condition}),t.jsxs("div",{className:"qw-city-meta",children:[t.jsxs("span",{children:[t.jsx(Zn,{size:"0.85em"})," ",b.humidity??"--","%"]}),t.jsxs("span",{children:[t.jsx(es,{size:"0.85em"})," ",b.windSpeed??"--"]})]})]},p)})}),u?.hourly24&&t.jsxs("div",{className:"qw-timeline-section",children:[t.jsx("div",{className:"qw-timeline-label",style:{fontWeight:600,fontSize:"0.85rem"},children:Ra(u,l[a])}),t.jsx("div",{className:"qw-timeline-strip",children:u.hourly24.map((p,w)=>t.jsxs("div",{className:"qw-timeline-slot",children:[t.jsx("div",{className:"qw-slot-time",children:p.label}),t.jsx("div",{className:"qw-slot-icon",children:p.iconId?t.jsx(nt,{id:p.iconId,size:40}):p.icon}),t.jsxs("div",{className:"qw-slot-temp",style:{fontSize:"0.9rem"},children:[p.temp,"Â°"]}),p.precip>.5&&t.jsxs("div",{className:"qw-slot-rain",children:[p.precip,"mm"]})]},w))})]}),g&&t.jsxs("div",{className:"qw-headsup",children:[t.jsx("span",{className:"qw-headsup-icon",children:g.icon}),t.jsx("span",{children:g.message})]}),m&&t.jsxs("div",{className:"qw-severe",style:{background:"rgba(220,38,38,0.15)",border:"1px solid rgba(220,38,38,0.4)",borderRadius:"8px",padding:"8px 12px",margin:"8px 0 0",display:"flex",alignItems:"center",gap:"8px",fontSize:"0.78rem",color:"#fca5a5"},children:[t.jsx("span",{style:{fontSize:"1.1rem"},children:"âš ï¸"}),t.jsx("span",{children:m})]})]})};function Ra(e,n){if(!e?.hourly24)return`${n} â€¢ Forecast`;const a=e.hourly24.filter(r=>r.precip>.5||r.prob>40),i=e.current;return a.length>=3?`${n} â€¢ Rainy spells ahead`:a.length>0?`${n} â€¢ Scattered showers`:i?.condition?`${n} â€¢ ${i.condition}`:`${n} â€¢ Clear Skies`}function Da(e){if(!e?.hourly24)return null;const s=e.hourly24.filter(g=>g.precip>.5||g.prob>40);if(s.length===0)return null;const a=s.reduce((g,m)=>g+(m.precip||0),0),i=Math.max(...s.map(g=>g.prob||0)),r=g=>{const m=g>=12?"p":"a";return`${g%12===0?12:g%12}${m}`},o=r(s[0].hour),l=s.length>1?r(s[s.length-1].hour):null;let c="Rain",d="ðŸŒ§ï¸";a>=10||i>=80?(c="Heavy rain",d="â›ˆï¸"):a<2&&i<50&&(c="Light showers possible",d="ðŸŒ¦ï¸");const h=l?`${o}â€“${l}`:`around ${o}`,u=a>.5?` (~${a.toFixed(1)}mm)`:"";return{icon:d,message:`${c} expected ${h}${u}`}}function La(e){if(!e?.hourly24)return null;const n=e.hourly24,s=n.filter(o=>o.precip>=10),a=n.filter(o=>o.prob>=80),i=n.map(o=>o.temp).filter(o=>o!=null),r=i.length>0?Math.max(...i):null;return s.length>0?`Heavy rainfall warning: ${s.reduce((l,c)=>l+c.precip,0).toFixed(1)}mm expected`:a.length>=2?"Thunderstorm activity likely in the next 24 hours":r!=null&&r>=42?`Extreme heat warning: Temperatures may reach ${r}Â°C`:null}const an={MORNING_WEATHER:{id:"morning_weather",name:"Morning Weather",icon:"ðŸŒ…",startHour:6,startMinute:55,endHour:7,endMinute:0,sections:["weather"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MORNING_NEWS:{id:"morning_news",name:"Morning News",icon:"ðŸŒ„",startHour:7,startMinute:0,endHour:9,endMinute:0,sections:["weather","world","india","chennai","trichy","local","dtNext"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}},MARKET_BRIEF:{id:"market_brief",name:"Market Brief",icon:"ðŸ“Š",startHour:9,startMinute:0,endHour:11,endMinute:55,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},MIDDAY_BRIEF:{id:"midday_brief",name:"Midday Brief",icon:"â˜€ï¸",startHour:11,startMinute:55,endHour:14,endMinute:30,sections:["india","world","chennai","trichy"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!1,social:!1,weather:!0,market:!0}},MARKET_MOVERS:{id:"market_movers",name:"Market Movers",icon:"ðŸ“ˆ",startHour:14,startMinute:30,endHour:16,endMinute:20,sections:["market","india","world"],recommended:{world:!0,india:!0,chennai:!1,trichy:!1,local:!1,social:!1,weather:!1,market:!0}},EVENING_NEWS:{id:"evening_news",name:"Evening News",icon:"ðŸŒ†",startHour:16,startMinute:20,endHour:16,endMinute:45,sections:["world","india","chennai","trichy","local","social"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},LOCAL_EVENTS:{id:"local_events",name:"Local Events",icon:"ðŸ“",startHour:16,startMinute:45,endHour:19,endMinute:30,sections:["chennai","trichy","local","social"],recommended:{world:!1,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!1}},NIGHT_WRAP_UP:{id:"night_wrap_up",name:"Night Wrap-Up",icon:"ðŸŒ™",startHour:19,startMinute:30,endHour:20,endMinute:0,sections:["world","india","chennai","trichy","local","social","market"],recommended:{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!0,weather:!0,market:!0}},URGENT_ONLY:{id:"urgent_only",name:"Urgent Alerts Only",icon:"ðŸ””",startHour:20,startMinute:0,endHour:6,endMinute:55,sections:["urgent"],recommended:{world:!1,india:!1,chennai:!1,trichy:!1,local:!1,social:!1,weather:!0,market:!1}}};function Qe(e=new Date){const n=e.getHours(),s=e.getMinutes(),a=n*60+s,i=Object.values(an);for(const r of i){const o=r.startHour*60+r.startMinute;let l=r.endHour*60+r.endMinute;if(r.id==="urgent_only"){if(a>=o||a<l)return r}else if(a>=o&&a<l)return r}return an.URGENT_ONLY}function rn(e){return e?.recommended||{world:!0,india:!0,chennai:!0,trichy:!0,local:!0,social:!1,weather:!0,market:!1}}function Oa(e){if(!e)return"Welcome to Daily Event AI";switch(e.id){case"morning_weather":return"Good Morning! Here's your weather start.";case"morning_news":return"Your Morning Headlines are ready.";case"market_brief":return"Market Open: Sensex & Nifty Updates.";case"midday_brief":return"Midday Update: Top stories so far.";case"market_movers":return"Market Movers: Gainers & Losers.";case"evening_news":return"Evening Wrap: Catch up on the day.";case"local_events":return"How your evening looks around town.";case"night_wrap_up":return"The Day in Review.";case"urgent_only":return"Urgent Updates Only.";default:return"Daily Event AI: Live Updates."}}function Fa({breakingNews:e}){const n=Qe(),s=new Date;return t.jsxs("div",{className:"newspaper-masthead",children:[t.jsxs("div",{className:"masthead__header",children:[t.jsxs("div",{className:"masthead__title",children:[t.jsx("h1",{className:"masthead__logo",children:"Daily News AI"}),t.jsx("div",{className:"masthead__tagline",children:"Your Intelligent News Digest"})]}),t.jsxs("div",{className:"masthead__meta",children:[t.jsx("div",{className:"masthead__date",children:s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),t.jsx("div",{className:"masthead__segment",children:n.name})]})]}),e?.length>0&&t.jsxs("div",{className:"masthead__breaking",children:[t.jsx("span",{className:"breaking-badge",children:"BREAKING"}),t.jsx("span",{className:"breaking-text",children:e[0].title})]})]})}function Ze({article:e,size:n="medium",onClick:s,href:a,badge:i}){const{settings:r}=se(),[o,l]=x.useState(!1),[c,d]=x.useState(!1),[h,u]=x.useState(!1);`${encodeURIComponent(e.source)}`;const g=e.imageUrl&&!o,m=a?"a":"article",p=a?{href:a,target:"_blank",rel:"noopener noreferrer"}:{};return t.jsxs(m,{className:`image-card image-card--${n}`,onClick:s,...p,style:{position:"relative"},children:[r?.debugLogs&&e._scoreBreakdown&&t.jsxs("div",{className:"debug-badge",onClick:w=>{w.preventDefault(),w.stopPropagation(),u(!h)},style:{position:"absolute",top:"5px",right:"5px",zIndex:20,background:"rgba(0,0,0,0.7)",color:"#00ff41",fontSize:"0.6rem",padding:"2px 4px",borderRadius:"4px",cursor:"help",border:"1px solid #00ff41"},children:[e._scoreBreakdown.total.toFixed(1),h&&t.jsx("div",{style:{position:"absolute",top:"100%",right:0,width:"200px",background:"#111",border:"1px solid #333",padding:"8px",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",pointerEvents:"none"},children:Object.entries(e._scoreBreakdown).map(([w,b])=>w!=="total"&&typeof b=="number"&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[t.jsx("span",{style:{color:"#aaa",textTransform:"capitalize"},children:w}),t.jsx("span",{style:{color:"#fff"},children:b.toFixed(2)})]},w))})]}),g&&t.jsxs("div",{className:"image-card__media",children:[!c&&t.jsx("div",{className:"image-card__skeleton"}),t.jsx("img",{src:e.imageUrl,alt:e.title,className:`image-card__image ${c?"loaded":""}`,onLoad:()=>d(!0),onError:()=>l(!0),loading:"lazy"}),i&&t.jsx("div",{className:"image-card__badge",children:i}),t.jsx("div",{className:"image-card__overlay",children:t.jsx("span",{className:"image-card__source",children:e.source})})]}),t.jsxs("div",{className:"image-card__content",children:[t.jsx("h3",{className:"image-card__headline",children:e.title}),e.summary&&t.jsxs("p",{className:"image-card__summary",children:[e.summary.substring(0,150),"..."]}),t.jsxs("div",{className:"image-card__meta",children:[t.jsx("span",{className:"meta__time",children:e.time}),e.sentiment&&t.jsx("span",{className:`meta__sentiment meta__sentiment--${e.sentiment.label}`,children:e.sentiment.label==="positive"?"ðŸ“ˆ":e.sentiment.label==="negative"?"ðŸ“‰":"ï¿½"})]})]})]})}function $a({newsData:e,breakingNews:n,settings:s}){const{settings:a}=se(),i=Object.entries(e).filter(([u,g])=>u!=="frontPage"&&a?.sections?.[u]?.enabled!==!1).map(([u,g])=>{const m=a?.sections?.[u]?.count;return typeof m=="number"?g.slice(0,m):g}).flat();let r=i;if(e.frontPage&&Array.isArray(e.frontPage)){const u=new Set(e.frontPage.map(m=>m.title)),g=i.filter(m=>!u.has(m.title));r=[...e.frontPage,...g]}const o=r.filter(u=>u.imageUrl),l=r.filter(u=>!u.imageUrl),c=o.slice(0,s?.headlinesCount||3),d=o.slice(3,3+(s?.leadsCount||6)),h=l.slice(0,s?.briefsCount||12);return t.jsxs("div",{className:"newspaper-layout",children:[t.jsx(Fa,{breakingNews:n}),c.length>0&&t.jsxs("section",{className:"headlines-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸ“° Top Stories"}),t.jsxs("div",{className:"headlines-grid",children:[c[0]&&t.jsx("div",{className:"headline-lead",children:t.jsx(Ze,{article:c[0],size:"large",onClick:()=>window.open(c[0].link,"_blank")})}),c.length>1&&t.jsx("div",{className:"headline-supporting",children:c.slice(1).map(u=>t.jsx(Ze,{article:u,size:"medium",onClick:()=>window.open(u.link,"_blank")},u.id))})]})]}),d.length>0&&t.jsxs("section",{className:"leads-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸŒ More From Today"}),t.jsx("div",{className:"leads-scroll",children:d.map(u=>t.jsx(Ze,{article:u,size:"medium",onClick:()=>window.open(u.link,"_blank")},u.id))})]}),h.length>0&&t.jsxs("section",{className:"briefs-zone",children:[t.jsx("h2",{className:"zone-title",children:"ðŸ“‹ News Briefs"}),t.jsx("div",{className:"briefs-list",children:h.map(u=>t.jsxs("article",{className:"brief-item",onClick:()=>window.open(u.link,"_blank"),children:[t.jsx("h4",{className:"brief-title",children:u.title}),t.jsxs("div",{className:"brief-meta",children:[t.jsx("span",{className:"brief-source",children:u.source}),t.jsx("span",{className:"brief-time",children:u.time})]})]},u.id))})]})]})}const Ba="https://en.wikipedia.org/api/rest_v1/feed/onthisday/selected",Pa={fetchDailyFacts:async()=>{const e=new Date,n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),a=`${Ba}/${n}/${s}`;try{console.log(`[QuickFacts] Fetching from ${a}`);const i=await fetch(a);if(!i.ok)throw new Error("Wiki API Failed");const r=await i.json();return!r.selected||r.selected.length===0?[]:r.selected.sort(()=>.5-Math.random()).slice(0,5).map(c=>({text:c.text,year:c.year,pages:c.pages}))}catch(i){return console.warn("[QuickFacts] Fetch failed:",i),[{year:"1969",text:"The internet (ARPANET) sent its first message."},{year:"1990",text:"The first web page was published by Tim Berners-Lee."},{year:"2004",text:"Facebook was launched by Mark Zuckerberg."}]}}},on=["Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.","Octopuses have three hearts. Two pump blood to the gills, while one pumps it to the rest of the body.","Bananas are berries, but strawberries aren't.","The Eiffel Tower can be 15 cm taller during the summer due to thermal expansion.","A group of flamingos is called a 'flamboyance'.","Wombat poop is cube-shaped.","The shortest war in history lasted 38 minutes between Britain and Zanzibar in 1896.","Cleopatra lived closer in time to the Moon landing than to the construction of the Great Pyramid of Giza.","Sloths can hold their breath longer than dolphins (up to 40 minutes).","A cloud can weigh more than a million pounds.","The first computer bug was an actual moth trapped in a relay of the Harvard Mark II computer in 1947."];async function za(){try{const e=await Pa.fetchDailyFacts();if(e&&e.length>0){const n=e[Math.floor(Math.random()*e.length)];return{text:`On this day in ${n.year}: ${n.text}`,year:n.year,isDynamic:!0}}return null}catch(e){return console.warn("OnThisDay fetch failed:",e),null}}function Ha(e){const n=[],s=new Set(["the","and","for","with","that","this","from","dead","kills","says","india","world","chennai","tamil","nadu"]),a=[...e.world||[],...e.india||[],...e.tech||[]];if(a.length===0)return null;a.forEach(l=>{if(!l.title)return;l.title.replace(/[^\w\s]/gi,"").toLowerCase().split(/\s+/).forEach(d=>{d.length>3&&!s.has(d)&&n.push(d)})});const i={};n.forEach(l=>i[l]=(i[l]||0)+1);const o=Object.entries(i).sort((l,c)=>c[1]-l[1]).slice(0,3).map(l=>l[0]);return o.length===0?null:{type:"TRENDING",icon:"ðŸ”¥",text:`Trending now: #${o.join(", #")}`}}function Ua(e){if(!e||Object.keys(e).length===0)return null;const n=Object.keys(e)[0],s=e[n];if(!s||!s.current)return null;const a=s.current.temp,i=s.current.condition.toLowerCase();let r="";return a>35?r=`It's a scorcher today at ${a}Â°C. Stay hydrated!`:a<20?r=`Cooler vibes today at ${a}Â°C.`:i.includes("rain")?r="Rainy skies today. Don't forget your umbrella.":r=`Currently ${a}Â°C and ${i}. A pleasant day ahead?`,{type:"WEATHER INSIGHT",icon:"ðŸŒ¤ï¸",text:r}}function Wa(e,n,s=null){const a=[];if(s&&s.isDynamic){const o={type:"ON THIS DAY",icon:"ðŸ“…",text:s.text};a.push(o),a.push(o),a.push(o)}else a.push({type:"DID YOU KNOW?",icon:"ðŸ’¡",text:on[Math.floor(Math.random()*on.length)]});const i=Ha(e);i&&a.push(i);const r=Ua(n);return r&&a.push(r),a[Math.floor(Math.random()*a.length)]}const je=[{start:"06:55",id:"morning_weather",label:"Morning Weather",name:"Morning Weather",icon:"ðŸŒ¤ï¸",focus:"weather"},{start:"07:00",id:"morning_news",label:"Morning News",name:"Morning News",icon:"â˜•",focus:"news_top"},{start:"09:00",id:"market_brief",label:"Market Brief",name:"Market Brief",icon:"ðŸ“ˆ",focus:"market"},{start:"11:55",id:"midday_brief",label:"Midday Brief",name:"Midday Brief",icon:"â˜€ï¸",focus:"news_all"},{start:"14:30",id:"market_movers",label:"Market Movers",name:"Market Movers",icon:"ðŸ“‰",focus:"market"},{start:"16:20",id:"evening_news",label:"Evening News",name:"Evening News",icon:"ðŸŒ†",focus:"news_all"},{start:"16:45",id:"local_events",label:"Local Events",name:"Local Events",icon:"ðŸ“",focus:"local"},{start:"19:30",id:"night_wrap",label:"Night Wrap-Up",name:"Night Wrap-Up",icon:"ðŸŒ™",focus:"summary"},{start:"20:00",id:"urgent_only",label:"Urgent Alerts Only",name:"Urgent Alerts Only",icon:"âš ï¸",focus:"breaking"}];function ln(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=je[je.length-1];for(let a=0;a<je.length;a++){const i=je[a],[r,o]=i.start.split(":").map(Number),l=r*60+o;if(n>=l)s=i;else break}return s}function Ga(){const e=new Date,n=e.getHours()*60+e.getMinutes();let s=null;for(const i of je){const[r,o]=i.start.split(":").map(Number);if(r*60+o>n){s=i;break}}let a=new Date(e);if(s){const[i,r]=s.start.split(":").map(Number);a.setHours(i,r,0,0)}else{const[i,r]=je[0].start.split(":").map(Number);a.setDate(a.getDate()+1),a.setHours(i,r,0,0)}return Math.max(0,a.getTime()-e.getTime())}function ts(e,n={}){Notification.permission==="granted"&&(navigator.serviceWorker&&navigator.serviceWorker.ready?navigator.serviceWorker.ready.then(s=>{s.showNotification(e,{icon:"./vite.svg",badge:"./vite.svg",vibrate:[200,100,200],requireInteraction:!0,...n})}):new Notification(e,{icon:"./vite.svg",...n}))}const ns=x.createContext();function Ka({children:e}){const[n,s]=x.useState(()=>ln());return x.useEffect(()=>{let a;const i=()=>{const r=Ga()+2e3;console.log(`[Segment] Next switch in ${(r/6e4).toFixed(1)} min`),a=setTimeout(()=>{const o=ln();console.log(`[Segment] Switching to ${o.label}`),s(o),ts(`${o.icon} ${o.label}`,{body:"New content available. Tap to refresh.",tag:"segment-update",renotify:!0}),i()},r)};return i(),()=>clearTimeout(a)},[]),t.jsx(ns.Provider,{value:{currentSegment:n,SEGMENTS:je},children:e})}function Va(){return x.useContext(ns)}function ot(){const[e,n]=x.useState(!1),[s,a]=x.useState(!1),[i,r]=x.useState(!1),[o,l]=x.useState(typeof window<"u"?window.innerWidth:0);return x.useEffect(()=>{const c=()=>{const d=window.innerWidth;l(d);const h=d>=1024,u=d>=768&&d<1024;n(h),a(u),r(h),console.log(`[Layout] Width: ${d}px, Mode: ${h?"desktop":u?"tablet":"mobile"}`)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),{isDesktop:e,isTablet:s,isWebView:i,screenWidth:o}}const qa=({threshold:e=0,root:n=null,rootMargin:s="0px",freezeOnceVisible:a=!0}={})=>{const[i,r]=x.useState(null),o=i?.isIntersecting&&a,l=x.useRef(null),c=([d])=>{r(d)};return x.useEffect(()=>{const d=l.current;if(!!!window.IntersectionObserver||o||!d)return;const u={threshold:e,root:n,rootMargin:s},g=new IntersectionObserver(c,u);return g.observe(d),()=>g.disconnect()},[l,e,n,s,o]),[l,i]},Ya=({children:e,onVisible:n,isLoaded:s,placeholderHeight:a="200px"})=>{const[i,r]=qa({threshold:.1,rootMargin:"200px",freezeOnceVisible:!0});return x.useEffect(()=>{r?.isIntersecting&&n&&n()},[r,n]),s?t.jsx("div",{children:e}):t.jsx("div",{ref:i,style:{minHeight:a,display:"flex",alignItems:"center",justifyContent:"center",margin:"20px 0"},children:r?.isIntersecting?t.jsxs("div",{className:"loading-state",style:{opacity:.6},children:[t.jsx("div",{className:"loading-spinner",style:{border:"3px solid rgba(255,255,255,0.1)",borderTop:"3px solid var(--accent-primary)",width:"24px",height:"24px",borderRadius:"50%",animation:"spin 1s linear infinite"}}),t.jsx("span",{style:{marginLeft:"10px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Loading section..."}),t.jsx("style",{children:`
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    `})]}):null})};function Ja(e){return Ee({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"},child:[]}]})(e)}function Xa(e){return Ee({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function Qa(e){return Ee({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(e)}function Za(e){return Ee({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"},child:[]}]})(e)}function er(e){return Ee({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"},child:[]}]})(e)}function tr(e){return Ee({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H88c-13.255 0-24 10.745-24 24v8H24c-13.255 0-24 10.745-24 24v272c0 30.928 25.072 56 56 56h472c26.51 0 48-21.49 48-48V88c0-13.255-10.745-24-24-24zM56 400a8 8 0 0 1-8-8V144h16v248a8 8 0 0 1-8 8zm236-16H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm-208-96H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm0-96H140c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h360c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12z"},child:[]}]})(e)}function nr(e){return Ee({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(e)}const sr=({news:e=[],title:n="Global Headlines"})=>{if(!e||e.length===0)return null;const s=e.slice(0,10);return t.jsxs("div",{className:"card",style:{padding:"var(--spacing-md)",background:"var(--bg-card)",border:"1px solid var(--border-default)"},children:[t.jsx("h3",{style:{fontFamily:"'Playfair Display', serif",fontSize:"1.2rem",marginBottom:"var(--spacing-md)",paddingBottom:"var(--spacing-sm)",borderBottom:"2px solid var(--accent-primary)",color:"var(--text-primary)"},children:n}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:s.map((a,i)=>t.jsx("article",{style:{paddingBottom:"var(--spacing-sm)",borderBottom:"1px solid var(--border-default)"},children:t.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",display:"block"},children:[t.jsx("h4",{style:{fontSize:"0.95rem",fontWeight:"600",lineHeight:"1.4",marginBottom:"4px",color:"var(--text-primary)"},children:a.headline||a.title}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--text-muted)"},children:[t.jsx("span",{children:a.source}),t.jsx("span",{children:a.time||new Date(a.publishedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},i))}),t.jsx("div",{style:{marginTop:"var(--spacing-md)",textAlign:"center",fontSize:"0.8rem",color:"var(--accent-secondary)"},children:"Top Stories"})]})},ir=()=>{const{settings:e}=se(),{currentSegment:n}=Va(),[s,a]=x.useState(Notification.permission),[i,r]=x.useState(null),[o,l]=x.useState(null),{isWebView:c,isDesktop:d}=ot(),{weatherData:h,loading:u,refreshWeather:g}=at(),{newsData:m,loading:p,errors:w,breakingNews:b,refreshNews:j,loadSection:f,loadedSections:N}=it(),{sections:T,uiMode:_="timeline"}=e,[D,P]=x.useState([]);x.useEffect(()=>{if(!m.frontPage){P([]);return}if(e.customSortTopStories){let E=m.frontPage.filter(A=>!(Gs(A.id)||$n(A.id)>3));E.sort((A,S)=>(S.impactScore||0)-(A.impactScore||0));const y=10;if(E.length<y){const A=new Set(E.map(k=>k.id)),S=m.frontPage.filter(k=>!A.has(k.id));S.sort((k,F)=>(F.impactScore||0)-(k.impactScore||0));const C=y-E.length;E=[...E,...S.slice(0,C)]}P(E)}else P(m.frontPage)},[m.frontPage,e.customSortTopStories]),x.useEffect(()=>{g(),j()},[n.id,j,g]),x.useEffect(()=>{za().then(E=>{E&&l(E)})},[]),x.useEffect(()=>{const E=m&&Object.keys(m).length>0,y=h&&Object.keys(h).length>0;(E||y||o)&&r(Wa(m,h,o))},[p,u,m,h,o]);const[I,B]=x.useState(!1);x.useEffect(()=>{const E=()=>{window.scrollY>400?B(!0):B(!1)};return window.addEventListener("scroll",E),()=>window.removeEventListener("scroll",E)},[]);const $=()=>{window.scrollTo({top:0,behavior:"smooth"})};x.useEffect(()=>{let E=0,y=!1;const A=k=>{window.scrollY===0&&(E=k.touches[0].clientY,y=!0)},S=k=>{y&&k.touches[0].clientY},C=k=>{if(!y)return;k.changedTouches[0].clientY-E>150&&window.scrollY===0&&(j(),g()),y=!1};return d||(document.addEventListener("touchstart",A),document.addEventListener("touchmove",S),document.addEventListener("touchend",C)),()=>{document.removeEventListener("touchstart",A),document.removeEventListener("touchmove",S),document.removeEventListener("touchend",C)}},[j,g,d]);const M=u&&!h||p&&Object.keys(m).length===0,v=M?1:3,L=_==="timeline",O=_==="newspaper",R=n.id==="urgent_only",H=[{id:"world-news",icon:"ðŸŒ",label:"World"},T.india?.enabled&&{id:"india-news",icon:"ðŸ‡®ðŸ‡³",label:"India"},T.chennai?.enabled&&{id:"chennai-news",icon:"ðŸ›ï¸",label:"Tamil Nadu"},T.local?.enabled&&{id:"local-news",icon:"ðŸ“",label:"Muscat"}].filter(Boolean),W=t.jsxs("div",{className:"header__actions",children:[t.jsx(Re,{to:"/refresh",className:"header__action-btn",children:"ðŸ”„"}),t.jsx(Re,{to:"/settings",className:"header__action-btn",children:"âš™ï¸"})]});return t.jsxs("div",{className:`page-container mode-${_} ${c?"page-container--desktop":""}`,children:[L?t.jsx(va,{title:n.id==="market_brief"?"":n.label,icon:n.icon,actions:W,loadingPhase:v}):t.jsx(_e,{title:n.label,icon:n.icon,actions:W,loadingPhase:v}),t.jsxs("main",{className:`main-content ${c?"main-content--desktop":""}`,children:[c&&t.jsxs("div",{className:"desktop-sidebar",children:[t.jsx(sn,{}),t.jsx(sr,{news:m.world&&m.world.length>0?m.world:m.chennai&&m.chennai.length>0?m.chennai:m.frontPage,title:"Global Headlines"})]}),t.jsxs("div",{className:"content-wrapper",children:[M&&t.jsxs("div",{className:"loading",style:{padding:"40px"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Updates..."})]}),!L&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"topline",children:[t.jsxs("div",{className:"topline__label",style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:i?.icon||"ðŸ“°"}),t.jsx("span",{children:i?.type||"TOPLINE"})]}),t.jsx("div",{className:"topline__text",children:i?.text||Oa(n)})]}),t.jsx(wa,{items:b})]}),!c&&t.jsx(sn,{}),O?t.jsx($a,{newsData:m,breakingNews:b,settings:e.newspaper}):t.jsxs("div",{className:"news-sections news-sections--grid",children:[(!R||b.length===0)&&t.jsxs(t.Fragment,{children:[D.length>0?t.jsx(ue,{id:"top-stories",title:"Top Stories",icon:"â­",colorClass:"news-section__title--world",news:D,maxDisplay:10}):e.customSortTopStories&&m.frontPage?.length>0&&t.jsxs("div",{className:"empty-state",style:{padding:"20px",marginBottom:"20px",background:"var(--bg-card)",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:"âœ…"}),t.jsx("p",{style:{color:"var(--text-muted)"},children:"You're all caught up with top stories!"}),t.jsx("button",{onClick:()=>j(),className:"btn btn--secondary",style:{marginTop:"10px",fontSize:"0.8rem",padding:"6px 12px"},children:"Check for new updates"})]}),t.jsx(ue,{id:"world-news",title:"Global Updates",icon:"ðŸŒ",colorClass:"news-section__title--world",news:m.world,maxDisplay:T.world?.count||5}),T.india?.enabled&&t.jsx(ue,{id:"india-news",title:L?"India":"India News",icon:"ðŸ‡®ðŸ‡³",colorClass:"news-section__title--india",news:m.india,maxDisplay:T.india.count||5,error:w.india}),T.chennai?.enabled&&t.jsx(ue,{id:"chennai-news",title:"Tamil Nadu",icon:"ðŸ›ï¸",colorClass:"news-section__title--chennai",news:m.chennai,maxDisplay:T.chennai.count||5,error:w.chennai}),T.trichy?.enabled&&t.jsx(ue,{id:"trichy-news",title:"Trichy",icon:"ðŸ›ï¸",colorClass:"news-section__title--trichy",news:m.trichy,maxDisplay:T.trichy.count||5,error:w.trichy}),T.local?.enabled&&t.jsx(Ya,{id:"local-news",onVisible:()=>f("local"),isLoaded:N.includes("local"),children:t.jsx(ue,{id:"local-news",title:"Local â€” Muscat",icon:"ðŸ“",colorClass:"news-section__title--local",news:m.local,maxDisplay:T.local.count||5,error:w.local})})]}),R&&b.length===0&&t.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-muted)"},children:[t.jsx("h3",{children:"Urgent Alerts Mode"}),t.jsx("p",{children:"Monitoring for critical updates..."})]})]}),e.debugLogs&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"var(--spacing-md)",padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:"var(--radius-sm)",fontSize:"0.7rem",color:"var(--text-muted)",flexWrap:"wrap"},children:[t.jsxs("span",{title:"Segment",children:[n.icon," ",n.label]}),t.jsx("span",{title:"Notifications",children:s==="granted"?"ðŸ””":"ðŸ”•"}),t.jsxs("span",{title:"UI Mode",children:["ðŸ“± ",_]}),t.jsx("span",{title:"Strict Mode",children:e.strictFreshness?"ðŸ›¡ï¸":"ðŸ”“"}),t.jsx(Re,{to:"/settings",onClick:()=>{},style:{marginLeft:"auto",color:"var(--accent-primary)",fontSize:"0.7rem"},children:"Debug â†’"})]})]})]}),t.jsx(kt,{sections:H}),t.jsx("button",{onClick:$,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:I?1:0,pointerEvents:I?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},className:"back-to-top",children:"â†‘"})]})};function ar(e="ua_watchlist"){const[n,s]=x.useState(()=>{try{return JSON.parse(localStorage.getItem(e))||[]}catch{return[]}});return{watchlist:n,toggleWatchlist:r=>{let o;n.includes(r)?o=n.filter(l=>l!==r):o=[...n,r],s(o),localStorage.setItem(e,JSON.stringify(o))},isWatched:r=>n.includes(r)}}const rr=(e,n)=>{const s=new Date,a=s.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",i=new Date(s.getTime()+3600*1e3).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",r=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${e}
DESCRIPTION:${n}
DTSTART:${a}
DTEND:${i}
END:VEVENT
END:VCALENDAR`,o=new Blob([r],{type:"text/calendar"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`${e.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.ics`,c.click(),URL.revokeObjectURL(l)},ss={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},xt=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],ke=Object.keys(ss).filter(e=>e.length>2).join("|"),or=/\b(\d{4})-(\d{1,2})-(\d{1,2})\b/,lr=/\b(\d{1,2})[/-](\d{1,2})[/-](\d{4})\b/,cr=new RegExp(`\\b(${ke})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s-]+(\\d{4}))?\\b`,"i"),dr=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${ke})(?:[-\\s,]+(\\d{4}))?\\b`,"i"),ur=new RegExp(`\\b(${ke})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(${ke})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),hr=new RegExp(`\\b(${ke})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),mr=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-)\\s*(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${ke})\\b`,"i"),pr=/\bnext\s+(\d+)\s+(day|week)s?\b/,gr=new RegExp(`\\b(?:ends?|last date|deadline|valid (?:till|until)|expires?|before)\\s+(?:on\\s+)?(${ke})\\s+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s]+(\\d{4}))?\\b`,"i");function Ne(e){return ss[e.toLowerCase().slice(0,3)]??null}function fe(e,n,s){const a=new Date(s.getFullYear(),e,n);return a<s&&s-a>30*864e5&&a.setFullYear(a.getFullYear()+1),a}function fr(e,n){const s=e.match(or);if(s)return{start:new Date(+s[1],+s[2]-1,+s[3]),end:null,type:"iso"};const a=e.match(lr);return a?{start:new Date(+a[3],+a[2]-1,+a[1]),end:null,type:"numeric"}:null}function yr(e,n){const s=e.match(cr);if(s){const i=Ne(s[1]),r=+s[2],o=s[3]?+s[3]:null;return{start:o?new Date(o,i,r):fe(i,r,n),end:null,type:"named"}}const a=e.match(dr);if(a){const i=Ne(a[2]),r=+a[1],o=a[3]?+a[3]:null;return{start:o?new Date(o,i,r):fe(i,r,n),end:null,type:"named"}}return null}function xr(e,n){const s=e.match(ur);if(s)return{start:fe(Ne(s[1]),+s[2],n),end:fe(Ne(s[3]),+s[4],n),type:"range"};const a=e.match(hr);if(a){const r=Ne(a[1]);return{start:fe(r,+a[2],n),end:fe(r,+a[3],n),type:"range"}}const i=e.match(mr);if(i){const r=Ne(i[3]);return{start:fe(r,+i[1],n),end:fe(r,+i[2],n),type:"range"}}return null}function wr(e,n){const s=e.toLowerCase();if(!/tomorrow|today|next|this|week|weekend/.test(s))return null;if(/\btomorrow\b/.test(s)){const i=new Date(n);return i.setDate(i.getDate()+1),{start:i,end:null,type:"relative"}}if(/\btoday\b/.test(s))return{start:new Date(n),end:null,type:"relative"};const a=s.match(pr);if(a){const i=+a[1],r=a[2]==="week"?7:1,o=new Date(n);return o.setDate(o.getDate()+i*r),{start:new Date(n),end:o,type:"relative"}}if(/\bnext week\b/.test(s)){const i=new Date(n);i.setDate(i.getDate()+(7-i.getDay()+1));const r=new Date(i);return r.setDate(r.getDate()+6),{start:i,end:r,type:"relative"}}for(let i=0;i<xt.length;i++){if(!s.includes(xt[i]))continue;if(new RegExp(`\\b(?:this|next|coming)\\s+${xt[i]}\\b`,"i").test(e)){const o=new Date(n);let l=(i-o.getDay()+7)%7;return l===0&&(l=7),o.setDate(o.getDate()+l),{start:o,end:null,type:"relative"}}}if(/\bthis weekend\b/.test(s)){const i=new Date(n);i.setDate(i.getDate()+(6-i.getDay()+7)%7);const r=new Date(i);return r.setDate(r.getDate()+1),{start:i,end:r,type:"relative"}}return null}function vr(e,n){const s=e.match(gr);if(s){const a=Ne(s[1]),i=+s[2],r=s[3]?+s[3]:null,o=r?new Date(r,a,i):fe(a,i,n);return{start:new Date(n),end:o,type:"deadline"}}return null}function Ct(e,n){if(!e)return null;const s=n?new Date(n):new Date;return isNaN(s.getTime())?null:fr(e)||xr(e,s)||vr(e,s)||yr(e,s)||wr(e,s)}function br(e,n=14){if(!e?.start)return[];const s=[],a=new Date(e.start);a.setHours(0,0,0,0);const i=e.end?new Date(e.end):new Date(a);i.setHours(0,0,0,0);let r=new Date(a);for(;r<=i&&s.length<n;)s.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return s}const me="upAhead_planner",Je="upAhead_blacklist",Xe="/api",re={sync:async()=>{try{const e=await fetch(`${Xe}/blacklist`);if(e.ok){const s=await e.json(),a=re.getBlacklist(),i=new Set([...a,...s]);localStorage.setItem(Je,JSON.stringify([...i]))}const n=await fetch(`${Xe}/user_plan`);if(n.ok){const s=await n.json(),a=localStorage.getItem(me),r={...a?JSON.parse(a):{},...s};localStorage.setItem(me,JSON.stringify(r))}console.log("[PlannerStorage] Synced with server")}catch(e){console.warn("[PlannerStorage] Sync failed",e)}},getUpcomingDays:(e=14)=>{try{const n=localStorage.getItem(me);if(!n)return[];const s=JSON.parse(n),a=new Date().toISOString().split("T")[0];return Object.entries(s).filter(([r])=>r>=a).sort((r,o)=>r[0].localeCompare(o[0])).slice(0,e).map(([r,o])=>({date:r,items:o}))}catch(n){return console.error("Failed to read planner storage",n),[]}},addItem:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};return a[e]||(a[e]=[]),a[e].some(i=>i.id===n.id)?!1:(a[e].push(n),localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a),!0)}catch(s){return console.error("Failed to add item to planner",s),!1}},removeItem:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};return a[e]?(a[e]=a[e].filter(i=>i.id!==n),a[e].length===0&&delete a[e],localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a),!0):!1}catch(s){return console.error("Failed to remove item",s),!1}},merge:(e,n)=>{try{const s=localStorage.getItem(me),a=s?JSON.parse(s):{};let i=!1;e.forEach(r=>{a[r]||(a[r]=[]);const o=new Set(a[r].map(l=>l.id));n.forEach(l=>{o.has(l.id)||(a[r].push(l),i=!0)})}),i&&(localStorage.setItem(me,JSON.stringify(a)),re.savePlanToApi(a))}catch(s){console.error("Merge failed",s)}},savePlanToApi:async e=>{try{await fetch(`${Xe}/user_plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save plan error:",n)}},addToBlacklist:e=>{try{const n=JSON.parse(localStorage.getItem(Je)||"[]");n.includes(e)||(n.push(e),localStorage.setItem(Je,JSON.stringify(n)),re.saveBlacklistToApi(n))}catch(n){console.error("Failed to blacklist",n)}},getBlacklist:()=>{try{return new Set(JSON.parse(localStorage.getItem(Je)||"[]"))}catch{return new Set}},saveBlacklistToApi:async e=>{try{await fetch(`${Xe}/blacklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.warn("API save blacklist error:",n)}}},is="upAhead_cache";function Sr(){try{const e=localStorage.getItem(is);if(e){const n=JSON.parse(e);return Date.now()-new Date(n.lastUpdated||0).getTime()>480*60*1e3&&console.log("[UpAheadService] Cache is older than 8 hours."),n}}catch(e){console.warn("Cache read error",e)}return null}function jr(e){try{localStorage.setItem(is,JSON.stringify(e))}catch(n){console.warn("Cache write error",n)}}const cn=new Map;function Nr(e,n){let s=cn.get(n);if(!s){const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=new RegExp(`\\b${a}\\b`,"i"),cn.set(n,s)}return s.test(e)}function _r(e){let n=0;if(!e)return"0";for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n.toString()}function kr(e,n){const s=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");return _r(`${s}-${n}`)}function Be(e,n){const s=e.toLowerCase(),a=n.toLowerCase();return n.includes(" ")?s.includes(a):Nr(s,a)}const Cr={movies:["Tamil movie release this week","new movie release OTT","BookMyShow Chennai movies","upcoming movies Kollywood","movie tickets showtimes"],events:["Chennai events this week","LiveChennai events","concert tickets Chennai","standup comedy show Chennai","exhibition workshops Chennai","things to do Chennai weekend","Muscat events this week","Muscat concerts exhibitions","theatre shows Chennai this week","art exhibition Chennai","food festival Chennai","cultural event Chennai","music sabha Chennai","Muscat Royal Opera House events"],festivals:["Maha Shivaratri 2025 date","upcoming festivals Tamil Nadu 2025","bank holidays India upcoming","public holidays Tamil Nadu","religious festivals this month India","Oman festivals holidays"],alerts:["TANGEDCO power cut Chennai tomorrow","TNEB power shutdown schedule","Chennai traffic advisory today","Chennai metro maintenance","water supply disruption Chennai","road closure Chennai"],weather_alerts:["IMD Chennai weather warning","Tamil Nadu heavy rain alert","cyclone warning Chennai","heat wave advisory Tamil Nadu","Oman weather warning Muscat"],sports:["IPL 2026 schedule matches","cricket match Chennai CSK","ISL football match schedule","Pro Kabaddi schedule","sports events Chennai this week"],shopping:["Chennai sale offers discount today","exhibition sale Chennai","Pongal sale Tamil Nadu","Diwali offers Chennai","end of season sale Chennai mall","Muscat shopping festival offers"],airlines:["Oman Air flight offers","Indigo Airlines offers","Salam Air ticket offers","Air India sale","flight ticket offers India"],civic:["VIP visit Chennai road closure","minister visit Tamil Nadu traffic","protest bandh Chennai tomorrow","Chennai corporation announcement","Muscat road closure traffic"]},dn={movies:["https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/bollywood/rssfeed.xml"],sports:["https://www.espn.com/espn/rss/news"],festivals:["https://www.timeanddate.com/holidays/india/feed"],events:["https://www.thehindu.com/news/cities/chennai/feeder/default.rss"]};async function Er(){try{const s=`${"./".endsWith("/")?"./":".//"}data/up_ahead.json`,a=await fetch(s);if(!a.ok)return console.warn(`[UpAheadService] Static fetch failed: ${a.status}`),null;const i=await a.json();return i.error?(console.warn(`[UpAheadService] Static data has error: ${i.error}`),null):i}catch(e){return console.error("[UpAheadService] Static fetch exception:",e),null}}function un(e,n){if(!e)return n;if(!n)return e;const s={...e},a=new Map;return e.timeline&&e.timeline.forEach(i=>{a.set(i.date,{...i,items:[...i.items||[]]})}),n.timeline&&n.timeline.forEach(i=>{if(!a.has(i.date))a.set(i.date,i);else{const r=a.get(i.date),o=new Set(r.items.map(l=>l.id));i.items.forEach(l=>{o.has(l.id)||(r.items.push(l),o.add(l.id))})}}),s.timeline=Array.from(a.values()).sort((i,r)=>i.date.localeCompare(r.date)),n.sections&&(s.sections||(s.sections={}),Object.keys(n.sections).forEach(i=>{const r=s.sections[i]||[],o=n.sections[i]||[],l=new Set(r.map(d=>d.title)),c=[...r];o.forEach(d=>{l.has(d.title)||(c.push(d),l.add(d.title))}),s.sections[i]=c})),s.weekly_plan=rs(s.timeline,new Set),s.lastUpdated=n.lastUpdated||e.lastUpdated,s}async function Tr(e){const n=Date.now();console.log("[UpAheadService] Fetching LIVE data with settings:",e);const s=e?.categories||{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0},a=e?.locations&&e.locations.length>0?e.locations:["Chennai","India"],i=e?.keywords||oe.upAhead.keywords;let r=[];const o=[],l=p=>{const w=encodeURIComponent(p);o.push({url:`https://news.google.com/rss/search?q=${w}+when:7d&hl=en-IN&gl=IN&ceid=IN:en`,type:"search",originalQuery:p})};for(const[p,w]of Object.entries(s)){if(!w)continue;dn[p]&&dn[p].forEach(j=>{o.push({url:j,type:"static",category:p})}),(Cr[p]||[]).forEach(j=>{p==="events"||p==="alerts"||p==="movies"?a.forEach(f=>{f.toLowerCase()==="india"&&(p==="alerts"||p==="events")||l(`${j} ${f}`)}):p==="shopping"||p==="airlines"?a.forEach(f=>{l(`${j} ${f}`)}):l(`${j}`)})}const c=[...new Map(o.map(p=>[p.url,p])).values()];console.log(`[UpAheadService] Prepared ${c.length} feeds to fetch.`);const d=c.map(async p=>{try{const{items:w}=await Gn.fetchViaProxy(p.url);return w.map(b=>Ir(b,p,i))}catch(w){return console.warn(`[UpAheadService] Failed to fetch ${p.url}:`,w.message),[]}}),h=await Promise.allSettled(d);for(let p=0;p<h.length;p++)h[p].status==="fulfilled"?r.push(...h[p].value):console.warn("[UpAheadService] A feed failed to load:",h[p].reason);const u=Rr(r,e);try{for(const p of r)if(p.extractedDate){const w=Ct(`${p.title} ${p.description||""}`,p.pubDate);if(w){const b=br(w);b.length>0&&re.merge(b,[{id:p.id,title:p.title,category:p.category,link:p.link}])}}}catch(p){console.warn("[UpAhead] Planner storage write failed",p)}const g=Date.now()-n,m=u?.timeline?.reduce((p,w)=>p+(w.items?.length||0),0)||0;return he.success("upAhead",`LIVE: ${m} items from ${c.length} feeds`,{durationMs:g}),u}function St(e){if(!e)return"";let n=e.toString();const s={"&nbsp;":" ","&amp;":"&","&quot;":'"',"&#39;":"'","&lt;":"<","&gt;":">"};return n=n.replace(/&[a-z0-9#]+;/gi,a=>s[a]||a),n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,""),n=n.replace(/<style[^>]*>([\S\s]*?)<\/style>/gmi,""),n=n.replace(/<\/?[^>]+(>|$)/g,""),n.trim()}function Ir(e,n,s=null){const a=St(e.title||""),i=e.description||"",r=St(i),o=`${a} ${r}`;let l=e.pubDate?new Date(e.pubDate):null;l&&isNaN(l.getTime())&&(l=null);let c=n.category;(!c||n.type==="search")&&(c=Mr(o,s));let d=null;const h=Ct(o,l);h?.start?c==="shopping"&&h.end?d=h.end:d=h.start:d=as(o,l);let u=[],g=!1;/ott|releases|week/i.test(a)&&/\d+ new/i.test(a)&&(g=!0),g&&c==="movies"&&(u=Ar(i,l));const m=d?d.toISOString().slice(0,10):l?l.toISOString().slice(0,10):"nodate",p=kr(a,m);return{id:e.guid||e.link||a,canonicalId:p,title:a,link:e.link,description:r,pubDate:l,extractedDate:d,category:c,rawSource:n.originalQuery||"feed",isRoundup:g,subItems:u}}function Ar(e,n){const s=[],a=e.split(/<br\s*\/?>|\n|<\/li>|<\/p>|â€¢/i),i=["netflix","prime","prime video","hotstar","sony liv","zee5","jiocinema","aha","sunnxt","hulu","disney"],r=new RegExp(`\\b(${i.sort((o,l)=>l.length-o.length).join("|")})\\b`,"i");return a.forEach(o=>{const l=St(o).trim();if(l.length<5)return;const c=r.test(l),d=as(l,n);if(c||d){let h=l.replace(/^\d+\.\s*/,"").replace(/^[-\u2013\u2014]\s*/,"").replace(/\(.*\)/g,"").trim();if(h.length<3)return;const u=l.match(r),g=u?u[0]:"OTT";s.push({title:h,date:d,originalText:l,platform:g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()})}}),s}function Mr(e,n=null){const s=e.toLowerCase(),a=n||oe.upAhead.keywords,i=r=>r&&r.some(o=>Be(s,o));return s.includes("arrest")||s.includes("held for")||s.includes("police")||s.includes("seized")||s.includes("murder")||s.includes("crime")||s.includes("jail")||s.includes("court")||s.includes("bail")||s.includes("clinic")&&s.includes("unregistered")?"general":i(a.weather_alerts)?"weather_alerts":i(a.alerts)?"alerts":i(a.movies)?(a.movies_negative||[]).some(o=>Be(s,o))?"general":"movies":i(a.sports)?(a.sports_negative||[]).some(o=>Be(s,o))?"general":"sports":i(a.airlines)?"airlines":i(a.shopping)?"shopping":i(a.festivals)?"festivals":i(a.civic)?"civic":i(a.events)?"events":"general"}function as(e,n){return Ct(e,n)?.start||null}function Rr(e,n){const s=new Date;s.setHours(0,0,0,0);const a=new Map,i={movies:[],festivals:[],alerts:[],events:[],sports:[],shopping:[],civic:[],weather_alerts:[],airlines:[]},r=new Set,l=(n?.hideOlderThanHours||336)*60*60*1e3,c={weather_alerts:6,alerts:12,festivals:336},d=n?.keywords||n?.upAhead?.keywords||oe.upAhead.keywords,h=f=>{let N=d.negative&&d.negative.length>0?d.negative:oe.upAhead.keywords.negative;const T=`${f}_negative`,_=d[T]&&d[T].length>0?d[T]:oe.upAhead.keywords[T]||[];return[...new Set([...N,..._])]},u=n?.signals||oe.upAhead.signals,g={};["movies","events","festivals","alerts","sports","shopping","civic","weather_alerts","airlines"].forEach(f=>{g[f]=d[f]&&d[f].length>0?d[f]:oe.upAhead.keywords[f]||[]});const p=(n?.locations||n?.upAhead?.locations||["Chennai","Muscat","Trichy"]).map(f=>f.toLowerCase());e.forEach(f=>{if(r.has(f.id)||(r.add(f.id),!f.pubDate||isNaN(f.pubDate.getTime())))return;const N=Date.now()-f.pubDate.getTime();let T=l;if(c[f.category]){const k=c[f.category]*60*60*1e3;T=Math.min(l,k)}const _=["movies","events","sports","shopping","civic","festivals","airlines"].includes(f.category),D=f.extractedDate&&f.extractedDate>=s;if(!_&&!D&&N>T)return;const P=(f.title+" "+f.description).toLowerCase(),I=/(?:â€¢|-|published)\s*(\d+)\s*(mo|month|months|w|week|weeks|y|year|years)\s*(?:ago)?/i,B=P.match(I);if(B){const k=parseInt(B[1]),F=B[2].toLowerCase();if(F.startsWith("mo")||F.startsWith("y")||F.startsWith("w")&&k>=1)return}const $=/ott|releases|week|weekend/i.test(P)&&/\d+ new/i.test(P);let M=0;const v=n?.ranking?.[f.category]||n?.upAhead?.ranking?.[f.category]||{},L=v.positiveMultiplier||1,O=v.negativeMultiplier||1,R=v.filterThreshold||0,H=g[f.category]||[],W=h(f.category),E=H.reduce((k,F)=>Be(P,F.toLowerCase())?k+1:k,0),y=W.reduce((k,F)=>Be(P,F.toLowerCase())?k+1:k,0);M=E*L-y*O;const A=u.reduce((k,F)=>P.includes(F)?k+1:k,0);if(M+=A*.5,["movies","events","shopping","airlines","sports","festivals"].includes(f.category)&&M<R||!$&&y>0&&M<=0||_&&!f.extractedDate&&!f.isRoundup&&E===0&&A===0||(f.category==="alerts"||f.category==="civic")&&!p.some(F=>P.includes(F)))return;if(f._forwardScore=M,f.category&&i[f.category]){if((f.category==="movies"||f.category==="events"||f.category==="festivals")&&!f.extractedDate&&!f.isRoundup||_&&!f.extractedDate&&!f.isRoundup&&M<=0)return;if(f.category==="festivals"&&f.extractedDate){if((f.extractedDate.getTime()-s.getTime())/(1e3*3600*24)<-3)return}else if(_&&f.extractedDate&&f.extractedDate<s)return;let k=null;!f.extractedDate&&["shopping","alerts","weather_alerts","civic"].includes(f.category)&&(k=f.pubDate?f.pubDate.toDateString():null);const F={title:f.title,link:f.link,releaseDate:f.extractedDate?f.extractedDate.toDateString():k,date:f.extractedDate?f.extractedDate.toDateString():k,text:f.title,severity:"medium",language:"Unknown",isRoundup:f.isRoundup,subItemsCount:f.subItems?f.subItems.length:0};i[f.category].push(F)}let C=f.extractedDate;if(!C&&(f.category==="alerts"||f.category==="weather_alerts")){const k=f.category==="weather_alerts"?12:24;if(f.pubDate&&Date.now()-f.pubDate.getTime()<k*60*60*1e3)C=s;else return}if(!C&&f.isRoundup&&(C=s),!C&&M>0&&_&&["shopping","airlines","alerts","weather_alerts","civic"].includes(f.category)&&f.pubDate&&Date.now()-f.pubDate.getTime()<2880*60*1e3&&(C=s),C&&C>=s){const k=C.toISOString().split("T")[0];a.has(k)||a.set(k,{date:k,dayLabel:Dr(C),items:[]});const F={id:f.id,type:Lr(f.category),title:f.title,subtitle:f.isRoundup?`${f.subItems?.length||"Multiple"} ITEMS`:f.category.toUpperCase(),description:f.description,tags:[f.category],link:f.link,isRoundup:f.isRoundup,subItems:f.subItems,_forwardScore:f._forwardScore||0};a.get(k).items.push(F)}});const w=Array.from(a.values()).sort((f,N)=>f.date.localeCompare(N.date));w.forEach(f=>{f.items.sort((N,T)=>(T._forwardScore||0)-(N._forwardScore||0)),f.items.forEach(N=>delete N._forwardScore)}),Object.keys(i).forEach(f=>{i[f].sort((N,T)=>N.date&&T.date?new Date(N.date)-new Date(T.date):0),i[f]=i[f].slice(0,10)});const b=re.getBlacklist?re.getBlacklist():new Set,j=rs(w,b);return{timeline:w,sections:i,weekly_plan:j,lastUpdated:new Date().toISOString()}}function Dr(e){const n=new Date;n.setHours(0,0,0,0);const s=new Date(n);s.setDate(s.getDate()+1);const a=new Date(e);return a.setHours(0,0,0,0),a.getTime()===n.getTime()?"Today":a.getTime()===s.getTime()?"Tomorrow":a.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}function Lr(e){return{movies:"movie",events:"event",festivals:"festival",alerts:"alert",sports:"sport",shopping:"shopping",civic:"civic",weather_alerts:"weather_alert",airlines:"airline"}[e]||"event"}function rs(e,n=new Set){const s=[],a=new Date,i=r=>{const o=["th","st","nd","rd"],l=r%100;return r+(o[(l-20)%10]||o[l]||o[0])};for(let r=0;r<7;r++){const o=new Date(a);o.setDate(a.getDate()+r);const l=o.toISOString().split("T")[0],c=o.toLocaleDateString("en-US",{weekday:"long"}),d=o.toLocaleDateString("en-US",{month:"short"}),h=o.getDate(),u=`${i(h)} ${d}`,g=e.find(p=>p.date===l);let m=[];g&&g.items.length>0&&(m=g.items.filter(w=>!(w.type==="festival"||n.has(w.id))).slice(0,10).map(w=>({id:w.id,title:w.title,type:w.type,icon:Or(w.type),link:w.link,description:w.description,isOffer:w.type==="shopping"||w.type==="airline"}))),s.push({day:c,date:u,items:m})}return s}function Or(e){return{movie:"ðŸŽ¬",event:"ðŸŽ­",festival:"ðŸŽŠ",alert:"âš ï¸",sport:"âš½",shopping:"ðŸ›’",civic:"ðŸ›ï¸",entertainment:"ðŸŽ¶",weather_alert:"ðŸŒªï¸",airline:"âœˆï¸",general:"ðŸ“…"}[e]||"ðŸ“…"}function Fr(){const{settings:e}=se(),[n,s]=x.useState(null),[a,i]=x.useState(!0),[r,o]=x.useState(!1),[l,c]=x.useState(0),[d,h]=x.useState("plan"),[,u]=x.useState(re.getBlacklist?re.getBlacklist():new Set),{toggleWatchlist:g,isWatched:m}=ar(),p=x.useCallback(async($=!1)=>{if($?(o(!0),c(1)):(i(!0),c(0)),!$){const M=Sr();M&&(s(M),i(!1),c(1))}try{const M=await Er();M&&(s(v=>un(v,M)),$||c(2),i(!1))}catch(M){console.warn("Static fetch failed",M)}o(!0);try{const M=e.upAhead||{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},locations:["Chennai"]},v=await Tr(M);s(L=>{const O=un(L,v);return jr(O),O}),c(3)}catch(M){console.error("Failed to load Live Up Ahead data",M)}finally{o(!1),i(!1)}},[e.upAhead]);x.useEffect(()=>{p(!1)},[p]);const w=$=>{$&&re.addToBlacklist&&(re.addToBlacklist($),u(re.getBlacklist()),p(!1))},b=($,M)=>{re.addItem(M,{id:$.id,title:$.title,category:$.tags?.[0]||"event",link:$.link,description:$.description}),alert("Added to Plan!")},j=$=>{if(!$)return"Coming Soon";const M=new Date($);if(isNaN(M.getTime()))return $;const v=M.toLocaleDateString("en-US",{weekday:"short"}),L=M.getDate().toString().padStart(2,"0"),O=M.toLocaleDateString("en-US",{month:"short"});return`${v}, ${L} ${O}`},f=({items:$,colorClass:M,emptyMessage:v,isOffer:L=!1})=>!$||$.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:v})}):t.jsx("div",{className:"ua-wk-card",style:{border:"none",background:"transparent",padding:0},children:t.jsx("ul",{className:"ua-wk-list",children:$.map((O,R)=>{const H=j(O.date||O.releaseDate);return t.jsxs("li",{className:"ua-wk-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px",background:"var(--bg-secondary)",padding:"12px",borderRadius:"12px",marginBottom:"8px"},children:[t.jsxs("a",{href:O.link,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",flex:1,overflow:"hidden",display:"flex",alignItems:"center",gap:"8px"},children:[L&&t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ·ï¸"}),t.jsx("span",{className:"ua-wk-text",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.95rem",fontWeight:500},children:O.title})]}),t.jsx("span",{className:`ua-wk-date ${M}`,style:{whiteSpace:"nowrap",flexShrink:0,fontSize:"0.8rem",fontWeight:600},children:H})]},R)})})});if(a&&!n)return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Scanning horizon..."})]})]});if(!n||!n.timeline||n.timeline.length===0)return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l}),t.jsxs("div",{className:"empty-state",children:[t.jsx("span",{style:{fontSize:"3rem"},children:"ðŸ”­"}),t.jsx("h3",{children:"Nothing on the radar"}),t.jsx("p",{children:"No upcoming events found."}),t.jsx("button",{onClick:()=>p(!0),className:"btn btn--primary",style:{marginTop:"1rem"},children:"Retry Scan"}),t.jsx("div",{style:{marginTop:"0.75rem"},children:t.jsxs("small",{children:["Try adding more locations or categories in ",t.jsx(Re,{to:"/settings",style:{color:"var(--accent-primary)"},children:"Settings"}),"."]})})]})]});const N=n.sections?.weather_alerts||[],T=n.sections?.alerts||[],_=n.sections?.civic||[],D=[...N,...T,..._],P=N[0]||T[0]||null,I=N.length>0?"ðŸŒªï¸":"âš ï¸",B=N.length>0?"Weather Warning":"Worth Knowing";return t.jsxs("div",{className:"page-container up-ahead-page",children:[t.jsx(_e,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:l,rightElement:r?t.jsx("div",{className:"scanning-indicator",style:{fontSize:"0.7rem",color:"var(--accent-primary)"},children:"Scanning..."}):null}),t.jsx("div",{style:{textAlign:"center",fontSize:"0.7rem",color:"var(--text-muted)",padding:"6px",background:"var(--bg-secondary)",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:r?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading__spinner",style:{width:"12px",height:"12px",borderWidth:"2px"}}),t.jsx("span",{children:"Scanning horizon..."})]}):t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:["Live Feed â€¢ ",e.upAhead?.locations?.join(", ")||"All Locations"]}),t.jsx("button",{onClick:()=>p(!0),style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.8rem"},children:"ðŸ”„"})]})}),P&&t.jsxs("div",{className:`ua-alert-banner ${N.length>0?"weather-alert":""}`,children:[t.jsx("span",{className:"ua-alert-icon",children:I}),t.jsxs("div",{className:"ua-alert-content",children:[t.jsx("h4",{children:B}),t.jsx("p",{children:P.text})]})]}),t.jsxs("div",{className:"ua-view-toggle scrollable-tabs",children:[t.jsx("button",{className:`ua-toggle-btn ${d==="plan"?"active":""}`,onClick:()=>h("plan"),children:"Plan My Week"}),t.jsx("button",{className:`ua-toggle-btn ${d==="offers"?"active":""}`,onClick:()=>h("offers"),children:"Offers"}),t.jsx("button",{className:`ua-toggle-btn ${d==="movies"?"active":""}`,onClick:()=>h("movies"),children:"Releasing Soon"}),t.jsx("button",{className:`ua-toggle-btn ${d==="events"?"active":""}`,onClick:()=>h("events"),children:"Upcoming Events"}),t.jsx("button",{className:`ua-toggle-btn ${d==="alerts"?"active":""}`,onClick:()=>h("alerts"),children:"Alerts"}),t.jsx("button",{className:`ua-toggle-btn ${d==="festivals"?"active":""}`,onClick:()=>h("festivals"),children:"Festivals"}),t.jsx("button",{className:`ua-toggle-btn ${d==="feed"?"active":""}`,onClick:()=>h("feed"),children:"Timeline"})]}),d==="plan"&&t.jsx("div",{className:"ua-weekly-plan",children:n.weekly_plan&&Array.isArray(n.weekly_plan)?n.weekly_plan.map(($,M)=>t.jsxs("div",{className:"ua-plan-day-row",children:[t.jsx("div",{className:"ua-plan-ribbon",children:t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:800,whiteSpace:"nowrap"},children:[$.day," ",t.jsx("span",{style:{opacity:.8,fontWeight:400},children:$.date})]})}),t.jsx("div",{className:"ua-plan-day-content",children:$.items&&$.items.length>0?$.items.map((v,L)=>t.jsxs("div",{className:"ua-plan-event-item",children:[t.jsx("button",{className:"ua-plan-delete-btn",onClick:O=>{O.preventDefault(),w(v.id)},"aria-label":"Remove event",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:"0.9rem",padding:"0 8px 0 0"},children:"âœ•"}),t.jsxs("a",{href:v.link,target:"_blank",rel:"noopener noreferrer",style:{flex:1,display:"flex",alignItems:"center",gap:"10px",textDecoration:"none",color:"inherit"},children:[t.jsx("span",{className:"ua-event-icon",children:v.icon}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("span",{className:"ua-event-title",children:v.title}),v.isOffer&&t.jsx("span",{className:"ua-offer-badge",children:"ðŸ›’ Ends Today"})]})]}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsx("button",{className:"ua-plan-action-btn",onClick:O=>{O.preventDefault(),rr(v.title,v.description||v.title)},title:"Add to Calendar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.1rem"},children:"ðŸ“…"})})]},L)):t.jsx("span",{className:"ua-plan-empty",style:{padding:"10px",color:"var(--text-muted)",fontSize:"0.9rem"},children:"-"})})]},M)):t.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"Data unavailable."})}),d==="movies"&&t.jsx("div",{className:"ua-tab-view",children:t.jsx(f,{items:n.sections?.movies,colorClass:"text-accent-info",emptyMessage:"No upcoming movie releases found."})}),d==="offers"&&t.jsxs("div",{className:"ua-tab-view",children:[t.jsx(f,{items:[...n.sections?.shopping||[],...n.sections?.airlines||[]],colorClass:"text-accent-success",emptyMessage:"No offers found.",isOffer:!0}),t.jsx("div",{style:{textAlign:"center",marginTop:"10px",fontSize:"0.8rem",color:"var(--text-muted)"},children:"Including Airline Offers"})]}),d==="events"&&t.jsx("div",{className:"ua-tab-view",children:t.jsx(f,{items:[...n.sections?.events||[],...n.sections?.sports||[]],colorClass:"text-accent-primary",emptyMessage:"No upcoming events found."})}),d==="alerts"&&t.jsx("div",{className:"ua-tab-view",children:t.jsx(f,{items:D,colorClass:"text-accent-error",emptyMessage:"No alerts found."})}),d==="festivals"&&t.jsx("div",{className:"ua-tab-view",children:t.jsx(f,{items:n.sections?.festivals,colorClass:"text-accent-warning",emptyMessage:"No festivals found."})}),d==="feed"&&t.jsx("div",{className:"ua-timeline",children:n.timeline.map($=>t.jsxs("div",{className:"ua-day-section",children:[t.jsxs("div",{className:"ua-day-header",children:[t.jsx("div",{className:"ua-day-label",children:$.dayLabel}),t.jsx("div",{className:"ua-date-sub",children:$.date})]}),$.items?.map(M=>t.jsx("div",{className:"ua-media-card",children:t.jsxs("div",{className:"ua-media-content",children:[t.jsxs("div",{className:"ua-media-header",children:[t.jsx("span",{className:`ua-badge type-${M.type}`,children:M.type.toUpperCase()}),t.jsx("button",{className:`ua-watch-btn ${m(M.id)?"active":""}`,onClick:()=>g(M.id),children:m(M.id)?"â˜…":"â˜†"})]}),t.jsx("h3",{className:"ua-media-title",children:M.title}),t.jsx("p",{className:"ua-media-desc",children:M.description?M.description.length>100?M.description.substring(0,100)+"...":M.description:""}),t.jsxs("div",{className:"ua-media-footer",children:[M.link&&t.jsx("a",{href:M.link,target:"_blank",rel:"noopener noreferrer",className:"ua-source-link",children:"Read Source â†—"}),t.jsx("button",{className:"ua-cal-btn",onClick:()=>b(M,$.date),title:"Add to Plan My Week",children:"ðŸ“Œ Plan"})]})]})},M.id))]},$.date))})]})}const $r=({weatherData:e,activeCity:n,onRefresh:s,loading:a,isDesktop:i})=>{const r=n||Object.keys(e)[0]||"chennai",o=e[r]||e[r.toLowerCase()],l=x.useMemo(()=>{if(!o)return"Loading weather data...";const c=o.current||{},d=o.next8Hours||[],h=o.hourly24||[];let u=c.high;if((u==null||u===void 0)&&h.length>0){const b=Math.max(...h.map(j=>j.temp||-999));b!==-999&&(u=b)}const g=u!=null?`${u}Â°`:"--";let m="";const p=d.slice(0,4).find(b=>b.precip>.5||b.prob>=40);p?m=`Rain likely at ${p.label}`:c.windSpeed>25?m=`Windy (${c.windSpeed} km/h)`:c.temp>38||u>38?m="Heatwave Alert":c.humidity>85&&c.temp>30?m="High Humidity":c.condition&&c.condition.toLowerCase().includes("rain")&&(m="Raining Now");let w=`${c.condition||"Clear"} â€¢ High ${g}`;return m?`${w} â€¢ ${m}`:w},[o]);return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"linear-gradient(to bottom, var(--bg-card), var(--bg-primary))",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 20px rgba(0,0,0,0.4)",padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("h2",{style:{fontSize:"1.4rem",margin:0,fontWeight:800,background:"linear-gradient(135deg, #fff 0%, #aaa 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textTransform:"capitalize",letterSpacing:"-0.02em",lineHeight:1.1},children:r}),a&&t.jsx("span",{className:"pulse-dot",style:{width:"8px",height:"8px",borderRadius:"50%",background:"var(--accent-primary)",display:"inline-block",boxShadow:"0 0 10px var(--accent-primary)"}})]}),t.jsx("div",{style:{fontSize:"0.95rem",color:"var(--accent-info)",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:i?"auto":"280px",opacity:.9},children:l})]}),t.jsx("button",{onClick:s,style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"var(--text-primary)",opacity:a?.7:1,transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},title:"Refresh Weather",children:t.jsx("span",{style:{display:"block",transform:a?"rotate(360deg)":"none",transition:"transform 1s linear infinite",fontSize:"18px"},children:a?"âŸ³":"â†»"})})]})};function Br({weatherData:e,activeCity:n,setActiveCity:s}){const{settings:a}=se(),i=(a.weather?.cities||["chennai","trichy","muscat"]).map(m=>m.toLowerCase()),r={chennai:"Chennai",trichy:"Trichy",muscat:"Muscat",[i[2]]:i[2].charAt(0).toUpperCase()+i[2].slice(1)},o={chennai:"ðŸ›ï¸",trichy:"ðŸ¯",muscat:"ðŸ“",[i[2]]:"ðŸ“"},[l,c]=x.useState(null);if(!e)return null;const d=e[n]||e.chennai;if(!d)return t.jsx("div",{className:"dw-container",children:"Data unavailable"});const h=new Date().getHours();let u=[];const g=(m,p,w=null)=>{m==="today"||d.tomorrow;const b=m==="today"?d[p]:d.tomorrow?.[p];let j=w;return j||(p==="morning"?j="Morning":p==="noon"?j="Afternoon":j="Evening",m==="tomorrow"&&(j="Tomorrow "+j)),{id:`${m}-${p}`,label:j,data:b}};return h<11?u=[g("today","morning","This Morning"),g("today","noon"),g("today","evening")]:h<17?u=[g("today","noon","This Afternoon"),g("today","evening"),g("tomorrow","morning")]:h<21?u=[g("today","evening","Tonight"),g("tomorrow","morning"),g("tomorrow","noon")]:u=[g("tomorrow","morning","Tomorrow Morning"),g("tomorrow","noon"),g("tomorrow","evening")],t.jsxs("div",{className:"dw-container",children:[t.jsx("div",{className:"dw-sidebar",children:i.map(m=>t.jsxs("button",{className:`dw-city-tab ${m===n?"active":""}`,onClick:()=>s(m),"aria-label":`Select ${r[m]}`,children:[t.jsx("span",{className:"dw-city-icon",children:o[m]||"ðŸ“"}),t.jsx("span",{className:"dw-city-name",children:r[m]||m})]},m))}),t.jsxs("div",{className:"dw-content",children:[t.jsxs("div",{className:"dw-header",children:[t.jsxs("div",{className:"dw-header-main",children:[t.jsx("h2",{className:"dw-city-title",children:d.name}),t.jsxs("span",{className:"dw-current-temp",children:[d.current?.temp,"Â°"]})]}),t.jsx("div",{className:"dw-header-sub",children:d.summary})]}),t.jsx("div",{className:"dw-cards-list",children:u.map((m,p)=>m.data?t.jsx(Pr,{segment:m,isExpanded:l===p,onToggle:()=>c(l===p?null:p)},m.id):null)}),t.jsxs("div",{className:"dw-footer",children:["Forecast based on ",d.models?.count," models (",d.models?.names,")."]})]})]})}function Pr({segment:e,isExpanded:n,onToggle:s}){const{label:a,data:i}=e,r=parseFloat(i.rainMm==="-"?0:i.rainMm),o=i.rainProb?.avg||0,l=r>=1,c=r>0||o>0;let d=nn,h="var(--text-secondary)",u="No significant rain";c&&(l?(d=Ma,h="#3b82f6"):(d=nn,h="#94a3b8"),u=`${r>0?r.toFixed(1)+"mm":"Trace"} (${o}%)`);const g=zr(i);return t.jsxs("div",{className:`dw-card ${n?"expanded":""}`,onClick:s,children:[t.jsxs("div",{className:"dw-card-header",children:[t.jsx("span",{className:"dw-period-badge",children:a}),t.jsx("span",{className:"dw-expand-hint",children:n?"Collapse":"Touch for Hourly"})]}),t.jsxs("div",{className:"dw-card-main",children:[t.jsx("div",{className:"dw-main-icon",children:i.iconId?t.jsx(nt,{id:i.iconId,size:56}):t.jsx("span",{style:{fontSize:"3rem"},children:i.icon})}),t.jsxs("div",{className:"dw-main-temp",children:[t.jsxs("div",{className:"dw-temp-val",children:[i.temp,"Â°"]}),t.jsxs("div",{className:"dw-temp-feels",children:["Feels like ",i.feelsLike,"Â°"]})]})]}),t.jsxs("div",{className:"dw-details-grid",children:[t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(d,{size:20,color:h})}),t.jsx("div",{className:"dw-detail-text",children:u})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:t.jsx(Zn,{size:20})}),t.jsxs("div",{className:"dw-detail-text",children:[i.humidity,"% ",t.jsx("span",{className:"dw-sep",children:"|"})," ",t.jsx(es,{size:16})," ",i.windSpeed," km/h"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â˜€ï¸"}),t.jsxs("div",{className:"dw-detail-text",children:["UV: ",i.uvIndex||"-"," ",t.jsx("span",{className:"dw-sep",children:"|"})," PM 2.5: -"]})]}),t.jsxs("div",{className:"dw-detail-row",children:[t.jsx("div",{className:"dw-detail-icon",children:"â„¹ï¸"}),t.jsx("div",{className:"dw-detail-text dw-desc",children:g})]})]}),n&&i.hourly&&t.jsx("div",{className:"dw-hourly-container hide-scrollbar",onClick:m=>m.stopPropagation(),children:i.hourly.map((m,p)=>t.jsxs("div",{className:"dw-hourly-slot",children:[t.jsx("span",{className:"dw-slot-time",children:m.time}),t.jsx("div",{className:"dw-slot-icon",children:m.iconId?t.jsx(nt,{id:m.iconId,size:28}):m.icon}),t.jsxs("strong",{className:"dw-slot-temp",children:[m.temp,"Â°"]}),m.precip>0&&t.jsxs("span",{className:"dw-slot-precip",children:[m.precip>=1&&t.jsx("span",{style:{fontSize:"0.7rem"},children:"â˜‚ï¸"}),m.precip,"mm"]})]},p))})]})}function zr(e){const n=[];return e.rainProb?.avg>40?n.push("Rain expected."):e.cloudCover>70?n.push("Cloudy."):e.cloudCover<20&&n.push("Clear skies."),e.windSpeed>20&&n.push("Breezy."),e.uvIndex>8&&n.push("High UV."),n.length===0?"Pleasant conditions.":n.join(" ")}function Hr(){const{weatherData:e,loading:n,error:s,refreshWeather:a}=at(),{settings:i}=se(),{isDesktop:r}=ot(),o=e,l=(i.weather?.cities||["chennai","trichy","muscat"]).map(u=>u.toLowerCase()),[c,d]=x.useState(()=>localStorage.getItem("dw_active_city")||"chennai");x.useEffect(()=>{localStorage.setItem("dw_active_city",c)},[c]);const h=()=>{a(!0)};return n&&!e?t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Forecast..."})]})}):t.jsxs("div",{className:"page-container",style:{padding:0},children:[o&&t.jsx($r,{weatherData:o,activeCity:c,cities:l,onRefresh:h,loading:n,isDesktop:r}),t.jsxs("main",{className:"main-content",style:{padding:0,marginTop:0},children:[s&&t.jsxs("div",{className:"topline",style:{borderLeftColor:"var(--accent-danger)",margin:"16px"},children:[t.jsx("div",{className:"topline__label",style:{color:"var(--accent-danger)"},children:"Error"}),t.jsx("div",{className:"topline__text",children:"Failed to update weather. Showing cached data."})]}),o?t.jsx(Br,{weatherData:o,activeCity:c,setActiveCity:d}):t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"â˜ï¸"}),t.jsx("p",{children:"Weather data unavailable."}),t.jsx("button",{onClick:h,className:"btn btn--secondary mt-md",children:"Retry"})]})]})]})}const Ur=({indices:e,onRefresh:n,loading:s,lastUpdated:a})=>{const r=["NIFTY 50","SENSEX","NIFTY BANK"].map(c=>e?.find(d=>d.name.toUpperCase().includes(c))).filter(Boolean),o=r.length>0?r:e?.slice(0,3)||[],l=c=>c?new Date(c).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):"";return t.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-primary)",paddingBottom:"8px",borderBottom:"1px solid var(--border-default)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",background:"var(--gradient-header)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ“ˆ"}),t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"1.1rem",margin:0,fontWeight:700,color:"var(--text-primary)",lineHeight:1.2},children:"Indian Markets"}),a&&t.jsxs("div",{style:{fontSize:"0.65rem",color:"rgba(255,255,255,0.7)",fontWeight:400},children:["Updated ",l(a)]})]})]}),t.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem",padding:"4px",color:"var(--text-primary)",opacity:s?.5:1,transition:"transform 0.3s"},title:"Refresh Markets",className:s?"spin":"",children:s?"âŸ³":"ðŸ”„"})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${o.length}, 1fr)`,gap:"1px",background:"var(--border-default)",marginTop:"0"},children:o.map((c,d)=>{const h=c.direction==="up"||c.change>0,u=h?"var(--accent-success)":"var(--accent-danger)",g=h?"â–²":"â–¼";return t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"10px 4px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",fontWeight:600,marginBottom:"2px",textTransform:"uppercase"},children:c.name.replace("NIFTY","").replace("SENSEX","SENSEX").trim()||c.name}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,color:"var(--text-primary)",marginBottom:"2px"},children:c.value}),t.jsxs("div",{style:{fontSize:"0.75rem",color:u,fontWeight:600,display:"flex",alignItems:"center",gap:"2px"},children:[t.jsx("span",{children:g}),t.jsx("span",{children:Math.abs(c.change).toFixed(2)}),t.jsxs("span",{style:{opacity:.8},children:["(",Math.abs(c.changePercent).toFixed(2),"%)"]})]})]},d)})}),t.jsx("style",{children:`
                .spin { animation: spin 1s linear infinite; }
                @keyframes spin { 100% { transform: rotate(360deg); } }
            `})]})};function Wr({funds:e}){const[n,s]=x.useState(!1);if(!e||e.length===0)return t.jsxs("div",{className:"mf-card mf-card--empty",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Funds"]}),t.jsx("p",{className:"mf-card__empty-text",children:"NAV data unavailable"})]});const a=n?e:e.slice(0,4);return t.jsxs("div",{className:"mf-card",children:[t.jsxs("div",{className:"mf-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]}),t.jsx("span",{className:"mf-card__date",children:e[0]?.navDate||"Latest"})]}),t.jsx("div",{className:"mf-card__list",children:a.map((i,r)=>t.jsxs("div",{className:"mf-fund",children:[t.jsxs("div",{className:"mf-fund__info",children:[t.jsx("div",{className:"mf-fund__name",children:i.name}),t.jsx("div",{className:"mf-fund__category",children:i.category})]}),t.jsxs("div",{className:"mf-fund__nav",children:[t.jsxs("div",{className:"mf-fund__value",children:["â‚¹",i.nav]}),t.jsxs("div",{className:`mf-fund__change mf-fund__change--${i.direction}`,children:[i.direction==="up"?"â–²":"â–¼"," ",i.changePercent,"%"]})]})]},i.code||r))}),e.length>4&&t.jsx("button",{className:"mf-card__toggle",onClick:()=>s(!n),children:n?"Show Less â–²":`Show All (${e.length}) â–¼`})]})}function Gr({ipoData:e}){const[n,s]=x.useState("upcoming");if(!e)return t.jsxs("div",{className:"ipo-card ipo-card--empty",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),t.jsx("p",{children:"IPO data unavailable"})]});const a=[{key:"upcoming",label:"Upcoming",icon:"ðŸ“…"},{key:"live",label:"Live",icon:"ðŸ”´"},{key:"recent",label:"Recent",icon:"âœ…"}],i=e[n]||[];return t.jsxs("div",{className:"ipo-card",children:[t.jsxs("div",{className:"ipo-card__header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),e.isFallback&&t.jsx("span",{className:"ipo-card__fallback-badge",children:"Demo Data"})]}),t.jsx("div",{className:"ipo-card__tabs",children:a.map(r=>t.jsxs("button",{className:`ipo-tab ${n===r.key?"ipo-tab--active":""}`,onClick:()=>s(r.key),children:[r.icon," ",r.label,t.jsx("span",{className:"ipo-tab__count",children:e[r.key]?.length||0})]},r.key))}),t.jsx("div",{className:"ipo-card__list",children:i.length===0?t.jsxs("div",{className:"ipo-card__empty",children:["No ",n," IPOs at the moment"]}):i.map((r,o)=>t.jsxs("div",{className:"ipo-item",children:[t.jsxs("div",{className:"ipo-item__header",children:[t.jsxs("div",{className:"ipo-item__name",children:[r.name,r.isSME&&t.jsx("span",{style:{fontSize:"0.6rem",marginLeft:"6px",background:"#333",padding:"2px 4px",borderRadius:"4px"},children:"SME"})]}),t.jsx("div",{className:`ipo-item__status ipo-item__status--${r.status||n}`,children:r.status||n})]}),t.jsxs("div",{className:"ipo-item__details",children:[r.issuePrice&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Price Band:"}),t.jsx("span",{className:"ipo-item__value",children:r.issuePrice})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Open:"}),t.jsx("span",{className:"ipo-item__value",children:r.openDate})]}),t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Close:"}),t.jsx("span",{className:"ipo-item__value",children:r.closeDate})]}),r.issueSize&&r.issueSize!=="-"&&t.jsxs("div",{className:"ipo-item__detail",children:[t.jsx("span",{className:"ipo-item__label",children:"Size:"}),t.jsx("span",{className:"ipo-item__value",children:r.issueSize})]})]})]},o))})]})}function Kr(){const{marketData:e,loading:n,error:s,refreshMarket:a,lastFetch:i}=zn(),{settings:r}=se(),o=r?.market||{},[l,c]=x.useState(()=>Date.now());x.useEffect(()=>{const I=setInterval(()=>c(Date.now()),6e4);return()=>clearInterval(I)},[]);const d=()=>{a()},h=I=>{const B=I?.timestamp||i;return B?l-B:1/0},u=I=>{const B=h(I),$=B>900*1e3;return B>14400*1e3?{opacity:.3,filter:"grayscale(1) brightness(0.7)",transition:"all 0.3s ease"}:$?{opacity:.6,filter:"grayscale(0.5)",transition:"all 0.3s ease"}:{opacity:1,filter:"none",transition:"all 0.3s ease"}},[g,m]=x.useState(!1);x.useEffect(()=>{const I=()=>{m(window.scrollY>400)};return window.addEventListener("scroll",I),()=>window.removeEventListener("scroll",I)},[]);const p=[(o.showGainers!==!1||o.showLosers!==!1)&&{id:"market-movers",icon:"ðŸ“ˆ",label:"Top Movers"},o.showSectorals!==!1&&{id:"sectoral-indices",icon:"ðŸ›ï¸",label:"Sectorals"},o.showCommodities!==!1&&{id:"commodities",icon:"ðŸª™",label:"Commodities"},o.showCurrency!==!1&&{id:"currency",icon:"ðŸ’±",label:"Currency"},o.showFIIDII!==!1&&{id:"fiidii",icon:"ðŸ¦",label:"FII/DII"},o.showMutualFunds!==!1&&{id:"mutual-funds",icon:"ðŸ’°",label:"Mutual Funds"},o.showIPO!==!1&&{id:"ipo-tracker",icon:"ðŸŽ¯",label:"IPO Watch"}].filter(Boolean);if(n&&!e)return t.jsx("div",{className:"page-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("span",{children:"Loading Market Data..."})]})});const{indices:w,mutualFunds:b,ipo:j,movers:f,sectorals:N,commodities:T,currencies:_,fiidii:D}=e||{},P=()=>{window.scrollTo({top:0,behavior:"smooth"})};return t.jsxs("div",{className:"page-container",style:{padding:0},children:[t.jsx(Ur,{indices:w,onRefresh:d,loading:n,lastUpdated:i}),t.jsxs("main",{className:"main-content market-page",style:{padding:"16px",marginTop:0},children:[s&&t.jsx("div",{className:"error-state",style:{marginBottom:"16px",padding:"12px",background:"rgba(255, 71, 87, 0.1)",border:"1px solid var(--accent-danger)",borderRadius:"8px",color:"var(--accent-danger)"},children:t.jsx("p",{style:{margin:0},children:"Failed to load market data. Showing cached data."})}),(o.showGainers!==!1||o.showLosers!==!1)&&t.jsxs("section",{id:"market-movers",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ“ˆ"})," Top Movers"]}),t.jsxs("div",{className:"movers-grid",children:[o.showGainers!==!1&&t.jsxs("div",{className:"movers-column movers-column--gainers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”¼ Top Gainers"}),f?.gainers?.slice(0,5).map((I,B)=>t.jsxs("div",{className:"mover-item",style:u(I),children:[t.jsx("div",{className:"mover-item__symbol",children:I.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",I.price]}),t.jsxs("div",{className:"mover-item__change text-success",children:["+",I.changePercent,"%"]})]},B))]}),o.showLosers!==!1&&t.jsxs("div",{className:"movers-column movers-column--losers",children:[t.jsx("h3",{className:"movers-column__title",children:"ðŸ”½ Top Losers"}),f?.losers?.slice(0,5).map((I,B)=>t.jsxs("div",{className:"mover-item",style:u(I),children:[t.jsx("div",{className:"mover-item__symbol",children:I.symbol}),t.jsxs("div",{className:"mover-item__price",children:["â‚¹",I.price]}),t.jsxs("div",{className:"mover-item__change text-danger",children:[I.changePercent,"%"]})]},B))]})]})]}),o.showSectorals!==!1&&t.jsxs("section",{id:"sectoral-indices",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ›ï¸"})," Sectoral Indices"]}),t.jsx("div",{className:"sectoral-grid",children:N?.map((I,B)=>t.jsxs("div",{className:"sectoral-card",style:u(I),children:[t.jsx("div",{className:"sectoral-card__name",children:I.name}),t.jsx("div",{className:"sectoral-card__value",children:I.value}),t.jsxs("div",{className:`sectoral-card__change ${I.changePercent>=0?"text-success":"text-danger"}`,children:[I.changePercent>=0?"â–²":"â–¼"," ",I.changePercent,"%"]})]},B))})]}),o.showCommodities!==!1&&t.jsxs("section",{id:"commodities",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸª™"})," Commodity Watch"]}),t.jsx("div",{className:"commodity-grid",children:T?.map((I,B)=>t.jsxs("div",{className:"commodity-card",style:u(I),children:[t.jsx("div",{className:"commodity-card__name",children:I.name}),t.jsxs("div",{className:"commodity-card__value",children:[I.value," ",t.jsx("span",{className:"commodity-card__unit",children:I.unit})]}),t.jsxs("div",{className:`commodity-card__change ${I.changePercent>=0?"text-success":"text-danger"}`,children:[I.changePercent>=0?"+":"",I.changePercent,"%"]})]},B))})]}),o.showCurrency!==!1&&t.jsxs("section",{id:"currency",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ’±"})," Currency Rates"]}),t.jsx("div",{className:"currency-grid",children:_?.map((I,B)=>t.jsxs("div",{className:"currency-card",style:u(I),children:[t.jsx("div",{className:"currency-card__name",children:I.name}),t.jsxs("div",{className:"currency-card__value",children:["â‚¹",I.value]}),t.jsxs("div",{className:`currency-card__change ${I.changePercent>=0?"text-success":"text-danger"}`,children:[I.changePercent>=0?"+":"",I.changePercent,"%"]})]},B))})]}),o.showFIIDII!==!1&&t.jsxs("section",{id:"fiidii",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ¦"})," FII/DII Activity"]}),t.jsxs("div",{className:"fiidii-container",children:[t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"FII (Foreign Investors)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",D?.fii?.buy," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",D?.fii?.sell," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${D?.fii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",D?.fii?.net," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-block",children:[t.jsx("h3",{className:"fiidii-block__title",children:"DII (Domestic Investors)"}),t.jsxs("div",{className:"fiidii-stats",children:[t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Buy:"}),t.jsxs("span",{className:"fiidii-stat__value text-success",children:["â‚¹",D?.dii?.buy," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Sell:"}),t.jsxs("span",{className:"fiidii-stat__value text-danger",children:["â‚¹",D?.dii?.sell," Cr"]})]}),t.jsxs("div",{className:"fiidii-stat",children:[t.jsx("span",{className:"fiidii-stat__label",children:"Net:"}),t.jsxs("span",{className:`fiidii-stat__value ${D?.dii?.net>=0?"text-success":"text-danger"}`,children:["â‚¹",D?.dii?.net," Cr"]})]})]})]}),t.jsxs("div",{className:"fiidii-date",children:["As of: ",D?.date]})]})]}),o.showMutualFunds!==!1&&t.jsxs("section",{id:"mutual-funds",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸ“Š"})," Mutual Fund NAVs"]}),t.jsx(Wr,{funds:b})]}),o.showIPO!==!1&&t.jsxs("section",{id:"ipo-tracker",className:"market-section",children:[t.jsxs("h2",{className:"market-section__title",children:[t.jsx("span",{children:"ðŸŽ¯"})," IPO Tracker"]}),t.jsx(Gr,{ipoData:j})]}),t.jsxs("div",{className:"market-disclaimer",children:[t.jsx("div",{children:"* Data is for informational purposes only. Not investment advice."}),e?.fetchedAt&&t.jsxs("div",{style:{fontSize:"0.7rem",opacity:.7,marginTop:"4px"},children:["Last Updated: ",new Date(e.fetchedAt).toLocaleString()]})]})]}),t.jsx(kt,{sections:p}),t.jsx("button",{onClick:P,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:g?1:0,pointerEvents:g?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:"â†‘"})]})}const hn="buzz_page_cache";function Vr(){const{newsData:e,refreshNews:n,loading:s,loadSection:a}=it(),{settings:i}=se(),[r,o]=x.useState("tamil"),[l,c]=x.useState(null),[d,h]=x.useState(0);x.useEffect(()=>{try{const _=localStorage.getItem(hn);if(_){const D=JSON.parse(_);Date.now()-(D.timestamp||0)<480*60*1e3?(c(D),h(1)):(console.log("[Buzz] Cache expired, showing anyway until live loads"),c(D),h(1))}}catch(_){console.warn("Buzz Cache read error",_)}},[]),x.useEffect(()=>{["entertainment","social","technology","local","world","india","chennai"].forEach(D=>a(D))},[a]);const u=Dn.useCallback(_=>{if(!_)return[];const D=(i.freshnessLimitHours||72)*36e5,P=Date.now();return _.filter(I=>P-(I.publishedAt||0)<D)},[i.freshnessLimitHours]),g=e.entertainment&&e.entertainment.length>0;x.useEffect(()=>{g&&h(3)},[g]);const m=g?e:l?.data||{},p=x.useMemo(()=>{const _=m.entertainment||[],D={tamil:["vijay","ajith","rajini","kamal","dhanush","suriya","vikram","simbu","siva karthikeyan","trisha","nayanthara","anirudh","ar rahman","kollywood","thalapathy","thala","udhayanidhi","vetri maaran","lokesh","nelson","jailer","leo","kanguva","indian 2","vettaiyan","goat","viduthalai","karthi","sethupathi","tamil","chennai"],hindi:["shah rukh","srk","salman","aamir","ranbir","alia","deepika","ranveer","kareena","akshay","bachchan","bollywood","hrithik","katrina","vicky kaushal","karan johar","yrf","dharma","pathaan","jawan","tiger 3","animal","dunki","war 2","singham","hindi","mumbai"],hollywood:["oscar","grammy","emmy","golden globe","marvel","dc","disney","warner bros","universal","tom cruise","dicaprio","nolan","avengers","spider-man","batman","superman","taylor swift","beyonce","kim kardashian","kanye","justin bieber","selena gomez","zendaya","hollywood","bad bunny","rihanna","drake"],ott:["netflix","prime video","hotstar","sonyliv","zee5","aha","streaming","web series","season","episode","ott"]};return _.map(P=>{const I=(P.title+" "+(P.summary||"")).toLowerCase();return D.tamil.some(B=>I.includes(B))?{...P,region:"tamil"}:D.hindi.some(B=>I.includes(B))?{...P,region:"hindi"}:D.hollywood.some(B=>I.includes(B))?{...P,region:"hollywood"}:D.ott.some(B=>I.includes(B))?{...P,region:"ott"}:P})},[m.entertainment]),w=x.useMemo(()=>{const _={india:["india","indian","bollywood","cricket","modi","delhi","mumbai","bangalore","hyderabad","ipl","bcci"],tamilnadu:["chennai","tamil","tamilnadu","kollywood","rajini","kamal","vijay","trichy","coimbatore","madurai","tn"],muscat:["muscat","oman","gulf","gcc","uae","dubai","arab","middle east","expat","omani"]},D=R=>{const H=(R.title+" "+(R.summary||"")).toLowerCase();return _.tamilnadu.some(W=>H.includes(W))?"tamilnadu":_.muscat.some(W=>H.includes(W))?"muscat":_.india.some(W=>H.includes(W))?"india":"world"},P=u(m.social||[]),I=u(m.world||[]),B=u(m.india||[]),$=u(m.chennai||[]),M=u(m.local||[]),v={world:[],india:[],tamilnadu:[],muscat:[]};P.forEach(R=>{const H=D(R);v[H].push({...R,source:"social"})}),I.filter(R=>R.title?.toLowerCase().includes("trend")||R.title?.toLowerCase().includes("viral")||R.title?.toLowerCase().includes("social")).forEach(R=>v.world.push({...R,source:"world"})),B.filter(R=>R.title?.toLowerCase().includes("trend")||R.title?.toLowerCase().includes("viral")||R.title?.toLowerCase().includes("social")).forEach(R=>v.india.push({...R,source:"india"})),$.forEach(R=>{v.tamilnadu.push({...R,source:"chennai"})}),M.forEach(R=>{v.muscat.push({...R,source:"local"})});const L={world:i.socialTrends?.worldCount??8,india:i.socialTrends?.indiaCount??8,tamilnadu:i.socialTrends?.tamilnaduCount??5,muscat:i.socialTrends?.muscatCount??4},O=[];return Object.entries(L).forEach(([R,H])=>{const W=v[R];W.sort((y,A)=>(A.publishedAt||0)-(y.publishedAt||0)),W.slice(0,H).forEach(y=>{O.push({...y,region:R,regionLabel:R==="world"?"ðŸŒ World":R==="india"?"ðŸ‡®ðŸ‡³ India":R==="tamilnadu"?"ðŸ›ï¸ Tamil Nadu":"ðŸï¸ Muscat"})})}),O.sort((R,H)=>(H.publishedAt||0)-(R.publishedAt||0)),O},[m,i.freshnessLimitHours,i.socialTrends,u]);x.useEffect(()=>{if(g)try{const _={timestamp:Date.now(),data:{entertainment:e.entertainment,social:e.social,technology:e.technology,world:e.world,india:e.india,chennai:e.chennai,local:e.local}};localStorage.setItem(hn,JSON.stringify(_))}catch(_){console.warn("Buzz Cache write error",_)}},[g,e]);const b=()=>{h(3),n(["technology","social","world","india","chennai","local"])},j=[{id:"entertainment",icon:"ðŸŽ¬",label:"Entertainment"},{id:"social-trends",icon:"ðŸ‘¥",label:"Social Trends"},{id:"tech-news",icon:"ðŸš€",label:"Tech & Startups"},{id:"ai-innovation",icon:"ðŸ¤–",label:"AI & Innovation"}],[f,N]=x.useState(!1);x.useEffect(()=>{const _=()=>{window.scrollY>400?N(!0):N(!1)};return window.addEventListener("scroll",_),()=>window.removeEventListener("scroll",_)},[]);const T=()=>{window.scrollTo({top:0,behavior:"smooth"})};return t.jsxs("div",{className:"page-container",children:[t.jsx(_e,{title:"Buzz Hub",icon:"ðŸŽ­",onRefresh:b,loadingPhase:d||(s?3:0)}),t.jsxs("main",{className:"main-content",children:[t.jsxs("section",{id:"entertainment",className:"news-section entertainment-hub",children:[t.jsxs("h2",{className:"news-section__title news-section__title--entertainment",children:[t.jsx("span",{children:"ðŸŽ¬"})," Entertainment"]}),t.jsxs("div",{className:"entertainment-tabs",children:[t.jsx("button",{className:`ent-tab ${r==="tamil"?"ent-tab--active":""}`,onClick:()=>o("tamil"),children:"ðŸŽ­ Tamil"}),t.jsx("button",{className:`ent-tab ${r==="hindi"?"ent-tab--active":""}`,onClick:()=>o("hindi"),children:"ðŸŽª Hindi"}),t.jsx("button",{className:`ent-tab ${r==="hollywood"?"ent-tab--active":""}`,onClick:()=>o("hollywood"),children:"ðŸŽ¬ Hollywood"}),t.jsx("button",{className:`ent-tab ${r==="ott"?"ent-tab--active":""}`,onClick:()=>o("ott"),children:"ðŸ“º OTT"})]}),t.jsx("div",{className:"entertainment-content",children:t.jsx(ue,{title:r==="tamil"?"Tamil Cinema":r==="hindi"?"Hindi Cinema":r==="hollywood"?"Hollywood":"OTT & Streaming",icon:r==="tamil"?"ðŸŽ­":r==="hindi"?"ðŸŽª":r==="hollywood"?"ðŸŽ¬":"ðŸ“º",news:u(p.filter(_=>_.region===r)),maxDisplay:r==="tamil"?i.entertainment?.tamilCount??5:r==="hindi"?i.entertainment?.hindiCount??5:r==="hollywood"?i.entertainment?.hollywoodCount??3:i.entertainment?.ottCount??2,hideTitle:!0,showCritics:!1})})]}),t.jsxs("section",{id:"social-trends",className:"news-section",children:[t.jsxs("h2",{className:"news-section__title news-section__title--social",children:[t.jsx("span",{children:"ðŸ‘¥"})," Social Trends"]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px",padding:"0 16px"},children:[w.map((_,D)=>t.jsx(Ze,{article:{..._,time:_.time||"Recently"},href:_.link,badge:_.regionLabel,size:"medium"},D)),w.length===0&&t.jsx("div",{className:"empty-state",style:{gridColumn:"1/-1"},children:t.jsx("p",{children:"No social trends available"})})]})]}),t.jsx(ue,{id:"tech-news",title:"Tech & Startups",icon:"ðŸš€",colorClass:"news-section__title--world",news:u(m.technology),maxDisplay:i.sections?.technology?.count||5,showCritics:!1}),t.jsx(ue,{id:"ai-innovation",title:"AI & Innovation",icon:"ðŸ¤–",colorClass:"news-section__title--entertainment",news:u(m.technology?.filter(_=>_.title?.toLowerCase().includes("ai")||_.title?.toLowerCase().includes("innovation")||_.title?.toLowerCase().includes("machine learning")||_.title?.toLowerCase().includes("chatgpt")||_.title?.toLowerCase().includes("gemini"))),maxDisplay:6,showCritics:!1})]}),t.jsx(kt,{sections:j}),t.jsx("button",{onClick:T,style:{position:"fixed",bottom:"90px",left:"50%",transform:"translateX(-50%)",width:"40px",height:"40px",borderRadius:"50%",background:"rgba(var(--bg-card), 0.6)",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",fontSize:"1.2rem",cursor:"pointer",opacity:f?1:0,pointerEvents:f?"auto":"none",transition:"all 0.3s ease",zIndex:900,backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},className:"back-to-top",children:"â†‘"})]})}const qr=({article:e,sourceName:n,isTranslated:s})=>{const a=s&&e.title_en?e.title_en:e.title;return t.jsxs("article",{className:"newspaper-card",children:[n&&t.jsx("div",{className:"newspaper-card__source",children:n}),t.jsx("h3",{className:"newspaper-card__title",children:t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:a})}),t.jsx("div",{className:"newspaper-card__footer",children:t.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"newspaper-card__link",children:["Read Full Story ",t.jsx(Qa,{size:10})]})})]})};var mn;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(mn||(mn={}));var pn;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(pn||(pn={}));var gn;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(gn||(gn={}));const fn=["user","model","function","system"];var yn;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(yn||(yn={}));var xn;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(xn||(xn={}));var wn;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(wn||(wn={}));var vn;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(vn||(vn={}));var Pe;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(Pe||(Pe={}));var bn;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(bn||(bn={}));var Sn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Sn||(Sn={}));var jn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(jn||(jn={}));class ne extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class Ae extends ne{constructor(n,s){super(n),this.response=s}}class os extends ne{constructor(n,s,a,i){super(n),this.status=s,this.statusText=a,this.errorDetails=i}}class we extends ne{}class ls extends ne{}const Yr="https://generativelanguage.googleapis.com",Jr="v1beta",Xr="0.24.1",Qr="genai-js";var Ce;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ce||(Ce={}));class Zr{constructor(n,s,a,i,r){this.model=n,this.task=s,this.apiKey=a,this.stream=i,this.requestOptions=r}toString(){var n,s;const a=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Jr;let r=`${((s=this.requestOptions)===null||s===void 0?void 0:s.baseUrl)||Yr}/${a}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}function eo(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${Qr}/${Xr}`),n.join(" ")}async function to(e){var n;const s=new Headers;s.append("Content-Type","application/json"),s.append("x-goog-api-client",eo(e.requestOptions)),s.append("x-goog-api-key",e.apiKey);let a=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(i){throw new we(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${i.message}`)}for(const[i,r]of a.entries()){if(i==="x-goog-api-key")throw new we(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new we(`Header name ${i} can only be set using the apiClient field`);s.append(i,r)}}return s}async function no(e,n,s,a,i,r){const o=new Zr(e,n,s,a,r);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},ro(r)),{method:"POST",headers:await to(o),body:i})}}async function We(e,n,s,a,i,r={},o=fetch){const{url:l,fetchOptions:c}=await no(e,n,s,a,i,r);return so(l,c,o)}async function so(e,n,s=fetch){let a;try{a=await s(e,n)}catch(i){io(i,e)}return a.ok||await ao(a,e),a}function io(e,n){let s=e;throw s.name==="AbortError"?(s=new ls(`Request aborted when fetching ${n.toString()}: ${e.message}`),s.stack=e.stack):e instanceof os||e instanceof we||(s=new ne(`Error fetching from ${n.toString()}: ${e.message}`),s.stack=e.stack),s}async function ao(e,n){let s="",a;try{const i=await e.json();s=i.error.message,i.error.details&&(s+=` ${JSON.stringify(i.error.details)}`,a=i.error.details)}catch{}throw new os(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,a)}function ro(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const s=new AbortController;e?.timeout>=0&&setTimeout(()=>s.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{s.abort()}),n.signal=s.signal}return n}function Et(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),et(e.candidates[0]))throw new Ae(`${xe(e)}`,e);return oo(e)}else if(e.promptFeedback)throw new Ae(`Text not available. ${xe(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),et(e.candidates[0]))throw new Ae(`${xe(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Nn(e)[0]}else if(e.promptFeedback)throw new Ae(`Function call not available. ${xe(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),et(e.candidates[0]))throw new Ae(`${xe(e)}`,e);return Nn(e)}else if(e.promptFeedback)throw new Ae(`Function call not available. ${xe(e)}`,e)},e}function oo(e){var n,s,a,i;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)o.text&&r.push(o.text),o.executableCode&&r.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&r.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}function Nn(e){var n,s,a,i;const r=[];if(!((s=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const o of(i=(a=e.candidates)===null||a===void 0?void 0:a[0].content)===null||i===void 0?void 0:i.parts)o.functionCall&&r.push(o.functionCall);if(r.length>0)return r}const lo=[Pe.RECITATION,Pe.SAFETY,Pe.LANGUAGE];function et(e){return!!e.finishReason&&lo.includes(e.finishReason)}function xe(e){var n,s,a;let i="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)i+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(i+=` due to ${e.promptFeedback.blockReason}`),!((s=e.promptFeedback)===null||s===void 0)&&s.blockReasonMessage&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((a=e.candidates)===null||a===void 0)&&a[0]){const r=e.candidates[0];et(r)&&(i+=`Candidate was blocked due to ${r.finishReason}`,r.finishMessage&&(i+=`: ${r.finishMessage}`))}return i}function ze(e){return this instanceof ze?(this.v=e,this):new ze(e)}function co(e,n,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s.apply(e,n||[]),i,r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(g){a[g]&&(i[g]=function(m){return new Promise(function(p,w){r.push([g,m,p,w])>1||l(g,m)})})}function l(g,m){try{c(a[g](m))}catch(p){u(r[0][3],p)}}function c(g){g.value instanceof ze?Promise.resolve(g.value.v).then(d,h):u(r[0][2],g)}function d(g){l("next",g)}function h(g){l("throw",g)}function u(g,m){g(m),r.shift(),r.length&&l(r[0][0],r[0][1])}}const _n=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function uo(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),s=po(n),[a,i]=s.tee();return{stream:mo(a),response:ho(i)}}async function ho(e){const n=[],s=e.getReader();for(;;){const{done:a,value:i}=await s.read();if(a)return Et(go(n));n.push(i)}}function mo(e){return co(this,arguments,function*(){const s=e.getReader();for(;;){const{value:a,done:i}=yield ze(s.read());if(i)break;yield yield ze(Et(a))}})}function po(e){const n=e.getReader();return new ReadableStream({start(a){let i="";return r();function r(){return n.read().then(({value:o,done:l})=>{if(l){if(i.trim()){a.error(new ne("Failed to parse stream"));return}a.close();return}i+=o;let c=i.match(_n),d;for(;c;){try{d=JSON.parse(c[1])}catch{a.error(new ne(`Error parsing JSON response: "${c[1]}"`));return}a.enqueue(d),i=i.substring(c[0].length),c=i.match(_n)}return r()}).catch(o=>{let l=o;throw l.stack=o.stack,l.name==="AbortError"?l=new ls("Request aborted when reading from the stream"):l=new ne("Error reading from the stream"),l})}}})}function go(e){const n=e[e.length-1],s={promptFeedback:n?.promptFeedback};for(const a of e){if(a.candidates){let i=0;for(const r of a.candidates)if(s.candidates||(s.candidates=[]),s.candidates[i]||(s.candidates[i]={index:i}),s.candidates[i].citationMetadata=r.citationMetadata,s.candidates[i].groundingMetadata=r.groundingMetadata,s.candidates[i].finishReason=r.finishReason,s.candidates[i].finishMessage=r.finishMessage,s.candidates[i].safetyRatings=r.safetyRatings,r.content&&r.content.parts){s.candidates[i].content||(s.candidates[i].content={role:r.content.role||"user",parts:[]});const o={};for(const l of r.content.parts)l.text&&(o.text=l.text),l.functionCall&&(o.functionCall=l.functionCall),l.executableCode&&(o.executableCode=l.executableCode),l.codeExecutionResult&&(o.codeExecutionResult=l.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),s.candidates[i].content.parts.push(o)}i++}a.usageMetadata&&(s.usageMetadata=a.usageMetadata)}return s}async function cs(e,n,s,a){const i=await We(n,Ce.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(s),a);return uo(i)}async function ds(e,n,s,a){const r=await(await We(n,Ce.GENERATE_CONTENT,e,!1,JSON.stringify(s),a)).json();return{response:Et(r)}}function us(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function He(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const s of e)typeof s=="string"?n.push({text:s}):n.push(s);return fo(n)}function fo(e){const n={role:"user",parts:[]},s={role:"function",parts:[]};let a=!1,i=!1;for(const r of e)"functionResponse"in r?(s.parts.push(r),i=!0):(n.parts.push(r),a=!0);if(a&&i)throw new ne("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!i)throw new ne("No content is provided for sending chat message.");return a?n:s}function yo(e,n){var s;let a={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(s=n?.cachedContent)===null||s===void 0?void 0:s.name,contents:[]};const i=e.generateContentRequest!=null;if(e.contents){if(i)throw new we("CountTokensRequest must have one of contents or generateContentRequest, not both.");a.contents=e.contents}else if(i)a=Object.assign(Object.assign({},a),e.generateContentRequest);else{const r=He(e);a.contents=[r]}return{generateContentRequest:a}}function kn(e){let n;return e.contents?n=e:n={contents:[He(e)]},e.systemInstruction&&(n.systemInstruction=us(e.systemInstruction)),n}function xo(e){return typeof e=="string"||Array.isArray(e)?{content:He(e)}:e}const Cn=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],wo={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function vo(e){let n=!1;for(const s of e){const{role:a,parts:i}=s;if(!n&&a!=="user")throw new ne(`First content should be with role 'user', got ${a}`);if(!fn.includes(a))throw new ne(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(fn)}`);if(!Array.isArray(i))throw new ne("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new ne("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of i)for(const c of Cn)c in l&&(r[c]+=1);const o=wo[a];for(const l of Cn)if(!o.includes(l)&&r[l]>0)throw new ne(`Content with role '${a}' can't contain '${l}' part`);n=!0}}function En(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const s=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(s===void 0||s.parts===void 0||s.parts.length===0)return!1;for(const a of s.parts)if(a===void 0||Object.keys(a).length===0||a.text!==void 0&&a.text==="")return!1;return!0}const Tn="SILENT_ERROR";class bo{constructor(n,s,a,i={}){this.model=s,this.params=a,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,a?.history&&(vo(a.history),this._history=a.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,s={}){var a,i,r,o,l,c;await this._sendPromise;const d=He(n),h={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},u=Object.assign(Object.assign({},this._requestOptions),s);let g;return this._sendPromise=this._sendPromise.then(()=>ds(this._apiKey,this.model,h,u)).then(m=>{var p;if(En(m.response)){this._history.push(d);const w=Object.assign({parts:[],role:"model"},(p=m.response.candidates)===null||p===void 0?void 0:p[0].content);this._history.push(w)}else{const w=xe(m.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}g=m}).catch(m=>{throw this._sendPromise=Promise.resolve(),m}),await this._sendPromise,g}async sendMessageStream(n,s={}){var a,i,r,o,l,c;await this._sendPromise;const d=He(n),h={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},u=Object.assign(Object.assign({},this._requestOptions),s),g=cs(this._apiKey,this.model,h,u);return this._sendPromise=this._sendPromise.then(()=>g).catch(m=>{throw new Error(Tn)}).then(m=>m.response).then(m=>{if(En(m)){this._history.push(d);const p=Object.assign({},m.candidates[0].content);p.role||(p.role="model"),this._history.push(p)}else{const p=xe(m);p&&console.warn(`sendMessageStream() was unsuccessful. ${p}. Inspect response object for details.`)}}).catch(m=>{m.message!==Tn&&console.error(m)}),g}}async function So(e,n,s,a){return(await We(n,Ce.COUNT_TOKENS,e,!1,JSON.stringify(s),a)).json()}async function jo(e,n,s,a){return(await We(n,Ce.EMBED_CONTENT,e,!1,JSON.stringify(s),a)).json()}async function No(e,n,s,a){const i=s.requests.map(o=>Object.assign(Object.assign({},o),{model:n}));return(await We(n,Ce.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),a)).json()}class In{constructor(n,s,a={}){this.apiKey=n,this._requestOptions=a,s.model.includes("/")?this.model=s.model:this.model=`models/${s.model}`,this.generationConfig=s.generationConfig||{},this.safetySettings=s.safetySettings||[],this.tools=s.tools,this.toolConfig=s.toolConfig,this.systemInstruction=us(s.systemInstruction),this.cachedContent=s.cachedContent}async generateContent(n,s={}){var a;const i=kn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return ds(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}async generateContentStream(n,s={}){var a;const i=kn(n),r=Object.assign(Object.assign({},this._requestOptions),s);return cs(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},i),r)}startChat(n){var s;return new bo(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),this._requestOptions)}async countTokens(n,s={}){const a=yo(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),s);return So(this.apiKey,this.model,a,i)}async embedContent(n,s={}){const a=xo(n),i=Object.assign(Object.assign({},this._requestOptions),s);return jo(this.apiKey,this.model,a,i)}async batchEmbedContents(n,s={}){const a=Object.assign(Object.assign({},this._requestOptions),s);return No(this.apiKey,this.model,n,a)}}class _o{constructor(n){this.apiKey=n}getGenerativeModel(n,s){if(!n.model)throw new ne("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new In(this.apiKey,n,s)}getGenerativeModelFromCachedContent(n,s,a){if(!n.name)throw new we("Cached content must contain a `name` field.");if(!n.model)throw new we("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const o of i)if(s?.[o]&&n[o]&&s?.[o]!==n[o]){if(o==="model"){const l=s.model.startsWith("models/")?s.model.replace("models/",""):s.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(l===c)continue}throw new we(`Different value for "${o}" specified in modelParams (${s[o]}) and cachedContent (${n[o]})`)}const r=Object.assign(Object.assign({},s),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new In(this.apiKey,r,a)}}let An=null,jt=null;const Mn=e=>{if(!e)return!1;try{return An=new _o(e),jt=An.getGenerativeModel({model:"gemini-1.5-flash"}),!0}catch(n){return console.error("Failed to initialize Gemini AI:",n),!1}},wt={generateSummary:async(e,n,s=!1)=>{if(!Mn(n))throw new Error("Invalid or missing API Key");let i=`You are a professional news editor. Summarize the following news headlines into a concise, insightful daily briefing (3-4 bullet points).

Headlines:
${e.slice(0,15).map(r=>`- ${r.title}`).join(`
`)}`;s?i+=`

REQUIREMENTS:
1. Provide the summary in TWO languages: English and Tamil.
2. SEPARATE the English summary and Tamil summary with the exact delimiter "|||".

OUTPUT FORMAT:
<English Summary>
|||
<Tamil Summary>`:i+=`

REQUIREMENTS:
1. Language: English ONLY.
2. No introductory text.`;try{const l=(await(await jt.generateContent(i)).response).text().trim();if(s&&l.includes("|||")){const c=l.split("|||");return{summary:c[0].trim(),summary_ta:c[1].trim()}}return{summary:l}}catch(r){throw console.error("Summary generation failed:",r),new Error("AI Generation Failed. Check your API Key or Quota.")}},translateTexts:async(e,n)=>{if(!Mn(n))throw new Error("Invalid or missing API Key");const a=`Translate the following news headlines to English. Maintain journalistic style. Return ONLY the translated list, numbered exactly as input.

${e.map((i,r)=>`${r+1}. ${i}`).join(`
`)}`;try{const l=(await(await jt.generateContent(a)).response).text().split(`
`),c=new Array(e.length).fill(null);return l.forEach(d=>{const h=d.match(/^(\d+)\.\s+(.*)/);if(h){const u=parseInt(h[1])-1;u>=0&&u<e.length&&(c[u]=h[2].trim())}}),c}catch(i){throw console.error("Translation failed:",i),i}}},ko="https://api.allorigins.win/raw?url=";async function Co(e){if(!e)return"";try{const n=ko+encodeURIComponent(e),s=await fetch(n,{signal:AbortSignal.timeout(12e3)});if(!s.ok)return"";const a=await s.text();return Eo(a)}catch{return""}}function Eo(e){const s=new DOMParser().parseFromString(e,"text/html");s.querySelectorAll("script, style, nav, footer, header, aside, .ad, .advertisement, .social-share, .comments").forEach(o=>o.remove());const a=["article",'[itemprop="articleBody"]',".article-body",".story-content",".article-content",".post-content",".entry-content",".td-post-content","#article-body",".story-element","main"];for(const o of a){const l=s.querySelector(o);if(l){const c=l.textContent.trim();if(c.length>200)return c.slice(0,5e3)}}return Array.from(s.querySelectorAll("p")).map(o=>o.textContent.trim()).filter(o=>o.length>40).join(`

`).slice(0,5e3)}async function To(e,n=5){if(!e||e.length<100)return e||"";const s=await Io(e);return s||Ao(e,n)}async function Io(e){try{if(!("ai"in self)||!("summarizer"in self.ai)||(await self.ai.summarizer.capabilities()).available==="no")return null;const s=await self.ai.summarizer.create({type:"key-points",format:"plain-text",length:"medium"}),a=await s.summarize(e);return s.destroy(),a}catch{return null}}function Ao(e,n=5){const s=e.replace(/([.!?])\s+/g,`$1
`).split(`
`).map(l=>l.trim()).filter(l=>l.length>20&&l.length<500);if(s.length<=n)return s.join(" ");const a=e.toLowerCase().split(/\W+/).filter(l=>l.length>3),i={};for(const l of a)i[l]=(i[l]||0)+1;const r=s.map((l,c)=>{const d=l.toLowerCase().split(/\W+/).filter(u=>u.length>3);let h=0;for(const u of d)h+=i[u]||0;return h=h/Math.max(d.length,1),c<3&&(h*=1.3),c===s.length-1&&(h*=1.1),{sentence:l,score:h,index:c}});r.sort((l,c)=>c.score-l.score);const o=r.slice(0,n);return o.sort((l,c)=>l.index-c.index),o.map(l=>l.sentence).join(" ")}const Mo={THE_HINDU:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"International",limit:6},{id:"business",title:"Business",limit:5},{id:"sports",title:"Sport",limit:5}]},INDIAN_EXPRESS:{sections:[{id:"india",title:"Front Page",limit:10},{id:"world",title:"World",limit:5},{id:"technology",title:"Explained / Tech",limit:5}]},DINAMANI:{sections:[{id:"chennai",title:"Tamil Nadu",limit:10},{id:"entertainment",title:"Cinema",limit:5}]},DAILY_THANTHI:{sections:[{id:"chennai",title:"Headlines",limit:10},{id:"local",title:"District News",limit:5}]}},Ro={getVirtualPaper:async e=>{const n=Mo[e];if(!n)return console.warn(`[VirtualPaper] No config for ${e}`),[];console.log(`[VirtualPaper] Generating for ${e}...`);const s=n.sections.map(async i=>{try{const r=await bt(i.id,i.limit);return{page:i.title,articles:r.map(o=>({title:o.title,link:o.link,description:o.description,source:o.source,publishedAt:o.publishedAt}))}}catch(r){return console.error(`[VirtualPaper] Failed to fetch section ${i.id}`,r),{page:i.title,articles:[],error:"Failed to load section"}}});return(await Promise.all(s)).filter(i=>i.articles.length>0)}},Do="./data/epaper_data.json",pe={THE_HINDU:{id:"THE_HINDU",label:"The Hindu",lang:"en"},INDIAN_EXPRESS:{id:"INDIAN_EXPRESS",label:"Indian Express",lang:"en"},DINAMANI:{id:"DINAMANI",label:"Dinamani",lang:"ta"},DAILY_THANTHI:{id:"DAILY_THANTHI",label:"Daily Thanthi",lang:"ta"}},Lo=()=>{const{settings:e}=se(),{isWebView:n}=ot(),[s,a]=x.useState(pe.THE_HINDU.id),[i,r]=x.useState(null),[o,l]=x.useState(null),[c,d]=x.useState(!0),[h,u]=x.useState(null),[g,m]=x.useState(!1),[p,w]=x.useState({}),[b,j]=x.useState({}),[f,N]=x.useState(!1),[T,_]=x.useState(!1),[D,P]=x.useState(!1),[I,B]=x.useState({}),[$,M]=x.useState(!1),v=e.newspaper?.summaryLineLimit||50,L=x.useCallback(async()=>{d(!0),u(null);try{const S=await fetch(`${Do}?t=${Date.now()}`);if(!S.ok)throw new Error("Failed to fetch data");const C=await S.json();if(!C||!C.sources)throw new Error("Invalid data format");r(C.sources),l(C.lastUpdated)}catch(S){console.warn("JSON fetch failed, trying RSS fallback...",S);try{const C=await O();r(C),l(new Date().toISOString())}catch(C){console.error("Fallback failed:",C),u("Failed to load today's paper. Please check your internet connection.")}}finally{d(!1)}},[]),O=async()=>{const S={},C=new Promise((F,z)=>setTimeout(()=>z(new Error("Timeout")),15e3)),k=Object.keys(pe).map(async F=>{try{const z=await Ro.getVirtualPaper(F);z&&z.length>0&&(S[F]=z)}catch(z){console.warn(`Virtual Paper failed for ${F}:`,z.message)}});try{await Promise.race([Promise.all(k),C])}catch(F){console.warn("Virtual Paper fetch timed out or failed:",F)}if(Object.keys(S).length===0)throw new Error("Failed to generate Virtual Paper. Please check connection.");return S};x.useEffect(()=>{L()},[L]),x.useEffect(()=>{(async()=>{if(!i||!i[s]||!e.geminiKey)return;const C=i[s],k=pe[s].lang==="ta";for(const F of C){const z=!F.summary&&!F.summary_ta||F.error,K=p[F.page];if(z&&!K&&!f){N(!0);try{console.log(`Generating fallback summary for ${F.page}...`);const q=await wt.generateSummary(F.articles,e.geminiKey,k);w(X=>({...X,[F.page]:q}))}catch(q){console.error(`Failed to generate summary for ${F.page}:`,q)}finally{N(!1)}}}})()},[i,s,e.geminiKey,p,f]);const R=x.useCallback(async(S,C)=>{const k=`${s}_${S}`;if(I[k])return;const F=C?.[0];if(F?.link)try{const z=await Co(F.link);if(z&&z.length>200){const K=await To(z,6);K&&B(q=>({...q,[k]:K}))}}catch{}},[s,I]);x.useEffect(()=>{(async()=>{if(!g||!i||!i[s]||pe[s].lang==="en"||!e.geminiKey)return;const C=i[s];let k=[],F=[];if(C.forEach(z=>{z.articles.forEach(K=>{const q=K.title_en,X=b[K.link];!q&&!X&&(k.push(K.title),F.push(K.link))})}),k.length>0&&!T){_(!0);try{console.log(`Translating ${k.length} titles...`);const z=15;for(let K=0;K<k.length;K+=z){const q=k.slice(K,K+z),X=await wt.translateTexts(q,e.geminiKey);j(ie=>{const le={...ie};return X.forEach((Se,G)=>{const ae=K+G;F[ae]&&(le[F[ae]]=Se)}),le})}}catch(z){console.error("Translation failed:",z)}finally{_(!1)}}})()},[g,i,s,e.geminiKey,b,T]);const H=S=>{const C=p[S.page];if(C){if(g&&C.summary)return{text:C.summary,method:"gemini"};if(!g&&C.summary_ta)return{text:C.summary_ta,method:"gemini"};if(C.summary)return{text:C.summary,method:"gemini"}}if(g){if(S.summary)return{text:S.summary,method:S.summary_method||"server"};if(S.summary_ta)return{text:S.summary_ta,method:S.summary_method||"server"}}else{if(S.summary_ta)return{text:S.summary_ta,method:S.summary_method||"server"};if(S.summary)return{text:S.summary,method:S.summary_method||"server"}}const k=`${s}_${S.page}`;return I[k]?{text:I[k],method:"extractive"}:null},W=async()=>{if(!i||!i[s])return;M(!0);const C=i[s].map(async k=>{const F=`${s}_${k.page}`,z=p[k.page],K=I[F],q=pe[s].lang==="ta"&&!g?k.summary_ta:k.summary;if(!(z||K||q))if(e.geminiKey)try{const X=await wt.generateSummary(k.articles,e.geminiKey,pe[s].lang==="ta");w(ie=>({...ie,[k.page]:X}))}catch(X){console.error(`Gemini Gen Failed for ${k.page}:`,X)}else try{await R(k.page,k.articles)}catch(X){console.error(`Client Summary Failed for ${k.page}:`,X)}});await Promise.allSettled(C),M(!1)};x.useEffect(()=>{if(!i||!i[s])return;const S=i[s][0];S&&!S.summary&&!S.summary_ta&&!e.geminiKey&&R(S.page,S.articles)},[i,s,e.geminiKey,R]);const E=i?i[s]:[],A=pe[s].lang==="ta";return t.jsxs("div",{className:`page-container mode-newspaper ${n?"page-container--desktop":""}`,children:[t.jsxs("div",{className:"header",children:[t.jsxs("div",{className:"header__title",children:[t.jsx(tr,{className:"header__title-icon"}),t.jsx("span",{children:"Daily Brief"})]}),t.jsxs("div",{className:"header__actions",style:{gap:"8px"},children:[t.jsx("button",{onClick:W,className:`btn-icon ${$?"pulse":""}`,title:"Generate All Summaries",disabled:$,style:{color:$?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(Ja,{size:18})}),t.jsx("button",{onClick:()=>P(!D),className:`btn-icon ${D?"active":""}`,title:D?"Card View":"Digest View",style:{color:D?"var(--accent-primary)":"var(--text-secondary)",fontSize:"1.1rem"},children:D?"ðŸ“°":"ðŸ“–"}),A&&t.jsx("button",{onClick:()=>m(!g),className:`btn-icon ${g?"active":""}`,title:g?"Show Original (Tamil)":"Translate to English",style:{color:g?"var(--accent-primary)":"var(--text-secondary)"},children:t.jsx(Za,{size:24})}),t.jsx("button",{onClick:L,className:"btn-icon","aria-label":"Refresh",children:t.jsx(nr,{className:c?"spin":""})})]})]}),t.jsxs("div",{className:"topline",style:{borderRadius:0,margin:0,borderLeft:"none",borderBottom:"1px solid var(--border-default)",overflowX:"auto"},children:[t.jsx("div",{style:{display:"flex",gap:"8px",minWidth:"max-content"},children:Object.values(pe).map(S=>t.jsx("button",{onClick:()=>{a(S.id),m(!1)},className:`btn ${s===S.id?"btn--primary":"btn--secondary"}`,style:{padding:"8px 12px",fontSize:"0.85rem",whiteSpace:"nowrap"},children:S.label},S.id))}),o&&t.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"8px",textAlign:"center"},children:["Updated: ",new Date(o).toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),t.jsx("div",{className:"main-content",style:{padding:"16px"},children:c&&!i?t.jsxs("div",{className:"loading",children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching Today's Brief..."})]}):h?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state__icon",children:"âš ï¸"}),t.jsx("p",{children:h}),t.jsx("button",{onClick:L,className:"btn btn--primary mt-md",children:"Retry"})]}):t.jsxs("div",{className:"newspaper-content",children:[!E||E.length===0?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:"No content available for this source today."})}):E.map((S,C)=>{const k=H(S),F={gemini:"AI Summary",server:"Summary",extractive:"Auto-Summary",headlines:"Headlines"};return t.jsxs("div",{className:"newspaper-section",style:{marginBottom:"32px"},children:[t.jsxs("h2",{className:"zone-title",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{children:S.page}),T&&g&&t.jsx("span",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",fontWeight:"normal"},children:"Translating..."})]}),k?t.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"16px",borderRadius:"8px",marginBottom:"20px",borderLeft:"4px solid var(--accent-primary)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--accent-primary)",fontWeight:"bold",marginBottom:"8px"},children:[t.jsx(er,{}),t.jsx("span",{children:F[k.method]||"Summary"}),k.method==="extractive"&&t.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"normal",color:"var(--text-muted)",marginLeft:"4px"},children:"(no API key needed)"})]}),t.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.95rem",lineHeight:"1.6",fontFamily:"serif",display:"-webkit-box",WebkitLineClamp:v,WebkitBoxOrient:"vertical",overflow:"hidden"},children:k.text})]}):t.jsxs("div",{style:{padding:"12px",marginBottom:"20px",background:"rgba(255, 0, 0, 0.05)",borderLeft:"4px solid var(--accent-danger)",borderRadius:"4px",fontSize:"0.85rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(Xa,{color:"var(--accent-danger)"}),t.jsx("span",{children:S.error==="Quota Exceeded"?"Daily AI Limit Reached.":S.error==="API Key Missing"?"AI Summary Unavailable.":"Summary not generated."})]}),!e.geminiKey&&t.jsx(Re,{to:"/settings",style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"Add Key to Enable"}),e.geminiKey&&f&&t.jsx("span",{style:{color:"var(--accent-primary)"},children:"Generating..."})]}),D?t.jsx("div",{style:{fontSize:"0.9rem",lineHeight:"1.7"},children:S.articles.map((z,K)=>{const q=g&&(b[z.link]||z.title_en)||z.title;return t.jsx("div",{style:{padding:"8px 0",borderBottom:"1px solid var(--border-default)"},children:t.jsx("a",{href:z.link,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--text-primary)",textDecoration:"none",fontWeight:500},children:q})},K)})}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px"},children:S.articles.map((z,K)=>{const q={...z,title_en:b[z.link]||z.title_en};return t.jsx(qr,{article:q,sourceName:pe[s].label,isTranslated:g},K)})})]},C)}),t.jsx("div",{className:"market-disclaimer",style:{marginTop:"32px"},children:"Content aggregated from official sources. Summaries generated by AI. Verify important details from original articles."})]})})]})};function ge({checked:e,onChange:n,recommended:s=!1,disabled:a=!1}){return t.jsxs("label",{className:`toggle ${s?"toggle--recommended":""}`,children:[t.jsx("input",{type:"checkbox",className:"toggle__input",checked:e,onChange:i=>n(i.target.checked),disabled:a}),t.jsx("span",{className:"toggle__slider"})]})}const Oo="https://api.allorigins.win/get?url=",Fo=e=>/\.(xml|rss|atom)$/i.test(e)||/feed|rss|atom/i.test(e),$o=async e=>{try{if(!e)return[];if(Fo(e))return[{title:"Custom Feed",url:e}];const n=encodeURIComponent(e),a=await(await fetch(`${Oo}${n}`)).json();if(!a.contents)throw new Error("Failed to fetch page content");const r=new DOMParser().parseFromString(a.contents,"text/html"),o=[];if(r.querySelectorAll('link[rel="alternate"][type="application/rss+xml"], link[rel="alternate"][type="application/atom+xml"]').forEach(c=>{let d=c.getAttribute("href");const h=c.getAttribute("title")||"RSS Feed";if(d&&!d.startsWith("http")){const u=new URL(e);d=new URL(d,u.origin).href}d&&o.push({title:h,url:d})}),o.length===0){const c=["/feed","/rss","/rss.xml","/atom.xml"],d=new URL(e).origin;c.forEach(h=>{o.push({title:`Possible Feed (${h})`,url:`${d}${h}`})})}return o}catch(n){return console.error("Feed discovery failed:",n),[]}},Bo="ver.12-02-26 time 17.41",Po=()=>{const{settings:e}=se(),[n,s]=x.useState([]),[a,i]=x.useState(null);x.useEffect(()=>{try{he&&typeof he.getLogs=="function"?s(he.getLogs()):s([])}catch(o){console.error("Failed to load logs",o),i(o.message)}},[]);const r=o=>{if(typeof o=="object")try{return JSON.stringify(o)}catch{return"[Circular Object]"}return String(o)};return a?t.jsxs("div",{className:"error-state",children:["Debug Error: ",a]}):t.jsxs("div",{className:"settings-tab-content",children:[t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ›"})," Debug Info"]}),t.jsxs("div",{className:"settings-card",children:[t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"App Version:"})," ",e?.appVersion||"Unknown"]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"User Agent:"})," ",navigator.userAgent]}),t.jsxs("div",{style:{fontSize:"0.8rem",marginBottom:"10px"},children:[t.jsx("strong",{children:"Screen:"})," ",window.innerWidth,"x",window.innerHeight]})]}),t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:"ðŸ“œ"})," Recent Logs"]}),t.jsx("div",{className:"settings-card",style:{maxHeight:"300px",overflowY:"auto",background:"black",color:"#0f0",fontFamily:"monospace",fontSize:"0.7rem",padding:"10px"},children:n.length===0?t.jsx("div",{children:"No logs available."}):n.map((o,l)=>t.jsxs("div",{style:{marginBottom:"4px",borderBottom:"1px solid #333",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[t.jsxs("span",{style:{color:"#888"},children:["[",new Date(o.timestamp).toLocaleTimeString(),"]"]})," ",t.jsxs("span",{style:{color:o.level==="error"?"red":o.level==="warn"?"orange":"#0f0"},children:[o.level.toUpperCase(),":"]})," ",r(o.message),o.details&&t.jsx("div",{style:{marginLeft:"15px",color:"#aaa",fontSize:"0.65rem"},children:r(o.details)})]},l))}),t.jsx("div",{className:"settings-card",children:t.jsx("button",{className:"btn btn--danger",onClick:()=>{window.confirm("Clear all data?")&&(localStorage.clear(),window.location.reload())},style:{width:"100%"},children:"Clear All Local Storage & Reload"})})]})},zo=e=>{const n=e||{},s=n.freshness?.maxBoost||3,a=n.source?.tier1Boost||5,i=n.visual?.videoBoost||1.3,r=n.geo?.cityMatch||1.5;let o=0;return s>=2.5&&s<=4?o+=1.5:s>1&&(o+=1),a>=4&&a<=7?o+=1.5:a>=2&&(o+=1),i>=1.2&&i<=1.5?o+=1:o+=.5,r>=1.3&&r<=2?o+=1:o+=.5,Math.min(5,Math.max(1,Math.round(o)))};function Ho(){const{settings:e,updateSettings:n,reloadSettings:s}=se(),[a,i]=x.useState("general"),[r,o]=x.useState(!1),[l,c]=x.useState(""),[d,h]=x.useState(!1),[u,g]=x.useState(null),[m,p]=x.useState({}),[w,b]=x.useState(null),[j,f]=x.useState({tier1:"",tier2:"",tier3:""}),[N,T]=x.useState({title:"Breaking: Major Economic Reforms Announced",description:"Government unveils new policy to boost GDP growth by 2%. Markets rally on the news.",source:"BBC News",age:2,section:"business",result:null});if(x.useEffect(()=>{if(!e?.rankingWeights)return;const y={title:N.title,description:N.description,source:N.source,publishedAt:Date.now()-N.age*60*60*1e3,section:N.section,imageUrl:null},A={...e,debugLogs:!0},S=_t(y,N.section,0,A);T(C=>({...C,result:{score:S,breakdown:y._scoreBreakdown}}))},[N.title,N.description,N.source,N.age,N.section,e]),!e)return t.jsx("div",{className:"loading",children:"Loading..."});const _=(y,A)=>{const S=y.split("."),C={...e};let k=C;for(let F=0;F<S.length-1;F++)k[S[F]]={...k[S[F]]},k=k[S[F]];k[S[S.length-1]]=A,n(C)},D=()=>{o(!0),setTimeout(()=>o(!1),2e3),s()},P=()=>{window.confirm("Reset all settings to defaults?")&&(n({...oe}),s())},I=(y,A)=>{if(!A||!A.trim())return;const S=y.split(".");let C=e;for(const k of S)C=C?.[k]||[];Array.isArray(C)||(C=[]),C.includes(A.trim())||_(y,[...C,A.trim()])},B=(y,A)=>{const S=y.split(".");let C=e;for(const k of S)C=C?.[k]||[];Array.isArray(C)&&_(y,C.filter(k=>k!==A))},$=(y,A)=>{I(y,A),p({...m,[y]:""})},M=(y,A)=>{if(!A||!A.trim())return;const S=e.sourceTiers?.[y]||[];S.some(C=>C.toLowerCase()===A.trim().toLowerCase())||_(`sourceTiers.${y}`,[...S,A.trim()]),f({...j,[y]:""})},v=(y,A)=>{const S=e.sourceTiers?.[y]||[];_(`sourceTiers.${y}`,S.filter(C=>C!==A))},L=async()=>{if(l){h(!0),g(null);try{const y=await $o(l);if(y.length>0){const A=y[0];n({...e,customFeeds:[...e.customFeeds||[],{title:A.title,url:A.url}]}),c("")}else g("No feeds found.")}catch{g("Error discovering feeds.")}finally{h(!1)}}},O=y=>{const A=[...e.customFeeds||[]];A.splice(y,1),n({...e,customFeeds:A})},R=()=>{const y={settings:e,hiddenEvents:JSON.parse(localStorage.getItem("upAhead_hiddenEvents")||"[]"),watchlist:JSON.parse(localStorage.getItem("upAhead_watchlist")||"[]"),readingHistory:e.readingHistory||[]},A="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(y,null,2)),S=document.createElement("a");S.setAttribute("href",A),S.setAttribute("download","news_app_full_backup.json"),document.body.appendChild(S),S.click(),S.remove()},H=y=>{const A=y.target.files[0];if(!A)return;const S=new FileReader;S.onload=C=>{try{const k=JSON.parse(C.target.result);window.confirm("Replace current settings, hidden events, and watchlist with imported data?")&&(k.settings?(n(k.settings),k.hiddenEvents&&localStorage.setItem("upAhead_hiddenEvents",JSON.stringify(k.hiddenEvents)),k.watchlist&&localStorage.setItem("upAhead_watchlist",JSON.stringify(k.watchlist))):n(k),s())}catch{alert("Invalid backup file")}},S.readAsText(A)},W=[{id:"general",label:"General",icon:"âš™ï¸"},{id:"ranking",label:"Ranking & Logic",icon:"ðŸ§ "},{id:"weather",label:"Weather",icon:"ðŸŒ¤ï¸"},{id:"sources",label:"Sources",icon:"ðŸ“¡"},{id:"market",label:"Market",icon:"ðŸ“ˆ"},{id:"sandbox",label:"Sandbox",icon:"ðŸ§ª"},{id:"advanced",label:"Advanced",icon:"ðŸ”§"},{id:"debug",label:"Debug",icon:"ðŸ›"}],E=()=>{switch(a){case"general":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“±",title:"Interface"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Home Layout",subLabel:"Timeline / Classic / Newspaper",children:t.jsxs("select",{value:e.uiMode||"timeline",onChange:y=>n({...e,uiMode:y.target.value}),className:"settings-select",children:[t.jsx("option",{value:"timeline",children:"ðŸ“± Timeline"}),t.jsx("option",{value:"classic",children:"ðŸ“Š Classic"}),t.jsx("option",{value:"newspaper",children:"ðŸ“° Newspaper"})]})}),t.jsx(J,{label:"Font Size",subLabel:`${e.fontSize||26}px`,children:t.jsx("input",{type:"range",min:"14",max:"34",step:"1",value:e.fontSize||26,onChange:y=>n({...e,fontSize:parseInt(y.target.value)}),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ¤–",title:"AI Configuration"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:"Gemini API Key"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)",fontSize:"0.65rem"},children:"Required for client-side fallback."})]}),t.jsx("input",{type:"password",value:e.geminiKey||"",onChange:y=>n({...e,geminiKey:y.target.value}),className:"settings-input",placeholder:"Enter API Key"})]})}),t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Data"}),t.jsx(ee,{children:t.jsxs("div",{className:"settings-item",style:{flexDirection:"column",alignItems:"stretch"},children:[t.jsx("div",{className:"settings-item__label",children:t.jsx("span",{children:"Alpha Vantage API Key"})}),t.jsx("input",{type:"password",value:e.alphaVantageKey||"",onChange:y=>n({...e,alphaVantageKey:y.target.value}),className:"settings-input",placeholder:"Enter AV Key"})]})})]});case"ranking":return t.jsx(Uo,{settings:e,updateNested:_,updateSettings:n,addToList:I,removeFromList:B});case"weather":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“",title:"Locations"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"10px"},children:"Active Cities"}),t.jsxs("div",{style:{display:"grid",gap:"10px",marginBottom:"10px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"1."}),t.jsx("input",{type:"text",value:"Chennai",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"2."}),t.jsx("input",{type:"text",value:"Trichy",disabled:!0,className:"settings-input",style:{opacity:.7}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{width:"20px"},children:"3."}),t.jsx("input",{type:"text",value:e.weather?.cities?.[2]||"Muscat",onChange:y=>{const A=[...e.weather?.cities||["chennai","trichy","muscat"]];A[2]=y.target.value,_("weather.cities",A)},className:"settings-input",placeholder:"Enter city..."})]})]})]}),t.jsx(Z,{icon:"ðŸŒ¤ï¸",title:"Weather Models"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ECMWF (European)",children:t.jsx(ge,{checked:e.weather?.models?.ecmwf!==!1,onChange:y=>_("weather.models.ecmwf",y)})}),t.jsx(J,{label:"GFS (NOAA)",children:t.jsx(ge,{checked:e.weather?.models?.gfs!==!1,onChange:y=>_("weather.models.gfs",y)})}),t.jsx(J,{label:"ICON (DWD)",children:t.jsx(ge,{checked:e.weather?.models?.icon!==!1,onChange:y=>_("weather.models.icon",y)})})]})]});case"sources":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“¡",title:"News Sources"}),t.jsxs(ee,{children:[t.jsxs("div",{className:"settings-item",style:{borderBottom:"1px solid var(--accent-danger)",background:"rgba(220, 38, 38, 0.15)",padding:"10px"},children:[t.jsxs("div",{className:"settings-item__label",style:{color:"var(--accent-danger)"},children:[t.jsx("span",{children:"ðŸ† Top Websites Only"}),t.jsx("small",{style:{display:"block",color:"var(--text-muted)"},children:"BBC, Reuters, NDTV, Hindu, TOI..."})]}),t.jsx(ge,{checked:e.topWebsitesOnly===!0,onChange:y=>n({...e,topWebsitesOnly:y})})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",padding:"10px"},children:Object.keys(e.newsSources||{}).map(y=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.8rem"},children:[t.jsx("input",{type:"checkbox",checked:e.newsSources?.[y]!==!1,onChange:A=>_(`newsSources.${y}`,A.target.checked),disabled:e.topWebsitesOnly}),y]},y))})]}),t.jsx(Z,{icon:"ðŸ†",title:"Source Tiers"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Classify sources to boost their ranking score."}),t.jsx(Me,{label:`Tier 1 (High Boost: ${e.rankingWeights?.source?.tier1Boost||.5}x)`,placeholder:"e.g. BBC, Reuters",value:j.tier1,onChange:y=>f({...j,tier1:y}),onAdd:()=>M("tier1",j.tier1),items:e.sourceTiers?.tier1||[],onRemove:y=>v("tier1",y)}),t.jsx(Me,{label:`Tier 2 (Medium Boost: ${e.rankingWeights?.source?.tier2Boost||.2}x)`,placeholder:"e.g. NDTV, Hindu",value:j.tier2,onChange:y=>f({...j,tier2:y}),onAdd:()=>M("tier2",j.tier2),items:e.sourceTiers?.tier2||[],onRemove:y=>v("tier2",y)}),t.jsx(Me,{label:`Tier 3 (No Boost: ${e.rankingWeights?.source?.tier3Boost||0}x)`,placeholder:"e.g. Local Blogs",value:j.tier3,onChange:y=>f({...j,tier3:y}),onAdd:()=>M("tier3",j.tier3),items:e.sourceTiers?.tier3||[],onRemove:y=>v("tier3",y)})]}),t.jsx(Z,{icon:"ðŸ”—",title:"Custom Feeds"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"10px"},children:[t.jsx("input",{type:"text",value:l,onChange:y=>c(y.target.value),placeholder:"RSS URL...",className:"settings-input"}),t.jsx("button",{className:"btn btn--primary",onClick:L,disabled:d,children:d?"...":"Add"})]}),u&&t.jsx("div",{style:{color:"red",fontSize:"0.75rem"},children:u}),e.customFeeds?.map((y,A)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",padding:"5px 0"},children:[t.jsx("span",{children:y.title||y.url}),t.jsx("button",{onClick:()=>O(A),style:{color:"red"},children:"âœ•"})]},A))]})]});case"upahead":return null;case"market":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ“ˆ",title:"Market Display"}),t.jsx(ee,{children:Object.keys(e.market||{}).filter(y=>y.startsWith("show")).map(y=>t.jsx(J,{label:y.replace("show",""),children:t.jsx(ge,{checked:e.market?.[y]!==!1,onChange:A=>_(`market.${y}`,A)})},y))})]});case"logic":return null;case"sandbox":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ§ª",title:"Ranking Sandbox"}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:`Simulate how the current settings affect an article's score. Change settings in the "Custom Ranking" tab to see impact here.`}),t.jsx(ee,{children:t.jsxs("div",{style:{display:"grid",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Title"}),t.jsx("input",{className:"settings-input",value:N.title,onChange:y=>T({...N,title:y.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Description"}),t.jsx("textarea",{className:"settings-input",style:{resize:"vertical",minHeight:"60px"},value:N.description,onChange:y=>T({...N,description:y.target.value})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Source"}),t.jsxs("select",{className:"settings-select",value:N.source,onChange:y=>T({...N,source:y.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"BBC News",children:"BBC (Tier 1)"}),t.jsx("option",{value:"Unknown Blog",children:"Blog (Tier 3)"}),t.jsx("option",{value:"NDTV",children:"NDTV (Tier 2)"}),t.jsx("option",{value:"TechCrunch",children:"TechCrunch"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:"Section"}),t.jsxs("select",{className:"settings-select",value:N.section,onChange:y=>T({...N,section:y.target.value}),style:{width:"100%"},children:[t.jsx("option",{value:"world",children:"World (High Priority)"}),t.jsx("option",{value:"business",children:"Business"}),t.jsx("option",{value:"technology",children:"Technology"}),t.jsx("option",{value:"general",children:"General"})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{style:{fontSize:"0.75rem",color:"var(--text-muted)",display:"block",marginBottom:"4px"},children:["Age: ",N.age," hours"]}),t.jsx("input",{type:"range",min:"0",max:"72",step:"1",value:N.age,onChange:y=>T({...N,age:parseInt(y.target.value)}),style:{width:"100%"}})]})]})}),N.result&&t.jsxs("div",{className:"settings-card",style:{border:"1px solid var(--accent-primary)",background:"rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{textAlign:"center",padding:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:"CALCULATED SCORE"}),t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"var(--accent-primary)"},children:N.result.score.toFixed(1)})]}),t.jsx("div",{style:{padding:"10px",fontSize:"0.75rem"},children:t.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:t.jsx("tbody",{children:Object.entries(N.result.breakdown||{}).map(([y,A])=>y==="total"||typeof A!="number"?null:t.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[t.jsx("td",{style:{padding:"4px",textTransform:"capitalize",color:"var(--text-secondary)"},children:y.replace(/([A-Z])/g," $1").trim()}),t.jsxs("td",{style:{padding:"4px",textAlign:"right",fontWeight:"bold",color:A>1.5?"#4f4":A<.5?"#f44":"#fff"},children:[A.toFixed(2),y.toLowerCase().includes("boost")||y.toLowerCase().includes("multiplier")?"x":""]})]},y))})})})]})]});case"advanced":return t.jsxs("div",{className:"settings-tab-content",children:[t.jsx(Z,{icon:"ðŸ”§",title:"Advanced"}),t.jsxs(ee,{children:[t.jsx(J,{label:"Enable News Cache",subLabel:"Faster loads, 5min TTL",children:t.jsx(ge,{checked:e.enableCache!==!1,onChange:y=>n({...e,enableCache:y})})}),t.jsx(J,{label:"Crawler Mode",children:t.jsxs("select",{value:e.crawlerMode||"auto",onChange:y=>n({...e,crawlerMode:y.target.value}),className:"settings-select",children:[t.jsx("option",{value:"auto",children:"Auto"}),t.jsx("option",{value:"manual",children:"Manual"})]})}),t.jsx(J,{label:"Debug Logs",children:t.jsx(ge,{checked:e.debugLogs===!0,onChange:y=>n({...e,debugLogs:y})})})]}),t.jsx(Z,{icon:"ðŸ•µï¸",title:"Impact & Priority"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ’¥ Base Impact Weight",subLabel:"Multiplier",children:t.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:e.rankingWeights?.impact?.boost||1,onChange:y=>_("rankingWeights.impact.boost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ High Impact Boost",subLabel:"Triggers on Major Event Keywords",children:t.jsx("input",{type:"range",min:"1.0",max:"5.0",step:"0.1",value:e.rankingWeights?.impact?.highImpactBoost||2.5,onChange:y=>_("rankingWeights.impact.highImpactBoost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(Me,{label:"Major Event Keywords",placeholder:"e.g. Budget, Treaty, War",value:m.highImpact,onChange:y=>p({...m,highImpact:y}),onAdd:()=>$("highImpactKeywords",m.highImpact),items:e.highImpactKeywords||[],onRemove:y=>B("highImpactKeywords",y)}),t.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"5px"},children:["â„¹ï¸ Articles containing these words receive the ",t.jsx("strong",{children:"High Impact Boost"})," (above)."]})]}),t.jsx(Z,{icon:"âš¡",title:"Buzz Ranking"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:'Configuration for "Buzz" and "Social" sections.'}),t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:y=>_("buzzRankingWeights.visual.videoBoost",parseFloat(y.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:y=>_("buzzRankingWeights.trending.threshold",parseFloat(y.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ”„",title:"Backup & Sync"}),t.jsxs(ee,{children:[t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{className:"btn btn--secondary",onClick:R,style:{flex:1},children:"Export Backup"}),t.jsxs("label",{className:"btn btn--secondary",style:{flex:1,cursor:"pointer",textAlign:"center"},children:["Import Backup",t.jsx("input",{type:"file",accept:".json",onChange:H,style:{display:"none"}})]})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"8px"},children:"Saves Settings, Hidden Events (Plan My Week), and Watchlist to a file."})]})]});case"debug":return t.jsx(Po,{});default:return null}};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[t.jsx(_e,{title:"Settings",showBack:!0,backTo:"/",compact:!0,style:{flex:"0 0 auto"}}),t.jsxs("div",{className:"settings-layout",children:[t.jsx("div",{className:"settings-sidebar",children:W.map(y=>t.jsxs("button",{className:`settings-tab-btn ${a===y.id?"active":""}`,onClick:()=>i(y.id),children:[t.jsx("span",{className:"tab-icon",children:y.icon}),t.jsx("span",{className:"tab-label",children:y.label})]},y.id))}),t.jsxs("div",{className:"settings-content",children:[t.jsx("div",{className:"settings-scroll-area",style:{overflowY:a==="ranking"?"hidden":"auto",padding:a==="ranking"?0:"15px"},children:E()}),t.jsxs("div",{className:"settings-footer",children:[t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx("button",{className:"btn btn--danger",onClick:P,style:{flex:1},children:"Reset"}),t.jsx("button",{className:"btn btn--primary",onClick:D,style:{flex:1},children:r?"âœ“ Saved":"Save"})]}),t.jsx("div",{className:"version-tag",children:Bo})]})]})]}),t.jsx("style",{children:`
                .settings-layout { display: flex; flex: 1; overflow: hidden; background: var(--bg-primary); }
                .settings-sidebar { width: 60px; background: var(--bg-secondary); border-right: 1px solid var(--border-default); display: flex; flex-direction: column; padding: 10px 5px; overflow-y: auto; flex-shrink: 0; }
                .settings-tab-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 5px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 8px; margin-bottom: 5px; }
                .settings-tab-btn.active { background: var(--accent-primary); color: #fff; }
                .tab-icon { font-size: 1.5rem; } .tab-label { display: none; }
                .settings-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
                .settings-scroll-area { flex: 1; overflow-y: auto; padding: 15px; }
                .settings-footer { flex-shrink: 0; background: var(--bg-secondary); border-top: 1px solid var(--border-default); padding: 15px; }
                .settings-card { background: var(--bg-card); border-radius: var(--radius-md); padding: 15px; margin-bottom: 20px; border: 1px solid var(--border-default); }
                .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
                .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
                .settings-item:last-child { border-bottom: none; }
                .settings-select, .settings-input, .settings-input-number { background: var(--bg-secondary); border: 1px solid var(--border-default); color: var(--text-primary); padding: 8px; border-radius: 4px; font-size: 0.85rem; }
                .settings-input { width: 100%; }
                .chip-checkbox { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 16px; border: 1px solid var(--border-default); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.8rem; cursor: pointer; }
                .chip-checkbox.active { background: var(--accent-primary); color: #fff; border-color: var(--accent-primary); }
                .keyword-chip { display: inline-flex; align-items: center; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; margin: 2px; font-size: 0.75rem; }
                .keyword-chip button { background: none; border: none; color: var(--accent-danger); margin-left: 6px; cursor: pointer; padding: 0; }
                .version-tag { text-align: right; font-size: 0.7rem; color: var(--text-muted); margin-top: 8px; font-family: monospace; opacity: 0.7; }
            `})]})}const Uo=({settings:e,updateNested:n,updateSettings:s,addToList:a,removeFromList:i})=>{const[r,o]=x.useState("main"),[l,c]=x.useState("entertainment"),[d,h]=x.useState("movies"),[u,g]=x.useState({}),m=(j,f)=>g(N=>({...N,[j]:f})),p=()=>{const j=zo(e.rankingWeights||{});return t.jsxs("div",{children:[t.jsx("div",{className:"settings-card",style:{background:"linear-gradient(135deg, rgba(255,215,0,0.1), rgba(0,0,0,0))",border:"1px solid rgba(255,215,0,0.3)"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("div",{style:{fontWeight:600,color:"#FFD700"},children:"â˜… Quality Rating"})}),t.jsxs("div",{style:{fontSize:"1.8rem",color:"#FFD700"},children:["â˜…".repeat(j),"â˜†".repeat(5-j)]})]})}),t.jsx(Z,{icon:"ðŸ†",title:"Top Stories & Global"}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ† Top Stories Boost",subLabel:"Min Score for Top Stories",children:t.jsx("input",{type:"range",min:"8",max:"30",step:"1",value:e.rankingWeights?.trending?.threshold||12,onChange:f=>n("rankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“Œ Keyword Match",subLabel:`+${(e.rankingWeights?.keyword?.matchBoost||2).toFixed(1)} Points`,children:t.jsx("input",{type:"range",min:"0",max:"5",step:"0.5",value:e.rankingWeights?.keyword?.matchBoost||2,onChange:f=>n("rankingWeights.keyword.matchBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ“ Location Match",subLabel:`${(e.rankingWeights?.geo?.cityMatch||1.5).toFixed(1)}x Multiplier`,children:t.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:e.rankingWeights?.geo?.cityMatch||1.5,onChange:f=>n("rankingWeights.geo.cityMatch",parseFloat(f.target.value)),style:{width:"100%"}})})]}),t.jsx(Z,{icon:"ðŸ“‰",title:"Freshness & Decay"}),t.jsxs(ee,{children:[t.jsxs(J,{label:"ðŸŽšï¸ Freshness Sensitivity",subLabel:"Left: Stricter (Newer) | Right: Relaxed",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",gap:"10px"},children:[t.jsx("span",{title:"Strict/Fresh",style:{fontSize:"1.2rem"},children:"âš¡"}),t.jsx("input",{type:"range",min:"6",max:"72",value:e.rankingWeights?.freshness?.decayHours||26,onChange:f=>n("rankingWeights.freshness.decayHours",parseInt(f.target.value)),style:{flex:1}}),t.jsx("span",{title:"Relaxed/Older",style:{fontSize:"1.2rem"},children:"ðŸ¢"})]}),t.jsxs("div",{style:{textAlign:"right",fontSize:"0.7rem",color:"var(--text-muted)"},children:["Decay over ",e.rankingWeights?.freshness?.decayHours||26,"h"]})]}),t.jsx(J,{label:"ðŸ“‰ Hide Stale News",subLabel:`> ${e.hideOlderThanHours||60}h`,children:t.jsx("input",{type:"number",min:1,max:168,value:e.hideOlderThanHours||60,onChange:f=>s({...e,hideOlderThanHours:parseInt(f.target.value)||60}),className:"settings-input-number",style:{width:"60px"}})})]}),t.jsx(Z,{icon:"ðŸ§ ",title:"Classification Logic"}),t.jsxs(ee,{children:[t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:"Automatic categorization logic."}),t.jsx("div",{className:"settings-item__label",style:{color:"var(--accent-primary)",marginTop:"10px"},children:"Entity Overrides (Exact Matches)"}),t.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"8px",margin:"5px 0 15px 0",fontSize:"0.75rem",fontFamily:"monospace"},children:Object.entries(Wn).map(([f,N])=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("span",{style:{color:"var(--text-primary)"},children:f}),t.jsxs("span",{style:{color:"var(--text-muted)"},children:["â†’ ",N]})]},f))})]})]})},w=()=>{const j=[{id:"entertainment",label:"Entertain",icon:"ðŸŽ¬"},{id:"technology",label:"Tech",icon:"ðŸ’»"},{id:"sports",label:"Sports",icon:"âš½"},{id:"social",label:"Social",icon:"ðŸ”¥"}];return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:j.map(f=>t.jsxs("button",{onClick:()=>c(f.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:l===f.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:l===f.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:f.icon}),f.label]},f.id))}),t.jsx("div",{style:{flex:1,overflowY:"auto"},children:l==="social"?t.jsxs("div",{children:[t.jsx(Z,{icon:"ðŸ”¥",title:"Social Trends"}),t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:["Uses ",t.jsx("strong",{children:"Legacy Scoring"})," (Freshness + Source)."]}),t.jsxs(ee,{children:[t.jsx(J,{label:"ðŸ“¸ Visual Boost",subLabel:"Videos/Images",children:t.jsx("input",{type:"range",min:"1.0",max:"3.0",step:"0.1",value:e.buzzRankingWeights?.visual?.videoBoost||2,onChange:f=>n("buzzRankingWeights.visual.videoBoost",parseFloat(f.target.value)),style:{width:"100%"}})}),t.jsx(J,{label:"ðŸ”¥ Trend Threshold",subLabel:"Lower = More Trending",children:t.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:e.buzzRankingWeights?.trending?.threshold||10,onChange:f=>n("buzzRankingWeights.trending.threshold",parseFloat(f.target.value)),style:{width:"100%"}})})]})]}):t.jsx(Rn,{title:l.charAt(0).toUpperCase()+l.slice(1),icon:j.find(f=>f.id===l).icon,configPath:`buzz.${l}`,configData:e.buzz?.[l]||{},updateNested:n,addToList:a,removeFromList:i,localInputs:u,handleLocalInput:m,subTab:l})})]})},b=()=>{const j=[{id:"movies",label:"Movies",icon:"ðŸŽ¬"},{id:"events",label:"Events",icon:"ðŸŽ¤"},{id:"festivals",label:"Festivals",icon:"ðŸª”"},{id:"sports",label:"Sports",icon:"âš½"},{id:"shopping",label:"Shopping",icon:"ðŸ›’"},{id:"airlines",label:"Airlines",icon:"âœˆï¸"},{id:"alerts",label:"Alerts",icon:"âš ï¸"},{id:"civic",label:"Civic",icon:"ðŸ›ï¸"}],f=e.upAhead?.ranking?.[d]||{},N=v=>{const L=v==="positive"?e.upAhead?.keywords?.[d]:e.upAhead?.keywords?.[`${d}_negative`];return L&&L.length>0?L:(v==="positive"?oe.upAhead.keywords[d]:oe.upAhead.keywords[`${d}_negative`])||[]},T=N("positive"),_=N("negative"),D=()=>{const v=e.upAhead?.keywords?.negative;return v&&v.length>0?v:oe.upAhead.keywords.negative||[]},P=D(),I={enabled:e.upAhead?.categories?.[d]!==!1,positiveMultiplier:f.positiveMultiplier||1,negativeMultiplier:f.negativeMultiplier||1,filterThreshold:f.filterThreshold||0,positiveKeywords:T,negativeKeywords:[...P,..._]},B=(v,L)=>{v==="enabled"?n(`upAhead.categories.${d}`,L):(v==="positiveMultiplier"||v==="negativeMultiplier"||v==="filterThreshold")&&n(`upAhead.ranking.${d}.${v}`,L)},$=(v,L)=>{if(!L||!L.trim())return;const O=L.trim();if(v==="positiveKeywords"){const R=N("positive");if(R.some(H=>H.toLowerCase()===O.toLowerCase()))return;n(`upAhead.keywords.${d}`,[...R,O])}else if(v==="negativeKeywords"){const R=N("negative");if(R.some(H=>H.toLowerCase()===O.toLowerCase()))return;n(`upAhead.keywords.${d}_negative`,[...R,O])}},M=(v,L)=>{if(v==="positiveKeywords"){const R=N("positive").filter(H=>H!==L);n(`upAhead.keywords.${d}`,R)}else if(v==="negativeKeywords"){const O=N("negative");if(O.includes(L)){const R=O.filter(H=>H!==L);n(`upAhead.keywords.${d}_negative`,R)}else{const R=D();if(R.includes(L)&&window.confirm(`"${L}" is a global negative keyword. Remove it from ALL categories?`)){const H=R.filter(W=>W!==L);n("upAhead.keywords.negative",H)}}}};return t.jsxs("div",{style:{display:"flex",height:"100%",gap:"10px"},children:[t.jsx("div",{style:{width:"70px",flexShrink:0,display:"flex",flexDirection:"column",gap:"5px"},children:j.map(v=>t.jsxs("button",{onClick:()=>h(v.id),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",border:"none",background:d===v.id?"var(--accent-primary)":"rgba(255,255,255,0.05)",color:d===v.id?"#fff":"var(--text-secondary)",borderRadius:"8px",cursor:"pointer",fontSize:"0.7rem",fontWeight:500},children:[t.jsx("span",{style:{fontSize:"1.3rem",marginBottom:"2px"},children:v.icon}),v.label]},v.id))}),t.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[t.jsx(Z,{icon:"ðŸŒ",title:"Global Config"}),t.jsxs(ee,{children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"5px"},children:"Locations"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px"},children:["Chennai","Muscat","Trichy"].map(v=>t.jsxs("label",{className:`chip-checkbox ${e.upAhead?.locations?.includes(v)?"active":""}`,children:[t.jsx("input",{type:"checkbox",style:{display:"none"},checked:e.upAhead?.locations?.includes(v)||!1,onChange:L=>{const O=e.upAhead?.locations||[],R=L.target.checked?[...O,v]:O.filter(H=>H!==v);n("upAhead.locations",R)}}),v]},v))})]}),t.jsx(Rn,{title:j.find(v=>v.id===d).label,icon:j.find(v=>v.id===d).icon,configData:I,customUpdate:B,customAdd:$,customRemove:M,localInputs:u,handleLocalInput:m,subTab:`ua_${d}`})]})]})};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",padding:"0 15px",flexShrink:0},children:[t.jsx("button",{className:`btn ${r==="main"?"btn--primary":"btn--secondary"}`,onClick:()=>o("main"),style:{flex:1},children:"âš™ï¸ Main"}),t.jsx("button",{className:`btn ${r==="buzz"?"btn--primary":"btn--secondary"}`,onClick:()=>o("buzz"),style:{flex:1},children:"âš¡ Buzz"}),t.jsx("button",{className:`btn ${r==="upahead"?"btn--primary":"btn--secondary"}`,onClick:()=>o("upahead"),style:{flex:1},children:"ðŸ—“ï¸ Up Ahead"})]}),t.jsxs("div",{className:"settings-tab-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"0 15px 15px 15px"},children:[r==="main"&&p(),r==="buzz"&&w(),r==="upahead"&&b()]})]})},Rn=({title:e,icon:n,configPath:s,configData:a,updateNested:i,addToList:r,removeFromList:o,localInputs:l,handleLocalInput:c,subTab:d,customUpdate:h,customAdd:u,customRemove:g})=>{const m=(b,j)=>{h?h(b,j):i(`${s}.${b}`,j)},p=(b,j)=>{u?u(b,j):r(`${s}.${b}`,j)},w=(b,j)=>{g?g(b,j):o(`${s}.${b}`,j)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[t.jsx(Z,{icon:n,title:e}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:a.enabled!==!1?"Active":"Disabled"}),t.jsx(ge,{checked:a.enabled!==!1,onChange:b=>m("enabled",b)})]})]}),t.jsxs(ee,{children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"15px"},children:[t.jsx("strong",{children:"Ranking Formula:"})," (Positive Matches Ã— Multiplier) â€” (Negative Matches Ã— Multiplier)"]}),t.jsxs("div",{style:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#81c784"},children:"âœ… Positive Boost"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[a.positiveMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:a.positiveMultiplier||1,onChange:b=>m("positiveMultiplier",parseFloat(b.target.value)),style:{width:"80px"}})]})]}),t.jsx(Me,{label:"",placeholder:"Add positive keyword...",value:l[`${d}_pos`]||"",onChange:b=>c(`${d}_pos`,b),onAdd:()=>{p("positiveKeywords",l[`${d}_pos`]),c(`${d}_pos`,"")},items:a.positiveKeywords||[],onRemove:b=>w("positiveKeywords",b)})]}),t.jsxs("div",{style:{background:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"8px",padding:"15px",marginBottom:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t.jsx("div",{style:{fontWeight:600,color:"#e57373"},children:"ðŸš« Negative Penalty"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",background:"rgba(0,0,0,0.3)",padding:"4px 8px",borderRadius:"6px"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"#fff"},children:["Multi: ",t.jsxs("strong",{children:[a.negativeMultiplier||1,"x"]})]}),t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:a.negativeMultiplier||1,onChange:b=>m("negativeMultiplier",parseFloat(b.target.value)),style:{width:"80px"}})]})]}),t.jsx(Me,{label:"",placeholder:"Add negative keyword...",value:l[`${d}_neg`]||"",onChange:b=>c(`${d}_neg`,b),onAdd:()=>{p("negativeKeywords",l[`${d}_neg`]),c(`${d}_neg`,"")},items:a.negativeKeywords||[],onRemove:b=>w("negativeKeywords",b)})]}),t.jsx(J,{label:"ðŸ›¡ï¸ Filter Threshold",subLabel:`Hide if Score < ${a.filterThreshold||0}`,children:t.jsx("input",{type:"range",min:"-5",max:"5",step:"1",value:a.filterThreshold||0,onChange:b=>m("filterThreshold",parseInt(b.target.value)),style:{width:"100%"}})})]})]})},Z=({icon:e,title:n})=>t.jsxs("div",{className:"section-title",children:[t.jsx("span",{children:e})," ",n]}),ee=({children:e})=>t.jsx("div",{className:"settings-card",children:e}),J=({label:e,subLabel:n,children:s})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",children:[t.jsx("span",{children:e}),n&&t.jsx("small",{children:n})]}),t.jsx("div",{style:{flex:"0 0 auto",marginLeft:"10px"},children:s})]}),Me=({label:e,placeholder:n,value:s,onChange:a,onAdd:i,items:r,onRemove:o})=>t.jsxs("div",{style:{marginBottom:"15px"},children:[t.jsx("div",{className:"settings-item__label",style:{marginBottom:"6px"},children:e}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[t.jsx("input",{type:"text",value:s,onChange:l=>a(l.target.value),placeholder:n,className:"settings-input",onKeyDown:l=>l.key==="Enter"&&i()}),t.jsx("button",{className:"btn btn--secondary",onClick:i,style:{padding:"0 15px"},children:"Add"})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[r.map((l,c)=>t.jsxs("span",{className:"keyword-chip",children:[l,t.jsx("button",{onClick:()=>o(l),children:"Ã—"})]},c)),r.length===0&&t.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Default keywords only"})]})]});function Wo(){const e=Nt(),[n,s]=x.useState(()=>rn(Qe())),[a,i]=x.useState(!1),[r,o]=x.useState(()=>Ps()),[l]=x.useState(()=>rn(Qe())),{refreshWeather:c}=at(),{refreshNews:d}=it(),h=async()=>{i(!0);const p=Object.keys(n).filter(j=>n[j]),w=[],b=[];p.forEach(j=>{j==="weather"?(w.push(c(!0)),mt("weather")):j==="market"?mt("market"):(b.push(j),mt(j))}),b.length>0&&w.push(d(b));try{await Promise.all(w)}catch(j){console.error("Refresh failed",j)}o("Just now"),i(!1),setTimeout(()=>e("/"),500)},u=p=>{s({world:p,india:p,chennai:p,trichy:p,local:p,social:p,weather:p,market:p})},g=[{key:"world",icon:"ðŸŒ",label:"World News",desc:"International headlines"},{key:"india",icon:"ðŸ‡®ðŸ‡³",label:"India News",desc:"National news"},{key:"chennai",icon:"ðŸ›ï¸",label:"Chennai News",desc:"Chennai city updates"},{key:"trichy",icon:"ðŸ›ï¸",label:"Trichy News",desc:"Trichy local news"},{key:"local",icon:"ðŸ“",label:"Local (Muscat)",desc:"Muscat & Oman news"},{key:"social",icon:"ðŸ‘¥",label:"Social Trends",desc:"Trending topics"},{key:"weather",icon:"â˜ï¸",label:"Weather",desc:"Chennai, Trichy, Muscat"},{key:"market",icon:"ðŸ“ˆ",label:"Market",desc:"BSE, NSE, Movers"}],m=Object.values(n).filter(Boolean).length;return t.jsxs(t.Fragment,{children:[t.jsx(_e,{title:"Refresh Content",showBack:!0,backTo:"/"}),t.jsxs("div",{className:"refresh-page",children:[t.jsxs("div",{className:"refresh-info",children:[t.jsx("span",{children:"â±ï¸"}),t.jsxs("span",{children:["Last refresh: ",t.jsx("strong",{children:r})]})]}),t.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"},children:[t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>u(!0),children:"Select All"}),t.jsx("button",{className:"btn btn--secondary",style:{flex:1},onClick:()=>u(!1),children:"Clear All"})]}),t.jsxs("section",{className:"settings-section",children:[t.jsxs("h2",{className:"settings-section__title",children:[t.jsx("span",{children:"ðŸ“‹"}),"Select Sections to Refresh",t.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.8rem",fontWeight:"normal",color:"var(--accent-primary)"},children:[m,"/",g.length]})]}),t.jsx("div",{className:"settings-card",children:g.map(({key:p,icon:w,label:b,desc:j})=>t.jsxs("div",{className:"settings-item",children:[t.jsxs("div",{className:"settings-item__label",style:{flexDirection:"column",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-sm)"},children:[t.jsx("span",{className:"settings-item__icon",children:w}),b,l[p]&&t.jsx("span",{style:{color:"var(--weather-sun)",fontSize:"0.7rem"},children:"â˜…"})]}),t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginLeft:"28px"},children:j})]}),t.jsx(ge,{checked:n[p],onChange:f=>s(N=>({...N,[p]:f})),recommended:l[p]})]},p))})]}),t.jsxs("button",{className:`refresh-btn ${a?"refresh-btn--loading":""}`,onClick:h,disabled:a||m===0,children:[t.jsx("span",{className:"refresh-btn__icon",children:a?"âŸ³":"ðŸ”„"}),t.jsx("span",{children:a?"Refreshing...":"Refresh Now"})]}),t.jsxs("div",{className:"schedule-card",children:[t.jsxs("div",{className:"schedule-card__title",children:[t.jsx("span",{children:"ðŸ“Š"}),"Auto-Refresh Schedule"]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Forecast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 3 hours"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Weather Nowcast"}),t.jsx("span",{className:"schedule-item__value",children:"Every 1 hour"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"News Updates"}),t.jsx("span",{className:"schedule-item__value",children:"Every 30 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Market Data"}),t.jsx("span",{className:"schedule-item__value",children:"Every 5 minutes"})]}),t.jsxs("div",{className:"schedule-item",children:[t.jsx("span",{className:"schedule-item__label",children:"Social Trends"}),t.jsx("span",{className:"schedule-item__value",children:"Every 15 minutes"})]})]}),t.jsxs("div",{className:"card",style:{marginTop:"var(--spacing-md)",textAlign:"center"},children:[t.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:["Current Segment: ",t.jsx("strong",{style:{color:"var(--accent-primary)"},children:Qe()?.name})]}),t.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"4px"},children:"â˜… = Recommended sections for this time"})]})]})]})}function hs(e,n={}){const{country:s="IN",lang:a="en",timeRange:i="7d",excludeTerms:r=[]}=n;let o=encodeURIComponent(e);i&&(o+=`+when:${i}`),Array.isArray(r)&&r.forEach(h=>{o+=`+-${encodeURIComponent(h)}`});const l=`${a}-${s}`,c=s,d=`${s}:${a}`;return`https://news.google.com/rss/search?q=${o}&hl=${l}&gl=${c}&ceid=${d}`}async function ms(e){try{const n=hs(e.query||e.name,e.options||{});console.log(`[TopicService] Fetching news for "${e.name}"`);const s=await be(n,"following");Us(e.id);const a=V(),i=a.hideOlderThanHours||60,r=Date.now(),o=i*60*60*1e3,l=a.strictFreshness!==!1;let c=s;return l&&(c=s.filter(h=>h.publishedAt?r-h.publishedAt<=o:!1),console.log(`[TopicService] Filtered ${s.length-c.length} old articles for "${e.name}" (Limit: ${i}h)`)),c.map(h=>({...h,topicId:e.id,topicName:e.name,context:"following"}))}catch(n){return console.error(`[TopicService] Failed to fetch topic "${e.name}":`,n),[]}}async function Go(e){if(!e||e.length===0)return{};const n=e.map(r=>ms(r)),a=(await Promise.all(n)).flat(),i={};return a.forEach(r=>{r&&r.topicId&&(i[r.topicId]||(i[r.topicId]=[]),i[r.topicId].push(r))}),i}const ps=x.createContext();function Ko({children:e}){const[n,s]=x.useState([]),[a,i]=x.useState({}),[r,o]=x.useState(!1),[l,c]=x.useState([]);x.useEffect(()=>{const b=V();s(b.followedTopics||[]),p()},[]),x.useEffect(()=>{if(n.length===0)return;d(!1);const b=setInterval(()=>{console.log("[TopicContext] Auto-refreshing topics..."),d(!0)},900*1e3);return()=>clearInterval(b)},[n.length]);const d=async(b=!1)=>{if(n.length!==0){b||o(!0);try{const j=await Go(n);b&&h(j),i(j)}catch(j){console.error("[TopicContext] Failed to refresh topics:",j)}finally{b||o(!1)}}},h=b=>{let j=0,f="";if(Object.entries(b).forEach(([N,T])=>{const _=a[N]||[];if(T.length>0&&_.length>0&&T[0].id!==_[0].id){j++;const D=n.find(P=>P.id===N);D&&(f=D.name)}}),j>0){const N=j===1?`New update for ${f}`:`Updates in ${j} followed topics`;ts(N,{body:"Click to see the latest stories.",tag:"topic-update"})}},u=b=>{zs(b);const j=V();s(j.followedTopics||[]),setTimeout(()=>d(!1),50)},g=b=>{Hs(b),s(f=>f.filter(N=>N.id!==b));const j={...a};delete j[b],i(j)},m=b=>{Bn(b),p()},p=()=>{const b=Ks();c(b)},w={followedTopics:n,topicNews:a,loading:r,suggestions:l,addTopic:u,removeTopic:g,refreshTopics:d,addToHistory:m};return t.jsx(ps.Provider,{value:w,children:e})}function gs(){return x.useContext(ps)}function Vo({topic:e,articleCount:n,onClick:s,onRemove:a}){const i=Nt(),r=e.lastFetched?qo(new Date(e.lastFetched)):"Never updated",o=()=>{s?s(e):i(`/following/${e.id}`)};return t.jsxs("div",{className:"topic-card",onClick:o,children:[t.jsx("div",{className:"topic-card__icon",children:e.icon||"ðŸ“°"}),t.jsxs("div",{className:"topic-card__content",children:[t.jsx("h3",{className:"topic-card__name",children:e.name}),t.jsxs("p",{className:"topic-card__update",children:["Last update: ",r]})]}),t.jsx("div",{className:"topic-card__badge",children:n>0&&t.jsxs("span",{className:"topic-card__count",children:[n," new"]})}),t.jsx("button",{className:"topic-card__menu",onClick:l=>{l.stopPropagation(),window.confirm(`Stop following "${e.name}"?`)&&a(e.id)},"aria-label":"Remove topic",children:"â‹®"})]})}function qo(e){if(!e)return"Never";const n=Math.floor((Date.now()-e)/6e4);if(n<1)return"Just now";if(n<60)return`${n} min${n>1?"s":""} ago`;const s=Math.floor(n/60);return s<24?`${s} hour${s>1?"s":""} ago`:`${Math.floor(s/24)} days ago`}function Yo({onAddTopic:e}){const[n,s]=x.useState(""),[a,i]=x.useState([]),[r,o]=x.useState(!1),l=async d=>{if(d.preventDefault(),!!n.trim()){o(!0);try{const h=hs(n),u=await be(h,"preview");i(u.slice(0,5))}catch(h){console.error("Search failed:",h),alert("Failed to find news for this topic. Try different keywords.")}finally{o(!1)}}},c=()=>{const d={name:n,query:n,icon:Jo(n),options:{country:"IN",lang:"en",timeRange:"30d"}};e(d),s(""),i([])};return t.jsxs("div",{className:"topic-search",children:[t.jsxs("form",{onSubmit:l,children:[t.jsx("input",{type:"text",placeholder:"Search topics... (e.g., Tamil Nadu Elections)",value:n,onChange:d=>s(d.target.value),className:"topic-search__input"}),t.jsx("button",{type:"submit",disabled:r,children:r?"...":"Search"})]}),a.length>0&&t.jsxs("div",{className:"topic-search__preview",children:[t.jsxs("h4",{children:['Preview: "',n,'"']}),t.jsx("ul",{children:a.map((d,h)=>t.jsx("li",{children:d.title},h))}),t.jsxs("button",{onClick:c,className:"topic-search__follow-btn",children:['âž• Follow "',n,'"']})]})]})}function Jo(e){const n=e.toLowerCase();return n.includes("election")?"ðŸ—³ï¸":n.includes("market")||n.includes("stock")||n.includes("sensex")?"ðŸ“Š":n.includes("film")||n.includes("movie")||n.includes("cinema")?"ðŸŽ¬":n.includes("sport")||n.includes("cricket")||n.includes("ipl")?"ðŸ":n.includes("tech")||/\bai\b/.test(n)||n.includes("startup")?"ðŸ’»":n.includes("weather")||n.includes("rain")?"â˜ï¸":"ðŸ“°"}function Xo(){const{followedTopics:e,topicNews:n,loading:s,suggestions:a,addTopic:i,removeTopic:r,refreshTopics:o}=gs();x.useEffect(()=>{},[]);const l=e.length>0,c=d=>{i({name:d,query:d,icon:"ðŸ”",options:{country:"IN",lang:"en",timeRange:"30d"}})};return t.jsxs("div",{className:"following-page",children:[t.jsx("header",{className:"following-page__header",children:t.jsx("h1",{children:"ðŸ“Œ Following"})}),t.jsxs("div",{className:"following-page__content",children:[t.jsx(Yo,{onAddTopic:i}),a.length>0&&t.jsxs("div",{className:"following-page__suggestions-section",children:[t.jsx("h4",{children:"Suggested for you"}),t.jsx("div",{className:"following-page__suggestions",children:a.map((d,h)=>t.jsxs("button",{className:"suggestion-chip",onClick:()=>c(d.word),children:["+ ",d.word]},h))})]}),s&&t.jsx("p",{children:"Loading updates..."}),l?t.jsxs("div",{className:"following-page__topics",children:[t.jsx("h2",{className:"following-page__section-title",children:"Your Topics"}),e.map(d=>t.jsx(Vo,{topic:d,articleCount:n[d.id]?.length||0,onRemove:r},d.id))]}):t.jsxs("div",{className:"following-page__empty",children:[t.jsx("p",{children:"No topics followed yet."}),t.jsx("p",{children:"Search for topics above to get started!"})]})]})]})}function Qo(){const{topicId:e}=Ts(),n=Nt(),{followedTopics:s,addToHistory:a}=gs(),[i,r]=x.useState([]),[o,l]=x.useState(!0),c=s.find(d=>d.id===e);return x.useEffect(()=>{if(!c)return;(async()=>{l(!0);try{const h=await ms(c);r(h)}catch(h){console.error(h)}finally{l(!1)}})()},[e,c]),c?t.jsxs("div",{className:"page-container",children:[t.jsxs("header",{className:"header",style:{position:"sticky",top:0,zIndex:100,background:"var(--bg-secondary)",borderBottom:"1px solid var(--border-color)",padding:"10px 15px",display:"flex",alignItems:"center",gap:"15px"},children:[t.jsx("button",{onClick:()=>n("/following"),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"var(--text-primary)"},children:"â†"}),t.jsxs("h1",{style:{margin:0,fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:c?.icon}),c?.name]})]}),t.jsx("main",{className:"main-content",style:{paddingTop:"0"},children:o?t.jsxs("div",{className:"loading",style:{padding:"20px",textAlign:"center"},children:[t.jsx("div",{className:"loading__spinner"}),t.jsx("p",{children:"Fetching latest news..."})]}):t.jsx("div",{style:{padding:"10px"},children:t.jsx(ue,{id:`topic-${e}`,title:`Latest on ${c?.name}`,icon:c?.icon,news:i,maxDisplay:50,showExpand:!1,colorClass:"news-section__title--world",onArticleClick:d=>a(d)})})})]}):t.jsx("div",{className:"page-container",children:t.jsxs("div",{className:"loading",style:{padding:"20px"},children:[t.jsx("p",{children:"Loading topic..."}),t.jsx("button",{onClick:()=>n("/following"),children:"Back to List"})]})})}function Zo(){const{isWebView:e}=ot(),n=Ln(),s=[{path:"/",label:"Main",icon:"ðŸ "},{path:"/up-ahead",label:"Up Ahead",icon:"ðŸ—“ï¸"},{path:"/following",label:"Follow",icon:"ðŸ“Œ"},{path:"/newspaper",label:"Paper",icon:"ðŸ“°"},{path:"/markets",label:"Market",icon:"ðŸ“ˆ"},{path:"/tech-social",label:"Buzz",icon:"ðŸŽ­"},{path:"/weather",label:"Weather",icon:"â˜ï¸"},{path:"/settings",label:"Settings",icon:"âš™ï¸"}];return t.jsx("nav",{className:`bottom-nav ${e?"bottom-nav--desktop":""}`,children:s.map(a=>t.jsxs(Is,{to:a.path,className:`bottom-nav__item ${n.pathname===a.path?"active":""}`,title:a.label,children:[t.jsx("span",{className:"bottom-nav__icon",children:a.icon}),t.jsx("span",{className:"bottom-nav__label",children:a.label})]},a.path))})}const el=300*1e3;function tl(){const{pathname:e}=Ln();return x.useEffect(()=>{window.scrollTo(0,0)},[e]),x.useEffect(()=>{let n=null;const s=()=>{document.hidden?n=Date.now():n&&Date.now()-n>el&&window.scrollTo(0,0)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[]),null}function nl(){return console.log("[App] Rendering root component..."),t.jsx(fi,{children:t.jsx(Ka,{children:t.jsx(Ia,{children:t.jsx(xa,{children:t.jsx(gi,{children:t.jsx(Ko,{children:t.jsxs(As,{children:[t.jsx(tl,{}),t.jsxs("div",{className:"app",children:[t.jsxs(Ms,{children:[t.jsx(de,{path:"/",element:t.jsx(ir,{})}),t.jsx(de,{path:"/up-ahead",element:t.jsx(Fr,{})}),t.jsx(de,{path:"/weather",element:t.jsx(Hr,{})}),t.jsx(de,{path:"/markets",element:t.jsx(Kr,{})}),t.jsx(de,{path:"/tech-social",element:t.jsx(Vr,{})}),t.jsx(de,{path:"/newspaper",element:t.jsx(Lo,{})}),t.jsx(de,{path:"/settings",element:t.jsx(Ho,{})}),t.jsx(de,{path:"/refresh",element:t.jsx(Wo,{})}),t.jsx(de,{path:"/following",element:t.jsx(Xo,{})}),t.jsx(de,{path:"/following/:topicId",element:t.jsx(Qo,{})})]}),t.jsx(Zo,{})]})]})})})})})})})}class sl extends Dn.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){this.setState({error:n,errorInfo:s}),console.error("Uncaught error:",n,s)}render(){return this.state.hasError?t.jsxs("div",{style:{padding:"20px",color:"red",background:"#333",minHeight:"100vh"},children:[t.jsx("h1",{children:"Something went wrong."}),t.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),t.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}function il(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})})}const al=[{title:"Millions affected by Chennai floods",description:"Heavy rains in Tamil Nadu capital have caused massive flooding affecting 5 million people.",imageUrl:"https://example.com/floods.jpg",section:"chennai",publishedAt:Date.now()-3600*1e3,source:"The Hindu"},{title:"Hero rescues child from burning building",description:"A brave firefighter in Mumbai saved a child from a tragic fire, creating a moment of hope.",imageUrl:"https://youtube.com/watch?v=abc",section:"india",publishedAt:Date.now()-7200*1e3,source:"NDTV"},{title:"Tech company announces new CEO",description:"Silicon Valley startup announces John Doe as new CEO replacing the founder.",imageUrl:null,section:"technology",publishedAt:Date.now()-300*60*1e3,source:"TechCrunch"}];function rl(){const e=V();console.log(`
=== SCORING TEST (New Scoring: ${e.enableNewScoring}) ===`),al.forEach(n=>{const s={...n,sentiment:{label:"neutral"},keywords:[]},a=_t(s,n.section);console.log(`
Title: ${n.title}`),console.log(`Section: ${n.section}`),console.log(`Score: ${a.toFixed(2)}`)}),console.log(`
=================================================
`)}console.log("[Main] Application starting...");typeof window<"u"&&(window.runScoringTests=rl);il();try{const e=document.getElementById("root");if(!e)throw new Error("Root element not found");Fs.createRoot(e).render(t.jsx(x.StrictMode,{children:t.jsx(sl,{children:t.jsx(nl,{})})}))}catch(e){console.error("Critical Application Failure:",e);const n=document.getElementById("root");n&&(n.innerHTML=`
      <div style="color: red; padding: 20px; text-align: center;">
        <h1>Application Failed to Start</h1>
        <p>${e.message}</p>
        <pre>${e.stack}</pre>
      </div>
    `)}
//# sourceMappingURL=index-BB-lmb3i.js.map
