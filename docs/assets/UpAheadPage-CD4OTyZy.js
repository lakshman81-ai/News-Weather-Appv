import{D as L,p as le,l as ce,a as de,j as o}from"./index-Cu5lRAYs.js";import{b as O,L as ue}from"./vendor-react-BMB3rUHI.js";import{H as K}from"./Header-wyIJ1Xr8.js";import"./utils-sentiment-EAYl0nxh.js";function he(n="ua_watchlist"){const[e,t]=O.useState(()=>{try{return JSON.parse(localStorage.getItem(n))||[]}catch{return[]}});return{watchlist:e,toggleWatchlist:i=>{let l;e.includes(i)?l=e.filter(c=>c!==i):l=[...e,i],t(l),localStorage.setItem(n,JSON.stringify(l))},isWatched:i=>e.includes(i)}}const pe=(n,e)=>{const t=new Date,s=t.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",a=new Date(t.getTime()+3600*1e3).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",i=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${n}
DESCRIPTION:${e}
DTSTART:${s}
DTEND:${a}
END:VEVENT
END:VCALENDAR`,l=new Blob([i],{type:"text/calendar"}),c=URL.createObjectURL(l),f=document.createElement("a");f.href=c,f.download=`${n.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.ics`,f.click(),URL.revokeObjectURL(c)},se={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},V=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],U=Object.keys(se).filter(n=>n.length>2).join("|"),ge=/\b(\d{4})-(\d{1,2})-(\d{1,2})\b/,fe=/\b(\d{1,2})[/-](\d{1,2})[/-](\d{4})\b/,me=new RegExp(`\\b(${U})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s-]+(\\d{4}))?\\b`,"i"),ye=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${U})(?:[-\\s,]+(\\d{4}))?\\b`,"i"),we=new RegExp(`\\b(${U})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(${U})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),ve=new RegExp(`\\b(${U})[-\\s]+(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-|through)\\s*(\\d{1,2})(?:st|nd|rd|th)?\\b`,"i"),xe=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:to|â€“|-)\\s*(\\d{1,2})(?:st|nd|rd|th)?[-\\s]+(${U})\\b`,"i"),Se=/\bnext\s+(\d+)\s+(day|week)s?\b/,be=new RegExp(`\\b(?:ends?|last date|deadline|valid (?:till|until)|expires?|before)\\s+(?:on\\s+)?(${U})\\s+(\\d{1,2})(?:st|nd|rd|th)?(?:[,\\s]+(\\d{4}))?\\b`,"i");function M(n){return se[n.toLowerCase().slice(0,3)]??null}function $(n,e,t){const s=new Date(t.getFullYear(),n,e);return s<t&&t-s>30*864e5&&s.setFullYear(s.getFullYear()+1),s}function De(n,e){const t=n.match(ge);if(t)return{start:new Date(+t[1],+t[2]-1,+t[3]),end:null,type:"iso"};const s=n.match(fe);return s?{start:new Date(+s[3],+s[2]-1,+s[1]),end:null,type:"numeric"}:null}function Ne(n,e){const t=n.match(me);if(t){const a=M(t[1]),i=+t[2],l=t[3]?+t[3]:null;return{start:l?new Date(l,a,i):$(a,i,e),end:null,type:"named"}}const s=n.match(ye);if(s){const a=M(s[2]),i=+s[1],l=s[3]?+s[3]:null;return{start:l?new Date(l,a,i):$(a,i,e),end:null,type:"named"}}return null}function ke(n,e){const t=n.match(we);if(t)return{start:$(M(t[1]),+t[2],e),end:$(M(t[3]),+t[4],e),type:"range"};const s=n.match(ve);if(s){const i=M(s[1]);return{start:$(i,+s[2],e),end:$(i,+s[3],e),type:"range"}}const a=n.match(xe);if(a){const i=M(a[3]);return{start:$(i,+a[1],e),end:$(i,+a[2],e),type:"range"}}return null}function je(n,e){const t=n.toLowerCase();if(!/tomorrow|today|next|this|week|weekend/.test(t))return null;if(/\btomorrow\b/.test(t)){const a=new Date(e);return a.setDate(a.getDate()+1),{start:a,end:null,type:"relative"}}if(/\btoday\b/.test(t))return{start:new Date(e),end:null,type:"relative"};const s=t.match(Se);if(s){const a=+s[1],i=s[2]==="week"?7:1,l=new Date(e);return l.setDate(l.getDate()+a*i),{start:new Date(e),end:l,type:"relative"}}if(/\bnext week\b/.test(t)){const a=new Date(e);a.setDate(a.getDate()+(7-a.getDay()+1));const i=new Date(a);return i.setDate(i.getDate()+6),{start:a,end:i,type:"relative"}}for(let a=0;a<V.length;a++){if(!t.includes(V[a]))continue;if(new RegExp(`\\b(?:this|next|coming)\\s+${V[a]}\\b`,"i").test(n)){const l=new Date(e);let c=(a-l.getDay()+7)%7;return c===0&&(c=7),l.setDate(l.getDate()+c),{start:l,end:null,type:"relative"}}}if(/\bthis weekend\b/.test(t)){const a=new Date(e);a.setDate(a.getDate()+(6-a.getDay()+7)%7);const i=new Date(a);return i.setDate(i.getDate()+1),{start:a,end:i,type:"relative"}}return null}function Ce(n,e){const t=n.match(be);if(t){const s=M(t[1]),a=+t[2],i=t[3]?+t[3]:null,l=i?new Date(i,s,a):$(s,a,e);return{start:new Date(e),end:l,type:"deadline"}}return null}function Y(n,e){if(!n)return null;const t=e?new Date(e):new Date;return isNaN(t.getTime())?null:De(n)||ke(n,t)||Ce(n,t)||Ne(n,t)||je(n,t)}function Ae(n,e=14){if(!n?.start)return[];const t=[],s=new Date(n.start);s.setHours(0,0,0,0);const a=n.end?new Date(n.end):new Date(s);a.setHours(0,0,0,0);let i=new Date(s);for(;i<=a&&t.length<e;)t.push(i.toISOString().slice(0,10)),i.setDate(i.getDate()+1);return t}const R="upAhead_planner",B="upAhead_blacklist",F="/api",k={sync:async()=>{try{const n=await fetch(`${F}/blacklist`);if(n.ok){const t=await n.json(),s=k.getBlacklist(),a=new Set([...s,...t]);localStorage.setItem(B,JSON.stringify([...a]))}const e=await fetch(`${F}/user_plan`);if(e.ok){const t=await e.json(),s=localStorage.getItem(R),i={...s?JSON.parse(s):{},...t};localStorage.setItem(R,JSON.stringify(i))}console.log("[PlannerStorage] Synced with server")}catch(n){console.warn("[PlannerStorage] Sync failed",n)}},getUpcomingDays:(n=14)=>{try{const e=localStorage.getItem(R);if(!e)return[];const t=JSON.parse(e),s=new Date().toISOString().split("T")[0];return Object.entries(t).filter(([i])=>i>=s).sort((i,l)=>i[0].localeCompare(l[0])).slice(0,n).map(([i,l])=>({date:i,items:l}))}catch(e){return console.error("Failed to read planner storage",e),[]}},addItem:(n,e)=>{try{const t=localStorage.getItem(R),s=t?JSON.parse(t):{};return s[n]||(s[n]=[]),s[n].some(a=>a.id===e.id)?!1:(s[n].push(e),localStorage.setItem(R,JSON.stringify(s)),k.savePlanToApi(s),!0)}catch(t){return console.error("Failed to add item to planner",t),!1}},removeItem:(n,e)=>{try{const t=localStorage.getItem(R),s=t?JSON.parse(t):{};return s[n]?(s[n]=s[n].filter(a=>a.id!==e),s[n].length===0&&delete s[n],localStorage.setItem(R,JSON.stringify(s)),k.savePlanToApi(s),!0):!1}catch(t){return console.error("Failed to remove item",t),!1}},merge:(n,e)=>{try{const t=localStorage.getItem(R),s=t?JSON.parse(t):{};let a=!1;n.forEach(i=>{s[i]||(s[i]=[]);const l=new Set(s[i].map(c=>c.id));e.forEach(c=>{l.has(c.id)||(s[i].push(c),a=!0)})}),a&&(localStorage.setItem(R,JSON.stringify(s)),k.savePlanToApi(s))}catch(t){console.error("Merge failed",t)}},savePlanToApi:async n=>{try{await fetch(`${F}/user_plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(e){console.warn("API save plan error:",e)}},addToBlacklist:n=>{try{const e=JSON.parse(localStorage.getItem(B)||"[]");e.includes(n)||(e.push(n),localStorage.setItem(B,JSON.stringify(e)),k.saveBlacklistToApi(e))}catch(e){console.error("Failed to blacklist",e)}},getBlacklist:()=>{try{return new Set(JSON.parse(localStorage.getItem(B)||"[]"))}catch{return new Set}},saveBlacklistToApi:async n=>{try{await fetch(`${F}/blacklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(e){console.warn("API save blacklist error:",e)}}},ae="upAhead_cache";function Ee(){try{const n=localStorage.getItem(ae);if(n){const e=JSON.parse(n);return Date.now()-new Date(e.lastUpdated||0).getTime()>480*60*1e3&&console.log("[UpAheadService] Cache is older than 8 hours."),e}}catch(n){console.warn("Cache read error",n)}return null}function Te(n){try{localStorage.setItem(ae,JSON.stringify(n))}catch(e){console.warn("Cache write error",e)}}const ee=new Map;function Ie(n,e){let t=ee.get(e);if(!t){const s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t=new RegExp(`\\b${s}\\b`,"i"),ee.set(e,t)}return t.test(n)}function _e(n){let e=0;if(!n)return"0";for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e.toString()}function Re(n,e){const t=n.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");return _e(`${t}-${e}`)}function W(n,e){const t=n.toLowerCase(),s=e.toLowerCase();return e.includes(" ")?t.includes(s):Ie(t,s)}const Oe={movies:["Tamil movie release this week","new movie release OTT","BookMyShow Chennai movies","upcoming movies Kollywood","movie tickets showtimes"],events:["Chennai events this week","LiveChennai events","concert tickets Chennai","standup comedy show Chennai","exhibition workshops Chennai","things to do Chennai weekend","Muscat events this week","Muscat concerts exhibitions","theatre shows Chennai this week","art exhibition Chennai","food festival Chennai","cultural event Chennai","music sabha Chennai","Muscat Royal Opera House events"],festivals:["Maha Shivaratri 2025 date","upcoming festivals Tamil Nadu 2025","bank holidays India upcoming","public holidays Tamil Nadu","religious festivals this month India","Oman festivals holidays"],alerts:["TANGEDCO power cut Chennai tomorrow","TNEB power shutdown schedule","Chennai traffic advisory today","Chennai metro maintenance","water supply disruption Chennai","road closure Chennai"],weather_alerts:["IMD Chennai weather warning","Tamil Nadu heavy rain alert","cyclone warning Chennai","heat wave advisory Tamil Nadu","Oman weather warning Muscat"],sports:["IPL 2026 schedule matches","cricket match Chennai CSK","ISL football match schedule","Pro Kabaddi schedule","sports events Chennai this week"],shopping:["Chennai sale offers discount today","exhibition sale Chennai","Pongal sale Tamil Nadu","Diwali offers Chennai","end of season sale Chennai mall","Muscat shopping festival offers"],airlines:["Oman Air flight offers","Indigo Airlines offers","Salam Air ticket offers","Air India sale","flight ticket offers India"],civic:["VIP visit Chennai road closure","minister visit Tamil Nadu traffic","protest bandh Chennai tomorrow","Chennai corporation announcement","Muscat road closure traffic"]},te={movies:["https://www.hindustantimes.com/feeds/rss/entertainment/tamil-cinema/rssfeed.xml","https://www.hindustantimes.com/feeds/rss/entertainment/bollywood/rssfeed.xml"],sports:["https://www.espn.com/espn/rss/news"],festivals:["https://www.timeanddate.com/holidays/india/feed"],events:["https://www.thehindu.com/news/cities/chennai/feeder/default.rss"]};async function $e(){try{const t=`${"./".endsWith("/")?"./":".//"}data/up_ahead.json`,s=await fetch(t);if(!s.ok)return console.warn(`[UpAheadService] Static fetch failed: ${s.status}`),null;const a=await s.json();return a.error?(console.warn(`[UpAheadService] Static data has error: ${a.error}`),null):a}catch(n){return console.error("[UpAheadService] Static fetch exception:",n),null}}function ne(n,e){if(!n)return e;if(!e)return n;const t={...n},s=new Map;return n.timeline&&n.timeline.forEach(a=>{s.set(a.date,{...a,items:[...a.items||[]]})}),e.timeline&&e.timeline.forEach(a=>{if(!s.has(a.date))s.set(a.date,a);else{const i=s.get(a.date),l=new Set(i.items.map(c=>c.id));a.items.forEach(c=>{l.has(c.id)||(i.items.push(c),l.add(c.id))})}}),t.timeline=Array.from(s.values()).sort((a,i)=>a.date.localeCompare(i.date)),e.sections&&(t.sections||(t.sections={}),Object.keys(e.sections).forEach(a=>{const i=t.sections[a]||[],l=e.sections[a]||[],c=new Set(i.map(h=>h.title)),f=[...i];l.forEach(h=>{c.has(h.title)||(f.push(h),c.add(h.title))}),t.sections[a]=f})),t.weekly_plan=oe(t.timeline,new Set),t.lastUpdated=e.lastUpdated||n.lastUpdated,t}async function Le(n){const e=Date.now();console.log("[UpAheadService] Fetching LIVE data with settings:",n);const t=n?.categories||{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0},s=n?.locations&&n.locations.length>0?n.locations:["Chennai","India"],a=n?.keywords||L.upAhead.keywords;let i=[];const l=[],c=d=>{const g=encodeURIComponent(d);l.push({url:`https://news.google.com/rss/search?q=${g}+when:7d&hl=en-IN&gl=IN&ceid=IN:en`,type:"search",originalQuery:d})};for(const[d,g]of Object.entries(t)){if(!g)continue;te[d]&&te[d].forEach(I=>{l.push({url:I,type:"static",category:d})}),(Oe[d]||[]).forEach(I=>{d==="events"||d==="alerts"||d==="movies"?s.forEach(r=>{r.toLowerCase()==="india"&&(d==="alerts"||d==="events")||c(`${I} ${r}`)}):d==="shopping"||d==="airlines"?s.forEach(r=>{c(`${I} ${r}`)}):c(`${I}`)})}const f=[...new Map(l.map(d=>[d.url,d])).values()];console.log(`[UpAheadService] Prepared ${f.length} feeds to fetch.`);const h=f.map(async d=>{try{const{items:g}=await le.fetchViaProxy(d.url);return g.map(T=>Me(T,d,a))}catch(g){return console.warn(`[UpAheadService] Failed to fetch ${d.url}:`,g.message),[]}}),m=await Promise.allSettled(h);for(let d=0;d<m.length;d++)m[d].status==="fulfilled"?i.push(...m[d].value):console.warn("[UpAheadService] A feed failed to load:",m[d].reason);const N=We(i,n);try{for(const d of i)if(d.extractedDate){const g=Y(`${d.title} ${d.description||""}`,d.pubDate);if(g){const T=Ae(g);T.length>0&&k.merge(T,[{id:d.id,title:d.title,category:d.category,link:d.link}])}}}catch(d){console.warn("[UpAhead] Planner storage write failed",d)}const x=Date.now()-e,j=N?.timeline?.reduce((d,g)=>d+(g.items?.length||0),0)||0;return ce.success("upAhead",`LIVE: ${j} items from ${f.length} feeds`,{durationMs:x}),N}function X(n){if(!n)return"";let e=n.toString();const t={"&nbsp;":" ","&amp;":"&","&quot;":'"',"&#39;":"'","&lt;":"<","&gt;":">"};return e=e.replace(/&[a-z0-9#]+;/gi,s=>t[s]||s),e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,""),e=e.replace(/<style[^>]*>([\S\s]*?)<\/style>/gmi,""),e=e.replace(/<\/?[^>]+(>|$)/g,""),e.trim()}function Me(n,e,t=null){const s=X(n.title||""),a=n.description||"",i=X(a),l=`${s} ${i}`;let c=n.pubDate?new Date(n.pubDate):null;c&&isNaN(c.getTime())&&(c=null);let f=e.category;(!f||e.type==="search")&&(f=Pe(l,t));let h=null;const m=Y(l,c);m?.start?f==="shopping"&&m.end?h=m.end:h=m.start:h=re(l,c);let N=[],x=!1;/ott|releases|week/i.test(s)&&/\d+ new/i.test(s)&&(x=!0),x&&f==="movies"&&(N=Ue(a,c));const j=h?h.toISOString().slice(0,10):c?c.toISOString().slice(0,10):"nodate",d=Re(s,j);return{id:n.guid||n.link||s,canonicalId:d,title:s,link:n.link,description:i,pubDate:c,extractedDate:h,category:f,rawSource:e.originalQuery||"feed",isRoundup:x,subItems:N}}function Ue(n,e){const t=[],s=n.split(/<br\s*\/?>|\n|<\/li>|<\/p>|â€¢/i),a=["netflix","prime","prime video","hotstar","sony liv","zee5","jiocinema","aha","sunnxt","hulu","disney"],i=new RegExp(`\\b(${a.sort((l,c)=>c.length-l.length).join("|")})\\b`,"i");return s.forEach(l=>{const c=X(l).trim();if(c.length<5)return;const f=i.test(c),h=re(c,e);if(f||h){let m=c.replace(/^\d+\.\s*/,"").replace(/^[-\u2013\u2014]\s*/,"").replace(/\(.*\)/g,"").trim();if(m.length<3)return;const N=c.match(i),x=N?N[0]:"OTT";t.push({title:m,date:h,originalText:c,platform:x.charAt(0).toUpperCase()+x.slice(1).toLowerCase()})}}),t}function Pe(n,e=null){const t=n.toLowerCase(),s=e||L.upAhead.keywords,a=i=>i&&i.some(l=>W(t,l));return t.includes("arrest")||t.includes("held for")||t.includes("police")||t.includes("seized")||t.includes("murder")||t.includes("crime")||t.includes("jail")||t.includes("court")||t.includes("bail")||t.includes("clinic")&&t.includes("unregistered")?"general":a(s.weather_alerts)?"weather_alerts":a(s.alerts)?"alerts":a(s.movies)?(s.movies_negative||[]).some(l=>W(t,l))?"general":"movies":a(s.sports)?(s.sports_negative||[]).some(l=>W(t,l))?"general":"sports":a(s.airlines)?"airlines":a(s.shopping)?"shopping":a(s.festivals)?"festivals":a(s.civic)?"civic":a(s.events)?"events":"general"}function re(n,e){return Y(n,e)?.start||null}function We(n,e){const t=new Date;t.setHours(0,0,0,0);const s=new Map,a={movies:[],festivals:[],alerts:[],events:[],sports:[],shopping:[],civic:[],weather_alerts:[],airlines:[]},i=new Set,c=(e?.hideOlderThanHours||336)*60*60*1e3,f={weather_alerts:6,alerts:12,festivals:336},h=e?.keywords||e?.upAhead?.keywords||L.upAhead.keywords,m=r=>{let v=h.negative&&h.negative.length>0?h.negative:L.upAhead.keywords.negative;const S=`${r}_negative`,_=h[S]&&h[S].length>0?h[S]:L.upAhead.keywords[S]||[];return[...new Set([...v,..._])]},N=e?.signals||L.upAhead.signals,x={};["movies","events","festivals","alerts","sports","shopping","civic","weather_alerts","airlines"].forEach(r=>{x[r]=h[r]&&h[r].length>0?h[r]:L.upAhead.keywords[r]||[]});const d=(e?.locations||e?.upAhead?.locations||["Chennai","Muscat","Trichy"]).map(r=>r.toLowerCase());n.forEach(r=>{if(i.has(r.id)||(i.add(r.id),!r.pubDate||isNaN(r.pubDate.getTime())))return;const v=Date.now()-r.pubDate.getTime();let S=c;if(f[r.category]){const y=f[r.category]*60*60*1e3;S=Math.min(c,y)}const _=["movies","events","sports","shopping","civic","festivals","airlines"].includes(r.category),z=r.extractedDate&&r.extractedDate>=t;if(!_&&!z&&v>S)return;const C=(r.title+" "+r.description).toLowerCase(),G=/(?:â€¢|-|published)\s*(\d+)\s*(mo|month|months|w|week|weeks|y|year|years)\s*(?:ago)?/i,P=C.match(G);if(P){const y=parseInt(P[1]),D=P[2].toLowerCase();if(D.startsWith("mo")||D.startsWith("y")||D.startsWith("w")&&y>=1)return}const p=/ott|releases|week|weekend/i.test(C)&&/\d+ new/i.test(C);let u=0;const w=e?.ranking?.[r.category]||e?.upAhead?.ranking?.[r.category]||{},A=w.positiveMultiplier||1,b=w.negativeMultiplier||1,J=w.filterThreshold||0,H=x[r.category]||[],ie=m(r.category),q=H.reduce((y,D)=>W(C,D.toLowerCase())?y+1:y,0),Z=ie.reduce((y,D)=>W(C,D.toLowerCase())?y+1:y,0);u=q*A-Z*b;const Q=N.reduce((y,D)=>C.includes(D)?y+1:y,0);if(u+=Q*.5,["movies","events","shopping","airlines","sports","festivals"].includes(r.category)&&u<J||!p&&Z>0&&u<=0||_&&!r.extractedDate&&!r.isRoundup&&q===0&&Q===0||(r.category==="alerts"||r.category==="civic")&&!d.some(D=>C.includes(D)))return;if(r._forwardScore=u,r.category&&a[r.category]){if((r.category==="movies"||r.category==="events"||r.category==="festivals")&&!r.extractedDate&&!r.isRoundup||_&&!r.extractedDate&&!r.isRoundup&&u<=0)return;if(r.category==="festivals"&&r.extractedDate){if((r.extractedDate.getTime()-t.getTime())/(1e3*3600*24)<-3)return}else if(_&&r.extractedDate&&r.extractedDate<t)return;let y=null;!r.extractedDate&&["shopping","alerts","weather_alerts","civic"].includes(r.category)&&(y=r.pubDate?r.pubDate.toDateString():null);const D={title:r.title,link:r.link,releaseDate:r.extractedDate?r.extractedDate.toDateString():y,date:r.extractedDate?r.extractedDate.toDateString():y,text:r.title,severity:"medium",language:"Unknown",isRoundup:r.isRoundup,subItemsCount:r.subItems?r.subItems.length:0};a[r.category].push(D)}let E=r.extractedDate;if(!E&&(r.category==="alerts"||r.category==="weather_alerts")){const y=r.category==="weather_alerts"?12:24;if(r.pubDate&&Date.now()-r.pubDate.getTime()<y*60*60*1e3)E=t;else return}if(!E&&r.isRoundup&&(E=t),!E&&u>0&&_&&["shopping","airlines","alerts","weather_alerts","civic"].includes(r.category)&&r.pubDate&&Date.now()-r.pubDate.getTime()<2880*60*1e3&&(E=t),E&&E>=t){const y=E.toISOString().split("T")[0];s.has(y)||s.set(y,{date:y,dayLabel:Be(E),items:[]});const D={id:r.id,type:Fe(r.category),title:r.title,subtitle:r.isRoundup?`${r.subItems?.length||"Multiple"} ITEMS`:r.category.toUpperCase(),description:r.description,tags:[r.category],link:r.link,isRoundup:r.isRoundup,subItems:r.subItems,_forwardScore:r._forwardScore||0};s.get(y).items.push(D)}});const g=Array.from(s.values()).sort((r,v)=>r.date.localeCompare(v.date));g.forEach(r=>{r.items.sort((v,S)=>(S._forwardScore||0)-(v._forwardScore||0)),r.items.forEach(v=>delete v._forwardScore)}),Object.keys(a).forEach(r=>{a[r].sort((v,S)=>v.date&&S.date?new Date(v.date)-new Date(S.date):0),a[r]=a[r].slice(0,10)});const T=k.getBlacklist?k.getBlacklist():new Set,I=oe(g,T);return{timeline:g,sections:a,weekly_plan:I,lastUpdated:new Date().toISOString()}}function Be(n){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);t.setDate(t.getDate()+1);const s=new Date(n);return s.setHours(0,0,0,0),s.getTime()===e.getTime()?"Today":s.getTime()===t.getTime()?"Tomorrow":s.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}function Fe(n){return{movies:"movie",events:"event",festivals:"festival",alerts:"alert",sports:"sport",shopping:"shopping",civic:"civic",weather_alerts:"weather_alert",airlines:"airline"}[n]||"event"}function oe(n,e=new Set){const t=[],s=new Date,a=i=>{const l=["th","st","nd","rd"],c=i%100;return i+(l[(c-20)%10]||l[c]||l[0])};for(let i=0;i<7;i++){const l=new Date(s);l.setDate(s.getDate()+i);const c=l.toISOString().split("T")[0],f=l.toLocaleDateString("en-US",{weekday:"long"}),h=l.toLocaleDateString("en-US",{month:"short"}),m=l.getDate(),N=`${a(m)} ${h}`,x=n.find(d=>d.date===c);let j=[];x&&x.items.length>0&&(j=x.items.filter(g=>!(g.type==="festival"||e.has(g.id))).slice(0,10).map(g=>({id:g.id,title:g.title,type:g.type,icon:ze(g.type),link:g.link,description:g.description,isOffer:g.type==="shopping"||g.type==="airline"}))),t.push({day:f,date:N,items:j})}return t}function ze(n){return{movie:"ðŸŽ¬",event:"ðŸŽ­",festival:"ðŸŽŠ",alert:"âš ï¸",sport:"âš½",shopping:"ðŸ›’",civic:"ðŸ›ï¸",entertainment:"ðŸŽ¶",weather_alert:"ðŸŒªï¸",airline:"âœˆï¸",general:"ðŸ“…"}[n]||"ðŸ“…"}function qe(){const{settings:n}=de(),[e,t]=O.useState(null),[s,a]=O.useState(!0),[i,l]=O.useState(!1),[c,f]=O.useState(0),[h,m]=O.useState("plan"),[,N]=O.useState(k.getBlacklist?k.getBlacklist():new Set),{toggleWatchlist:x,isWatched:j}=he(),d=O.useCallback(async(p=!1)=>{if(p?(l(!0),f(1)):(a(!0),f(0)),!p){const u=Ee();u&&(t(u),a(!1),f(1))}try{const u=await $e();u&&(t(w=>ne(w,u)),p||f(2),a(!1))}catch(u){console.warn("Static fetch failed",u)}l(!0);try{const u=n.upAhead||{categories:{movies:!0,events:!0,festivals:!0,alerts:!0,sports:!0,shopping:!0,civic:!0,weather_alerts:!0,airlines:!0},locations:["Chennai"]},w=await Le(u);t(A=>{const b=ne(A,w);return Te(b),b}),f(3)}catch(u){console.error("Failed to load Live Up Ahead data",u)}finally{l(!1),a(!1)}},[n.upAhead]);O.useEffect(()=>{d(!1)},[d]);const g=p=>{p&&k.addToBlacklist&&(k.addToBlacklist(p),N(k.getBlacklist()),d(!1))},T=(p,u)=>{k.addItem(u,{id:p.id,title:p.title,category:p.tags?.[0]||"event",link:p.link,description:p.description}),alert("Added to Plan!")},I=p=>{if(!p)return"Coming Soon";const u=new Date(p);if(isNaN(u.getTime()))return p;const w=u.toLocaleDateString("en-US",{weekday:"short"}),A=u.getDate().toString().padStart(2,"0"),b=u.toLocaleDateString("en-US",{month:"short"});return`${w}, ${A} ${b}`},r=({items:p,colorClass:u,emptyMessage:w,isOffer:A=!1})=>!p||p.length===0?o.jsx("div",{className:"empty-state",children:o.jsx("p",{children:w})}):o.jsx("div",{className:"ua-wk-card",style:{border:"none",background:"transparent",padding:0},children:o.jsx("ul",{className:"ua-wk-list",children:p.map((b,J)=>{const H=I(b.date||b.releaseDate);return o.jsxs("li",{className:"ua-wk-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px",background:"var(--bg-secondary)",padding:"12px",borderRadius:"12px",marginBottom:"8px"},children:[o.jsxs("a",{href:b.link,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",flex:1,overflow:"hidden",display:"flex",alignItems:"center",gap:"8px"},children:[A&&o.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ·ï¸"}),o.jsx("span",{className:"ua-wk-text",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.95rem",fontWeight:500},children:b.title})]}),o.jsx("span",{className:`ua-wk-date ${u}`,style:{whiteSpace:"nowrap",flexShrink:0,fontSize:"0.8rem",fontWeight:600},children:H})]},J)})})});if(s&&!e)return o.jsxs("div",{className:"page-container",children:[o.jsx(K,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:c}),o.jsxs("div",{className:"loading",children:[o.jsx("div",{className:"loading__spinner"}),o.jsx("p",{children:"Scanning horizon..."})]})]});if(!e||!e.timeline||e.timeline.length===0)return o.jsxs("div",{className:"page-container",children:[o.jsx(K,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:c}),o.jsxs("div",{className:"empty-state",children:[o.jsx("span",{style:{fontSize:"3rem"},children:"ðŸ”­"}),o.jsx("h3",{children:"Nothing on the radar"}),o.jsx("p",{children:"No upcoming events found."}),o.jsx("button",{onClick:()=>d(!0),className:"btn btn--primary",style:{marginTop:"1rem"},children:"Retry Scan"}),o.jsx("div",{style:{marginTop:"0.75rem"},children:o.jsxs("small",{children:["Try adding more locations or categories in ",o.jsx(ue,{to:"/settings",style:{color:"var(--accent-primary)"},children:"Settings"}),"."]})})]})]});const v=e.sections?.weather_alerts||[],S=e.sections?.alerts||[],_=e.sections?.civic||[],z=[...v,...S,..._],C=v[0]||S[0]||null,G=v.length>0?"ðŸŒªï¸":"âš ï¸",P=v.length>0?"Weather Warning":"Worth Knowing";return o.jsxs("div",{className:"page-container up-ahead-page",children:[o.jsx(K,{title:"Up Ahead",icon:"ðŸ—“ï¸",loadingPhase:c,rightElement:i?o.jsx("div",{className:"scanning-indicator",style:{fontSize:"0.7rem",color:"var(--accent-primary)"},children:"Scanning..."}):null}),o.jsx("div",{style:{textAlign:"center",fontSize:"0.7rem",color:"var(--text-muted)",padding:"6px",background:"var(--bg-secondary)",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:i?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"loading__spinner",style:{width:"12px",height:"12px",borderWidth:"2px"}}),o.jsx("span",{children:"Scanning horizon..."})]}):o.jsxs(o.Fragment,{children:[o.jsxs("span",{children:["Live Feed â€¢ ",n.upAhead?.locations?.join(", ")||"All Locations"]}),o.jsx("button",{onClick:()=>d(!0),style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.8rem"},children:"ðŸ”„"})]})}),C&&o.jsxs("div",{className:`ua-alert-banner ${v.length>0?"weather-alert":""}`,children:[o.jsx("span",{className:"ua-alert-icon",children:G}),o.jsxs("div",{className:"ua-alert-content",children:[o.jsx("h4",{children:P}),o.jsx("p",{children:C.text})]})]}),o.jsxs("div",{className:"ua-view-toggle scrollable-tabs",children:[o.jsx("button",{className:`ua-toggle-btn ${h==="plan"?"active":""}`,onClick:()=>m("plan"),children:"Plan My Week"}),o.jsx("button",{className:`ua-toggle-btn ${h==="offers"?"active":""}`,onClick:()=>m("offers"),children:"Offers"}),o.jsx("button",{className:`ua-toggle-btn ${h==="movies"?"active":""}`,onClick:()=>m("movies"),children:"Releasing Soon"}),o.jsx("button",{className:`ua-toggle-btn ${h==="events"?"active":""}`,onClick:()=>m("events"),children:"Upcoming Events"}),o.jsx("button",{className:`ua-toggle-btn ${h==="alerts"?"active":""}`,onClick:()=>m("alerts"),children:"Alerts"}),o.jsx("button",{className:`ua-toggle-btn ${h==="festivals"?"active":""}`,onClick:()=>m("festivals"),children:"Festivals"}),o.jsx("button",{className:`ua-toggle-btn ${h==="feed"?"active":""}`,onClick:()=>m("feed"),children:"Timeline"})]}),h==="plan"&&o.jsx("div",{className:"ua-weekly-plan",children:e.weekly_plan&&Array.isArray(e.weekly_plan)?e.weekly_plan.map((p,u)=>o.jsxs("div",{className:"ua-plan-day-row",children:[o.jsx("div",{className:"ua-plan-ribbon",children:o.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:800,whiteSpace:"nowrap"},children:[p.day," ",o.jsx("span",{style:{opacity:.8,fontWeight:400},children:p.date})]})}),o.jsx("div",{className:"ua-plan-day-content",children:p.items&&p.items.length>0?p.items.map((w,A)=>o.jsxs("div",{className:"ua-plan-event-item",children:[o.jsx("button",{className:"ua-plan-delete-btn",onClick:b=>{b.preventDefault(),g(w.id)},"aria-label":"Remove event",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)",fontSize:"0.9rem",padding:"0 8px 0 0"},children:"âœ•"}),o.jsxs("a",{href:w.link,target:"_blank",rel:"noopener noreferrer",style:{flex:1,display:"flex",alignItems:"center",gap:"10px",textDecoration:"none",color:"inherit"},children:[o.jsx("span",{className:"ua-event-icon",children:w.icon}),o.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[o.jsx("span",{className:"ua-event-title",children:w.title}),w.isOffer&&o.jsx("span",{className:"ua-offer-badge",children:"ðŸ›’ Ends Today"})]})]}),o.jsx("div",{style:{display:"flex",gap:"8px"},children:o.jsx("button",{className:"ua-plan-action-btn",onClick:b=>{b.preventDefault(),pe(w.title,w.description||w.title)},title:"Add to Calendar",style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.1rem"},children:"ðŸ“…"})})]},A)):o.jsx("span",{className:"ua-plan-empty",style:{padding:"10px",color:"var(--text-muted)",fontSize:"0.9rem"},children:"-"})})]},u)):o.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"Data unavailable."})}),h==="movies"&&o.jsx("div",{className:"ua-tab-view",children:o.jsx(r,{items:e.sections?.movies,colorClass:"text-accent-info",emptyMessage:"No upcoming movie releases found."})}),h==="offers"&&o.jsxs("div",{className:"ua-tab-view",children:[o.jsx(r,{items:[...e.sections?.shopping||[],...e.sections?.airlines||[]],colorClass:"text-accent-success",emptyMessage:"No offers found.",isOffer:!0}),o.jsx("div",{style:{textAlign:"center",marginTop:"10px",fontSize:"0.8rem",color:"var(--text-muted)"},children:"Including Airline Offers"})]}),h==="events"&&o.jsx("div",{className:"ua-tab-view",children:o.jsx(r,{items:[...e.sections?.events||[],...e.sections?.sports||[]],colorClass:"text-accent-primary",emptyMessage:"No upcoming events found."})}),h==="alerts"&&o.jsx("div",{className:"ua-tab-view",children:o.jsx(r,{items:z,colorClass:"text-accent-error",emptyMessage:"No alerts found."})}),h==="festivals"&&o.jsx("div",{className:"ua-tab-view",children:o.jsx(r,{items:e.sections?.festivals,colorClass:"text-accent-warning",emptyMessage:"No festivals found."})}),h==="feed"&&o.jsx("div",{className:"ua-timeline",children:e.timeline.map(p=>o.jsxs("div",{className:"ua-day-section",children:[o.jsxs("div",{className:"ua-day-header",children:[o.jsx("div",{className:"ua-day-label",children:p.dayLabel}),o.jsx("div",{className:"ua-date-sub",children:p.date})]}),p.items?.map(u=>o.jsx("div",{className:"ua-media-card",children:o.jsxs("div",{className:"ua-media-content",children:[o.jsxs("div",{className:"ua-media-header",children:[o.jsx("span",{className:`ua-badge type-${u.type}`,children:u.type.toUpperCase()}),o.jsx("button",{className:`ua-watch-btn ${j(u.id)?"active":""}`,onClick:()=>x(u.id),children:j(u.id)?"â˜…":"â˜†"})]}),o.jsx("h3",{className:"ua-media-title",children:u.title}),o.jsx("p",{className:"ua-media-desc",children:u.description?u.description.length>100?u.description.substring(0,100)+"...":u.description:""}),o.jsxs("div",{className:"ua-media-footer",children:[u.link&&o.jsx("a",{href:u.link,target:"_blank",rel:"noopener noreferrer",className:"ua-source-link",children:"Read Source â†—"}),o.jsx("button",{className:"ua-cal-btn",onClick:()=>T(u,p.date),title:"Add to Plan My Week",children:"ðŸ“Œ Plan"})]})]})},u.id))]},p.date))})]})}export{qe as default};
//# sourceMappingURL=UpAheadPage-CD4OTyZy.js.map
